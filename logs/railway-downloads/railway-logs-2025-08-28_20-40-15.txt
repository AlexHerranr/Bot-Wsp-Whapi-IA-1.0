Starting Container

> tealquilamos-bot@1.0.0 start
> node dist/main.js

üöÄ Starting TeAlquilamos Bot...
2025-08-29T01:39:36Z [APP_STAR:unknown] sys: Iniciando TeAlquilamos Bot
‚úÖ Configuration loaded successfully
2025-08-29T01:39:36Z [CONFIG_L:unknown] sys: Configuraci√≥n cargada exitosamente
üåç Server will start on 0.0.0.0:8080
üîß DI ‚úì 5 services, 1 function
üîå hotel-plugin registering 8 functions...
‚úÖ check_availability registered
‚úÖ check_booking_details registered
‚úÖ create_new_booking registered
‚úÖ edit_booking registered
‚úÖ cancel_booking registered
‚úÖ informar_movimiento_manana registered
‚úÖ generate_booking_confirmation_pdf registered
‚úÖ generate_payment_receipt_pdf registered
üîå hotel-plugin ‚úì 8 functions registered successfully
2025-08-29T01:39:36Z [PLUGIN_R:unknown] sys: hotel-plugin ‚úì 8 functions
2025-08-29T01:39:36Z [DI_COMPL:unknown] sys: DI ‚úì 2 services, 1 function (CRM jobs de...
Cache unificado inyectado en DB service - MemoryStore eliminado
2025-08-29T01:39:36Z [WEBHOOK_:unknown] sys: WebhookRouter inicializado
2025-08-29T01:39:36Z [DATABASE:database] sys: üóÑÔ∏è Conectado a la base de datos Postgre...
2025-08-29T01:39:36Z [DATABASE:unknown] sys: Conexi√≥n exitosa a PostgreSQL
2025-08-29T01:39:36Z [SYNC_DEP:unknown] sys: Sync deprecado - Cache unificado mantien...
2025-08-29T01:39:36Z [CONTEXT_:unknown] sys: Cache limpiado post-reinicio para contex...
üîß Cleanup tasks configured
2025-08-29T01:39:36Z [SERVER_S:unknown] sys: Servidor HTTP iniciado
=== Bot TeAlquilamos Iniciado ===
üöÄ Servidor: 0.0.0.0:8080
üîó Webhook: configurando...
‚úÖ Sistema listo

üöÄ CoreBot started successfully on 0.0.0.0:8080
üìä Functions registered: 8
2025-08-29T01:39:36Z [BOT_READ:unknown] sys: Bot completamente inicializado
2025-08-29T01:40:36Z [SYS_METRIC:system] sys: mem:23/512MB cpu:0% conn:0 uptime:0h1m activeUsers:0
2025-08-29T01:40:36Z [CACHE_METRIC:cache] sys: hits:0% misses:100% size:0MB users:0 evicts:0
2025-08-29T01:40:36Z [BUFFER_METRIC:buffer] sys: active:0 merged:0 abandoned:0 voice:0 text:0
2025-08-29T01:40:36Z [USAGE_STATS:system] sys: msgs:0/hr chunks:0 avgLen:0ch funcs:0 errs:0
2025-08-29T01:40:36Z [BUFFER_METRIC:buffer] sys: active:0 merged:0 abandoned:0 voice:0 text:0
2025-08-29T01:40:41Z [WEBHOOK_:unknown] sys: Webhook enrutado
2025-08-29T01:40:41Z [WEBHOOK_:unknown] sys: Procesando webhook [MAIN]
2025-08-29T01:40:41Z [WEBHOOK:webhook] pres:1
2025-08-29T01:40:41Z [BUFFER_E:unknown] 57300...251: Evento de presencia detectado [MAIN]
2025-08-29T01:40:41Z [BUFFER_T:unknown] 57300...251: Timeout configurado por processor
‚úçÔ∏è Usuario est√° escribiendo...
2025-08-29T01:40:42Z [WEBHOOK_:unknown] sys: Webhook enrutado
2025-08-29T01:40:42Z [WEBHOOK_:unknown] sys: Procesando webhook [MAIN]
2025-08-29T01:40:42Z [WEBHOOK:webhook] msg:1
2025-08-29T01:40:42Z [RECONCIL:unknown] sys: Cliente actualizado por reconciliaci√≥n
WEBHOOK_CACHE_SYNC: Updated clientCache for 573003913251, preserving threadId: null
2025-08-29T01:40:42Z [CLIENT_U:unknown] sys: Cliente actualizado desde webhook [MAIN]
2025-08-29T01:40:42Z [DELAYED_:unknown] 57300...251: Update programado para 2min
2025-08-29T01:40:42Z [SYNC_ENR:unknown] sys: Enriquecimiento s√≠ncrono para usuario nu...
2025-08-29T01:40:42Z [SYNC_ENR:unknown] sys: Usuario enriquecido s√≠ncronamente [MAIN]
2025-08-29T01:40:42Z [MSG_RX:webhook] 57300...251: text "Hola ejecuta la func..."
üó£Ô∏è Sr Alex: üí¨ "Hola ejecuta la funci√≥n de generar PDF de confirmaci√≥n para ..." ‚Üí ü§ñ
2025-08-29T01:40:42Z [BUFFER_C:unknown] 57300...251: Buffer creado para mensaje
2025-08-29T01:40:42Z [BUFFER_S:buffer] 57300...251: Mensaje agregado, estado actual buffer
2025-08-29T01:40:42Z [BUFFER_S:unknown] 57300...251: Buffer esperando agrupaci√≥n
2025-08-29T01:40:47Z [BUFFER:buffer] 57300...251: 1msg, 79ch
2025-08-29T01:40:47Z [MESSAGE_:webhook] 57300...251: Iniciando procesamiento de buffer
2025-08-29T01:40:47Z [CACHE_HIT:cache] 57300...251
2025-08-29T01:40:47Z [CONTEXT_:unknown] 57300...251: Contexto completo enviado a OpenAI
2025-08-29T01:40:47Z [OPENAI_M:unknown] 57300...251: Mensaje preparado para OpenAI
CACHE_GET: key=573003913251, found=true, size=1
Cache HIT for thread: 573003913251
CACHE_DEBUG: threadId=null, tokenCount=0, cachedAt=Fri Aug 29 2025 01:40:47 GMT+0000 (Coordinated Universal Time)
Cache HIT but no threadId - checking BD as fallback: 573003913251
2025-08-29T01:40:47Z [DB_QUERY:database] 57300...251: type:thread_fetch time:5ms res:thread:thread_s... cache:no_change
BD HIT (cache miss) for thread: 573003913251, syncing cache
[THREAD_SOURCE:cache] 573003913251: bd:0 cache:0 thread:thread_sVLmavdNUkYmjGZtWJUxQf7j src:bd_fallback
CACHE_SET: stored for 573003913251, size: 1
CACHE_SET_DEBUG: threadId=thread_sVLmavdNUkYmjGZtWJUxQf7j, tokenCount=0
2025-08-29T01:40:48Z [OPENAI_R:unknown] 57300...251: Iniciando run de OpenAI
2025-08-29T01:40:48Z [ASSISTAN:unknown] 57300...251: Assistant seleccionado para procesamient...
2025-08-29T01:40:48Z [ASSISTAN:unknown] 57300...251: Assistant ID efectivo para procesamiento
2025-08-29T01:40:48Z [OPENAI_C:unknown] 57300...251: Estado de concurrencia OpenAI
2025-08-29T01:40:48Z [AI_START:openai] 57300...251 | null
2025-08-29T01:40:48Z [THREAD_T:unknown] sys: Token count estimado para thread
2025-08-29T01:40:48Z [THREAD_R:unknown] 57300...251: Thread reutilizado - l√≥gica simplificada
2025-08-29T01:40:49Z [OPENAI_P:unknown] 57300...251: Prompt completo compactado enviado a Ope...
[OPENAI_RAW_CONTENT] 573003913251: "Cliente: Sr Alex\nTags: Colega Jefe, TesterBot\nHora actual: 28 de ago de 2025, 8:40 p. m.\n\nMensaje..." (195ch total)
2025-08-29T01:40:49Z [OPENAI_M:openai] 57300...251: Mensaje enviado al thread de OpenAI
2025-08-29T01:40:49Z [MODEL_DE:unknown] sys: Usando configuraci√≥n por defecto del Ass...
2025-08-29T01:40:50Z [OPENAI_P:unknown] sys: Esperando respuesta - status: queued
2025-08-29T01:40:55Z [OPENAI_P:unknown] sys: Esperando respuesta - status: in_progres...
2025-08-29T01:41:02Z [OPENAI_P:unknown] sys: Esperando respuesta - status: completed
2025-08-29T01:41:03Z [AI_DONE:openai] 57300...251 | th_threa...f7j | 15s | 12952t
2025-08-29T01:41:03Z [OPENAI_R:openai] 57300...251: Respuesta completa de OpenAI
2025-08-29T01:41:03Z [TOKENS_METRIC:openai] 57300...251: in:365 out:12952 total:13317 model:o3-mini-2025-01-31 thread:th_threa...f7j
[TOKEN_SUMMARY:openai] 573003913251: bd:0 cache:365 run:+12952 total:13317 src:cache_hit
2025-08-29T01:41:03Z [TOKEN_US:unknown] 57300...251: Tokens utilizados en procesamiento
2025-08-29T01:41:03Z [HIGH_LAT:performance] 57300...251: Latencia alta detectada en procesamiento
2025-08-29T01:41:03Z [OPENAI_R:unknown] 57300...251: Run de OpenAI completado
2025-08-29T01:41:03Z [DEBUG_FU:unknown] 57300...251: FunctionCalls: false
2025-08-29T01:41:03Z [TOKEN_DB:unknown] sys: Lag significativo detectado en BD tokens
2025-08-29T01:41:03Z [TOKEN_CO:unknown] sys: üìä Token count actualizado: 573003913251...
2025-08-29T01:41:03Z [TOKEN_IM:unknown] 57300...251: Tokens actualizados inmediatamente por r...
2025-08-29T01:41:03Z [QUOTE_DE:unknown] 57300...251: Decisi√≥n de citado calculada
2025-08-29T01:41:03Z [TIMING_H:unknown] sys: Iniciando timing por chunks
2025-08-29T01:41:03Z [WHAPI_CH:whapi] 57300...net: Enviando chunk 1/1
2025-08-29T01:41:03Z [HUMAN_DE:unknown] sys: text:179ch=2000ms
2025-08-29T01:41:03Z [PRESENCE:unknown] sys: ‚úçÔ∏èch1/1:2000ms
2025-08-29T01:41:05Z [WHAPI_CH:unknown] 57300...251: Resultado env√≠o chunk
2025-08-29T01:41:05Z [WHAPI_RE:unknown] sys: Respuesta completa de WHAPI
2025-08-29T01:41:05Z [WHAPI_ID:unknown] sys: IDs colectados para chunk
2025-08-29T01:41:05Z [TIMING_H:unknown] sys: Timing humano completado
ü§ñ OpenAI ‚Üí Sr Alex (14.8s)
2025-08-29T01:41:05Z [TYPING_F:whapi] 57300...251: Flag de typing reseteado post-procesamie...
2025-08-29T01:41:05Z [SENT:webhook] 57300...251 | 179ch | 15s
2025-08-29T01:41:05Z [FLAG_RES:unknown] 57300...251: duringRunMsgId reseteado post-procesamie...
2025-08-29T01:41:06Z [WEBHOOK_:unknown] sys: Webhook enrutado
2025-08-29T01:41:06Z [WEBHOOK_:unknown] sys: Procesando webhook [MAIN]
2025-08-29T01:41:06Z [WEBHOOK:webhook] msg:1
2025-08-29T01:41:06Z [RECONCIL:unknown] sys: Cliente actualizado por reconciliaci√≥n
WEBHOOK_CACHE_SYNC: Updated clientCache for 573003913251, preserving threadId: thread_sVLmavdNUkYmjGZtWJUxQf7j
2025-08-29T01:41:06Z [CLIENT_U:unknown] sys: Cliente actualizado desde webhook [MAIN]
2025-08-29T01:41:07Z [WEBHOOK_:unknown] sys: Webhook enrutado
2025-08-29T01:41:07Z [WEBHOOK_:unknown] sys: Procesando webhook [MAIN]
2025-08-29T01:41:07Z [WEBHOOK:webhook] stat:1
2025-08-29T01:41:07Z [WEBHOOK_:unknown] sys: üì• stat:1 [MAIN]
2025-08-29T01:41:07Z [WEBHOOK_:unknown] sys: Webhook enrutado
2025-08-29T01:41:07Z [WEBHOOK_:unknown] sys: Procesando webhook [MAIN]
2025-08-29T01:41:07Z [WEBHOOK:webhook] stat:1
2025-08-29T01:41:07Z [WEBHOOK_:unknown] sys: üì• stat:1 [MAIN]
2025-08-29T01:41:27Z [WEBHOOK_:unknown] sys: Webhook enrutado
2025-08-29T01:41:27Z [WEBHOOK_:unknown] sys: Procesando webhook [MAIN]
2025-08-29T01:41:27Z [WEBHOOK:webhook] pres:1
2025-08-29T01:41:27Z [BUFFER_E:unknown] 57300...251: Evento de presencia detectado [MAIN]
2025-08-29T01:41:27Z [BUFFER_T:unknown] 57300...251: Timeout configurado por processor
‚úçÔ∏è Sr Alex est√° escribiendo...
2025-08-29T01:41:34Z [WEBHOOK_:unknown] sys: Webhook enrutado
2025-08-29T01:41:34Z [WEBHOOK_:unknown] sys: Procesando webhook [MAIN]
2025-08-29T01:41:34Z [WEBHOOK:webhook] msg:1
2025-08-29T01:41:34Z [DELAYED_:unknown] 57300...251: Timer anterior cancelado
2025-08-29T01:41:34Z [DELAYED_:unknown] 57300...251: Update programado para 2min
2025-08-29T01:41:34Z [MSG_RX:webhook] 57300...251: text "Hola ejecuta la func..."
üó£Ô∏è Sr Alex: üí¨ "Hola ejecuta la funci√≥n de generar PDF de confirmaci√≥n para ..." ‚Üí ü§ñ
2025-08-29T01:41:34Z [BUFFER_C:unknown] 57300...251: Buffer creado para mensaje
2025-08-29T01:41:34Z [BUFFER_S:buffer] 57300...251: Mensaje agregado, estado actual buffer
2025-08-29T01:41:34Z [BUFFER_S:unknown] 57300...251: Buffer esperando agrupaci√≥n
2025-08-29T01:41:36Z [SYS_METRIC:system] sys: mem:29/512MB cpu:0% conn:0 uptime:0h2m activeUsers:1
2025-08-29T01:41:36Z [CACHE_METRIC:cache] sys: hits:100% misses:0% size:0MB users:1 evicts:0
2025-08-29T01:41:36Z [BUFFER_METRIC:buffer] sys: active:0 merged:0 abandoned:0 voice:0 text:0
2025-08-29T01:41:36Z [USAGE_STATS:system] sys: msgs:1/hr chunks:0 avgLen:190ch funcs:0 errs:0
2025-08-29T01:41:36Z [LATENCY_METRIC:system] null: openai:14773ms beds24:0ms whapi:0ms db:0ms total:14773ms
2025-08-29T01:41:36Z [BUFFER_METRIC:buffer] sys: active:1 merged:0 abandoned:0 voice:0 text:0
2025-08-29T01:41:39Z [BUFFER:buffer] 57300...251: 1msg, 105ch
2025-08-29T01:41:39Z [MESSAGE_:webhook] 57300...251: Iniciando procesamiento de buffer
2025-08-29T01:41:39Z [CACHE_HIT:cache] 57300...251
2025-08-29T01:41:39Z [BURST_PR:unknown] 57300...251: Procesando burst de mensajes agrupados
2025-08-29T01:41:39Z [CONTEXT_:unknown] 57300...251: Contexto completo enviado a OpenAI
2025-08-29T01:41:39Z [OPENAI_M:unknown] 57300...251: Mensaje preparado para OpenAI
CACHE_GET: key=573003913251, found=true, size=1
Cache HIT for thread: 573003913251
CACHE_DEBUG: threadId=thread_sVLmavdNUkYmjGZtWJUxQf7j, tokenCount=12952, cachedAt=Fri Aug 29 2025 01:41:39 GMT+0000 (Coordinated Universal Time)
2025-08-29T01:41:40Z [OPENAI_R:unknown] 57300...251: Iniciando run de OpenAI
2025-08-29T01:41:40Z [ASSISTAN:unknown] 57300...251: Assistant seleccionado para procesamient...
2025-08-29T01:41:40Z [ASSISTAN:unknown] 57300...251: Assistant ID efectivo para procesamiento
2025-08-29T01:41:40Z [OPENAI_C:unknown] 57300...251: Estado de concurrencia OpenAI
2025-08-29T01:41:40Z [AI_START:openai] 57300...251 | null
2025-08-29T01:41:40Z [THREAD_T:unknown] sys: Token count estimado para thread
2025-08-29T01:41:40Z [THREAD_R:unknown] 57300...251: Thread reutilizado - l√≥gica simplificada
2025-08-29T01:41:41Z [OPENAI_P:unknown] 57300...251: Prompt completo compactado enviado a Ope...
[OPENAI_RAW_CONTENT] 573003913251: "Cliente: Sr Alex\nTags: Colega Jefe, TesterBot\nHora actual: 28 de ago de 2025, 8:41 p. m.\n\nMensaje..." (223ch total)
2025-08-29T01:41:41Z [OPENAI_M:openai] 57300...251: Mensaje enviado al thread de OpenAI
2025-08-29T01:41:41Z [MODEL_DE:unknown] sys: Usando configuraci√≥n por defecto del Ass...
2025-08-29T01:41:42Z [OPENAI_P:unknown] sys: Esperando respuesta - status: queued
2025-08-29T01:41:48Z [OPENAI_P:unknown] sys: Esperando respuesta - status: in_progres...
2025-08-29T01:41:55Z [OPENAI_P:unknown] sys: Esperando respuesta - status: in_progres...
2025-08-29T01:42:00Z [OPENAI_P:unknown] sys: Esperando respuesta - status: requires_a...
2025-08-29T01:42:00Z [RUN_REQU:unknown] sys: Run requiere action para function callin...
[1:42:00 AM] ‚ÑπÔ∏è Processing 1 function calls for Sr Alex
2025-08-29T01:42:00Z [FUNC:functions] unknown()
[1:42:00 AM] ‚öôÔ∏è generate_booking_confirmation_pdf()
2025-08-29T01:42:00Z [OPENAI_F:unknown] sys: Llamando funci√≥n desde OpenAI
2025-08-29T01:42:00Z [FUNCTION:unknown] sys: Ejecutando funci√≥n generate_booking_conf...
üîç CURRENT_VALUES_DEBUG: {
  "currentChatId": "573003913251@s.whatsapp.net",
  "currentUserId": "573003913251",
  "currentThreadId": "thread_sVLmavdNUkYmjGZtWJUxQf7j",
  "userContextResult": {
    "chatId": "573003913251@s.whatsapp.net",
    "userId": "573003913251",
    "threadId": "thread_sVLmavdNUkYmjGZtWJUxQf7j"
  }
}
2025-08-29T01:42:00Z [FUNCTION:unknown] 57300...251: Contexto pasado a funci√≥n
üîß Executing function: generate_booking_confirmation_pdf
2025-08-29T01:42:00Z [USER_CON:unknown] sys: üîç UserContext recibido en funci√≥n
2025-08-29T01:42:00Z [GENERATE:unknown] sys: üöÄ Iniciando generaci√≥n PDF para reserva...
2025-08-29T01:42:00Z [GENERATE:unknown] sys: üîç Consultando datos reales de la reserv...
2025-08-29T01:42:00Z [FETCH_BO:unknown] sys: üîç Consultando reserva directamente: 747...
2025-08-29T01:42:00Z [BEDS24_A:unknown] sys: GET https://api.beds24.com/v2/bookings?b...
2025-08-29T01:42:00Z [BEDS24:beds24] 0 rooms found
2025-08-29T01:42:00Z [BEDS24_C:beds24] sys: B√∫squeda de reservas exitosa
2025-08-29T01:42:00Z [FETCH_BO:unknown] sys: API Response structure: {"success":true,...
2025-08-29T01:42:00Z [FETCH_BO:unknown] sys: Booking espec√≠fico encontrado: {"id":747...
2025-08-29T01:42:00Z [PROCESS_:unknown] sys: Datos procesados: {"id":74793397,"name":...
2025-08-29T01:42:00Z [FETCH_BO:unknown] sys: ‚úÖ Reserva encontrada exitosamente
2025-08-29T01:42:00Z [GENERATE:unknown] sys: ‚ö†Ô∏è Canal no clasificado, permitiendo: Un...
2025-08-29T01:42:01Z [TRAN:unknown] sys: üí∞ PAYMENTS PROCESADOS: 1 pagos
2025-08-29T01:42:01Z [GENERATE:unknown] sys: üöÄ Iniciando generaci√≥n PDF para reserva...
2025-08-29T01:42:01Z [GENERATE:unknown] sys: üìã Datos procesados - Tipo: CONFIRMACI√ìN...
üîß PDF_GENERATOR_CONSTRUCTOR: {
  "cwd": "/app",
  "baseDir": "dist",
  "isBuilt": true,
  "templatePath": "/app/dist/plugins/hotel/functions/generate-booking-confirmation-pdf/templates/invoice-template.html",
  "configPath": "/app/dist/plugins/hotel/functions/generate-booking-confirmation-pdf/config/invoice-config.json",
  "templatePathType": "string",
  "configPathType": "string"
}
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: üìÅ Base directory: dist/ (built: true)
2025-08-29T01:42:01Z [PDF_LIFE:unknown] sys: üõ°Ô∏è Handlers de Graceful Shutdown regist...
2025-08-29T01:42:01Z [PDF_LIFE:unknown] sys: üöÄ PDFGeneratorService inicializado con ...
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: Generando PDF para reserva: 74793397
2025-08-29T01:42:01Z [TEMPLATE:unknown] sys: Verificando template path en Railway
2025-08-29T01:42:01Z [TEMPLATE:unknown] sys: Template cargado exitosamente (17469 cha...
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: Configuraci√≥n cargada desde: /app/dist/p...
2025-08-29T01:42:01Z [PDF_:unknown] sys: üîç CONTEXT PAYMENTITEMS: 1 items
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: Inicializando navegador Puppeteer...
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: üöÄ Railway detectado - usando Puppeteer ...
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: ‚ö†Ô∏è Error obteniendo Sparticuz Chromium: ...
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: üîÑ Fallback a Puppeteer bundled por erro...
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: üöÄ Lanzando Chromium con opciones: {"hea...
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: üîç DEBUGGING: Iniciando puppeteer.launch...
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: ‚ö†Ô∏è Launch FAILED - ERROR COMPLETO:
üî¥ PUPPETEER ERROR COMPLETO:
Message: Browser was not found at the configured executablePath (/usr/bin/chromium)
Stack: Error: Browser was not found at the configured executablePath (/usr/bin/chromium)
    at ChromeLauncher.launch (/app/node_modules/puppeteer-core/lib/cjs/puppeteer/node/BrowserLauncher.js:89:19)
    at async PDFGeneratorService.initializeBrowser (/app/dist/plugins/hotel/services/pdf-generator.service.js:174:32)
    at async PDFGeneratorService.ensureBrowserHealth (/app/dist/plugins/hotel/services/pdf-generator.service.js:240:13)
    at async PDFGeneratorService.generatePDFFromHTML (/app/dist/plugins/hotel/services/pdf-generator.service.js:492:13)
    at async PDFGeneratorService.generateInvoicePDF (/app/dist/plugins/hotel/services/pdf-generator.service.js:297:31)
    at async generateInternalPDF (/app/dist/plugins/hotel/functions/generate-booking-confirmation-pdf/generate-booking-confirmation-pdf.js:679:24)
    at async Object.generateBookingConfirmationPDF [as handler] (/app/dist/plugins/hotel/functions/generate-booking-confirmation-pdf/generate-booking-confirmation-pdf.js:498:24)
    at async /app/dist/plugins/hotel/index.js:43:32
    at async FunctionRegistryService.execute (/app/dist/core/services/function-registry.service.js:49:32)
    at async OpenAIService.executeFunctionCall (/app/dist/core/services/openai.service.js:1184:28)
Type: Error
Options used: {
  "headless": "shell",
  "args": [
    "--no-sandbox",
    "--disable-setuid-sandbox",
    "--disable-dev-shm-usage",
    "--disable-gpu",
    "--font-render-hinting=medium",
    "--disable-font-subpixel-positioning",
    "--font-render-hinting=none",
    "--disable-background-timer-throttling",
  "hasPdfBuffer": false,
    "--disable-backgrounding-occluded-windows",
Retry Message: Browser was not found at the configured executablePath (/usr/bin/chromium)
  "hasUserContext": false,
    "--disable-renderer-backgrounding",
  "userContextKeys": null,
    "--disable-ipc-flooding-protection",
Retry Stack: Error: Browser was not found at the configured executablePath (/usr/bin/chromium)
  "hasChatId": false,
  ],
    at ChromeLauncher.launch (/app/node_modules/puppeteer-core/lib/cjs/puppeteer/node/BrowserLauncher.js:89:19)
    "--disable-web-security",
  "executablePath": "/usr/bin/chromium",
  ]
    "--no-first-run",
    at async PDFGeneratorService.initializeBrowser (/app/dist/plugins/hotel/services/pdf-generator.service.js:210:40)
  "timeout": 60000,
}
    "--no-default-browser-check",
    at async PDFGeneratorService.ensureBrowserHealth (/app/dist/plugins/hotel/services/pdf-generator.service.js:240:13)
    "--disable-setuid-sandbox",
  "handleSIGINT": false,
    "--single-process",
    at async PDFGeneratorService.generatePDFFromHTML (/app/dist/plugins/hotel/services/pdf-generator.service.js:492:13)
    "--disable-extensions",
  "handleSIGTERM": false,
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: ‚ùå Error espec√≠fico en Railway generando ...
    at async PDFGeneratorService.generateInvoicePDF (/app/dist/plugins/hotel/services/pdf-generator.service.js:297:31)
    "--no-sandbox",
    "--disable-dev-shm-usage"
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: Error generando PDF: Browser was not fou...
2025-08-29T01:42:01Z [GENERATE:unknown] sys: ‚ùå Fall√≥ generaci√≥n PDF: Browser was not ...
  "handleSIGHUP": false,
    "--disable-setuid-sandbox",
2025-08-29T01:42:01Z [GENERATE:unknown] sys: ‚úÖ PDF generado exitosamente
  "dumpio": true
    "--disable-dev-shm-usage",
2025-08-29T01:42:01Z [RESULT_D:unknown] sys: Result object completo del PDF service
2025-08-29T01:42:01Z [ATTACHME:unknown] sys: Preparando attachment para response
}
    at async generateInternalPDF (/app/dist/plugins/hotel/functions/generate-booking-confirmation-pdf/generate-booking-confirmation-pdf.js:679:24)
    "--disable-background-networking",
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: üîÑ DEBUGGING: Iniciando retry con opcion...
    "--disable-default-apps",
    at async Object.generateBookingConfirmationPDF [as handler] (/app/dist/plugins/hotel/functions/generate-booking-confirmation-pdf/generate-booking-confirmation-pdf.js:498:24)
    at async OpenAIService.executeFunctionCall (/app/dist/core/services/openai.service.js:1184:28)
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: üîç RETRY OPTIONS:
üîç DIRECT_SEND_DEBUG: {
    "--disable-sync",
    at async /app/dist/plugins/hotel/index.js:43:32
Retry Options: {
2025-08-29T01:42:01Z [PDF_GENE:unknown] sys: ‚ùå RETRY TAMBI√âN FALL√ì:
  "bookingId": "74793397"
  "resultSuccess": false,
üî¥ RETRY ERROR COMPLETO:
    "--disable-translate",
    at async FunctionRegistryService.execute (/app/dist/core/services/function-registry.service.js:49:32)
  "headless": "shell",
  "hasPdfPath": false,
    "--hide-scrollbars",
}
    "--metrics-recording-only",
  "executablePath": "/usr/bin/chromium",
    "--mute-audio",
  "args": [
‚ùå DIRECT_SEND_FAILED - Condiciones NO cumplidas: {
    "--no-first-run",
    "--no-sandbox",
  "resultSuccess": false,
    "--safebrowsing-disable-auto-update",
  "hasPdfPath": false,
    "--ignore-certificate-errors",
  "hasPdfBuffer": false,
    "--ignore-ssl-errors",
  "hasUserContext": false,
    "--ignore-certificate-errors-spki-list",
  "userContextKeys": null,
    "--disable-crash-reporter",
    "--disable-breakpad",
  "hasChatId": false,
    "--crash-dumps-dir=/tmp",
  "bookingId": "74793397",
    "--enable-logging=stderr",
  "conditionCheck": {
    "--disable-logging-redirect",
    "success": false,
    "--disable-crashpad",
    "hasPdf": false,
    "--no-crash-upload",
    "hasChatId": false,
    "--disable-crash-uploads",
    "fullCondition": false
    "--disable-ipc-flooding-protection",
  }
    "--disable-client-side-phishing-detection",
    "--disable-component-update",
}
    "--disable-domain-reliability",
‚úÖ Function generate_booking_confirmation_pdf completed in 981ms
    "--font-render-hinting=none",
2025-08-29T01:42:01Z [TOOL_OUT:unknown] sys: Result antes de stringify para OpenAI
    "--disable-font-subpixel-positioning"
2025-08-29T01:42:01Z [TOOL_OUT:unknown] sys: String JSON para OpenAI generado
2025-08-29T01:42:01Z [PLUGIN_R:unknown] sys: Respuesta completa de funci√≥n enviada a ...
2025-08-29T01:42:01Z [FUNCTION:functions] sys: Funci√≥n generate_booking_confirmation_pd...
2025-08-29T01:42:01Z [OPENAI_T:unknown] sys: Enviando tool outputs exactos a OpenAI
2025-08-29T01:42:01Z [TOOL_OUT:unknown] sys: Tool outputs enviados a OpenAI
2025-08-29T01:42:02Z [OPENAI_P:unknown] sys: Esperando respuesta - status: queued
2025-08-29T01:42:07Z [OPENAI_P:unknown] sys: Esperando respuesta - status: in_progres...
2025-08-29T01:42:14Z [OPENAI_P:unknown] sys: Esperando respuesta - status: in_progres...
2025-08-29T01:42:17Z [OPENAI_P:unknown] sys: Esperando respuesta - status: completed
2025-08-29T01:42:17Z [FUNCTION:unknown] sys: Respuesta recibida despu√©s de function c...
2025-08-29T01:42:17Z [AI_DONE:openai] 57300...251 | th_threa...f7j | 37s | 
2025-08-29T01:42:17Z [OPENAI_R:openai] 57300...251: Respuesta completa de OpenAI
2025-08-29T01:42:17Z [HIGH_LAT:performance] 57300...251: Latencia alta detectada en procesamiento
2025-08-29T01:42:17Z [OPENAI_R:unknown] 57300...251: Run de OpenAI completado
2025-08-29T01:42:17Z [DEBUG_FU:unknown] 57300...251: FunctionCalls: true
2025-08-29T01:42:17Z [DEBUG_FU:unknown] 57300...251: Detalles de functionCalls
2025-08-29T01:42:17Z [ATTACHME:unknown] 57300...251: Buscando attachments en functionCalls
2025-08-29T01:42:17Z [ATTACHME:unknown] 57300...251: Analizando funcCall individual
2025-08-29T01:42:17Z [FUNCTION:unknown] 57300...251: Estructura completa del resultado
2025-08-29T01:42:17Z [TOKEN_CO:unknown] 57300...251: Token count actualizado en memoria
2025-08-29T01:42:17Z [QUOTE_DE:unknown] 57300...251: Decisi√≥n de citado calculada
2025-08-29T01:42:17Z [TIMING_H:unknown] sys: Iniciando timing por chunks
2025-08-29T01:42:17Z [WHAPI_CH:whapi] 57300...net: Enviando chunk 1/1
2025-08-29T01:42:17Z [HUMAN_DE:unknown] sys: text:187ch=2000ms
2025-08-29T01:42:17Z [PRESENCE:unknown] sys: ‚úçÔ∏èch1/1:2000ms
2025-08-29T01:42:20Z [WHAPI_CH:unknown] 57300...251: Resultado env√≠o chunk
2025-08-29T01:42:20Z [WHAPI_RE:unknown] sys: Respuesta completa de WHAPI
2025-08-29T01:42:20Z [WHAPI_ID:unknown] sys: IDs colectados para chunk
2025-08-29T01:42:20Z [TIMING_H:unknown] sys: Timing humano completado
ü§ñ OpenAI ‚Üí Sr Alex (37.4s)
2025-08-29T01:42:20Z [TYPING_F:whapi] 57300...251: Flag de typing reseteado post-procesamie...
2025-08-29T01:42:20Z [SENT:webhook] 57300...251 | 187ch | 37s
2025-08-29T01:42:20Z [FLAG_RES:unknown] 57300...251: duringRunMsgId reseteado post-procesamie...
2025-08-29T01:42:21Z [WEBHOOK_:unknown] sys: Webhook enrutado
2025-08-29T01:42:21Z [WEBHOOK_:unknown] sys: Procesando webhook [MAIN]
2025-08-29T01:42:21Z [WEBHOOK:webhook] msg:1
2025-08-29T01:42:21Z [WEBHOOK_:unknown] sys: Webhook enrutado
2025-08-29T01:42:21Z [WEBHOOK_:unknown] sys: Procesando webhook [MAIN]
2025-08-29T01:42:21Z [WEBHOOK:webhook] stat:1
2025-08-29T01:42:21Z [WEBHOOK_:unknown] sys: üì• stat:1 [MAIN]
2025-08-29T01:42:22Z [WEBHOOK_:unknown] sys: Webhook enrutado
2025-08-29T01:42:22Z [WEBHOOK_:unknown] sys: Procesando webhook [MAIN]
2025-08-29T01:42:22Z [WEBHOOK:webhook] stat:1
2025-08-29T01:42:22Z [WEBHOOK_:unknown] sys: üì• stat:1 [MAIN]
2025-08-29T01:42:36Z [SYS_METRIC:system] sys: mem:31/512MB cpu:0% conn:0 uptime:0h3m activeUsers:1
2025-08-29T01:42:36Z [CACHE_METRIC:cache] sys: hits:100% misses:0% size:0MB users:1 evicts:0
2025-08-29T01:42:36Z [BUFFER_METRIC:buffer] sys: active:0 merged:0 abandoned:0 voice:0 text:0
2025-08-29T01:42:36Z [USAGE_STATS:system] sys: msgs:2/hr chunks:0 avgLen:203ch funcs:0 errs:0
2025-08-29T01:42:36Z [LATENCY_METRIC:system] null: openai:26075ms beds24:0ms whapi:0ms db:0ms total:26075ms
2025-08-29T01:42:36Z [BUFFER_METRIC:buffer] sys: active:0 merged:0 abandoned:0 voice:0 text:0
2025-08-29T01:43:34Z [DB_QUERY:database] 57300...251: type:thread_fetch time:9ms res:thread:thread_s... cache:no_change
2025-08-29T01:43:34Z [TOKENS_S:unknown] 57300...251: Tokens acumulados
2025-08-29T01:43:34Z [THREAD_T:unknown] 57300...251: Thread reusado - tokens acumulados: 1295...
2025-08-29T01:43:34Z [RECONCIL:unknown] 57300...251: Thread activity actualizado por reconcil...
2025-08-29T01:43:34Z [THREAD_A:unknown] 57300...251: Thread activity + tokens actualizados: 5...
2025-08-29T01:43:34Z [DELAYED_:unknown] 57300...251: lastActivity + tokens actualizados
2025-08-29T01:43:36Z [SYS_METRIC:system] sys: mem:32/512MB cpu:0% conn:0 uptime:0h4m activeUsers:1
2025-08-29T01:43:36Z [CACHE_METRIC:cache] sys: hits:100% misses:0% size:0MB users:1 evicts:0
2025-08-29T01:43:36Z [BUFFER_METRIC:buffer] sys: active:0 merged:0 abandoned:0 voice:0 text:0
2025-08-29T01:43:36Z [USAGE_STATS:system] sys: msgs:2/hr chunks:0 avgLen:203ch funcs:0 errs:0
2025-08-29T01:43:36Z [LATENCY_METRIC:system] null: openai:26075ms beds24:0ms whapi:0ms db:0ms total:26075ms
2025-08-29T01:43:36Z [BUFFER_METRIC:buffer] sys: active:0 merged:0 abandoned:0 voice:0 text:0
