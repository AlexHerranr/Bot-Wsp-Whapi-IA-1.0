[2025-06-30T23:20:01.651Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-06-30T23:20:01.659Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-06-30T23:20:01.663Z] [INFO] THREAD_STATE [app.ts]: Estado inicial de threads | {"totalThreads":0,"threads":{}}
[2025-06-30T23:20:01.664Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-06-30T23:20:01.665Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-06-30T23:20:01.666Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-06-30T23:20:01.666Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-06-30T23:20:01.666Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-06-30T23:20:01.670Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"initialThreads":{}}
[2025-06-30T23:20:23.115Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:20:23.115Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:23.115Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","userName":"Alexander -"}
[2025-06-30T23:20:23.116Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola"
[2025-06-30T23:20:23.116Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251
[2025-06-30T23:20:23.116Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1)
[2025-06-30T23:20:23.116Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-06-30T23:20:29.122Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-06-30T23:20:29.124Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:29.124Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1)
[2025-06-30T23:20:29.124Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":4,"preview":"Hola..."}
[2025-06-30T23:20:29.125Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:29.125Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251"}
[2025-06-30T23:20:29.125Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:29.126Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":false,"threadId":null,"allThreads":[]}
[2025-06-30T23:20:29.126Z] [INFO] THREAD_GET [app.ts]: No existe thread para 573003913251 | {"availableThreads":[],"searchedKey":"573003913251"}
[2025-06-30T23:20:29.126Z] [INFO] THREAD_CHECK [app.ts]: No se encontró thread existente | {"userJid":"573003913251","shortUserId":"573003913251","threadId":null,"existingThreads":{}}
[2025-06-30T23:20:29.126Z] [INFO] OPENAI_REQUEST [app.ts]: creating_new_thread para 573003913251
[2025-06-30T23:20:29.808Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:29.808Z] [INFO] THREAD_PERSIST [app.ts]: Thread saved para 573003913251: thread_lIOwdqKrnvFLocBigFKcveYN
[2025-06-30T23:20:29.808Z] [INFO] THREAD_STATE [app.ts]: Estado de threads actualizado | {"totalThreads":1,"threads":{"573003913251":"thread_lIOwdqKrnvFLocBigFKcveYN"}}
[2025-06-30T23:20:29.809Z] [INFO] OPENAI_REQUEST [app.ts]: thread_created para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:20:29.809Z] [SUCCESS] THREAD_NEW [app.ts]: Nuevo thread creado para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","userJid":"573003913251","cleanedId":"573003913251"}
[2025-06-30T23:20:29.809Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:20:30.338Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:20:30.339Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","messageLength":4,"messagePreview":"Hola"}
[2025-06-30T23:20:30.339Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:20:31.381Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:20:31.381Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:31.381Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","userName":"Alexander -"}
[2025-06-30T23:20:31.382Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo"
[2025-06-30T23:20:31.382Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2)
[2025-06-30T23:20:31.382Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-06-30T23:20:31.382Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-06-30T23:20:32.284Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_XTEHDBBO8SNJpyelI0qB51Sk"}
[2025-06-30T23:20:35.167Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:20:35.401Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 6042ms
[2025-06-30T23:20:35.402Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":77,"preview":"¡Hola! ¿En qué puedo ayudarte hoy con tu reserva de apartamento en Cartagena?...","threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","messageCount":2}
[2025-06-30T23:20:35.402Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-06-30T23:20:35.402Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":77,"preview":"¡Hola! ¿En qué puedo ayudarte hoy con tu reserva de apartamento en Cartagena?..."}
[2025-06-30T23:20:37.388Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-06-30T23:20:37.389Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:37.389Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2)
[2025-06-30T23:20:37.389Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":18,"preview":"Hola\n\nComo va todo..."}
[2025-06-30T23:20:37.390Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:37.390Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251"}
[2025-06-30T23:20:37.390Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:37.390Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","allThreads":["573003913251"]}
[2025-06-30T23:20:37.391Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251: thread_lIOwdqKrnvFLocBigFKcveYN
[2025-06-30T23:20:37.391Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_lIOwdqKrnvFLocBigFKcveYN | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","existingThreads":{"573003913251":"thread_lIOwdqKrnvFLocBigFKcveYN"}}
[2025-06-30T23:20:37.391Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","userJid":"573003913251","cleanedId":"573003913251"}
[2025-06-30T23:20:37.391Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:20:37.830Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:20:37.831Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","messageLength":18,"messagePreview":"Hola\n\nComo va todo"}
[2025-06-30T23:20:37.831Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:20:38.957Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_RdvSjC1ccuJjQJj0jpvuR3AK"}
[2025-06-30T23:20:39.316Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola! ¿En qué puedo ayudarte hoy con tu reserva d..."
[2025-06-30T23:20:39.316Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-06-30T23:20:39.316Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251
[2025-06-30T23:20:39.788Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:20:39.788Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-06-30T23:20:40.137Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrVjgGqFgfNxr0-wOKFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751325640"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-06-30T23:20:41.499Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:20:41.708Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4109ms
[2025-06-30T23:20:41.708Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":71,"preview":"¡Todo bien, gracias! ¿Cómo puedo asistirte con tu reserva en Cartagena?...","threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","messageCount":4}
[2025-06-30T23:20:41.709Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-06-30T23:20:41.709Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":71,"preview":"¡Todo bien, gracias! ¿Cómo puedo asistirte con tu reserva en Cartagena?..."}
[2025-06-30T23:20:45.240Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Todo bien, gracias! ¿Cómo puedo asistirte con tu ..."
[2025-06-30T23:20:45.241Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-06-30T23:20:45.241Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251
[2025-06-30T23:20:45.791Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:20:45.791Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-06-30T23:20:46.164Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrAbVX0FUPgCig-wKOFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751325646"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-06-30T23:20:56.501Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:20:56.501Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:56.501Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","userName":"Alexander -"}
[2025-06-30T23:20:56.502Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Mi nombre"
[2025-06-30T23:20:56.502Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251
[2025-06-30T23:20:56.502Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1)
[2025-06-30T23:20:56.502Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-06-30T23:20:57.159Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:20:57.159Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:57.160Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","userName":"Alexander -"}
[2025-06-30T23:20:57.160Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Es"
[2025-06-30T23:20:57.160Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2)
[2025-06-30T23:20:57.160Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-06-30T23:20:57.160Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-06-30T23:20:59.292Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:20:59.292Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:20:59.292Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","userName":"Alexander -"}
[2025-06-30T23:20:59.293Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Alexander"
[2025-06-30T23:20:59.293Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3)
[2025-06-30T23:20:59.293Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-06-30T23:20:59.293Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-06-30T23:21:00.891Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:21:00.891Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:21:00.891Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","userName":"Alexander -"}
[2025-06-30T23:21:00.891Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Herran"
[2025-06-30T23:21:00.891Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4)
[2025-06-30T23:21:00.891Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-06-30T23:21:00.892Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-06-30T23:21:03.199Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:21:03.200Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:21:03.200Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","userName":"Alexander -"}
[2025-06-30T23:21:03.200Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Soy genren"
[2025-06-30T23:21:03.200Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 5)
[2025-06-30T23:21:03.200Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-06-30T23:21:03.200Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-06-30T23:21:06.110Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:21:06.110Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:21:06.110Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","userName":"Alexander -"}
[2025-06-30T23:21:06.110Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "De mi empresa"
[2025-06-30T23:21:06.110Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 6)
[2025-06-30T23:21:06.110Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-06-30T23:21:06.111Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-06-30T23:21:12.118Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-06-30T23:21:12.119Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:21:12.119Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 6)
[2025-06-30T23:21:12.120Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 6 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":59,"preview":"Mi nombre\n\nEs\n\nAlexander\n\nHerran\n\nSoy genren\n\nDe mi empresa..."}
[2025-06-30T23:21:12.120Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:21:12.120Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251"}
[2025-06-30T23:21:12.121Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:21:12.121Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","allThreads":["573003913251"]}
[2025-06-30T23:21:12.121Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251: thread_lIOwdqKrnvFLocBigFKcveYN
[2025-06-30T23:21:12.121Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_lIOwdqKrnvFLocBigFKcveYN | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","existingThreads":{"573003913251":"thread_lIOwdqKrnvFLocBigFKcveYN"}}
[2025-06-30T23:21:12.121Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","userJid":"573003913251","cleanedId":"573003913251"}
[2025-06-30T23:21:12.121Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:21:12.570Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:21:12.570Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","messageLength":59,"messagePreview":"Mi nombre\n\nEs\n\nAlexander\n\nHerran\n\nSoy genren\n\nDe mi empresa"}
[2025-06-30T23:21:12.570Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:21:13.585Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_LSibQpQIyRwgNzIK5ndBasJJ"}
[2025-06-30T23:21:16.155Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:21:16.358Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4035ms
[2025-06-30T23:21:16.358Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":105,"preview":"Encantado de conocerte, Alexander. ¿Cómo puedo ayudarte hoy con respecto a los apartamentos en Carta...","threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","messageCount":6}
[2025-06-30T23:21:16.358Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-06-30T23:21:16.358Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":105,"preview":"Encantado de conocerte, Alexander. ¿Cómo puedo ayudarte hoy con respecto a los apartamentos en Carta..."}
[2025-06-30T23:21:19.914Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Encantado de conocerte, Alexander. ¿Cómo puedo ayu..."
[2025-06-30T23:21:19.914Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-06-30T23:21:19.914Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251
[2025-06-30T23:21:20.677Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:21:20.678Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-06-30T23:21:20.857Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrfGUw.1lG1YmE-wLmFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751325681"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-06-30T23:21:32.495Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:21:32.495Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:21:32.495Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","userName":"Alexander -"}
[2025-06-30T23:21:32.495Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Bye"
[2025-06-30T23:21:32.495Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251
[2025-06-30T23:21:32.495Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1)
[2025-06-30T23:21:32.496Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-06-30T23:21:35.661Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-06-30T23:21:35.661Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:21:35.661Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","userName":"Alexander -"}
[2025-06-30T23:21:35.661Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ahorita hablamos"
[2025-06-30T23:21:35.661Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2)
[2025-06-30T23:21:35.661Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-06-30T23:21:35.662Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-06-30T23:21:41.664Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-06-30T23:21:41.665Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:21:41.665Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2)
[2025-06-30T23:21:41.665Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":21,"preview":"Bye\n\nAhorita hablamos..."}
[2025-06-30T23:21:41.666Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:21:41.666Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251"}
[2025-06-30T23:21:41.667Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-06-30T23:21:41.667Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","allThreads":["573003913251"]}
[2025-06-30T23:21:41.668Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251: thread_lIOwdqKrnvFLocBigFKcveYN
[2025-06-30T23:21:41.668Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_lIOwdqKrnvFLocBigFKcveYN | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","existingThreads":{"573003913251":"thread_lIOwdqKrnvFLocBigFKcveYN"}}
[2025-06-30T23:21:41.668Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","userJid":"573003913251","cleanedId":"573003913251"}
[2025-06-30T23:21:41.668Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:21:42.053Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:21:42.054Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN","messageLength":21,"messagePreview":"Bye\n\nAhorita hablamos"}
[2025-06-30T23:21:42.054Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_lIOwdqKrnvFLocBigFKcveYN"}
[2025-06-30T23:21:43.205Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_imTwazC3ideQJONx73k8mrRG"}
[2025-06-30T23:21:51.898Z] [INFO] OPENAI_POLLING [app.ts]: Esperando respuesta para 573003913251, intento 10/60, estado: queued
[2025-06-30T23:22:05.101Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-06-30T23:22:05.108Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-06-30T23:22:05.110Z] [INFO] THREAD_STATE [app.ts]: Estado inicial de threads | {"totalThreads":0,"threads":{}}
[2025-06-30T23:22:05.111Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-06-30T23:22:05.112Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-06-30T23:22:05.113Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-06-30T23:22:05.114Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-06-30T23:22:05.114Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-06-30T23:22:05.120Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"initialThreads":{}}
[2025-06-30T23:22:58.812Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-06-30T23:22:58.818Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-06-30T23:22:58.820Z] [INFO] THREAD_STATE [app.ts]: Estado inicial de threads | {"totalThreads":0,"threads":{}}
[2025-06-30T23:22:58.821Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-06-30T23:22:58.821Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-06-30T23:22:58.822Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-06-30T23:22:58.822Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-06-30T23:22:58.823Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-06-30T23:22:58.828Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"initialThreads":{}}
[2025-06-30T23:38:31.769Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-06-30T23:38:31.855Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-06-30T23:38:31.859Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-06-30T23:38:31.859Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-06-30T23:38:31.860Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":1000}
[2025-06-30T23:38:31.861Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-06-30T23:38:31.861Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-06-30T23:38:31.863Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-06-30T23:38:31.863Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-06-30T23:38:31.864Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-06-30T23:38:31.870Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":1000}}
[2025-06-30T23:38:31.779Z] [SUCCESS] THREAD_PERSIST [threadPersistence.ts]: 1 threads cargados desde archivo
[2025-06-30T23:38:31.850Z] [INFO] THREAD_DEBUG [threadPersistence.ts]: Thread cargado: 573003913251 (Alexander) -> thread_iGJlkyZND0iuKp5h7J1d0QY1 (2 mensajes)
[2025-06-30T23:38:31.850Z] [INFO] THREAD_PERSIST [threadPersistence.ts]: Auto-guardado optimizado configurado cada 5 minutos
[2025-06-30T23:38:47.145Z] [INFO] HEALTH_CHECK [app.ts]: Health check solicitado | {"status":"Bot funcionando","timestamp":"2025-06-30T23:38:47.145Z","version":"simple","activeThreads":1,"activeBuffers":0,"threadStats":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":1000}}
[2025-06-30T23:38:50.586Z] [INFO] HEALTH_CHECK [app.ts]: Health check solicitado | {"status":"Bot funcionando","timestamp":"2025-06-30T23:38:50.586Z","version":"simple","activeThreads":1,"activeBuffers":0,"threadStats":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":1000}}
[2025-06-30T23:39:14.237Z] [INFO] HEALTH_CHECK [app.ts]: Health check solicitado | {"status":"Bot funcionando","timestamp":"2025-06-30T23:39:14.237Z","version":"simple","activeThreads":1,"activeBuffers":0,"threadStats":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":1000}}
[2025-06-30T23:45:19.299Z] [SUCCESS] THREAD_PERSIST [threadPersistence.ts]: 1 threads cargados desde archivo
[2025-06-30T23:45:19.322Z] [INFO] THREAD_DEBUG [threadPersistence.ts]: Thread cargado: 573003913251 (Alexander) -> thread_iGJlkyZND0iuKp5h7J1d0QY1 (2 mensajes)
[2025-06-30T23:45:19.323Z] [INFO] THREAD_PERSIST [threadPersistence.ts]: Auto-guardado optimizado configurado cada 5 minutos
[2025-06-30T23:45:19.288Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-06-30T23:45:19.326Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-06-30T23:45:19.331Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-06-30T23:45:19.332Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-06-30T23:45:19.333Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":1000}
[2025-06-30T23:45:19.334Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-06-30T23:45:19.335Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-06-30T23:45:19.336Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-06-30T23:45:19.337Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-06-30T23:45:19.338Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-06-30T23:45:19.344Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":1000}}
[2025-06-30T23:45:20.283Z] [SUCCESS] THREAD_PERSIST [threadPersistence.ts]: 1 threads cargados desde archivo
[2025-06-30T23:45:20.303Z] [INFO] THREAD_DEBUG [threadPersistence.ts]: Thread cargado: 573003913251 (Alexander) -> thread_iGJlkyZND0iuKp5h7J1d0QY1 (2 mensajes)
[2025-06-30T23:45:20.304Z] [INFO] THREAD_PERSIST [threadPersistence.ts]: Auto-guardado optimizado configurado cada 5 minutos
[2025-06-30T23:45:20.274Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-06-30T23:45:20.307Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-06-30T23:45:20.310Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-06-30T23:45:20.311Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-06-30T23:45:20.311Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":1000}
[2025-06-30T23:45:20.312Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-06-30T23:45:20.312Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-06-30T23:45:20.313Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-06-30T23:45:20.314Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-06-30T23:45:20.315Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-06-30T23:45:20.321Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":1000}}
[2025-07-01T00:11:58.966Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:11:58.998Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:11:59.001Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:11:59.001Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:11:59.002Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":1000}
[2025-07-01T00:11:59.002Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-07-01T00:11:59.002Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:11:59.003Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:11:59.004Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:11:59.004Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:11:59.008Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":1000}}
[2025-07-01T00:13:49.909Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:13:49.946Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:13:49.952Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:13:49.952Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:13:49.953Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}
[2025-07-01T00:13:49.953Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-07-01T00:13:49.953Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:13:49.954Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:13:49.955Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:13:49.955Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:13:49.959Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}}
[2025-07-01T00:18:05.596Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:18:05.636Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:18:05.639Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:18:05.640Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:18:05.641Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}
[2025-07-01T00:18:05.642Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-07-01T00:18:05.642Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:18:05.644Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:18:05.645Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:18:05.646Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:18:05.652Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}}
[2025-07-01T00:20:52.370Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:20:52.406Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:20:52.408Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:20:52.408Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:20:52.409Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}
[2025-07-01T00:20:52.409Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-07-01T00:20:52.409Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:20:52.410Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:20:52.411Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:20:52.412Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:20:52.416Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}}
[2025-07-01T00:21:05.623Z] [INFO] HEALTH_CHECK [app.ts]: Health check solicitado | {"status":"Bot funcionando","timestamp":"2025-07-01T00:21:05.623Z","version":"simple","activeThreads":1,"activeBuffers":0,"threadStats":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}}
[2025-07-01T00:22:21.308Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:22:21.340Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:22:21.342Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:22:21.343Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:22:21.344Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}
[2025-07-01T00:22:21.345Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-07-01T00:22:21.346Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:22:21.348Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:22:21.348Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:22:21.349Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:22:21.355Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}}
[2025-07-01T00:23:22.149Z] [INFO] HEALTH_CHECK [app.ts]: Health check solicitado | {"status":"Bot funcionando","timestamp":"2025-07-01T00:23:22.149Z","version":"simple","activeThreads":1,"activeBuffers":0,"threadStats":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}}
[2025-07-01T00:25:31.254Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:25:31.285Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:25:31.288Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:25:31.288Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:25:31.289Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}
[2025-07-01T00:25:31.290Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-07-01T00:25:31.290Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:25:31.291Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:25:31.292Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:25:31.293Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:25:31.297Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}}
[2025-07-01T00:25:38.716Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:25:38.717Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:25:38.717Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:25:38.718Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:25:38.718Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Fjfj"
[2025-07-01T00:25:38.719Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251
[2025-07-01T00:25:38.719Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1)
[2025-07-01T00:25:38.719Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:25:39.822Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:25:39.856Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:25:39.859Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:25:39.860Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:25:39.861Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}
[2025-07-01T00:25:39.861Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-07-01T00:25:39.862Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:25:39.863Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:25:39.864Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:25:39.865Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:25:39.869Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}}
[2025-07-01T00:25:44.391Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:25:44.392Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:25:44.392Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:25:44.392Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:25:44.393Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Gjgkg"
[2025-07-01T00:25:44.393Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251
[2025-07-01T00:25:44.393Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1)
[2025-07-01T00:25:44.393Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:25:46.403Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:25:46.403Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:25:46.404Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:25:46.404Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:25:46.404Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Jfig"
[2025-07-01T00:25:46.404Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2)
[2025-07-01T00:25:46.404Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:25:46.405Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:25:47.551Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:25:47.552Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:25:47.552Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:25:47.552Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:25:47.552Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ruri"
[2025-07-01T00:25:47.553Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3)
[2025-07-01T00:25:47.553Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:25:47.553Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:25:50.127Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:25:50.127Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:25:50.128Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:25:50.128Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:25:50.128Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola"
[2025-07-01T00:25:50.128Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4)
[2025-07-01T00:25:50.128Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:25:50.129Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:25:52.524Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:25:52.525Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:25:52.525Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:25:52.525Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:25:52.525Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo"
[2025-07-01T00:25:52.526Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 5)
[2025-07-01T00:25:52.526Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:25:52.526Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:25:57.608Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:25:57.609Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:25:57.609Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:25:57.609Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:25:57.609Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola"
[2025-07-01T00:25:57.610Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 6)
[2025-07-01T00:25:57.610Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:25:57.610Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:26:03.356Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:26:03.356Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:26:03.356Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:26:03.357Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:26:03.357Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Que tal"
[2025-07-01T00:26:03.357Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 7)
[2025-07-01T00:26:03.357Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:26:03.357Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:26:09.364Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T00:26:09.366Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:26:09.366Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 7)
[2025-07-01T00:26:09.367Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 7 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":52,"preview":"Gjgkg\n\nJfig\n\nRuri\n\nHola\n\nComo va todo\n\nHola\n\nQue tal..."}
[2025-07-01T00:26:09.367Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:26:09.368Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T00:26:09.368Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:26:09.369Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-06-30T21:45:35.161Z","messageCount":2,"previousThreads":[]}}
[2025-07-01T00:26:09.369Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z"}
[2025-07-01T00:26:09.369Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T00:26:09.369Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T00:26:09.370Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:26:10.214Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:26:10.214Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":52,"messagePreview":"Gjgkg\n\nJfig\n\nRuri\n\nHola\n\nComo va todo\n\nHola\n\nQue tal"}
[2025-07-01T00:26:10.215Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:26:12.070Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_PQ3DiYHC33H2NKWOPAVbCkZg"}
[2025-07-01T00:26:14.848Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:26:15.636Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5480ms
[2025-07-01T00:26:15.637Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":138,"preview":"¡Hola de nuevo! Estoy aquí para ayudarte a reservar apartamentos en Cartagena. ¿Tienes alguna pregun...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":4}
[2025-07-01T00:26:15.637Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T00:26:15.637Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":138,"preview":"¡Hola de nuevo! Estoy aquí para ayudarte a reservar apartamentos en Cartagena. ¿Tienes alguna pregun..."}
[2025-07-01T00:26:19.872Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola de nuevo! Estoy aquí para ayudarte a reserva..."
[2025-07-01T00:26:19.872Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T00:26:19.873Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251
[2025-07-01T00:26:20.708Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:26:20.708Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T00:26:20.807Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psrzw.6lb85LpQo-wCeFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751329581"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T00:28:32.931Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:28:32.967Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:28:32.970Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:28:32.970Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:28:32.971Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}
[2025-07-01T00:28:32.971Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-07-01T00:28:32.971Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:28:32.972Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:28:32.973Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:28:32.973Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:28:32.977Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2,"maxMessagesPerThread":5000}}
[2025-07-01T00:28:42.041Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:28:42.076Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:28:42.080Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:28:42.081Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:28:42.082Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2}
[2025-07-01T00:28:42.082Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-07-01T00:28:42.083Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:28:42.084Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:28:42.084Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:28:42.085Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:28:42.088Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2}}
[2025-07-01T00:28:45.541Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:28:45.575Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:28:45.580Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:28:45.580Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:28:45.581Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2}
[2025-07-01T00:28:45.581Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-07-01T00:28:45.582Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:28:45.582Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:28:45.583Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:28:45.584Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:28:45.587Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2}}
[2025-07-01T00:28:54.004Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:28:54.038Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:28:54.041Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:28:54.042Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:28:54.042Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2}
[2025-07-01T00:28:54.043Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"totalMessages":2,"averageMessagesPerThread":2,"activeThreads":1,"threadsNeedingRotation":0}
[2025-07-01T00:28:54.044Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:28:54.046Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:28:54.046Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:28:54.047Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:28:54.050Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1,"threadsNeedingRotation":0,"totalMessages":2,"averageMessagesPerThread":2}}
[2025-07-01T00:28:59.643Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:28:59.677Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:28:59.681Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:28:59.681Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:28:59.682Z] [ERROR] THREADS_LOAD [app.ts]: Error cargando threads: this.needsRotation is not a function | {"error":"TypeError: this.needsRotation is not a function\n    at ThreadPersistenceManager.getStats (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\utils\\persistence\\threadPersistence.ts:265:22)\n    at main (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:559:45)\n    at <anonymous> (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:654:1)\n    at ModuleJob.run (node:internal/modules/esm/module_job:274:25)\n    at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:644:26)\n    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)"}
[2025-07-01T00:28:59.683Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:28:59.684Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:28:59.684Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:28:59.688Z] [ERROR] SYSTEM [unknown.ts]: Uncaught Exception | {"error":"this.needsRotation is not a function","stack":"TypeError: this.needsRotation is not a function\n    at ThreadPersistenceManager.getStats (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\utils\\persistence\\threadPersistence.ts:265:22)\n    at Server.<anonymous> (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:606:45)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitListeningNT (node:net:1982:10)\n    at process.processTicksAndRejections (node:internal/process/task_queues:89:21)"}
[2025-07-01T00:29:06.119Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:29:06.172Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:29:06.182Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:29:06.183Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:29:06.183Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T00:29:06.184Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T00:29:06.186Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:29:06.187Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:29:06.188Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:29:06.191Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:29:06.198Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T00:29:11.665Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:29:11.699Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:29:11.702Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:29:11.702Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:29:11.702Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T00:29:11.703Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T00:29:11.703Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","messageCount":2,"lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:29:11.704Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:29:11.705Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:29:11.705Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:29:11.710Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T00:29:15.475Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:29:15.508Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:29:15.510Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:29:15.511Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:29:15.511Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T00:29:15.512Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T00:29:15.512Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:29:15.513Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:29:15.514Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:29:15.515Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:29:15.518Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T00:29:39.682Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:29:39.720Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:29:39.725Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:29:39.725Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:29:39.726Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T00:29:39.726Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T00:29:39.727Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:29:39.728Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:29:39.729Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:29:39.729Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:29:39.733Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T00:29:41.571Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:29:41.605Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:29:41.608Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:29:41.608Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:29:41.609Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T00:29:41.609Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T00:29:41.610Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:29:41.611Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:29:41.612Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:29:41.612Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:29:41.616Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T00:29:44.538Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:29:44.575Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:29:44.578Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:29:44.578Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:29:44.579Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T00:29:44.579Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T00:29:44.579Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:29:44.580Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:29:44.581Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:29:44.581Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:29:44.584Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T00:29:46.498Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:29:46.530Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:29:46.534Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:29:46.534Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:29:46.535Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T00:29:46.535Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T00:29:46.536Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:29:46.537Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:29:46.538Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:29:46.538Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:29:46.543Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T00:30:20.928Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:30:20.929Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:30:20.929Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:30:20.929Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:30:20.930Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola"
[2025-07-01T00:30:20.930Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251
[2025-07-01T00:30:20.930Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1)
[2025-07-01T00:30:20.930Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:30:23.416Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:30:23.416Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:30:23.416Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:30:23.416Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:30:23.417Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como"
[2025-07-01T00:30:23.417Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2)
[2025-07-01T00:30:23.417Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:30:23.417Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:30:24.455Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:30:24.456Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:30:24.456Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:30:24.456Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:30:24.456Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va"
[2025-07-01T00:30:24.457Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3)
[2025-07-01T00:30:24.457Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:30:24.457Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:30:25.739Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:30:25.740Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:30:25.740Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:30:25.740Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:30:25.740Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Todo"
[2025-07-01T00:30:25.740Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4)
[2025-07-01T00:30:25.741Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:30:25.741Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:30:31.753Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T00:30:31.754Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:30:31.754Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 4)
[2025-07-01T00:30:31.754Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 4 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":20,"preview":"Hola\n\nComo\n\nVa\n\nTodo..."}
[2025-07-01T00:30:31.754Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:30:31.755Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T00:30:31.755Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:30:31.755Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-06-30T21:45:35.161Z","messageCount":2,"previousThreads":[]}}
[2025-07-01T00:30:31.756Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-06-30T21:45:35.161Z"}
[2025-07-01T00:30:31.756Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T00:30:31.756Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T00:30:31.757Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:30:32.795Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:30:32.795Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":20,"messagePreview":"Hola\n\nComo\n\nVa\n\nTodo"}
[2025-07-01T00:30:32.796Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:30:34.672Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_ewuM5IiSYehtVDmXYrT8aVbI"}
[2025-07-01T00:30:36.797Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:30:37.000Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5042ms
[2025-07-01T00:30:37.001Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":92,"preview":"¡Hola! Todo va bien aquí. ¿Cómo puedo ayudarte con tu búsqueda de apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":6}
[2025-07-01T00:30:37.001Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T00:30:37.002Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":92,"preview":"¡Hola! Todo va bien aquí. ¿Cómo puedo ayudarte con tu búsqueda de apartamentos en Cartagena?..."}
[2025-07-01T00:30:40.734Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola! Todo va bien aquí. ¿Cómo puedo ayudarte con..."
[2025-07-01T00:30:40.734Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T00:30:40.735Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251
[2025-07-01T00:30:41.546Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:30:41.546Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T00:30:41.801Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsogoPbh6gR5nGY-wCWFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751329842"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T00:31:00.102Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:31:00.135Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:31:00.139Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:31:00.139Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:31:00.141Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T00:31:00.141Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T00:31:00.142Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-06-30T21:45:35.161Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:31:00.143Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:31:00.144Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:31:00.145Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:31:00.149Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T00:31:06.494Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:31:06.495Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:31:06.495Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:31:06.496Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:31:06.496Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola"
[2025-07-01T00:31:06.497Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251
[2025-07-01T00:31:06.497Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1)
[2025-07-01T00:31:06.497Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:31:11.466Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:31:11.466Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:31:11.466Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:31:11.466Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:31:11.467Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo"
[2025-07-01T00:31:11.467Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2)
[2025-07-01T00:31:11.467Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:31:11.467Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:31:17.482Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T00:31:17.483Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:31:17.484Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2)
[2025-07-01T00:31:17.484Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":18,"preview":"Hola\n\nComo va todo..."}
[2025-07-01T00:31:17.485Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:31:17.485Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T00:31:17.486Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:31:17.486Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-06-30T21:45:35.161Z","messageCount":2,"previousThreads":[]}}
[2025-07-01T00:31:17.486Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-06-30T21:45:35.161Z"}
[2025-07-01T00:31:17.486Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T00:31:17.487Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T00:31:17.487Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:31:18.161Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:31:18.161Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":18,"messagePreview":"Hola\n\nComo va todo"}
[2025-07-01T00:31:18.162Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:31:19.458Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_GXUYM9kXfwAGEPYSi6WQWMZM"}
[2025-07-01T00:31:22.082Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:31:22.281Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4597ms
[2025-07-01T00:31:22.281Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":97,"preview":"¡Hola! Todo bien por aquí. ¿Cómo puedo asistirte hoy en tu búsqueda de apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":8}
[2025-07-01T00:31:22.282Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T00:31:22.283Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":97,"preview":"¡Hola! Todo bien por aquí. ¿Cómo puedo asistirte hoy en tu búsqueda de apartamentos en Cartagena?..."}
[2025-07-01T00:31:26.388Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola! Todo bien por aquí. ¿Cómo puedo asistirte h..."
[2025-07-01T00:31:26.389Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T00:31:26.389Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251
[2025-07-01T00:31:27.163Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:31:27.163Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T00:31:27.454Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psou6dSdO0d1Jfs-wFSFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751329888"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T00:37:15.371Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:37:15.372Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:37:15.372Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:37:15.372Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:37:15.373Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Sabes mi nomrbe"
[2025-07-01T00:37:15.373Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251
[2025-07-01T00:37:15.373Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1)
[2025-07-01T00:37:15.373Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:37:21.382Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T00:37:21.383Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:37:21.383Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1)
[2025-07-01T00:37:21.384Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":15,"preview":"Sabes mi nomrbe..."}
[2025-07-01T00:37:21.384Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:37:21.384Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T00:37:21.385Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:37:21.385Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T00:31:18.160Z","previousThreads":[]}}
[2025-07-01T00:37:21.385Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:31:18.160Z"}
[2025-07-01T00:37:21.386Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T00:37:21.386Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T00:37:21.386Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:37:22.041Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:37:22.041Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":15,"messagePreview":"Sabes mi nomrbe"}
[2025-07-01T00:37:22.041Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:37:23.308Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_62OIJfcms4dMJLZIIqyyrDu9"}
[2025-07-01T00:37:26.323Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:37:26.533Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4939ms
[2025-07-01T00:37:26.533Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":77,"preview":"Lo siento, no tengo acceso a esa información. ¿Cómo te gustaría que te llame?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":10}
[2025-07-01T00:37:26.533Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T00:37:26.533Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":77,"preview":"Lo siento, no tengo acceso a esa información. ¿Cómo te gustaría que te llame?..."}
[2025-07-01T00:37:30.428Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Lo siento, no tengo acceso a esa información. ¿Cóm..."
[2025-07-01T00:37:30.428Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T00:37:30.429Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251
[2025-07-01T00:37:31.247Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:37:31.247Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T00:37:32.174Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqIltbLGseTHgk-wPeFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751330252"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T00:37:32.337Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqIltbLGseTHgk-wPeFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751330253"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T00:37:36.297Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:37:36.298Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:37:36.298Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:37:36.298Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:37:36.298Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Mi nombre es Alexander"
[2025-07-01T00:37:36.298Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251
[2025-07-01T00:37:36.299Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1)
[2025-07-01T00:37:36.299Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:37:42.309Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T00:37:42.310Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:37:42.310Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1)
[2025-07-01T00:37:42.311Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":22,"preview":"Mi nombre es Alexander..."}
[2025-07-01T00:37:42.311Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:37:42.311Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T00:37:42.312Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:37:42.312Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T00:37:22.040Z","previousThreads":[]}}
[2025-07-01T00:37:42.313Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:37:22.040Z"}
[2025-07-01T00:37:42.313Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T00:37:42.314Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T00:37:42.314Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:37:42.855Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:37:42.855Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":22,"messagePreview":"Mi nombre es Alexander"}
[2025-07-01T00:37:42.855Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:37:44.087Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_DHWQuGNz7BPDmBSldn1UZlkQ"}
[2025-07-01T00:37:46.504Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:37:47.069Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4193ms
[2025-07-01T00:37:47.069Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":107,"preview":"¡Encantado de conocerte, Alexander! ¿Cómo puedo ayudarte hoy con la reserva de un apartamento en Car...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":12}
[2025-07-01T00:37:47.069Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T00:37:47.069Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":107,"preview":"¡Encantado de conocerte, Alexander! ¿Cómo puedo ayudarte hoy con la reserva de un apartamento en Car..."}
[2025-07-01T00:37:50.770Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Encantado de conocerte, Alexander! ¿Cómo puedo ay..."
[2025-07-01T00:37:50.770Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T00:37:50.770Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251
[2025-07-01T00:37:51.567Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:37:51.567Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T00:37:52.698Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psqc6.WRJN40ZVc-wKeFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751330273"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T00:38:17.791Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:38:17.823Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:38:17.827Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:38:17.827Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:38:17.828Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T00:38:17.829Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T00:38:17.829Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:31:18.160Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:38:17.830Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:38:17.831Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:38:17.832Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:38:17.837Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T00:38:23.295Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:38:23.296Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:38:23.296Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:38:23.296Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:38:23.297Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hol"
[2025-07-01T00:38:23.297Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251
[2025-07-01T00:38:23.297Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1)
[2025-07-01T00:38:23.297Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:38:29.299Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T00:38:29.300Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:38:29.300Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1)
[2025-07-01T00:38:29.300Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":3,"preview":"Hol..."}
[2025-07-01T00:38:29.301Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:38:29.301Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T00:38:29.301Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:38:29.301Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T00:31:18.160Z","previousThreads":[]}}
[2025-07-01T00:38:29.302Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:31:18.160Z"}
[2025-07-01T00:38:29.302Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T00:38:29.302Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T00:38:29.302Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:38:30.428Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:38:30.429Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":3,"messagePreview":"Hol"}
[2025-07-01T00:38:30.429Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:38:32.341Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_ffBTlfynNvLyQMIRuLHSq9Zp"}
[2025-07-01T00:38:35.162Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:38:35.392Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5861ms
[2025-07-01T00:38:35.392Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":87,"preview":"¡Hola, Alexander! ¿Necesitas ayuda con algo específico sobre apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":14}
[2025-07-01T00:38:35.393Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T00:38:35.393Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":87,"preview":"¡Hola, Alexander! ¿Necesitas ayuda con algo específico sobre apartamentos en Cartagena?..."}
[2025-07-01T00:38:39.152Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! ¿Necesitas ayuda con algo especí..."
[2025-07-01T00:38:39.152Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T00:38:39.153Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251
[2025-07-01T00:38:39.944Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:38:39.944Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T00:38:40.188Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqkIBMtSzlKKvc-wFaFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751330320"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T00:38:57.515Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:38:57.515Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:38:57.515Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:38:57.515Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:38:57.515Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Gracias"
[2025-07-01T00:38:57.516Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251
[2025-07-01T00:38:57.516Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1)
[2025-07-01T00:38:57.516Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:49:28.550Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:49:28.590Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:49:28.593Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:49:28.593Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:49:28.594Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T00:49:28.594Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T00:49:28.595Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:31:18.160Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:49:28.595Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:49:28.596Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:49:28.596Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:49:28.601Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T00:49:29.799Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T00:49:29.836Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T00:49:29.841Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T00:49:29.841Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T00:49:29.842Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T00:49:29.842Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T00:49:29.843Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:31:18.160Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T00:49:29.844Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T00:49:29.844Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T00:49:29.845Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T00:49:29.850Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T00:49:46.194Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:49:46.195Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:49:46.195Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:49:46.195Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:49:46.195Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola q tal" | {"userName":"Alexander","preview":"Hola q tal"}
[2025-07-01T00:49:46.196Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T00:49:46.196Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T00:49:46.196Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:49:52.094Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:49:52.095Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:49:52.095Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:49:52.095Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:49:52.095Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo" | {"userName":"Alexander","preview":"Como va todo"}
[2025-07-01T00:49:52.095Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T00:49:52.095Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:49:52.096Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:49:58.107Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T00:49:58.108Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:49:58.108Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T00:49:58.109Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":24,"preview":"Hola q tal\n\nComo va todo..."}
[2025-07-01T00:49:58.109Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:49:58.109Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T00:49:58.109Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:49:58.110Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T00:31:18.160Z","previousThreads":[]}}
[2025-07-01T00:49:58.110Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:31:18.160Z"}
[2025-07-01T00:49:58.110Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T00:49:58.110Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T00:49:58.110Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:49:58.955Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:49:58.956Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":24,"messagePreview":"Hola q tal\n\nComo va todo"}
[2025-07-01T00:49:58.956Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:50:00.232Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_t5OXx5tIaWsYAZolo9giVCDk"}
[2025-07-01T00:50:02.727Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:50:03.024Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4618ms | {"duration":4618,"userName":"Alexander"}
[2025-07-01T00:50:03.025Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":110,"preview":"¡Hola, Alexander! Todo bien, gracias. ¿En qué puedo ayudarte hoy con respecto a los apartamentos en ...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":16,"userName":"Alexander"}
[2025-07-01T00:50:03.025Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T00:50:03.025Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":110,"preview":"¡Hola, Alexander! Todo bien, gracias. ¿En qué puedo ayudarte hoy con respecto a los apartamentos en ..."}
[2025-07-01T00:50:07.135Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo bien, gracias. ¿En qué pued..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo bien, gracias. ¿En qué pued..."}
[2025-07-01T00:50:07.135Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T00:50:07.135Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T00:50:07.915Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:50:07.915Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T00:50:08.128Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psq23sbM_MWmzhI-wCSFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751331008"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T00:53:23.931Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:53:23.932Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:53:23.932Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:53:23.932Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:53:23.932Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Que" | {"userName":"Alexander","preview":"Que"}
[2025-07-01T00:53:23.933Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T00:53:23.933Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T00:53:23.933Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:53:25.440Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:53:25.440Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:53:25.440Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:53:25.441Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:53:25.441Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Apartamento" | {"userName":"Alexander","preview":"Apartamento"}
[2025-07-01T00:53:25.441Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T00:53:25.441Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:53:25.441Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:53:26.871Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:53:26.871Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:53:26.871Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:53:26.872Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:53:26.872Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Tiene" | {"userName":"Alexander","preview":"Tiene"}
[2025-07-01T00:53:26.872Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T00:53:26.872Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:53:26.872Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:53:28.641Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:53:28.641Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:53:28.641Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:53:28.642Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:53:28.642Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Disponibilidad" | {"userName":"Alexander","preview":"Disponibilidad"}
[2025-07-01T00:53:28.642Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4) | {"total":4}
[2025-07-01T00:53:28.642Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T00:53:28.642Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:53:34.656Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T00:53:34.656Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:53:34.656Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 4) | {"total":4}
[2025-07-01T00:53:34.657Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 4 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":39,"preview":"Que\n\nApartamento\n\nTiene\n\nDisponibilidad..."}
[2025-07-01T00:53:34.657Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:53:34.657Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T00:53:34.657Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:53:34.657Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T00:49:58.955Z","previousThreads":[]}}
[2025-07-01T00:53:34.657Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:49:58.955Z"}
[2025-07-01T00:53:34.657Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T00:53:34.657Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T00:53:34.657Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:53:35.226Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:53:35.226Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":39,"messagePreview":"Que\n\nApartamento\n\nTiene\n\nDisponibilidad"}
[2025-07-01T00:53:35.226Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:53:41.591Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_JYWuvnCdcFioB6TZHg6J1fBU"}
[2025-07-01T00:53:44.452Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:53:44.699Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 9795ms | {"duration":9795,"userName":"Alexander"}
[2025-07-01T00:53:44.700Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":142,"preview":"Para verificar la disponibilidad, por favor indícame las fechas de tu estancia y las preferencias qu...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":18,"userName":"Alexander"}
[2025-07-01T00:53:44.700Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T00:53:44.701Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":142,"preview":"Para verificar la disponibilidad, por favor indícame las fechas de tu estancia y las preferencias qu..."}
[2025-07-01T00:53:48.383Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Para verificar la disponibilidad, por favor indíca..." | {"userName":"Usuario","preview":"Para verificar la disponibilidad, por favor indíca..."}
[2025-07-01T00:53:48.383Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T00:53:48.383Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T00:53:49.173Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:53:49.173Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T00:53:50.300Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PspQhTZp8Hecc8s-wBCFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751331231"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T00:57:55.078Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:57:55.078Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T00:57:55.079Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:57:55.079Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T00:57:55.079Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T00:57:55.079Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T00:57:55.079Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T00:57:55.079Z] [INFO] TIMER [app.ts]: Timer iniciado para 573003913251 (6s)
[2025-07-01T00:58:01.083Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T00:58:01.084Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:58:01.084Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T00:58:01.084Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":4,"preview":"Hola..."}
[2025-07-01T00:58:01.084Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:58:01.084Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T00:58:01.084Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T00:58:01.085Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T00:53:35.225Z","previousThreads":[]}}
[2025-07-01T00:58:01.085Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:53:35.225Z"}
[2025-07-01T00:58:01.085Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T00:58:01.085Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T00:58:01.085Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:58:01.505Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:58:01.505Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":4,"messagePreview":"Hola"}
[2025-07-01T00:58:01.505Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:58:02.580Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_iymKHd4qsBgEVfGH2HVIg2pv"}
[2025-07-01T00:58:04.523Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T00:58:04.933Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 3439ms | {"duration":3439,"userName":"Alexander"}
[2025-07-01T00:58:04.933Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":82,"preview":"¡Hola de nuevo, Alexander! ¿Cómo puedo ayudarte con los apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T00:58:04.934Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T00:58:04.934Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":82,"preview":"¡Hola de nuevo, Alexander! ¿Cómo puedo ayudarte con los apartamentos en Cartagena?..."}
[2025-07-01T00:58:08.803Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola de nuevo, Alexander! ¿Cómo puedo ayudarte co..." | {"userName":"Usuario","preview":"¡Hola de nuevo, Alexander! ¿Cómo puedo ayudarte co..."}
[2025-07-01T00:58:08.803Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T00:58:08.803Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T00:58:09.605Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T00:58:09.605Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T00:58:10.344Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psrzt_GI8jiHTeU-wAOFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751331490"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T00:58:10.689Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psrzt_GI8jiHTeU-wAOFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751331491"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:03:09.794Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:03:09.828Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:03:09.829Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:03:09.830Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:03:09.830Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:03:09.830Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:03:09.830Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:03:09.832Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:03:09.832Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:03:09.832Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:03:09.835Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":6000,"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:03:18.437Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:03:18.471Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:03:18.473Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:03:18.474Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:03:18.474Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:03:18.474Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:03:18.475Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:03:18.476Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:03:18.476Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:03:18.476Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:03:18.481Z] [ERROR] SYSTEM [unknown.ts]: Uncaught Exception | {"error":"USER_INACTIVITY_TIMEOUT_MS is not defined","stack":"ReferenceError: USER_INACTIVITY_TIMEOUT_MS is not defined\n    at Server.<anonymous> (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:612:48)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitListeningNT (node:net:1982:10)\n    at process.processTicksAndRejections (node:internal/process/task_queues:89:21)"}
[2025-07-01T01:03:37.065Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:03:37.109Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:03:37.112Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:03:37.113Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:03:37.113Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:03:37.114Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:03:37.115Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:03:37.116Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:03:37.117Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:03:37.118Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:03:37.127Z] [ERROR] SYSTEM [unknown.ts]: Uncaught Exception | {"error":"USER_INACTIVITY_TIMEOUT_MS is not defined","stack":"ReferenceError: USER_INACTIVITY_TIMEOUT_MS is not defined\n    at Server.<anonymous> (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:612:48)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitListeningNT (node:net:1982:10)\n    at process.processTicksAndRejections (node:internal/process/task_queues:89:21)"}
[2025-07-01T01:03:43.735Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:03:43.771Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:03:43.774Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:03:43.774Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:03:43.774Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:03:43.775Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:03:43.775Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:03:43.776Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:03:43.776Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:03:43.777Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:03:43.782Z] [ERROR] SYSTEM [unknown.ts]: Uncaught Exception | {"error":"USER_INACTIVITY_TIMEOUT_MS is not defined","stack":"ReferenceError: USER_INACTIVITY_TIMEOUT_MS is not defined\n    at Server.<anonymous> (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:623:48)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitListeningNT (node:net:1982:10)\n    at process.processTicksAndRejections (node:internal/process/task_queues:89:21)"}
[2025-07-01T01:03:53.249Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:03:53.286Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:03:53.288Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:03:53.289Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:03:53.289Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:03:53.289Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:03:53.289Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:03:53.290Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:03:53.290Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:03:53.291Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:03:53.295Z] [ERROR] SYSTEM [unknown.ts]: Uncaught Exception | {"error":"USER_INACTIVITY_TIMEOUT_MS is not defined","stack":"ReferenceError: USER_INACTIVITY_TIMEOUT_MS is not defined\n    at Server.<anonymous> (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:631:36)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitListeningNT (node:net:1982:10)\n    at process.processTicksAndRejections (node:internal/process/task_queues:89:21)"}
[2025-07-01T01:03:56.369Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:03:56.401Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:03:56.403Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:03:56.403Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:03:56.403Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:03:56.403Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:03:56.404Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:03:56.405Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:03:56.405Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:03:56.405Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:03:56.410Z] [ERROR] SYSTEM [unknown.ts]: Uncaught Exception | {"error":"USER_INACTIVITY_TIMEOUT_MS is not defined","stack":"ReferenceError: USER_INACTIVITY_TIMEOUT_MS is not defined\n    at Server.<anonymous> (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:631:36)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:530:35)\n    at emitListeningNT (node:net:1982:10)\n    at process.processTicksAndRejections (node:internal/process/task_queues:89:21)"}
[2025-07-01T01:04:02.652Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:04:02.684Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:04:02.686Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:04:02.687Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:04:02.687Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:04:02.687Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:04:02.688Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:04:02.689Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:04:02.689Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:04:02.689Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:04:02.694Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:04:06.337Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:04:06.369Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:04:06.371Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:04:06.371Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:04:06.372Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:04:06.372Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:04:06.373Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:04:06.373Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:04:06.374Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:04:06.374Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:04:06.378Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:16:06.610Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:16:06.641Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:16:06.644Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:16:06.644Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:16:06.644Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:16:06.644Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:16:06.644Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:16:06.645Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:16:06.646Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:16:06.646Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:16:06.650Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:16:10.303Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:16:10.336Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:16:10.338Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:16:10.339Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:16:10.339Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:16:10.339Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:16:10.339Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:16:10.340Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:16:10.340Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:16:10.341Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:16:10.347Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:20:04.965Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:20:04.996Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:20:05.000Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:20:05.001Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:20:05.001Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:20:05.001Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:20:05.002Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:20:05.003Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:20:05.003Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:20:05.004Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:20:05.007Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:20:07.636Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:20:07.671Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:20:07.676Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:20:07.676Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:20:07.676Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:20:07.676Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:20:07.676Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:20:07.677Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:20:07.678Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:20:07.678Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:20:07.682Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:21:41.761Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:21:41.793Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:21:41.796Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:21:41.796Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:21:41.796Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:21:41.797Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:21:41.797Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:21:41.798Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:21:41.798Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:21:41.799Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:21:41.802Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:21:47.846Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:21:47.880Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:21:47.883Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:21:47.883Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:21:47.883Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:21:47.883Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:21:47.884Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:21:47.884Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:21:47.885Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:21:47.885Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:21:47.888Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:24:28.930Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:24:28.961Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:24:28.965Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:24:28.965Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:24:28.966Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:24:28.966Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:24:28.967Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:24:28.968Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:24:28.969Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:24:28.969Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:24:28.973Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:26:31.369Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:26:31.403Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:26:31.405Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:26:31.405Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:26:31.406Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:26:31.406Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:26:31.406Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:26:31.407Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:26:31.408Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:26:31.409Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:26:31.413Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:26:32.856Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:26:32.893Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:26:32.895Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:26:32.895Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:26:32.896Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:26:32.896Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:26:32.897Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:26:32.898Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:26:32.899Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:26:32.900Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:26:32.904Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:30:33.170Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:30:33.202Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:30:33.204Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:30:33.204Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:30:33.204Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:30:33.204Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:30:33.205Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:30:33.205Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:30:33.206Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:30:33.206Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:30:33.209Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:31:53.126Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:31:53.160Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:31:53.162Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:31:53.163Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:31:53.163Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:31:53.163Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:31:53.164Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:31:53.165Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:31:53.165Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:31:53.165Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:31:53.170Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:34:52.778Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:34:52.810Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:34:52.812Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:34:52.813Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:34:52.813Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:34:52.813Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:34:52.813Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:34:52.814Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:34:52.815Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:34:52.816Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:34:52.820Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:35:45.992Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:35:45.993Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:35:45.993Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:35:45.993Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:35:45.993Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T01:35:45.994Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:35:45.994Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:35:45.994Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (1.5s) | {"messageCount":1,"totalLength":4,"averageLength":4,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:35:47.501Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:35:47.502Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:35:47.502Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:35:47.502Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":4,"preview":"Hola..."}
[2025-07-01T01:35:47.503Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:35:47.503Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:35:47.503Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:35:47.503Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T00:58:01.504Z","previousThreads":[]}}
[2025-07-01T01:35:47.503Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T00:58:01.504Z"}
[2025-07-01T01:35:47.504Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:35:47.504Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:35:47.504Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:35:48.495Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:35:48.495Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":4,"messagePreview":"Hola"}
[2025-07-01T01:35:48.495Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:35:49.854Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_kiDB7NeHTE0K6FEuRz3uFpAH"}
[2025-07-01T01:35:52.823Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:35:53.072Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5320ms | {"duration":5320,"userName":"Alexander"}
[2025-07-01T01:35:53.072Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":46,"preview":"¡Hola, Alexander! ¿En qué puedo asistirte hoy?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:35:53.073Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:35:53.073Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":46,"preview":"¡Hola, Alexander! ¿En qué puedo asistirte hoy?..."}
[2025-07-01T01:35:53.834Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:35:53.834Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:35:53.835Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:35:53.835Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:35:53.835Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo" | {"userName":"Alexander","preview":"Como va todo"}
[2025-07-01T01:35:53.835Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:35:53.835Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:35:53.836Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (1.5s) | {"messageCount":2,"totalLength":16,"averageLength":8,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:35:55.342Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:35:55.343Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:35:55.343Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:35:55.343Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":18,"preview":"Hola\n\nComo va todo..."}
[2025-07-01T01:35:55.343Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:35:55.343Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:35:55.343Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:35:55.343Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:35:48.494Z","previousThreads":[]}}
[2025-07-01T01:35:55.343Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:35:48.494Z"}
[2025-07-01T01:35:55.343Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:35:55.344Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:35:55.344Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:35:56.029Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:35:56.029Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":18,"messagePreview":"Hola\n\nComo va todo"}
[2025-07-01T01:35:56.029Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:35:57.045Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_JUiZK320ocrIfegZJuoz9C6E"}
[2025-07-01T01:35:57.091Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! ¿En qué puedo asistirte hoy?..." | {"userName":"Usuario","preview":"¡Hola, Alexander! ¿En qué puedo asistirte hoy?..."}
[2025-07-01T01:35:57.092Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:35:57.092Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:35:57.562Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:35:57.563Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:35:57.947Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrJgHUoysItkLw-wN6FabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751333758"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:35:58.983Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:35:59.287Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 3640ms | {"duration":3640,"userName":"Alexander"}
[2025-07-01T01:35:59.287Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":78,"preview":"¡Hola! Todo va bien. ¿En qué puedo ayudarte con los apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:35:59.288Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:35:59.288Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":78,"preview":"¡Hola! Todo va bien. ¿En qué puedo ayudarte con los apartamentos en Cartagena?..."}
[2025-07-01T01:36:01.429Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:01.429Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:36:01.429Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:01.429Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:36:01.429Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Nosé que anda" | {"userName":"Alexander","preview":"Nosé que anda"}
[2025-07-01T01:36:01.430Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:36:01.430Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:36:01.430Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (2s) | {"messageCount":1,"totalLength":13,"averageLength":13,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:36:02.565Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola! Todo va bien. ¿En qué puedo ayudarte con lo..." | {"userName":"Usuario","preview":"¡Hola! Todo va bien. ¿En qué puedo ayudarte con lo..."}
[2025-07-01T01:36:02.565Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:36:02.566Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:36:03.039Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:03.039Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:36:03.438Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:36:03.438Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:03.439Z] [WARNING] MESSAGE_PROCESS [app.ts]: Buffer vacío o inexistente para 573003913251
[2025-07-01T01:36:03.572Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsryMsq39ErPd0g-wMuFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751333764"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:36:03.921Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:03.921Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:36:03.921Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:03.921Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:36:03.921Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ustedes" | {"userName":"Alexander","preview":"Ustedes"}
[2025-07-01T01:36:03.921Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:36:03.922Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:36:03.922Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (2s) | {"messageCount":1,"totalLength":7,"averageLength":7,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:36:04.932Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:04.932Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:36:04.932Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:04.932Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:36:04.932Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hoy" | {"userName":"Alexander","preview":"Hoy"}
[2025-07-01T01:36:04.932Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:36:04.933Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:36:04.933Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (1.5s) | {"messageCount":2,"totalLength":10,"averageLength":5,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:36:06.448Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:36:06.449Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:06.449Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:36:06.449Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":12,"preview":"Ustedes\n\nHoy..."}
[2025-07-01T01:36:06.449Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:06.450Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:36:06.450Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:06.450Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:35:56.028Z","previousThreads":[]}}
[2025-07-01T01:36:06.450Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:35:56.028Z"}
[2025-07-01T01:36:06.450Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:36:06.450Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:36:06.451Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:36:06.968Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:36:06.968Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":12,"messagePreview":"Ustedes\n\nHoy"}
[2025-07-01T01:36:06.968Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:36:07.099Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:07.100Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:36:07.100Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:07.100Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:36:07.100Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "En día" | {"userName":"Alexander","preview":"En día"}
[2025-07-01T01:36:07.100Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T01:36:07.100Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:36:07.101Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (1.5s) | {"messageCount":3,"totalLength":16,"averageLength":5,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:36:08.511Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_hCQiNLEj0EWLQJ9MPryWJ3Q3"}
[2025-07-01T01:36:08.614Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:36:08.614Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:08.615Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 3) | {"total":3}
[2025-07-01T01:36:08.615Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 3 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":20,"preview":"Ustedes\n\nHoy\n\nEn día..."}
[2025-07-01T01:36:08.615Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:08.615Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:36:08.615Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:08.616Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:06.967Z","previousThreads":[]}}
[2025-07-01T01:36:08.616Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:06.967Z"}
[2025-07-01T01:36:08.616Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:36:08.616Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:36:08.616Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:36:09.270Z] [ERROR] OPENAI_ERROR [app.ts]: Error procesando mensaje para 573003913251 | {"error":"400 Can't add messages to thread_iGJlkyZND0iuKp5h7J1d0QY1 while a run run_hCQiNLEj0EWLQJ9MPryWJ3Q3 is active.","stack":"Error: 400 Can't add messages to thread_iGJlkyZND0iuKp5h7J1d0QY1 while a run run_hCQiNLEj0EWLQJ9MPryWJ3Q3 is active.\n    at Function.generate (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\node_modules\\openai\\src\\error.ts:72:14)\n    at OpenAI.makeStatusError (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\node_modules\\openai\\src\\core.ts:462:21)\n    at OpenAI.makeRequest (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\node_modules\\openai\\src\\core.ts:526:24)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async processWithOpenAI (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:268:9)\n    at async processUserMessage (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:421:22)\n    at async Timeout._onTimeout (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:554:17)","duration":650,"userJid":"573003913251","shortUserId":"573003913251"}
[2025-07-01T01:36:09.270Z] [ERROR] AI_PROCESSING [app.ts]: Respuesta falló para 573003913251 en 650ms | {"duration":650,"userName":"Alexander"}
[2025-07-01T01:36:09.271Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:36:09.271Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":75,"preview":"Lo siento, hubo un error procesando tu mensaje. Por favor intenta de nuevo...."}
[2025-07-01T01:36:10.465Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:36:10.713Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4015ms | {"duration":4015,"userName":"Alexander"}
[2025-07-01T01:36:10.714Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":117,"preview":"Estoy aquí para ayudarte con tus necesidades de reserva de apartamentos en Cartagena. ¿Qué informaci...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:36:10.714Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:36:10.714Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":117,"preview":"Estoy aquí para ayudarte con tus necesidades de reserva de apartamentos en Cartagena. ¿Qué informaci..."}
[2025-07-01T01:36:12.724Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:12.724Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:36:12.725Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:12.725Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:36:12.725Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ms" | {"userName":"Alexander","preview":"Ms"}
[2025-07-01T01:36:12.725Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4) | {"total":4}
[2025-07-01T01:36:12.725Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:36:12.725Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (1.5s) | {"messageCount":4,"totalLength":18,"averageLength":5,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:36:12.966Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Lo siento, hubo un error procesando tu mensaje. Po..." | {"userName":"Usuario","preview":"Lo siento, hubo un error procesando tu mensaje. Po..."}
[2025-07-01T01:36:12.966Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:36:12.966Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:36:13.643Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:13.643Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:36:14.061Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsooSFClB2PPbmM-wLmFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751333774"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:36:14.234Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:36:14.235Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:14.235Z] [WARNING] MESSAGE_PROCESS [app.ts]: Buffer vacío o inexistente para 573003913251
[2025-07-01T01:36:14.267Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Estoy aquí para ayudarte con tus necesidades de re..." | {"userName":"Usuario","preview":"Estoy aquí para ayudarte con tus necesidades de re..."}
[2025-07-01T01:36:14.268Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:36:14.268Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:36:14.465Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsooSFClB2PPbmM-wLmFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751333774"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:36:14.756Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:14.756Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:36:15.349Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqfmrJFx64E5mY-wHSFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751333776"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:36:15.732Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqfmrJFx64E5mY-wHSFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751333775"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:36:16.289Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:16.289Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:36:16.289Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:16.290Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:36:16.290Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "La cosa es q" | {"userName":"Alexander","preview":"La cosa es q"}
[2025-07-01T01:36:16.290Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:36:16.290Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:36:16.290Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (2s) | {"messageCount":1,"totalLength":12,"averageLength":12,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:36:18.300Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:36:18.301Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:18.301Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:36:18.301Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":12,"preview":"La cosa es q..."}
[2025-07-01T01:36:18.301Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:18.301Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:36:18.301Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:18.301Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:06.967Z","previousThreads":[]}}
[2025-07-01T01:36:18.301Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:06.967Z"}
[2025-07-01T01:36:18.301Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:36:18.302Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:36:18.302Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:36:18.977Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:36:18.978Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":12,"messagePreview":"La cosa es q"}
[2025-07-01T01:36:18.978Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:36:20.638Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_uM1PXRdHdfUJAZB0RntYcgsA"}
[2025-07-01T01:36:20.909Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:20.909Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:36:20.909Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:20.909Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:36:20.910Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Fin" | {"userName":"Alexander","preview":"Fin"}
[2025-07-01T01:36:20.910Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:36:20.910Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:36:20.910Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (1.5s) | {"messageCount":2,"totalLength":15,"averageLength":8,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:36:22.413Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:36:22.414Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:22.414Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:36:22.414Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":17,"preview":"La cosa es q\n\nFin..."}
[2025-07-01T01:36:22.415Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:22.415Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:36:22.415Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:36:22.415Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:18.977Z","previousThreads":[]}}
[2025-07-01T01:36:22.415Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z"}
[2025-07-01T01:36:22.415Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:36:22.415Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:36:22.416Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:36:22.667Z] [ERROR] OPENAI_ERROR [app.ts]: Error procesando mensaje para 573003913251 | {"error":"400 Can't add messages to thread_iGJlkyZND0iuKp5h7J1d0QY1 while a run run_uM1PXRdHdfUJAZB0RntYcgsA is active.","stack":"Error: 400 Can't add messages to thread_iGJlkyZND0iuKp5h7J1d0QY1 while a run run_uM1PXRdHdfUJAZB0RntYcgsA is active.\n    at Function.generate (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\node_modules\\openai\\src\\error.ts:72:14)\n    at OpenAI.makeStatusError (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\node_modules\\openai\\src\\core.ts:462:21)\n    at OpenAI.makeRequest (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\node_modules\\openai\\src\\core.ts:526:24)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async processWithOpenAI (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:268:9)\n    at async processUserMessage (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:421:22)\n    at async Timeout._onTimeout (C:\\Users\\alex-\\Bot-Wsp-Whapi-IA\\src\\app.ts:554:17)","duration":251,"userJid":"573003913251","shortUserId":"573003913251"}
[2025-07-01T01:36:22.667Z] [ERROR] AI_PROCESSING [app.ts]: Respuesta falló para 573003913251 en 251ms | {"duration":251,"userName":"Alexander"}
[2025-07-01T01:36:22.667Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:36:22.667Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":75,"preview":"Lo siento, hubo un error procesando tu mensaje. Por favor intenta de nuevo...."}
[2025-07-01T01:36:22.999Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:36:23.240Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4698ms | {"duration":4698,"userName":"Alexander"}
[2025-07-01T01:36:23.241Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":117,"preview":"Entiendo, Alexander. Cuéntame más sobre lo que necesitas, así puedo ayudarte mejor con los apartamen...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:36:23.241Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:36:23.241Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":117,"preview":"Entiendo, Alexander. Cuéntame más sobre lo que necesitas, así puedo ayudarte mejor con los apartamen..."}
[2025-07-01T01:36:26.291Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Lo siento, hubo un error procesando tu mensaje. Po..." | {"userName":"Usuario","preview":"Lo siento, hubo un error procesando tu mensaje. Po..."}
[2025-07-01T01:36:26.291Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:36:26.291Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:36:26.771Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:26.772Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:36:26.826Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Entiendo, Alexander. Cuéntame más sobre lo que nec..." | {"userName":"Usuario","preview":"Entiendo, Alexander. Cuéntame más sobre lo que nec..."}
[2025-07-01T01:36:26.826Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:36:26.826Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:36:27.343Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrD1bsofYYqVGs-wJqFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751333788"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:36:27.516Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:36:27.517Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:36:27.763Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrD1bsofYYqVGs-wJqFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751333787"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:36:27.895Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PspFvlEsNe9c3u8-wEWFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751333788"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:36:28.293Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PspFvlEsNe9c3u8-wEWFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751333788"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:44:47.342Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:44:47.374Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:44:47.376Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:44:47.377Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:44:47.377Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:44:47.377Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:44:47.378Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:44:47.379Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:44:47.379Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:44:47.379Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:44:47.383Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:45:00.679Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:45:00.710Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:45:00.716Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:45:00.716Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:45:00.716Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:45:00.716Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:45:00.717Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:45:00.718Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:45:00.718Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:45:00.719Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:45:00.723Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:46:08.026Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:46:08.060Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:46:08.062Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:46:08.063Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:46:08.063Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:46:08.063Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:46:08.064Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:46:08.064Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:46:08.065Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:46:08.065Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:46:08.069Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:46:21.151Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:46:21.184Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:46:21.186Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:46:21.186Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:46:21.187Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:46:21.187Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:46:21.187Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:46:21.188Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:46:21.189Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:46:21.189Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:46:21.193Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:46:41.298Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:46:41.299Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:46:41.299Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:46:41.299Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:46:41.299Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T01:46:41.300Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:46:41.300Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:46:41.301Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":1,"totalLength":4,"averageLength":4,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:46:44.306Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:46:44.307Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:46:44.307Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:46:44.307Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":4,"preview":"Hola..."}
[2025-07-01T01:46:44.308Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:46:44.308Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:46:44.308Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:46:44.308Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:18.977Z","previousThreads":[]}}
[2025-07-01T01:46:44.308Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z"}
[2025-07-01T01:46:44.308Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:46:44.308Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:46:44.309Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:46:45.089Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:46:45.089Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":4,"messagePreview":"Hola"}
[2025-07-01T01:46:45.089Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:46:45.225Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:46:45.225Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:46:45.226Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:46:45.226Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:46:45.226Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Cs" | {"userName":"Alexander","preview":"Cs"}
[2025-07-01T01:46:45.226Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:46:45.226Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:46:45.227Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":2,"totalLength":6,"averageLength":3,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:46:46.214Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_73spSTdUjx9FQLHUJomaI2Uq"}
[2025-07-01T01:46:48.234Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:46:48.235Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:46:48.235Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:46:48.235Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":8,"preview":"Hola\n\nCs..."}
[2025-07-01T01:46:48.236Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:46:48.236Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:46:48.236Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:46:48.236Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:46:45.088Z","previousThreads":[]}}
[2025-07-01T01:46:48.236Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:46:45.088Z"}
[2025-07-01T01:46:48.236Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:46:48.236Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:46:48.236Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:46:48.667Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:46:48.667Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":8,"messagePreview":"Hola\n\nCs"}
[2025-07-01T01:46:48.667Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:46:48.939Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:46:49.513Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4631ms | {"duration":4631,"userName":"Alexander"}
[2025-07-01T01:46:49.513Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":77,"preview":"¡Hola, Alexander! ¿Cómo puedo ayudarte hoy con los apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:46:49.514Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:46:49.514Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":77,"preview":"¡Hola, Alexander! ¿Cómo puedo ayudarte hoy con los apartamentos en Cartagena?..."}
[2025-07-01T01:46:50.411Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_Zz00O3YyLat3d2Mp1NeNRe7P"}
[2025-07-01T01:46:52.118Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:46:52.351Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 3882ms | {"duration":3882,"userName":"Alexander"}
[2025-07-01T01:46:52.351Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":86,"preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con respecto a apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:46:52.351Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:46:52.351Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":86,"preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con respecto a apartamentos en Cartagena?..."}
[2025-07-01T01:46:53.367Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! ¿Cómo puedo ayudarte hoy con los..." | {"userName":"Usuario","preview":"¡Hola, Alexander! ¿Cómo puedo ayudarte hoy con los..."}
[2025-07-01T01:46:53.367Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:46:53.367Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:46:53.847Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:46:53.847Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:46:54.265Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psrn0M1TUDmGikI-wL6FabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751334415"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:46:56.099Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! ¿En qué puedo ayudarte hoy con r..." | {"userName":"Usuario","preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con r..."}
[2025-07-01T01:46:56.100Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:46:56.100Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:46:56.586Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:46:56.586Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:46:57.091Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsoKWS9ClT9uccE-wIOFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751334417"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:47:08.302Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:47:08.302Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:47:08.302Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:47:08.302Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:47:08.303Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Comovatodoporakkandkkdjdjd" | {"userName":"Alexander","preview":"Comovatodoporakkandkkdjdjd"}
[2025-07-01T01:47:08.303Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:47:08.303Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:47:08.303Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (5s) | {"messageCount":1,"totalLength":26,"averageLength":26,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:47:13.316Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:47:13.317Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:47:13.317Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:47:13.317Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":26,"preview":"Comovatodoporakkandkkdjdjd..."}
[2025-07-01T01:47:13.317Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:47:13.317Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:47:13.318Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:47:13.318Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:46:48.666Z","previousThreads":[]}}
[2025-07-01T01:47:13.318Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:46:48.666Z"}
[2025-07-01T01:47:13.318Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:47:13.318Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:47:13.318Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:47:13.865Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:47:13.865Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":26,"messagePreview":"Comovatodoporakkandkkdjdjd"}
[2025-07-01T01:47:13.865Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:47:15.116Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_qzLNSDYCdUwrkXtyFTqfFqaG"}
[2025-07-01T01:47:17.832Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:47:18.077Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4515ms | {"duration":4515,"userName":"Alexander"}
[2025-07-01T01:47:18.077Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":92,"preview":"¡Todo bien por aquí! ¿Te gustaría conocer opciones de apartamentos disponibles en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:47:18.078Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:47:18.078Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":92,"preview":"¡Todo bien por aquí! ¿Te gustaría conocer opciones de apartamentos disponibles en Cartagena?..."}
[2025-07-01T01:47:21.806Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:47:21.837Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:47:21.839Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:47:21.839Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:47:21.839Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:47:21.840Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:47:21.840Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:47:21.841Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:47:21.841Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:47:21.842Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:47:21.847Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:47:22.462Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:47:22.462Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:47:22.649Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psr84_EyqWM4xKk-wB.FabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751334443"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:47:33.099Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:47:33.100Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:47:33.100Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:47:33.100Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:47:33.100Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T01:47:33.101Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:47:33.101Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:47:33.101Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":1,"totalLength":4,"averageLength":4,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:47:36.500Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:47:36.532Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:47:36.534Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:47:36.535Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:47:36.535Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:47:36.535Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:47:36.536Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:47:36.536Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:47:36.537Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:47:36.537Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:47:36.541Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:47:40.367Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:47:40.368Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:47:40.368Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:47:40.368Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:47:40.368Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hhola" | {"userName":"Alexander","preview":"Hhola"}
[2025-07-01T01:47:40.369Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:47:40.369Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:47:40.369Z] [INFO] HYBRID_SYSTEM [app.ts]: 🐌 573003913251: Usando timeouts conservadores (sin typing)
[2025-07-01T01:47:40.370Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":1,"totalLength":5,"averageLength":5,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:47:43.393Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:47:43.394Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:47:43.395Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:47:43.395Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":5,"preview":"Hhola..."}
[2025-07-01T01:47:43.397Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:47:43.397Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:47:43.398Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:47:43.398Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:18.977Z","previousThreads":[]}}
[2025-07-01T01:47:43.398Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z"}
[2025-07-01T01:47:43.398Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:47:43.399Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:47:43.399Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:47:44.005Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:47:44.005Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":5,"messagePreview":"Hhola"}
[2025-07-01T01:47:44.005Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:47:49.189Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:47:49.219Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:47:49.221Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:47:49.221Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:47:49.222Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:47:49.222Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:47:49.222Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:47:49.223Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:47:49.223Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:47:49.224Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:47:49.228Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:47:59.593Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:47:59.594Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:47:59.594Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:47:59.594Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:47:59.594Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hoa" | {"userName":"Alexander","preview":"Hoa"}
[2025-07-01T01:47:59.595Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:47:59.595Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:47:59.596Z] [INFO] HYBRID_SYSTEM [app.ts]: 🐌 573003913251: Usando timeouts conservadores (sin typing)
[2025-07-01T01:47:59.596Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":1,"totalLength":3,"averageLength":3,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:48:02.603Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:48:02.604Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:02.604Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:48:02.604Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":3,"preview":"Hoa..."}
[2025-07-01T01:48:02.605Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:02.605Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:48:02.605Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:02.605Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:18.977Z","previousThreads":[]}}
[2025-07-01T01:48:02.605Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z"}
[2025-07-01T01:48:02.605Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:48:02.605Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:48:02.606Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:48:03.401Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:48:03.401Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":3,"messagePreview":"Hoa"}
[2025-07-01T01:48:03.402Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:48:04.767Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:48:04.799Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:48:04.802Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:48:04.803Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:48:04.803Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:48:04.803Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:48:04.804Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:48:04.805Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:48:04.805Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:48:04.806Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:48:04.811Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:48:27.069Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:48:27.069Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:48:27.069Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:27.069Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:48:27.070Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Jsjs" | {"userName":"Alexander","preview":"Jsjs"}
[2025-07-01T01:48:27.070Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:48:27.070Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:48:27.071Z] [INFO] HYBRID_SYSTEM [app.ts]: 🐌 573003913251: Usando timeouts conservadores (sin typing)
[2025-07-01T01:48:27.071Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":1,"totalLength":4,"averageLength":4,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:48:29.182Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:48:29.183Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:48:29.183Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:29.183Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:48:29.183Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "D" | {"userName":"Alexander","preview":"D"}
[2025-07-01T01:48:29.183Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:48:29.183Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:48:29.184Z] [INFO] HYBRID_SYSTEM [app.ts]: 🐌 573003913251: Usando timeouts conservadores (sin typing)
[2025-07-01T01:48:29.184Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":2,"totalLength":5,"averageLength":3,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:48:31.243Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:48:31.244Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:48:31.244Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:31.244Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:48:31.244Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Dbdbd" | {"userName":"Alexander","preview":"Dbdbd"}
[2025-07-01T01:48:31.244Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T01:48:31.244Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:48:31.245Z] [INFO] HYBRID_SYSTEM [app.ts]: 🐌 573003913251: Usando timeouts conservadores (sin typing)
[2025-07-01T01:48:31.245Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":3,"totalLength":10,"averageLength":3,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:48:34.251Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:48:34.251Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:34.252Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 3) | {"total":3}
[2025-07-01T01:48:34.252Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 3 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":14,"preview":"Jsjs\n\nD\n\nDbdbd..."}
[2025-07-01T01:48:34.253Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:34.253Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:48:34.253Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:34.253Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:18.977Z","previousThreads":[]}}
[2025-07-01T01:48:34.253Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z"}
[2025-07-01T01:48:34.253Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:48:34.253Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:48:34.254Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:48:35.133Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:48:35.133Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":14,"messagePreview":"Jsjs\n\nD\n\nDbdbd"}
[2025-07-01T01:48:35.133Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:48:36.428Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_F0hIi4d9TLUAY9dgskDBnxgi"}
[2025-07-01T01:48:39.044Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:48:41.580Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4791ms | {"duration":4791,"userName":"Alexander"}
[2025-07-01T01:48:41.580Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":110,"preview":"Parece que tienes algo en mente. ¿Hay algo específico que necesites saber sobre los apartamentos en ...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:48:41.581Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:48:41.581Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":110,"preview":"Parece que tienes algo en mente. ¿Hay algo específico que necesites saber sobre los apartamentos en ..."}
[2025-07-01T01:48:45.205Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Parece que tienes algo en mente. ¿Hay algo específ..." | {"userName":"Usuario","preview":"Parece que tienes algo en mente. ¿Hay algo específ..."}
[2025-07-01T01:48:45.206Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:48:45.206Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:48:46.011Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:48:46.011Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:48:46.177Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqGp7RvYJlUXN4-wGWFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751334526"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:48:51.614Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:48:51.614Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:48:51.614Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:51.614Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:48:51.615Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Bbhbbbhbbbhhhh" | {"userName":"Alexander","preview":"Bbhbbbhbbbhhhh"}
[2025-07-01T01:48:51.615Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:48:51.615Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:48:51.615Z] [INFO] HYBRID_SYSTEM [app.ts]: 🐌 573003913251: Usando timeouts conservadores (sin typing)
[2025-07-01T01:48:51.615Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (4s) | {"messageCount":1,"totalLength":14,"averageLength":14,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:48:55.618Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:48:55.619Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:55.619Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:48:55.619Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":14,"preview":"Bbhbbbhbbbhhhh..."}
[2025-07-01T01:48:55.619Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:55.620Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:48:55.620Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:48:55.620Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:48:35.132Z","previousThreads":[]}}
[2025-07-01T01:48:55.620Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:48:35.132Z"}
[2025-07-01T01:48:55.620Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:48:55.620Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:48:55.620Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:48:57.086Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:48:57.087Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":14,"messagePreview":"Bbhbbbhbbbhhhh"}
[2025-07-01T01:48:57.087Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:48:58.781Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_len2mjECn5AR69FpPcSXVHGr"}
[2025-07-01T01:49:00.596Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:49:00.859Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4976ms | {"duration":4976,"userName":"Alexander"}
[2025-07-01T01:49:00.859Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":97,"preview":"Estoy aquí para ayudarte, Alexander. ¿Tienes alguna pregunta sobre los apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:49:00.859Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:49:00.859Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":97,"preview":"Estoy aquí para ayudarte, Alexander. ¿Tienes alguna pregunta sobre los apartamentos en Cartagena?..."}
[2025-07-01T01:49:04.370Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Estoy aquí para ayudarte, Alexander. ¿Tienes algun..." | {"userName":"Usuario","preview":"Estoy aquí para ayudarte, Alexander. ¿Tienes algun..."}
[2025-07-01T01:49:04.370Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:49:04.371Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:49:05.172Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:49:05.172Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:49:05.367Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrMZQvAPSztMqE-wOiFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751334546"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:50:36.568Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:50:36.600Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:50:36.602Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:50:36.602Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:50:36.602Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:50:36.603Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:50:36.603Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:50:36.604Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:50:36.604Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:50:36.605Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:50:36.609Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:50:37.590Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:50:37.623Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:50:37.626Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:50:37.626Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:50:37.627Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:50:37.627Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:50:37.627Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:50:37.628Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:50:37.629Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:50:37.629Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:50:37.634Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:50:49.634Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:50:49.635Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:50:49.636Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:50:49.636Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:50:49.636Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hoa" | {"userName":"Alexander","preview":"Hoa"}
[2025-07-01T01:50:49.637Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:50:49.637Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:50:49.637Z] [INFO] HYBRID_SYSTEM [app.ts]: 🐌 573003913251: Usando timeouts conservadores (sin typing)
[2025-07-01T01:50:49.638Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":1,"totalLength":3,"averageLength":3,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:50:51.396Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:50:51.397Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:50:51.397Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:50:51.397Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:50:51.397Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T01:50:51.397Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:50:51.398Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:50:51.398Z] [INFO] HYBRID_SYSTEM [app.ts]: 🐌 573003913251: Usando timeouts conservadores (sin typing)
[2025-07-01T01:50:51.399Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":2,"totalLength":7,"averageLength":4,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:50:52.777Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:50:52.777Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:50:52.778Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:50:52.778Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:50:52.778Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va" | {"userName":"Alexander","preview":"Va"}
[2025-07-01T01:50:52.778Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T01:50:52.778Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:50:52.778Z] [INFO] HYBRID_SYSTEM [app.ts]: 🐌 573003913251: Usando timeouts conservadores (sin typing)
[2025-07-01T01:50:52.779Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":3,"totalLength":9,"averageLength":3,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:50:54.003Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:50:54.004Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:50:54.004Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:50:54.004Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:50:54.004Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Todo" | {"userName":"Alexander","preview":"Todo"}
[2025-07-01T01:50:54.004Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4) | {"total":4}
[2025-07-01T01:50:54.005Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:50:54.005Z] [INFO] HYBRID_SYSTEM [app.ts]: 🐌 573003913251: Usando timeouts conservadores (sin typing)
[2025-07-01T01:50:54.006Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (3s) | {"messageCount":4,"totalLength":13,"averageLength":3,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:50:57.022Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:50:57.023Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:50:57.023Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 4) | {"total":4}
[2025-07-01T01:50:57.028Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 4 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":19,"preview":"Hoa\n\nComo\n\nVa\n\nTodo..."}
[2025-07-01T01:50:57.029Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:50:57.029Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:50:57.029Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:50:57.030Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:18.977Z","previousThreads":[]}}
[2025-07-01T01:50:57.032Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z"}
[2025-07-01T01:50:57.032Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:50:57.033Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:50:57.033Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:50:58.163Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:50:58.163Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":19,"messagePreview":"Hoa\n\nComo\n\nVa\n\nTodo"}
[2025-07-01T01:50:58.163Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:51:00.552Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_aF2ZuoBgoBoASQqNHM4Csc0X"}
[2025-07-01T01:51:03.236Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:51:03.614Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 6207ms | {"duration":6207,"userName":"Alexander"}
[2025-07-01T01:51:03.615Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":102,"preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudarte hoy con tu búsqueda de apartamentos en Cartagen...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:51:03.615Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:51:03.615Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":102,"preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudarte hoy con tu búsqueda de apartamentos en Cartagen..."}
[2025-07-01T01:51:07.233Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudar..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudar..."}
[2025-07-01T01:51:07.233Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:51:07.233Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:51:08.024Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:51:08.024Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:51:08.198Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Pspti5ZM2YD1wwE-wAaFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751334668"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:51:09.644Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:51:09.644Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:51:09.644Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:51:09.644Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:51:09.644Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Bbvhhhhbhhhjjhhhbbhhh" | {"userName":"Alexander","preview":"Bbvhhhhbhhhjjhhhbbhhh"}
[2025-07-01T01:51:09.644Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:51:09.645Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:51:09.645Z] [INFO] HYBRID_SYSTEM [app.ts]: 🐌 573003913251: Usando timeouts conservadores (sin typing)
[2025-07-01T01:51:09.645Z] [INFO] TIMER [app.ts]: Timer inteligente para 573003913251 (5s) | {"messageCount":1,"totalLength":21,"averageLength":21,"hasLikelyFinal":false,"recommendedAction":"wait"}
[2025-07-01T01:51:14.645Z] [INFO] TIMER [app.ts]: Timer expirado para 573003913251, procesando mensajes
[2025-07-01T01:51:14.646Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:51:14.646Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:51:14.647Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":21,"preview":"Bbvhhhhbhhhjjhhhbbhhh..."}
[2025-07-01T01:51:14.647Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:51:14.647Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:51:14.647Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:51:14.647Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:50:58.162Z","previousThreads":[]}}
[2025-07-01T01:51:14.647Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:50:58.162Z"}
[2025-07-01T01:51:14.647Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:51:14.647Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:51:14.648Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:51:15.363Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:51:15.363Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":21,"messagePreview":"Bbvhhhhbhhhjjhhhbbhhh"}
[2025-07-01T01:51:15.363Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:51:16.933Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_UA9E7UExVaKgkKISnL41UlLV"}
[2025-07-01T01:51:19.867Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:51:20.321Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5220ms | {"duration":5220,"userName":"Alexander"}
[2025-07-01T01:51:20.321Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":123,"preview":"Si necesitas información sobre apartamentos en Cartagena, estoy aquí para ayudarte. ¿Hay algo especí...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:51:20.321Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:51:20.321Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":123,"preview":"Si necesitas información sobre apartamentos en Cartagena, estoy aquí para ayudarte. ¿Hay algo especí..."}
[2025-07-01T01:51:23.894Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Si necesitas información sobre apartamentos en Car..." | {"userName":"Usuario","preview":"Si necesitas información sobre apartamentos en Car..."}
[2025-07-01T01:51:23.895Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:51:23.895Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:51:24.672Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:51:24.673Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:51:24.865Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psp6nEwALsfMZyU-wMuFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751334685"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:52:53.939Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:52:53.980Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:52:53.982Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:52:53.983Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:52:53.983Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:52:53.983Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:52:53.984Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:52:53.984Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:52:53.985Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:52:53.985Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:52:53.990Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:53:07.309Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:53:07.345Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:53:07.348Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:53:07.348Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:53:07.348Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:53:07.348Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:53:07.349Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:53:07.350Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:53:07.350Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:53:07.351Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:53:07.355Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:53:38.092Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:53:38.124Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:53:38.126Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:53:38.126Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:53:38.127Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:53:38.127Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:53:38.128Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:53:38.129Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:53:38.129Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:53:38.129Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:53:38.134Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:53:50.985Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:53:51.015Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:53:51.017Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:53:51.017Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:53:51.017Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:53:51.018Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:53:51.018Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:53:51.019Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:53:51.019Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:53:51.019Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:53:51.024Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:54:07.441Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:54:07.473Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:54:07.475Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:54:07.475Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:54:07.475Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:54:07.476Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:54:07.476Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:54:07.477Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:54:07.477Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:54:07.477Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:54:07.482Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:54:20.936Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:54:20.969Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:54:20.971Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:54:20.972Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:54:20.972Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:54:20.972Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:54:20.972Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:54:20.974Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:54:20.974Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:54:20.975Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:54:20.980Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:54:38.881Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:54:38.882Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:54:38.882Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:54:38.882Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:54:38.883Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T01:54:38.883Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:54:38.884Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:54:38.884Z] [INFO] WRITING_NORMAL [app.ts]: 💬 573003913251: Escritura normal - usando timeout inteligente
[2025-07-01T01:54:38.884Z] [INFO] TIMER [app.ts]: ⏱️ 573003913251: Timer configurado (5s) | {"messageCount":1,"totalLength":4,"averageLength":4,"hasLikelyFinal":false,"recommendedAction":"wait","writingState":"normal","timeout":"5000ms"}
[2025-07-01T01:54:42.525Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:54:42.525Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:54:42.525Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:54:42.525Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:54:42.526Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo" | {"userName":"Alexander","preview":"Como va todo"}
[2025-07-01T01:54:42.526Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:54:42.526Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:54:42.526Z] [INFO] WRITING_NORMAL [app.ts]: 💬 573003913251: Escritura normal - usando timeout inteligente
[2025-07-01T01:54:42.526Z] [INFO] TIMER [app.ts]: ⏱️ 573003913251: Timer configurado (4s) | {"messageCount":2,"totalLength":16,"averageLength":8,"hasLikelyFinal":false,"recommendedAction":"wait","writingState":"normal","timeout":"4000ms"}
[2025-07-01T01:54:46.535Z] [INFO] TIMER [app.ts]: ⏰ 573003913251: Timer expirado - procesando mensajes
[2025-07-01T01:54:46.536Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:54:46.536Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:54:46.536Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":18,"preview":"Hola\n\nComo va todo..."}
[2025-07-01T01:54:46.536Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:54:46.536Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:54:46.537Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:54:46.537Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:18.977Z","previousThreads":[]}}
[2025-07-01T01:54:46.537Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z"}
[2025-07-01T01:54:46.537Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:54:46.537Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:54:46.537Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:54:47.363Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:54:47.363Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":18,"messagePreview":"Hola\n\nComo va todo"}
[2025-07-01T01:54:47.363Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:54:48.363Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_YrOkpLrYSXn1rBh7GLTzsCH8"}
[2025-07-01T01:54:51.154Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:54:51.686Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4618ms | {"duration":4618,"userName":"Alexander"}
[2025-07-01T01:54:51.686Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":110,"preview":"¡Hola, Alexander! Todo bien, gracias. ¿En qué puedo ayudarte hoy con respecto a los apartamentos en ...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:54:51.687Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:54:51.687Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":110,"preview":"¡Hola, Alexander! Todo bien, gracias. ¿En qué puedo ayudarte hoy con respecto a los apartamentos en ..."}
[2025-07-01T01:54:55.718Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:54:55.718Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:54:55.718Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:54:55.719Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:54:55.719Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Jsjjdjdhdjdhdbdjdddjdhdhddhfhfhdjsjdjdjf" | {"userName":"Alexander","preview":"Jsjjdjdhdjdhdbdjdddjdhdhddhfhfhdjsjdjdjf"}
[2025-07-01T01:54:55.719Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T01:54:55.719Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:54:55.719Z] [INFO] WRITING_NORMAL [app.ts]: 💬 573003913251: Escritura normal - usando timeout inteligente
[2025-07-01T01:54:55.719Z] [INFO] TIMER [app.ts]: ⏱️ 573003913251: Timer configurado (6s) | {"messageCount":3,"totalLength":56,"averageLength":19,"hasLikelyFinal":false,"recommendedAction":"wait","writingState":"normal","timeout":"6000ms"}
[2025-07-01T01:54:55.733Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo bien, gracias. ¿En qué pued..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo bien, gracias. ¿En qué pued..."}
[2025-07-01T01:54:55.733Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:54:55.733Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:54:56.233Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:54:56.233Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:54:56.648Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psq8cl_5_p1zqO4-wBCFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751334897"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:55:01.724Z] [INFO] TIMER [app.ts]: ⏰ 573003913251: Timer expirado - procesando mensajes
[2025-07-01T01:55:01.725Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:01.725Z] [WARNING] MESSAGE_PROCESS [app.ts]: Buffer vacío o inexistente para 573003913251
[2025-07-01T01:55:05.786Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:55:05.786Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:55:05.786Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:05.787Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:55:05.787Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Jjfjdbbdjdbdbdbd" | {"userName":"Alexander","preview":"Jjfjdbbdjdbdbdbd"}
[2025-07-01T01:55:05.787Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:55:05.787Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:55:05.787Z] [INFO] WRITING_NORMAL [app.ts]: 💬 573003913251: Escritura normal - usando timeout inteligente
[2025-07-01T01:55:05.787Z] [INFO] TIMER [app.ts]: ⏱️ 573003913251: Timer configurado (6s) | {"messageCount":1,"totalLength":16,"averageLength":16,"hasLikelyFinal":false,"recommendedAction":"wait","writingState":"normal","timeout":"6000ms"}
[2025-07-01T01:55:11.802Z] [INFO] TIMER [app.ts]: ⏰ 573003913251: Timer expirado - procesando mensajes
[2025-07-01T01:55:11.803Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:11.803Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:55:11.803Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":16,"preview":"Jjfjdbbdjdbdbdbd..."}
[2025-07-01T01:55:11.803Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:11.803Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:55:11.803Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:11.803Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:54:47.362Z","previousThreads":[]}}
[2025-07-01T01:55:11.803Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:54:47.362Z"}
[2025-07-01T01:55:11.803Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:55:11.803Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:55:11.803Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:55:12.771Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:55:12.771Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":16,"messagePreview":"Jjfjdbbdjdbdbdbd"}
[2025-07-01T01:55:12.771Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:55:13.904Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_cHc2MyY1Hj0FmfmxJe09StFP"}
[2025-07-01T01:55:17.126Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:55:17.414Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5323ms | {"duration":5323,"userName":"Alexander"}
[2025-07-01T01:55:17.414Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":115,"preview":"Si tienes alguna pregunta o necesitas ayuda con apartamentos en Cartagena, ¡déjame saber! Estoy aquí...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:55:17.414Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:55:17.414Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":115,"preview":"Si tienes alguna pregunta o necesitas ayuda con apartamentos en Cartagena, ¡déjame saber! Estoy aquí..."}
[2025-07-01T01:55:20.948Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Si tienes alguna pregunta o necesitas ayuda con ap..." | {"userName":"Usuario","preview":"Si tienes alguna pregunta o necesitas ayuda con ap..."}
[2025-07-01T01:55:20.948Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:55:20.949Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:55:21.737Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:55:21.737Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:55:21.905Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrC.Ocn6Y2RR84-wH6FabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751334922"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:55:28.817Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:55:28.817Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:55:28.817Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:28.817Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:55:28.818Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T01:55:28.818Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:55:28.818Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:55:28.818Z] [INFO] WRITING_NORMAL [app.ts]: 💬 573003913251: Escritura normal - usando timeout inteligente
[2025-07-01T01:55:28.818Z] [INFO] TIMER [app.ts]: ⏱️ 573003913251: Timer configurado (6s) | {"messageCount":1,"totalLength":4,"averageLength":4,"hasLikelyFinal":false,"recommendedAction":"wait","writingState":"normal","timeout":"6000ms"}
[2025-07-01T01:55:34.826Z] [INFO] TIMER [app.ts]: ⏰ 573003913251: Timer expirado - procesando mensajes
[2025-07-01T01:55:34.826Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:34.827Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:55:34.827Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":4,"preview":"Hola..."}
[2025-07-01T01:55:34.827Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:34.827Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:55:34.827Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:34.827Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:55:12.770Z","previousThreads":[]}}
[2025-07-01T01:55:34.827Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:55:12.770Z"}
[2025-07-01T01:55:34.827Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:55:34.828Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:55:34.828Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:55:35.675Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:55:35.675Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":4,"messagePreview":"Hola"}
[2025-07-01T01:55:35.675Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:55:37.268Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_FT49nZwtEEEpsLW9nqc6Dk6H"}
[2025-07-01T01:55:39.126Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:55:39.458Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4299ms | {"duration":4299,"userName":"Alexander"}
[2025-07-01T01:55:39.458Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":90,"preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con respecto a los apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:55:39.458Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:55:39.458Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":90,"preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con respecto a los apartamentos en Cartagena?..."}
[2025-07-01T01:55:43.037Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! ¿En qué puedo ayudarte hoy con r..." | {"userName":"Usuario","preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con r..."}
[2025-07-01T01:55:43.037Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:55:43.038Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:55:43.882Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:55:43.883Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:55:44.057Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqLPlh13sNbeK4-wLqFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751334944"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:55:45.613Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:55:45.614Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:55:45.614Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:45.614Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:55:45.614Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Estoy escribiendo lento para ver si hace pausa jdj..." | {"userName":"Alexander","preview":"Estoy escribiendo lento para ver si hace pausa jdj..."}
[2025-07-01T01:55:45.614Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:55:45.614Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:55:45.614Z] [INFO] WRITING_NORMAL [app.ts]: 💬 573003913251: Escritura normal - usando timeout inteligente
[2025-07-01T01:55:45.615Z] [INFO] TIMER [app.ts]: ⏱️ 573003913251: Timer configurado (6s) | {"messageCount":1,"totalLength":62,"averageLength":62,"hasLikelyFinal":false,"recommendedAction":"wait","writingState":"normal","timeout":"6000ms"}
[2025-07-01T01:55:51.617Z] [INFO] TIMER [app.ts]: ⏰ 573003913251: Timer expirado - procesando mensajes
[2025-07-01T01:55:51.617Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:51.617Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:55:51.617Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":62,"preview":"Estoy escribiendo lento para ver si hace pausa jdjsjdjdjaksdjd..."}
[2025-07-01T01:55:51.617Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:51.617Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T01:55:51.617Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:55:51.618Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:55:35.674Z","previousThreads":[]}}
[2025-07-01T01:55:51.618Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:55:35.674Z"}
[2025-07-01T01:55:51.618Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T01:55:51.618Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T01:55:51.618Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:55:52.303Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:55:52.303Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":62,"messagePreview":"Estoy escribiendo lento para ver si hace pausa jdjsjdjdjaksdjd"}
[2025-07-01T01:55:52.303Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:55:57.118Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_ZtawNp1QOiJ81kis1lxCrokc"}
[2025-07-01T01:56:00.359Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T01:56:00.755Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 8742ms | {"duration":8742,"userName":"Alexander"}
[2025-07-01T01:56:00.756Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":133,"preview":"Entiendo, Alexander. Estoy aquí esperando para ayudarte. ¿Necesitas información sobre la disponibili...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T01:56:00.756Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T01:56:00.756Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":133,"preview":"Entiendo, Alexander. Estoy aquí esperando para ayudarte. ¿Necesitas información sobre la disponibili..."}
[2025-07-01T01:56:04.475Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Entiendo, Alexander. Estoy aquí esperando para ayu..." | {"userName":"Usuario","preview":"Entiendo, Alexander. Estoy aquí esperando para ayu..."}
[2025-07-01T01:56:04.475Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T01:56:04.476Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T01:56:05.302Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:56:05.302Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T01:56:05.507Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PspsTyRf6WBkWw4-wBOFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751334966"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T01:56:49.034Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:56:49.068Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:56:49.070Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:56:49.071Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:56:49.071Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:56:49.072Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:56:49.072Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:56:49.073Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:56:49.074Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:56:49.075Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:56:49.078Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:57:09.412Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T01:57:09.445Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T01:57:09.447Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T01:57:09.447Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T01:57:09.448Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T01:57:09.448Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T01:57:09.448Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T01:57:09.449Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T01:57:09.449Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T01:57:09.450Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T01:57:09.454Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T01:59:18.227Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:59:18.227Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:59:18.228Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:59:18.228Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:59:18.228Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T01:59:18.229Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T01:59:18.229Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T01:59:18.229Z] [INFO] WRITING_NORMAL [app.ts]: 💬 573003913251: Escritura normal - usando timeout inteligente
[2025-07-01T01:59:18.229Z] [INFO] TIMER [app.ts]: ⏱️ 573003913251: Timer configurado (5s) | {"messageCount":1,"totalLength":4,"averageLength":4,"hasLikelyFinal":false,"recommendedAction":"wait","writingState":"normal","timeout":"5000ms"}
[2025-07-01T01:59:19.567Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:59:19.567Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:59:19.567Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:59:19.567Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:59:19.567Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T01:59:19.568Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T01:59:19.568Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:59:19.568Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T01:59:19.569Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 2 mensajes, último "Como" (4 chars)
[2025-07-01T01:59:26.275Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:59:26.275Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:59:26.275Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:59:26.276Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:59:26.276Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va hodozkzkdjzjdjdjdjd" | {"userName":"Alexander","preview":"Va hodozkzkdjzjdjdjdjd"}
[2025-07-01T01:59:26.276Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T01:59:26.276Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:59:26.277Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T01:59:26.277Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 3 mensajes, último "Va hodozkzkdjzjdjdjdjd" (22 chars)
[2025-07-01T01:59:29.824Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:59:29.824Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:59:29.824Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:59:29.824Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:59:29.825Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ddddddd" | {"userName":"Alexander","preview":"Ddddddd"}
[2025-07-01T01:59:29.825Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4) | {"total":4}
[2025-07-01T01:59:29.826Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:59:29.826Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T01:59:29.827Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 4 mensajes, último "Ddddddd" (7 chars)
[2025-07-01T01:59:37.630Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:59:37.630Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:59:37.631Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:59:37.631Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:59:37.631Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T01:59:37.631Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 5) | {"total":5}
[2025-07-01T01:59:37.632Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:59:37.632Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T01:59:37.632Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 5 mensajes, último "Como" (4 chars)
[2025-07-01T01:59:44.338Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:59:44.338Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:59:44.338Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:59:44.338Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:59:44.338Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va hodozkzkdjzjdjdjdjd" | {"userName":"Alexander","preview":"Va hodozkzkdjzjdjdjdjd"}
[2025-07-01T01:59:44.339Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 6) | {"total":6}
[2025-07-01T01:59:44.339Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:59:44.339Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T01:59:44.340Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 6 mensajes, último "Va hodozkzkdjzjdjdjdjd" (22 chars)
[2025-07-01T01:59:47.885Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:59:47.886Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:59:47.886Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:59:47.886Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:59:47.886Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ddddddd" | {"userName":"Alexander","preview":"Ddddddd"}
[2025-07-01T01:59:47.886Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 7) | {"total":7}
[2025-07-01T01:59:47.887Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:59:47.887Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T01:59:47.887Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 7 mensajes, último "Ddddddd" (7 chars)
[2025-07-01T01:59:58.722Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T01:59:58.722Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T01:59:58.722Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T01:59:58.723Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T01:59:58.723Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T01:59:58.723Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 8) | {"total":8}
[2025-07-01T01:59:58.723Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T01:59:58.723Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T01:59:58.724Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 8 mensajes, último "Como" (4 chars)
[2025-07-01T02:00:05.388Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:00:05.389Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:00:05.389Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:00:05.389Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:00:05.389Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va hodozkzkdjzjdjdjdjd" | {"userName":"Alexander","preview":"Va hodozkzkdjzjdjdjdjd"}
[2025-07-01T02:00:05.389Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 9) | {"total":9}
[2025-07-01T02:00:05.390Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T02:00:05.390Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T02:00:05.390Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 9 mensajes, último "Va hodozkzkdjzjdjdjdjd" (22 chars)
[2025-07-01T02:00:08.944Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:00:08.944Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:00:08.944Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:00:08.944Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:00:08.944Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ddddddd" | {"userName":"Alexander","preview":"Ddddddd"}
[2025-07-01T02:00:08.945Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 10) | {"total":10}
[2025-07-01T02:00:08.945Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T02:00:08.945Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T02:00:08.945Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 10 mensajes, último "Ddddddd" (7 chars)
[2025-07-01T02:00:22.789Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:00:22.789Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:00:22.789Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:00:22.790Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:00:22.790Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T02:00:22.790Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 11) | {"total":11}
[2025-07-01T02:00:22.790Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T02:00:22.790Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T02:00:22.791Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 11 mensajes, último "Como" (4 chars)
[2025-07-01T02:00:29.467Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:00:29.467Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:00:29.467Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:00:29.467Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:00:29.468Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va hodozkzkdjzjdjdjdjd" | {"userName":"Alexander","preview":"Va hodozkzkdjzjdjdjdjd"}
[2025-07-01T02:00:29.468Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 12) | {"total":12}
[2025-07-01T02:00:29.468Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T02:00:29.468Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T02:00:29.468Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 12 mensajes, último "Va hodozkzkdjzjdjdjdjd" (22 chars)
[2025-07-01T02:00:33.007Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:00:33.008Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:00:33.008Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:00:33.008Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:00:33.008Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ddddddd" | {"userName":"Alexander","preview":"Ddddddd"}
[2025-07-01T02:00:33.008Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 13) | {"total":13}
[2025-07-01T02:00:33.008Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T02:00:33.008Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T02:00:33.009Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 13 mensajes, último "Ddddddd" (7 chars)
[2025-07-01T02:00:49.857Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:00:49.857Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:00:49.857Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:00:49.857Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:00:49.858Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T02:00:49.858Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 14) | {"total":14}
[2025-07-01T02:00:49.858Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T02:00:49.858Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T02:00:49.858Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 14 mensajes, último "Como" (4 chars)
[2025-07-01T02:00:55.392Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:00:55.424Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:00:55.426Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:00:55.427Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:00:55.427Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:00:55.427Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:00:55.428Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:00:55.428Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:00:55.429Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:00:55.429Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:00:55.433Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:00:56.541Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:00:56.542Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:00:56.542Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:00:56.542Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:00:56.542Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va hodozkzkdjzjdjdjdjd" | {"userName":"Alexander","preview":"Va hodozkzkdjzjdjdjdjd"}
[2025-07-01T02:00:56.543Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:00:56.543Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:00:56.543Z] [INFO] WRITING_NORMAL [app.ts]: 💬 573003913251: Escritura normal - usando timeout inteligente
[2025-07-01T02:00:56.544Z] [INFO] TIMER [app.ts]: ⏱️ 573003913251: Timer configurado (5s) | {"messageCount":1,"totalLength":22,"averageLength":22,"hasLikelyFinal":false,"recommendedAction":"wait","writingState":"normal","timeout":"5000ms"}
[2025-07-01T02:01:00.072Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:01:00.073Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:01:00.074Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:01:00.074Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:01:00.074Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ddddddd" | {"userName":"Alexander","preview":"Ddddddd"}
[2025-07-01T02:01:00.075Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T02:01:00.075Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T02:01:00.075Z] [SUCCESS] WRITING_ACTIVE [app.ts]: ✍️ 573003913251: Escribiendo activamente - pausando procesamiento
[2025-07-01T02:01:00.076Z] [INFO] WRITING_PATTERN [app.ts]: Patrón detectado: 2 mensajes, último "Ddddddd" (7 chars)
[2025-07-01T02:01:04.499Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:01:04.532Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:01:04.534Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:01:04.534Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:01:04.534Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:01:04.535Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:01:04.535Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:01:04.536Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:01:04.536Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:01:04.536Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:01:04.540Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:01:09.289Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:01:09.290Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:01:09.290Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:01:09.290Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:01:09.291Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T02:01:09.291Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:01:09.292Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:01:09.292Z] [INFO] WRITING_NORMAL [app.ts]: 💬 573003913251: Escritura normal - usando timeout inteligente
[2025-07-01T02:01:09.292Z] [INFO] TIMER [app.ts]: ⏱️ 573003913251: Timer configurado (5s) | {"messageCount":1,"totalLength":4,"averageLength":4,"hasLikelyFinal":false,"recommendedAction":"wait","writingState":"normal","timeout":"5000ms"}
[2025-07-01T02:01:12.292Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:01:12.324Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:01:12.326Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:01:12.326Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:01:12.327Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:01:12.327Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:01:12.327Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:01:12.328Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:01:12.328Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:01:12.329Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:01:12.333Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:01:18.988Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:01:19.025Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:01:19.028Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:01:19.028Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:01:19.029Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:01:19.029Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:01:19.030Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:01:19.031Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:01:19.031Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:01:19.032Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:01:19.038Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:01:27.762Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:01:27.824Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:01:27.828Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:01:27.828Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:01:27.829Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:01:27.829Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:01:27.830Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:01:27.831Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:01:27.831Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:01:27.832Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:01:27.840Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:01:33.871Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:01:33.912Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:01:33.915Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:01:33.916Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:01:33.916Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:01:33.917Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:01:33.918Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:01:33.919Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:01:33.919Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:01:33.920Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:01:33.925Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:01:37.488Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:01:37.488Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:01:37.488Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:01:37.489Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:01:37.489Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ddddddd" | {"userName":"Alexander","preview":"Ddddddd"}
[2025-07-01T02:01:37.489Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:01:37.490Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:01:37.490Z] [INFO] WRITING_NORMAL [app.ts]: 💬 573003913251: Escritura normal - usando timeout inteligente
[2025-07-01T02:01:37.490Z] [INFO] TIMER [app.ts]: ⏱️ 573003913251: Timer configurado (5s) | {"messageCount":1,"totalLength":7,"averageLength":7,"hasLikelyFinal":false,"recommendedAction":"wait","writingState":"normal","timeout":"5000ms"}
[2025-07-01T02:01:39.998Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:01:40.030Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:01:40.032Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:01:40.032Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:01:40.033Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:01:40.033Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:01:40.033Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:01:40.034Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:01:40.035Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:01:40.035Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:01:40.039Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:01:51.766Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:01:51.798Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:01:51.800Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:01:51.800Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:01:51.801Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:01:51.801Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:01:51.801Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:01:51.802Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:01:51.803Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:01:51.803Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:01:51.808Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:02:04.645Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:02:04.676Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:02:04.678Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:02:04.678Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:02:04.679Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:02:04.679Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:02:04.679Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:02:04.680Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:02:04.681Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:02:04.681Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:02:04.685Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:02:12.145Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:02:12.176Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:02:12.178Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:02:12.179Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:02:12.179Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:02:12.179Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:02:12.179Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:02:12.180Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:02:12.180Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:02:12.181Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:02:12.186Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:02:21.564Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:02:21.597Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:02:21.599Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:02:21.600Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:02:21.600Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:02:21.600Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:02:21.601Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:02:21.602Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:02:21.602Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:02:21.603Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:02:21.607Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:02:31.700Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:02:31.732Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:02:31.737Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:02:31.737Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:02:31.737Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:02:31.738Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:02:31.738Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:02:31.739Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:02:31.739Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:02:31.740Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:02:31.745Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:02:41.356Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:02:41.388Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:02:41.390Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:02:41.391Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:02:41.391Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:02:41.391Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:02:41.391Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:02:41.392Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:02:41.393Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:02:41.393Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:02:41.398Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:02:51.323Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:02:51.356Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:02:51.360Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:02:51.360Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:02:51.361Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:02:51.361Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:02:51.361Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:02:51.362Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:02:51.363Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:02:51.363Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:02:51.368Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:03:06.017Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:03:06.049Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:03:06.051Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:03:06.052Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:03:06.052Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:03:06.052Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:03:06.052Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:03:06.053Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:03:06.053Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:03:06.054Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:03:06.058Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:03:14.393Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:03:14.425Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:03:14.427Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:03:14.428Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:03:14.428Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:03:14.428Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:03:14.429Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:03:14.429Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:03:14.430Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:03:14.430Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:03:14.435Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:04:43.009Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:04:43.041Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:04:43.043Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:04:43.044Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:04:43.044Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:04:43.044Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:04:43.045Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:04:43.046Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:04:43.046Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:04:43.046Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:04:43.051Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:04:53.179Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:04:53.211Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:04:53.213Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:04:53.214Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:04:53.214Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:04:53.214Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:04:53.214Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:04:53.216Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:04:53.216Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:04:53.217Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:04:53.222Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:05:05.825Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:05:05.857Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:05:05.859Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:05:05.859Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:05:05.860Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:05:05.860Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:05:05.860Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:05:05.861Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:05:05.861Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:05:05.861Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:05:05.865Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:05:18.659Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:05:18.691Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:05:18.693Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:05:18.693Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:05:18.693Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:05:18.693Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:05:18.694Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:05:18.694Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:05:18.695Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:05:18.695Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:05:18.700Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:05:41.664Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:05:41.699Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:05:41.701Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:05:41.701Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:05:41.701Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:05:41.702Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:05:41.702Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:05:41.703Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:05:41.704Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:05:41.704Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:05:41.710Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:06:06.812Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:06:06.845Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:06:06.847Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:06:06.847Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:06:06.847Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:06:06.847Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:06:06.847Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:06:06.848Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:06:06.848Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:06:06.849Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:06:06.853Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:06:08.223Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:06:08.254Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:06:08.257Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:06:08.257Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:06:08.257Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:06:08.258Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:06:08.258Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:06:08.259Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:06:08.259Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:06:08.260Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:06:08.264Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:06:27.218Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:06:27.249Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:06:27.252Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:06:27.252Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:06:27.252Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:06:27.253Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:06:27.253Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:06:27.254Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:06:27.254Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:06:27.254Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:06:27.258Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:07:12.835Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:07:12.835Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:07:12.836Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:07:12.836Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:07:12.836Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T02:07:12.836Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:07:12.836Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:07:12.837Z] [INFO] TIMER [app.ts]: ⏱️ Timer configurado (3s) para 1 mensajes
[2025-07-01T02:07:15.841Z] [INFO] TIMER [app.ts]: ⏰ Procesando mensajes agrupados
[2025-07-01T02:07:15.842Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:07:15.842Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:07:15.843Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":4,"preview":"Hola..."}
[2025-07-01T02:07:15.843Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:07:15.843Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T02:07:15.843Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:07:15.844Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:18.977Z","previousThreads":[]}}
[2025-07-01T02:07:15.844Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z"}
[2025-07-01T02:07:15.844Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T02:07:15.844Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T02:07:15.844Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:07:16.450Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:07:16.450Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":4,"messagePreview":"Hola"}
[2025-07-01T02:07:16.450Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:07:17.524Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_S82dJvuxvfQvZjnOyAzJOwXy"}
[2025-07-01T02:07:19.542Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:07:19.893Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 3699ms | {"duration":3699,"userName":"Alexander"}
[2025-07-01T02:07:19.894Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":90,"preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con respecto a los apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T02:07:19.894Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:07:19.894Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":90,"preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con respecto a los apartamentos en Cartagena?..."}
[2025-07-01T02:07:23.932Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! ¿En qué puedo ayudarte hoy con r..." | {"userName":"Usuario","preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con r..."}
[2025-07-01T02:07:23.933Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T02:07:23.933Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T02:07:24.715Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:07:24.716Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T02:07:24.988Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psr8qmFo.TNxHIo-wAWFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751335645"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:07:27.338Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:07:27.339Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:07:27.339Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:07:27.339Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:07:27.339Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Colskdjdjdjdjsjescribirndolentooo" | {"userName":"Alexander","preview":"Colskdjdjdjdjsjescribirndolentooo"}
[2025-07-01T02:07:27.339Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:07:27.339Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:07:27.340Z] [INFO] TIMER [app.ts]: ⏱️ Timer configurado (5s) para 1 mensajes
[2025-07-01T02:07:32.347Z] [INFO] TIMER [app.ts]: ⏰ Procesando mensajes agrupados
[2025-07-01T02:07:32.347Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:07:32.348Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:07:32.348Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":33,"preview":"Colskdjdjdjdjsjescribirndolentooo..."}
[2025-07-01T02:07:32.348Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:07:32.348Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T02:07:32.348Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:07:32.348Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:07:16.449Z","previousThreads":[]}}
[2025-07-01T02:07:32.348Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:07:16.449Z"}
[2025-07-01T02:07:32.348Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T02:07:32.349Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T02:07:32.349Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:07:33.049Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:07:33.049Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":33,"messagePreview":"Colskdjdjdjdjsjescribirndolentooo"}
[2025-07-01T02:07:33.049Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:07:34.088Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_hUTJvOk6vYTb3eM91nrgIdgv"}
[2025-07-01T02:07:36.399Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:07:36.709Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4051ms | {"duration":4051,"userName":"Alexander"}
[2025-07-01T02:07:36.709Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":137,"preview":"No hay problema, Alexander. Tómate tu tiempo. Estoy aquí para ayudarte con cualquier pregunta que te...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T02:07:36.709Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:07:36.709Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":137,"preview":"No hay problema, Alexander. Tómate tu tiempo. Estoy aquí para ayudarte con cualquier pregunta que te..."}
[2025-07-01T02:07:40.446Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "No hay problema, Alexander. Tómate tu tiempo. Esto..." | {"userName":"Usuario","preview":"No hay problema, Alexander. Tómate tu tiempo. Esto..."}
[2025-07-01T02:07:40.447Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T02:07:40.447Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T02:07:41.265Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:07:41.265Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T02:07:42.015Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsoR01gkQRICPHs-wNKFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751335662"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:07:42.345Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsoR01gkQRICPHs-wNKFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751335663"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:08:52.952Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:08:52.987Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:08:52.989Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:08:52.989Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:08:52.989Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:08:52.989Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:08:52.990Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:08:52.990Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:08:52.991Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:08:52.991Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:08:52.994Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:09:13.817Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:09:13.848Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:09:13.852Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:09:13.853Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:09:13.853Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:09:13.853Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:09:13.853Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:09:13.854Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:09:13.854Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:09:13.855Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:09:13.858Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:09:30.849Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:09:30.882Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:09:30.884Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:09:30.884Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:09:30.884Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:09:30.884Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:09:30.885Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:09:30.885Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:09:30.886Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:09:30.886Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:09:30.890Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:09:43.860Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:09:43.892Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:09:43.894Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:09:43.894Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:09:43.895Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:09:43.895Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:09:43.895Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:09:43.896Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:09:43.896Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:09:43.897Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:09:43.900Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:09:53.181Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:09:53.216Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:09:53.218Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:09:53.218Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:09:53.218Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:09:53.218Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:09:53.219Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:09:53.219Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:09:53.220Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:09:53.220Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:09:53.225Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:10:14.424Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:10:14.425Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:10:14.425Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:10:14.425Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:10:14.426Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T02:10:14.426Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:10:14.426Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:10:14.426Z] [INFO] TIMER [app.ts]: ⏱️ Timer configurado (8s) para 1 mensajes
[2025-07-01T02:10:18.850Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:10:18.850Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:10:18.850Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:10:18.850Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:10:18.850Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo" | {"userName":"Alexander","preview":"Como va todo"}
[2025-07-01T02:10:18.850Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T02:10:18.851Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T02:10:18.851Z] [INFO] TIMER [app.ts]: ⏱️ Timer configurado (8s) para 2 mensajes
[2025-07-01T02:10:22.470Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:10:22.501Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:10:22.506Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:10:22.506Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:10:22.506Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:10:22.506Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:10:22.507Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:10:22.507Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:10:22.508Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:10:22.508Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:10:22.511Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:10:31.002Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:10:31.041Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:10:31.044Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:10:31.045Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:10:31.045Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:10:31.046Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:10:31.047Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:10:31.048Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:10:31.048Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:10:31.049Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:10:31.053Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","inactivityTimeout":"800-3000ms (inteligente)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:10:42.529Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:10:42.562Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:10:42.566Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:10:42.567Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:10:42.567Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:10:42.567Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:10:42.567Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:10:42.568Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:10:42.568Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:10:42.569Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:10:42.573Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:10:57.472Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:10:57.473Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:10:57.473Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:10:57.473Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:10:57.473Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T02:10:57.474Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:10:57.474Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:10:57.474Z] [INFO] TIMER [app.ts]: ⏱️ Timer configurado (8s) para 1 mensajes
[2025-07-01T02:11:02.295Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:11:02.296Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:11:02.296Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:11:02.296Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:11:02.296Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo" | {"userName":"Alexander","preview":"Como va todo"}
[2025-07-01T02:11:02.297Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T02:11:02.297Z] [INFO] TIMER [app.ts]: Timer anterior cancelado para 573003913251
[2025-07-01T02:11:02.297Z] [INFO] TIMER [app.ts]: ⏱️ Timer configurado (8s) para 2 mensajes
[2025-07-01T02:11:10.309Z] [INFO] TIMER [app.ts]: ⏰ Procesando mensajes agrupados
[2025-07-01T02:11:10.310Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:11:10.310Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T02:11:10.310Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":18,"preview":"Hola\n\nComo va todo..."}
[2025-07-01T02:11:10.311Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:11:10.311Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T02:11:10.312Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:11:10.312Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:18.977Z","previousThreads":[]}}
[2025-07-01T02:11:10.312Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z"}
[2025-07-01T02:11:10.312Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T02:11:10.313Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T02:11:10.313Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:11:10.902Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:11:10.902Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":18,"messagePreview":"Hola\n\nComo va todo"}
[2025-07-01T02:11:10.902Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:11:11.899Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_AWSJubbj0PcS7Z6S3qD9a6eC"}
[2025-07-01T02:11:14.349Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:11:14.677Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4038ms | {"duration":4038,"userName":"Alexander"}
[2025-07-01T02:11:14.678Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":103,"preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudarte hoy con la reserva de un apartamento en Cartage...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T02:11:14.678Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:11:14.678Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":103,"preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudarte hoy con la reserva de un apartamento en Cartage..."}
[2025-07-01T02:11:18.399Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudar..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudar..."}
[2025-07-01T02:11:18.400Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T02:11:18.400Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T02:11:19.274Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:11:19.275Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T02:11:19.513Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsofDzq3b4zxh7E-wCmFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751335880"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:12:30.368Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:12:30.402Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:12:30.404Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:12:30.405Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:12:30.405Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:12:30.405Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:12:30.405Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:12:30.406Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:12:30.406Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:12:30.407Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:12:30.410Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:12:59.877Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:12:59.908Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:12:59.910Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:12:59.910Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:12:59.911Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:12:59.911Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:12:59.911Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:12:59.912Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:12:59.912Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:12:59.913Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:12:59.916Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:13:03.697Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:13:03.733Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:13:03.738Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:13:03.738Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:13:03.738Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:13:03.739Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:13:03.739Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:13:03.740Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:13:03.740Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:13:03.741Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:13:03.744Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:13:11.983Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:13:12.016Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:13:12.019Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:13:12.019Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:13:12.019Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:13:12.020Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:13:12.020Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:13:12.021Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:13:12.021Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:13:12.022Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:13:12.025Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:14:38.580Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:14:38.611Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:14:38.614Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:14:38.614Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:14:38.614Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:14:38.614Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:14:38.615Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:14:38.616Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:14:38.616Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:14:38.616Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:14:38.621Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:14:41.941Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:14:41.973Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:14:41.975Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:14:41.975Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:14:41.975Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:14:41.976Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:14:41.976Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:14:41.977Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:14:41.977Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:14:41.978Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:14:41.982Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:15:12.100Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:15:12.100Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:15:12.100Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:15:12.100Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:15:12.101Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T02:15:12.101Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:15:12.101Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:15:12.102Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T02:15:16.093Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:15:16.094Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:15:16.094Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:15:16.094Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:15:16.094Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va" | {"userName":"Alexander","preview":"Como va"}
[2025-07-01T02:15:16.094Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T02:15:16.094Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (2)
[2025-07-01T02:15:20.655Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:15:20.655Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:15:20.656Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:15:20.656Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:15:20.656Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Todo" | {"userName":"Alexander","preview":"Todo"}
[2025-07-01T02:15:20.656Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T02:15:20.656Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (3)
[2025-07-01T02:15:24.733Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:15:24.733Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:15:24.734Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:15:24.734Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:15:24.734Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Que se dice?" | {"userName":"Alexander","preview":"Que se dice?"}
[2025-07-01T02:15:24.734Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4) | {"total":4}
[2025-07-01T02:15:24.734Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (4)
[2025-07-01T02:15:32.737Z] [INFO] TIMER [app.ts]: ✅ Procesando 4 mensajes
[2025-07-01T02:15:32.738Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:15:32.739Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 4) | {"total":4}
[2025-07-01T02:15:32.739Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 4 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":33,"preview":"Hola\n\nComo va\n\nTodo\n\nQue se dice?..."}
[2025-07-01T02:15:32.739Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:15:32.739Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T02:15:32.740Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:15:32.740Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T01:36:18.977Z","previousThreads":[]}}
[2025-07-01T02:15:32.740Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T01:36:18.977Z"}
[2025-07-01T02:15:32.740Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T02:15:32.740Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T02:15:32.741Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:15:33.318Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:15:33.318Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":33,"messagePreview":"Hola\n\nComo va\n\nTodo\n\nQue se dice?"}
[2025-07-01T02:15:33.318Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:15:34.214Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_0QZVEiIJfwl7ccc7rt4aY6fH"}
[2025-07-01T02:15:35.963Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:15:36.352Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 3224ms | {"duration":3224,"userName":"Alexander"}
[2025-07-01T02:15:36.352Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":158,"preview":"¡Hola, Alexander! Todo bien, gracias. Estoy aquí para ayudarte con cualquier pregunta que tengas sob...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T02:15:36.352Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:15:36.352Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":158,"preview":"¡Hola, Alexander! Todo bien, gracias. Estoy aquí para ayudarte con cualquier pregunta que tengas sob..."}
[2025-07-01T02:15:40.262Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo bien, gracias. Estoy aquí p..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo bien, gracias. Estoy aquí p..."}
[2025-07-01T02:15:40.263Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T02:15:40.263Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T02:15:41.032Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:15:41.033Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T02:15:41.217Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psr2oZ_.nMzoS4c-wLmFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336141"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:18:35.944Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:18:35.944Z] [INFO] WEBHOOK_SKIP [app.ts]: Mensaje omitido | {"from_me":true,"type":"text","hasText":true}
[2025-07-01T02:18:36.313Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"rsdXQVHafvXRLTxF4hIQ1A-wHyFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336317"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:18:43.805Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Q6BgFJB_JAU3OGUMuQ4sYg-gDmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336303"},{"id":"R20zjy069kzrO50DPnHuPw-gPuFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336304"},{"id":"OWqLw9CKYaaqEtzB2dIWrw-gLmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336304"},{"id":"DMUJlq.k4_ZXWhS8Nw6L_A-gGGFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336304"},{"id":"JczLCkl6QH.03V5H8QKDWA-gCCFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336304"},{"id":"a_8bL8dlfD0Z6U3KqTP9zw-gDiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336304"},{"id":"CsXhRUw6blPWrv006YY9LA-gF2FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336304"},{"id":"2XGTZUYDYcRdO0m9y89boQ-gKKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336304"},{"id":"378x1rc0A36ik0Egc8aklw-gHuFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336305"},{"id":"_.87JF4rW3yG08tTUyeHUQ-gC.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336305"},{"id":"5kQULL1bYmjAJ3CUZpMiwQ-gIiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336305"},{"id":"Rd6S7HhTvtOUZE7mSTIZOA-gPaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336305"},{"id":"Uhg5wbQLNAAbPPJadXB3Hw-gCaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336305"},{"id":"DaGZ._iDwU_sDoWk3Bzf.w-gHuFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336305"},{"id":"JCUZa4_eyoxagjzMf9LePw-gGWFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336306"},{"id":"uDQQg9CNSDoin_XFwjwu4A-gHmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336306"},{"id":"5sVML02LL.Vn775ku6sKCA-gNyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336306"},{"id":"sG7MQZbRNW5aMkzHmBsoCA-gHiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336306"},{"id":"JBibLPEDxIRxP7Mst.bYMg-gAaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336306"},{"id":"o8YsfD6sxglP68IpyNpzPA-gPOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336306"},{"id":"jA8PfYUOQXrP.6shfYjW1Q-gHmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336307"},{"id":"ETlja8e0hB8Vxz7I4tZBoA-gCOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336307"},{"id":"aej9hcP_QKlAzupEzxW4MQ-gLCFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336307"},{"id":"zJF8dl5d8cUVy_AOqSQ93Q-gGKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336307"},{"id":"kmersdhfnZT8nwLlGVWkUA-gHqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336307"},{"id":"TIqQ4UmP0AzyvqYLt6.1Ng-gNuFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336307"},{"id":"8mMQNvCwNYXAUO.REhtezw-gPqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336307"},{"id":"lBM0I8T0kUoXCmc0pQHbOg-gM2FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336308"},{"id":"DTyr37qSs6rwFGmNe_FeQg-gN2FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336308"},{"id":"Iqky0zr8wyMo0tvwLiIIWg-gK6FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336308"},{"id":"MvXGoUxHVnuujHUv3WY9NA-gLiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336308"},{"id":"jKStGZANJAHQoOTxmJfvUg-gJqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336308"},{"id":"90SU2QQofXFyc8VqPlwwDQ-gMeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336308"},{"id":"IWaT0Uv__MK7YU9ho8q9aA-gKmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336309"},{"id":"dMss3Z4K50jS31ONdr1Jjw-gOGFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336309"},{"id":"zwhiWwtfP2s7mUP98gXGxg-gMyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336309"},{"id":"HRYcX7PsoR5v5TNk.TViQg-gI2FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336309"},{"id":"y96VK7COup2NUYkA3h.W8A-gNCFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336309"},{"id":"RbTy.0BmB6P5oxr3v0.sEQ-gBOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336309"},{"id":"7qPz7jTj_uHosODLjEM8kw-gJqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336310"},{"id":"3KTF7FUobVYYkUHB1b0FGQ-gE2FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336310"},{"id":"vJu3WrPAnVr6en.a4NoPgA-gG.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336310"},{"id":"3bHCe2OxGqfeqCeDij4Lvw-gJKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336310"},{"id":"6PvXrTV4gaKRL.E4zlAJ6g-gHiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336310"},{"id":"D5aoNF7N8hK.kCxW.OLBnA-gDWFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336310"},{"id":"zrIWQ4lEzpFP3fRCm5fBcA-gKuFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336310"},{"id":"YEcOf9X.RkXCO49rjvm2Ag-gBeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336311"},{"id":"cTTXrXYOFXoRGJms5V0L4w-gMeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336311"},{"id":"ZQLaFz6DdQgA1m71.rV46A-gI.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336311"},{"id":"uutHokIzisEWWvJ1jOZ3zg-gISFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336311"},{"id":"zbUqj_b3aPD0z2ZwQnOQXw-gJmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336311"},{"id":"zTv7u421Vu4I7dNaPULJVw-gOqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336311"},{"id":"cw7dF2IVYlRqxy448oEkyQ-gFyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336312"},{"id":"9mmGGG59uPB9bYr24LWbiA-gNyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336312"},{"id":"CogQEUUht9gkx6sXAzVo5Q-gMOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336312"},{"id":"x5sJFu4B8KvpfSDiIMjgOQ-gBWFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336312"},{"id":"CKcaoBPY_N9TrhdQ2xMKow-gD.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336312"},{"id":"c30YF7vUatNRlhD4HUULlA-gKOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336312"},{"id":"qxnfpIWXeLnoHi7YtogC6g-gCOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336312"},{"id":"BBwm7lSCyR09ZM0gKhn6tQ-gK.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336313"},{"id":"VI8xWrS3qAwLTu7uVKYpCQ-gCOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336313"},{"id":"7BjQlWcVxkO6eYb8B0Z3ww-gAeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336313"},{"id":"vnboA6GSd6AHVe7xzAe_Vw-gCKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336313"},{"id":"KTk3_JjQb6YObCUAwsDBBA-gKqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336313"},{"id":"TlCN06.iR.qcaIJd6TlFdQ-gBmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336313"},{"id":"H_WEww21_4OitlMRJHAHPw-gGmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336314"},{"id":"sNG5YIjbRuXGOsF5GDsNwg-gAeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336314"},{"id":"W6bf0gjGr9t1XNkOuB8wzQ-gE.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336314"},{"id":"1diEUq95.dClrkpU19cIAg-gCOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336314"},{"id":"S8k5YtSwSkil9f93ZEFWfw-gM2FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336314"},{"id":"B6LQD9EKELdLNlKyEBmG8g-gGKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336314"},{"id":"9momID5rsa9AavI8w0iNJw-gDaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336314"},{"id":"6NopwNi2kpwhIVsV.2OpGA-gKOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336315"},{"id":"35O_0tdPj6nAB5eil4K3og-gCWFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336315"},{"id":"gAYAvNa15_wxtfxhKeinRg-gLCFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336315"},{"id":"6CC2jhyMPwcutmzajp2MnQ-gNiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336315"},{"id":"8nSIU.mjZu5FrtqT7xQZqA-gBmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336315"},{"id":"30nArgURU77tE3lDt194tw-gBqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336315"},{"id":"4ItrdB7vSq8XZllRiStb0w-gKeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336316"},{"id":"Eth_B3GOIfz_hNN7wMkOpA-gFaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336316"},{"id":"a3ODMzOnZEBzIvbEK4U3xA-gMqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336316"},{"id":"o.aTRqmvt6tfKgJllsMpiw-gGCFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336316"},{"id":"qYBWy4fwO3LsR5U5h.dg7A-gBCFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336316"},{"id":"A2XxtcYfQJAefj1sHSGACg-gBqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336316"},{"id":"VnPBeGHk.s8PpjASQ3OxsQ-gIiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336317"},{"id":"wgLpgILic1H1My76f9JxZg-gPaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336317"},{"id":"nvbuYAsMRf9SecoE7_chJQ-gKqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336317"},{"id":"_gh8nj9EVZZcbDyxmo7Czg-gBKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336317"},{"id":"fHK2ZPArx8JxhXIKzb0jGA-gGSFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336317"},{"id":"rbZtCv_kgfh7GHsL4qoXpA-gHaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336317"},{"id":"4ex8SyZjmHOh0Clhx4dKuA-gFWFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336318"},{"id":"V3FjVjsYIWXLjSygujy17g-gLiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336318"},{"id":"f9Tr4Tu8rayW5UtTWuQHJA-gImFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336318"},{"id":"Rs1XkIXsZLs2lhYcOFeohw-gAqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336318"},{"id":"mV97voTU4505iKW5UUHk2w-gHqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336318"},{"id":"INeQLqgG3SVrGaUBudEtGg-gEqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336318"},{"id":"njpE.BODVbpxMbdCVNX.BA-gGCFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336318"},{"id":"uoGuZhtSmbVcWndwhAiTOQ-gKmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336319"},{"id":"trYVCJ1lb8wCHEU.bkBl1g-gL6FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336319"},{"id":"iYlbh4PRESPznO7DB5EV4w-gBuFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336319"},{"id":"LQ_gyNEzujprFNsco5Mvvw-gA2FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336319"},{"id":"iSSCW1DS_gupE0Id0m6Seg-gE6FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336319"},{"id":"Rhw_Z0JKz8vMjBhyR5Qpgg-gBWFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336319"},{"id":"lYKB8GgGcL80gO1mzV34Xg-gKeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336319"},{"id":"2XjmvZpzMazj1wPXHyHmPw-gF.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336320"},{"id":"E.F0QF5jq3lXEu6YpG59Rw-gCSFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336320"},{"id":"USP_cR8gKzWcA5LyqNTSDA-gCqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336320"},{"id":"zArlPVEDmI6K9KE75yPUzA-gB2FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336320"},{"id":"AWq_5XOWx_GplOwhIk6.Tg-gNiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336320"},{"id":"fX0zyVOIj28Gg3NI3swJNA-gCCFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336320"},{"id":"1SflrQSHroM9cmRTas2O.w-gL.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336321"},{"id":"eNEgDbxkCTStc.RNvcActA-gG.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336321"},{"id":"8QAaFcGpEuGtnxHU_YJndw-gGeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336321"},{"id":"r4Ry3G6yx364r6uBrxvbNQ-gA2FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336321"},{"id":"kbYnrgR_zCHKpPt0fSFWbQ-gKaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336321"},{"id":"LKmg4fqNrkI2pmkXKBTe8A-gKOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336321"},{"id":"pT0Bmub8qr9Crf8EFKYsuA-gCyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336321"},{"id":"lFxiERgeIqpCuPnqeUGzsw-gFiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336322"},{"id":"AZUOYoWQo0m3b5lyEu8ftw-gFCFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336322"},{"id":"h6mO83OAxs48FzbJeGct0g-gGeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336322"},{"id":".RpVmV0wAqCWBVtlyyPV1g-gPiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336322"},{"id":"150BlR.VIBfWdpLQ8b10XA-gJOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336322"},{"id":"q01s0Omum3GtVCt97n_x_g-gBKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336322"},{"id":"aWJjM9dtad._uKFCLTvhuw-gDKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336323"},{"id":"im5dKsx23vel2Dvb6PtbUA-gMuFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336323"},{"id":"7E_I6ya8kYgle1dvVgPTgA-gHqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336323"},{"id":"DSNzP0fGos.sgClE_TEiZg-gMKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336323"},{"id":"4cZMjNdr8XfLtcechG9KPQ-gFGFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336323"},{"id":"RWnsy0E91WNQarsKos2GsA-gJ.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336323"},{"id":"Ii0DENF2jNoK7r_z68FeZg-gEuFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751336323"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:31:14.595Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:31:14.636Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:31:14.640Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:31:14.640Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:31:14.641Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:31:14.641Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:31:14.641Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:15:33.317Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:31:14.642Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:31:14.643Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:31:14.643Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:31:14.649Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:36:40.544Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:36:40.577Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:36:40.579Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:36:40.580Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:36:40.580Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:36:40.580Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:36:40.580Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:15:33.317Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:36:40.581Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:36:40.581Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:36:40.582Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:36:40.585Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:38:45.340Z] [INFO] HEALTH_CHECK [app.ts]: Health check solicitado | {"status":"Bot funcionando","timestamp":"2025-07-01T02:38:45.340Z","version":"fixed-8s-timeouts","activeThreads":1,"activeBuffers":0,"activeTyping":0,"threadStats":{"totalThreads":1,"activeThreads":1},"typingSystem":{"totalUsers":0,"usersWithTyping":0,"usersWithoutTyping":0,"averageConfidence":0}}
[2025-07-01T02:39:33.149Z] [INFO] HEALTH_CHECK [app.ts]: Health check solicitado | {"status":"Bot funcionando","timestamp":"2025-07-01T02:39:33.149Z","version":"fixed-8s-timeouts","activeThreads":1,"activeBuffers":0,"activeTyping":0,"threadStats":{"totalThreads":1,"activeThreads":1},"typingSystem":{"totalUsers":0,"usersWithTyping":0,"usersWithoutTyping":0,"averageConfidence":0}}
[2025-07-01T02:40:23.966Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:40:23.999Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:40:24.004Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:40:24.004Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:40:24.004Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:40:24.004Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:40:24.004Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:15:33.317Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:40:24.005Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:40:24.006Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:40:24.006Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:40:24.011Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:41:04.427Z] [INFO] HEALTH_CHECK [app.ts]: Health check solicitado | {"status":"Bot funcionando","timestamp":"2025-07-01T02:41:04.427Z","version":"fixed-8s-timeouts","activeThreads":1,"activeBuffers":0,"activeTyping":0,"threadStats":{"totalThreads":1,"activeThreads":1},"typingSystem":{"totalUsers":0,"usersWithTyping":0,"usersWithoutTyping":0,"averageConfidence":0}}
[2025-07-01T02:41:24.199Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:41:24.200Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:41:24.200Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:41:24.200Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:41:24.200Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T02:41:24.201Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:41:24.201Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:41:24.201Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T02:41:25.300Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:41:25.334Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:41:25.337Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:41:25.337Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:41:25.338Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:41:25.338Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:41:25.339Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:15:33.317Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:41:25.340Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:41:25.341Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:41:25.341Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:41:25.346Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:41:27.642Z] [INFO] HEALTH_CHECK [app.ts]: Health check solicitado | {"status":"Bot funcionando","timestamp":"2025-07-01T02:41:27.642Z","version":"fixed-8s-timeouts","activeThreads":1,"activeBuffers":0,"activeTyping":0,"threadStats":{"totalThreads":1,"activeThreads":1},"typingSystem":{"totalUsers":0,"usersWithTyping":0,"usersWithoutTyping":0,"averageConfidence":0}}
[2025-07-01T02:41:48.199Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:41:48.199Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:41:48.200Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:41:48.200Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:41:48.200Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ch ola" | {"userName":"Alexander","preview":"Ch ola"}
[2025-07-01T02:41:48.200Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:41:48.200Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:41:48.201Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T02:41:56.211Z] [INFO] TIMER [app.ts]: ✅ Procesando 1 mensajes
[2025-07-01T02:41:56.213Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:41:56.213Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:41:56.213Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":6,"preview":"Ch ola..."}
[2025-07-01T02:41:56.213Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:41:56.213Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T02:41:56.214Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:41:56.214Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:15:33.317Z","previousThreads":[]}}
[2025-07-01T02:41:56.214Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:15:33.317Z"}
[2025-07-01T02:41:56.214Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T02:41:56.214Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T02:41:56.214Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:41:57.039Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:41:57.039Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":6,"messagePreview":"Ch ola"}
[2025-07-01T02:41:57.040Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:41:59.193Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_XUST9oNBaR4uLjaL1RfFzEQG"}
[2025-07-01T02:42:01.864Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:42:02.167Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5651ms | {"duration":5651,"userName":"Alexander"}
[2025-07-01T02:42:02.167Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":86,"preview":"¡Hola, Alexander! ¿En qué puedo ayudarte con respecto a los apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T02:42:02.167Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:42:02.168Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":86,"preview":"¡Hola, Alexander! ¿En qué puedo ayudarte con respecto a los apartamentos en Cartagena?..."}
[2025-07-01T02:42:06.023Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! ¿En qué puedo ayudarte con respe..." | {"userName":"Usuario","preview":"¡Hola, Alexander! ¿En qué puedo ayudarte con respe..."}
[2025-07-01T02:42:06.023Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T02:42:06.023Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T02:42:06.807Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:42:06.807Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:42:06.807Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "¡Hola, Alexander! ¿En qué puedo ayudarte con respe..."
[2025-07-01T02:42:06.808Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:42:06.808Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:41:57.039Z","previousThreads":[]}}
[2025-07-01T02:42:06.808Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:41:57.039Z"}
[2025-07-01T02:42:07.924Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con OpenAI para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":86}
[2025-07-01T02:42:07.946Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psp8qgiYMGyV2U8-wLeFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337728"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:42:14.663Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"03flpQOzPRBiC3BQv2Xxzg-gOmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337734"},{"id":"Eu4lcMFXM1QaJkXE2W4TJQ-gGmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337734"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:42:19.367Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:42:19.367Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:42:19.367Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "Entrada manual..."
[2025-07-01T02:42:19.367Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:42:19.367Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:41:57.039Z","previousThreads":[]}}
[2025-07-01T02:42:19.368Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:41:57.039Z"}
[2025-07-01T02:42:19.479Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"SJh_rHMceHPq7i.Yfq6G9Q-wO.FabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337740"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:42:19.965Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con OpenAI para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":14}
[2025-07-01T02:43:44.107Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:43:44.108Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:43:44.109Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:43:44.109Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:43:44.109Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T02:43:44.110Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:43:44.110Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:43:44.110Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T02:43:45.440Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"TS.wt7hB6yBMrqu8OEoq0w-gG.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337825"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:43:47.598Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:43:47.599Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:43:47.599Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:43:47.599Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:43:47.599Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Esto" | {"userName":"Alexander","preview":"Esto"}
[2025-07-01T02:43:47.600Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T02:43:47.600Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (2)
[2025-07-01T02:43:49.188Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Lv_XVbvyflzTb8rk1MNOlw-gESFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337829"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:43:52.191Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:43:52.192Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:43:52.192Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:43:52.192Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:43:52.192Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Es una entrada manual" | {"userName":"Alexander","preview":"Es una entrada manual"}
[2025-07-01T02:43:52.192Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T02:43:52.193Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (3)
[2025-07-01T02:43:53.793Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"hIGcbmeeIJv2584jKU7EKg-gPuFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337834"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:44:00.205Z] [INFO] TIMER [app.ts]: ✅ Procesando 3 mensajes
[2025-07-01T02:44:00.206Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:44:00.206Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 3) | {"total":3}
[2025-07-01T02:44:00.206Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 3 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":33,"preview":"Hola\n\nEsto\n\nEs una entrada manual..."}
[2025-07-01T02:44:00.206Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:44:00.206Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T02:44:00.207Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:44:00.207Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:41:57.039Z","previousThreads":[]}}
[2025-07-01T02:44:00.207Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:41:57.039Z"}
[2025-07-01T02:44:00.207Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T02:44:00.207Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T02:44:00.207Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:44:00.822Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:44:00.822Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":33,"messagePreview":"Hola\n\nEsto\n\nEs una entrada manual"}
[2025-07-01T02:44:00.822Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:44:00.911Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:44:00.912Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:44:00.912Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "Mentira..."
[2025-07-01T02:44:00.912Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:44:00.912Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:44:00.821Z","previousThreads":[]}}
[2025-07-01T02:44:00.912Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:44:00.821Z"}
[2025-07-01T02:44:01.506Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con OpenAI para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":7}
[2025-07-01T02:44:02.028Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Muk4SKVu45yFpsvraFbdzw-wPyFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337842"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:44:02.258Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:44:02.258Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:44:02.258Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "Esto..."
[2025-07-01T02:44:02.259Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:44:02.259Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:44:00.821Z","previousThreads":[]}}
[2025-07-01T02:44:02.259Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:44:00.821Z"}
[2025-07-01T02:44:02.618Z] [ERROR] MANUAL_SYNC [app.ts]: ❌ Error sincronizando mensaje manual para 573003913251 | {"error":"400 Can't add messages to thread_iGJlkyZND0iuKp5h7J1d0QY1 while a run run_b3EwXQs7Fxr37LaefbPzxnTC is active.","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:44:03.044Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_b3EwXQs7Fxr37LaefbPzxnTC"}
[2025-07-01T02:44:03.382Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"AZ0BPMUcFJZi8eLT8YNLLw-wKuFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337844"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:44:04.941Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:44:04.941Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:44:04.941Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "Si es una..."
[2025-07-01T02:44:04.942Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:44:04.942Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:44:00.821Z","previousThreads":[]}}
[2025-07-01T02:44:04.942Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:44:00.821Z"}
[2025-07-01T02:44:05.353Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con OpenAI para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":9}
[2025-07-01T02:44:05.475Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:44:05.687Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5269ms | {"duration":5269,"userName":"Alexander"}
[2025-07-01T02:44:05.687Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":9,"preview":"Si es una...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T02:44:05.688Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:44:05.688Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":9,"preview":"Si es una..."}
[2025-07-01T02:44:06.097Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"lENaVtFTyiBHrTR121FZgw-wOqFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337846"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:44:08.149Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:44:08.149Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:44:08.149Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "E traes manual..."
[2025-07-01T02:44:08.149Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:44:08.150Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:44:00.821Z","previousThreads":[]}}
[2025-07-01T02:44:08.150Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:44:00.821Z"}
[2025-07-01T02:44:08.469Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con OpenAI para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":14}
[2025-07-01T02:44:09.272Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"VbFrn1XaoDkUNAq06sw95Q-wMqFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337850"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:44:09.435Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Si es una..." | {"userName":"Usuario","preview":"Si es una..."}
[2025-07-01T02:44:09.436Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T02:44:09.436Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T02:44:09.933Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:44:09.933Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:44:09.933Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "Si es una..."
[2025-07-01T02:44:09.934Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:44:09.934Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:44:00.821Z","previousThreads":[]}}
[2025-07-01T02:44:09.934Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:44:00.821Z"}
[2025-07-01T02:44:10.369Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con OpenAI para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":9}
[2025-07-01T02:44:10.415Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Pso.lk42l3dWzKU-wMCFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337851"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:44:10.787Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Pso.lk42l3dWzKU-wMCFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337851"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:45:42.744Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:45:42.777Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:45:42.779Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:45:42.780Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:45:42.780Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:45:42.780Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:45:42.781Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:15:33.317Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:45:42.782Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:45:42.782Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:45:42.782Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:45:42.787Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:45:56.365Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:45:56.366Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:45:56.366Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:45:56.366Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:45:56.366Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hoka" | {"userName":"Alexander","preview":"Hoka"}
[2025-07-01T02:45:56.366Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:45:56.367Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:45:56.367Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T02:45:57.695Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"XI9rAYdKWlvaxMxnLj1Wvw-gHOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337957"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:46:00.499Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:46:00.499Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:46:00.500Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:00.500Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:46:00.500Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T02:46:00.500Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T02:46:00.500Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (2)
[2025-07-01T02:46:02.079Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"tjNWaibQ2THX_g0UZi2umg-gISFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337962"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:46:03.655Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:46:03.656Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:46:03.656Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:03.656Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:46:03.656Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo" | {"userName":"Alexander","preview":"Como va todo"}
[2025-07-01T02:46:03.657Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T02:46:03.657Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (3)
[2025-07-01T02:46:05.224Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"O_BVbdIz1CA5n0Bz6FiMeA-gHyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337965"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:46:11.664Z] [INFO] TIMER [app.ts]: ✅ Procesando 3 mensajes
[2025-07-01T02:46:11.665Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:11.665Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 3) | {"total":3}
[2025-07-01T02:46:11.666Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 3 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":24,"preview":"Hoka\n\nHola\n\nComo va todo..."}
[2025-07-01T02:46:11.666Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:11.666Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T02:46:11.666Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:11.666Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:15:33.317Z","previousThreads":[]}}
[2025-07-01T02:46:11.667Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:15:33.317Z"}
[2025-07-01T02:46:11.667Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T02:46:11.667Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T02:46:11.667Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:46:12.248Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:46:12.248Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":24,"messagePreview":"Hoka\n\nHola\n\nComo va todo"}
[2025-07-01T02:46:12.248Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:46:13.121Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_gKwvTRt1Uo9k7bVMCScKgBlD"}
[2025-07-01T02:46:14.912Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:46:15.129Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 3246ms | {"duration":3246,"userName":"Alexander"}
[2025-07-01T02:46:15.129Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":102,"preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudarte hoy con respecto a los apartamentos en Cartagen...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T02:46:15.129Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:46:15.129Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":102,"preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudarte hoy con respecto a los apartamentos en Cartagen..."}
[2025-07-01T02:46:15.234Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:46:15.234Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:46:15.234Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:15.234Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:46:15.235Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Que precio tiene los apartamentos" | {"userName":"Alexander","preview":"Que precio tiene los apartamentos"}
[2025-07-01T02:46:15.235Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4) | {"total":4}
[2025-07-01T02:46:15.235Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (4)
[2025-07-01T02:46:16.800Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"LqUAdyATa2e_rPCyMaU..g-gCOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337977"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:46:18.931Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudar..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudar..."}
[2025-07-01T02:46:18.931Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T02:46:18.932Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T02:46:19.399Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:46:19.399Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:46:19.399Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudar..."
[2025-07-01T02:46:19.399Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:46:19.400Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:46:12.247Z","previousThreads":[]}}
[2025-07-01T02:46:19.400Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:46:12.247Z"}
[2025-07-01T02:46:19.897Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrvXAlJGQaGvKM-wFiFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337980"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:46:20.270Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrvXAlJGQaGvKM-wFiFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751337980"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:46:21.085Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con contexto para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","agentName":"Agente","messageLength":102,"timestamp":1751337979}
[2025-07-01T02:46:23.250Z] [INFO] TIMER [app.ts]: ✅ Procesando 4 mensajes
[2025-07-01T02:46:23.250Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:23.250Z] [WARNING] MESSAGE_PROCESS [app.ts]: Buffer vacío o inexistente para 573003913251
[2025-07-01T02:46:45.395Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:46:45.396Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:46:45.396Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:45.396Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:46:45.396Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Te" | {"userName":"Alexander","preview":"Te"}
[2025-07-01T02:46:45.396Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T02:46:45.396Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T02:46:45.397Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T02:46:46.724Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"v2PRmPHA3wwzwEsk8Z7Pug-gAmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338006"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:46:46.795Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:46:46.795Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:46:46.795Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:46.795Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:46:46.795Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Acabo" | {"userName":"Alexander","preview":"Acabo"}
[2025-07-01T02:46:46.796Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T02:46:46.796Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (2)
[2025-07-01T02:46:47.717Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:46:47.717Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:46:47.717Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:47.718Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:46:47.718Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "De" | {"userName":"Alexander","preview":"De"}
[2025-07-01T02:46:47.718Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T02:46:47.718Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (3)
[2025-07-01T02:46:48.287Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"GP.N.nvRpvsj39W4ewXZFw-gEeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338008"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:46:49.334Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"CoGApQgdDe9H6.YJWCuBHw-gKiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338009"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:46:50.367Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:46:50.368Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:46:50.368Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:50.368Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:46:50.368Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Preguntas" | {"userName":"Alexander","preview":"Preguntas"}
[2025-07-01T02:46:50.368Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4) | {"total":4}
[2025-07-01T02:46:50.368Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (4)
[2025-07-01T02:46:52.030Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"XxV0wmZa44mEaAUzQ.QGrg-gGyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338012"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:46:55.861Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:46:55.862Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T02:46:55.862Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:46:55.862Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T02:46:55.862Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Que precio tienen los apartamentos" | {"userName":"Alexander","preview":"Que precio tienen los apartamentos"}
[2025-07-01T02:46:55.862Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 5) | {"total":5}
[2025-07-01T02:46:55.862Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (5)
[2025-07-01T02:46:57.457Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"YQg2hsYzqFCALqQaFvQGgg-gCmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338017"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:47:03.866Z] [INFO] TIMER [app.ts]: ✅ Procesando 5 mensajes
[2025-07-01T02:47:03.866Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:47:03.867Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 5) | {"total":5}
[2025-07-01T02:47:03.867Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 5 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":60,"preview":"Te\n\nAcabo\n\nDe\n\nPreguntas\n\nQue precio tienen los apartamentos..."}
[2025-07-01T02:47:03.867Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:47:03.867Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T02:47:03.867Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T02:47:03.867Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:46:21.085Z","previousThreads":[]}}
[2025-07-01T02:47:03.867Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:46:21.085Z"}
[2025-07-01T02:47:03.867Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T02:47:03.867Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T02:47:03.868Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:47:04.659Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:47:04.660Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":60,"messagePreview":"Te\n\nAcabo\n\nDe\n\nPreguntas\n\nQue precio tienen los apartamentos"}
[2025-07-01T02:47:04.660Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:47:06.541Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_9Qf1gleRTeYPMC9L2iuYTyXc"}
[2025-07-01T02:47:09.194Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T02:47:10.304Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5327ms | {"duration":5327,"userName":"Alexander"}
[2025-07-01T02:47:10.305Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":179,"preview":"Para darte información precisa sobre los precios, necesito saber las fechas de tu estancia y el tipo...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T02:47:10.305Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:47:10.305Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":179,"preview":"Para darte información precisa sobre los precios, necesito saber las fechas de tu estancia y el tipo..."}
[2025-07-01T02:47:10.760Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:47:10.761Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:47:10.761Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "Hola..."
[2025-07-01T02:47:10.761Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:47:10.761Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:47:04.659Z","previousThreads":[]}}
[2025-07-01T02:47:10.761Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:04.659Z"}
[2025-07-01T02:47:11.449Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con contexto para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","agentName":"asesor de reservas","messageLength":4,"timestamp":1751338030}
[2025-07-01T02:47:11.642Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"sjJgnsUtqtB9x_EQ1ZXMKg-wDiFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338032"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:47:14.302Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Para darte información precisa sobre los precios, ..." | {"userName":"Usuario","preview":"Para darte información precisa sobre los precios, ..."}
[2025-07-01T02:47:14.303Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T02:47:14.303Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T02:47:14.774Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:47:14.774Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:47:14.774Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "Para darte información precisa sobre los precios, ..."
[2025-07-01T02:47:14.775Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:47:14.775Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:47:11.449Z","previousThreads":[]}}
[2025-07-01T02:47:14.775Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:11.449Z"}
[2025-07-01T02:47:15.181Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psqj5.9B98LW_Fw-wHqFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338035"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:47:15.480Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con contexto para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","agentName":"Agente","messageLength":179,"timestamp":1751338035}
[2025-07-01T02:47:18.714Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:47:18.714Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:47:18.714Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "Tiene un precio..."
[2025-07-01T02:47:18.715Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:47:18.715Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:47:15.479Z","previousThreads":[]}}
[2025-07-01T02:47:18.715Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:15.479Z"}
[2025-07-01T02:47:19.844Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Kq5DMc8ScjthJs8DB6ZLCg-wFKFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338040"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:47:19.918Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con contexto para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","agentName":"asesor de reservas","messageLength":15,"timestamp":1751338039}
[2025-07-01T02:47:23.408Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:47:23.408Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:47:23.408Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "De 220..."
[2025-07-01T02:47:23.409Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:47:23.409Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:47:19.918Z","previousThreads":[]}}
[2025-07-01T02:47:23.409Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:19.918Z"}
[2025-07-01T02:47:24.230Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con contexto para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","agentName":"asesor de reservas","messageLength":6,"timestamp":1751338043}
[2025-07-01T02:47:24.544Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"uHlToN3y_Cp6sQygGrzsrg-wJeFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338045"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:47:25.421Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T02:47:25.421Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:47:25.421Z] [INFO] MANUAL_MESSAGE [app.ts]: 📝 Mensaje manual detectado a 573003913251: "La noche..."
[2025-07-01T02:47:25.421Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T02:47:25.422Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:47:24.229Z","previousThreads":[]}}
[2025-07-01T02:47:25.422Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:24.229Z"}
[2025-07-01T02:47:26.237Z] [SUCCESS] MANUAL_SYNC [app.ts]: ✅ Mensaje manual sincronizado con contexto para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","agentName":"asesor de reservas","messageLength":8,"timestamp":1751338045}
[2025-07-01T02:47:26.566Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"LWJwILGvkwQX1rtgxKK_JQ-wK6FabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338047"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T02:53:21.906Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:53:21.945Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:53:21.948Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:53:21.948Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:53:21.949Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:53:21.949Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:53:21.949Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:53:21.950Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:53:21.951Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:53:21.952Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:53:21.957Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:53:23.195Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:53:23.239Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:53:23.242Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:53:23.243Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:53:23.243Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:53:23.243Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:53:23.244Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:53:23.245Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:53:23.246Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:53:23.246Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:53:23.250Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:57:44.407Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:57:44.440Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:57:44.442Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:57:44.442Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:57:44.443Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:57:44.443Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:57:44.443Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:57:44.444Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:57:44.444Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:57:44.445Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:57:44.449Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:57:52.028Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:57:52.064Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:57:52.070Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:57:52.070Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:57:52.070Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:57:52.071Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:57:52.071Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:57:52.072Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:57:52.072Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:57:52.073Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:57:52.077Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:58:08.308Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:58:08.344Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:58:08.346Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:58:08.346Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:58:08.346Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:58:08.346Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:58:08.347Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:58:08.347Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:58:08.348Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:58:08.348Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:58:08.351Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:58:12.531Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:58:12.567Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:58:12.569Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:58:12.570Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:58:12.570Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:58:12.571Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:58:12.571Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:58:12.573Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:58:12.574Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:58:12.574Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:58:12.579Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:58:19.377Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:58:19.410Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:58:19.414Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:58:19.414Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:58:19.415Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:58:19.415Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:58:19.415Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:58:19.416Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:58:19.416Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:58:19.417Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:58:19.422Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:58:25.567Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:58:25.603Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:58:25.606Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:58:25.606Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:58:25.606Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:58:25.607Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:58:25.607Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:58:25.609Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:58:25.609Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:58:25.610Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:58:25.615Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:59:00.399Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:59:00.431Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:59:00.436Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:59:00.437Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:59:00.437Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:59:00.437Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:59:00.438Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:59:00.438Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:59:00.439Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:59:00.439Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:59:00.443Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:59:13.858Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:59:13.891Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:59:13.893Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:59:13.894Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:59:13.894Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:59:13.894Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:59:13.894Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:59:13.895Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:59:13.895Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:59:13.896Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:59:13.901Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:59:20.735Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:59:20.772Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:59:20.774Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:59:20.775Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:59:20.775Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:59:20.775Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:59:20.776Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:59:20.777Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:59:20.777Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:59:20.778Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:59:20.781Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T02:59:34.483Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T02:59:34.515Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T02:59:34.520Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T02:59:34.520Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T02:59:34.520Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T02:59:34.521Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T02:59:34.521Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T02:59:34.522Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T02:59:34.522Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T02:59:34.522Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T02:59:34.526Z] [SUCCESS] SERVER_START [app.ts]: Servidor iniciado exitosamente | {"port":"3008","timeout":"8000ms (fijo)","debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1}}
[2025-07-01T03:00:13.561Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:00:13.680Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:00:13.685Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:00:13.685Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:00:13.686Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:00:13.686Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:00:13.687Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:00:13.688Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:00:13.688Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:00:13.689Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:00:13.704Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:00:16.967Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:00:17.009Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:00:17.014Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:00:17.014Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:00:17.015Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:00:17.015Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:00:17.016Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:00:17.017Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:00:17.018Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:00:17.019Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:00:17.025Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:00:46.037Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:00:46.037Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:00:46.037Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:00:46.038Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:00:46.038Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:00:46.038Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:00:46.038Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:00:46.038Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:00:46.039Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:47:26.236Z","previousThreads":[]}}
[2025-07-01T03:00:46.039Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z"}
[2025-07-01T03:00:46.039Z] [INFO] CONVERSATION_FLOW [app.ts]: 
📱 FLUJO DE CONVERSACIÓN - 573003913251
├─ Cliente: "Hola..."
├─ Buffer: 1 mensajes
├─ Esperando: 8s para agrupar
└─ Estado: Conversación activa

[2025-07-01T03:00:46.039Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T03:00:49.558Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:00:49.559Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:00:49.559Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:00:49.559Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:00:49.559Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como. A foso" | {"userName":"Alexander","preview":"Como. A foso"}
[2025-07-01T03:00:49.559Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:00:49.560Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:00:49.560Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:47:26.236Z","previousThreads":[]}}
[2025-07-01T03:00:49.560Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z"}
[2025-07-01T03:00:49.560Z] [INFO] CONVERSATION_FLOW [app.ts]: 
📱 FLUJO DE CONVERSACIÓN - 573003913251
├─ Cliente: "Como. A foso..."
├─ Buffer: 2 mensajes
├─ Esperando: 8s para agrupar
└─ Estado: Conversación activa

[2025-07-01T03:00:49.560Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (2)
[2025-07-01T03:00:57.562Z] [INFO] TIMER [app.ts]: ✅ Procesando 2 mensajes
[2025-07-01T03:00:57.563Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:00:57.564Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:00:57.564Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":18,"preview":"Hola\n\nComo. A foso..."}
[2025-07-01T03:00:57.564Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:00:57.565Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:00:57.565Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:00:57.565Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:47:26.236Z","previousThreads":[]}}
[2025-07-01T03:00:57.565Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z"}
[2025-07-01T03:00:57.565Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:00:57.565Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:00:57.566Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:00:58.133Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:00:58.134Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":18,"messagePreview":"Hola\n\nComo. A foso"}
[2025-07-01T03:00:58.134Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:00:59.303Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_L1khuiavvqWaiXOBhog9sUcs"}
[2025-07-01T03:01:01.316Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:01:01.520Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 3751ms | {"duration":3751,"userName":"Alexander"}
[2025-07-01T03:01:01.520Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":90,"preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con respecto a los apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:01:01.521Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:01:01.521Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":90,"preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con respecto a los apartamentos en Cartagena?..."}
[2025-07-01T03:01:05.347Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado: Psp2pAdhRTFVULk-wK6FabHYIw | {"chatId":"573003913251","messageId":"Psp2pAdhRTFVULk-wK6FabHYIw"}
[2025-07-01T03:01:05.347Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! ¿En qué puedo ayudarte hoy con r..." | {"userName":"Usuario","preview":"¡Hola, Alexander! ¿En qué puedo ayudarte hoy con r..."}
[2025-07-01T03:01:05.347Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T03:01:05.347Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:01:06.128Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:01:06.128Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: Psp2pAdhRTFVULk-wK6FabHYIw
[2025-07-01T03:01:06.849Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psp2pAdhRTFVULk-wK6FabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338867"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:01:07.178Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psp2pAdhRTFVULk-wK6FabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338868"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:01:22.031Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:01:22.031Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:01:22.031Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:01:22.031Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:01:22.032Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Quería saber de precios" | {"userName":"Alexander","preview":"Quería saber de precios"}
[2025-07-01T03:01:22.032Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:01:22.032Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:01:22.032Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:01:22.032Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:00:58.133Z","previousThreads":[]}}
[2025-07-01T03:01:22.033Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:00:58.133Z"}
[2025-07-01T03:01:22.034Z] [INFO] CONVERSATION_FLOW [app.ts]: 
📱 FLUJO DE CONVERSACIÓN - 573003913251
├─ Cliente: "Quería saber de precios..."
├─ Buffer: 1 mensajes
├─ Esperando: 8s para agrupar
└─ Estado: Conversación activa

[2025-07-01T03:01:22.034Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T03:01:30.036Z] [INFO] TIMER [app.ts]: ✅ Procesando 1 mensajes
[2025-07-01T03:01:30.036Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:01:30.037Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:01:30.037Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":23,"preview":"Quería saber de precios..."}
[2025-07-01T03:01:30.037Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:01:30.037Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:01:30.037Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:01:30.038Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:00:58.133Z","previousThreads":[]}}
[2025-07-01T03:01:30.038Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:00:58.133Z"}
[2025-07-01T03:01:30.038Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:01:30.038Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:01:30.038Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:01:30.735Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:01:30.735Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":23,"messagePreview":"Quería saber de precios"}
[2025-07-01T03:01:30.735Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:01:31.465Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"hYdLDhVcjuqAU.qabSL0iA-gLaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338891"},{"id":"addFCRABrFleD6CkL3.asQ-gNyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338891"},{"id":"GIEfnOK7M5BuC7oxy5SQSA-gGSFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338891"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:01:32.406Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_IyhWHJyk5MV272YFw9H3x7Au"}
[2025-07-01T03:01:35.729Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:01:35.983Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5692ms | {"duration":5692,"userName":"Alexander"}
[2025-07-01T03:01:35.984Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":153,"preview":"Claro, Alexander. Para poder darte información más precisa, ¿puedes indicarme las fechas de tu estan...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:01:35.984Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:01:35.984Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":153,"preview":"Claro, Alexander. Para poder darte información más precisa, ¿puedes indicarme las fechas de tu estan..."}
[2025-07-01T03:01:39.484Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado: PsoW33GsOE6clbk-wO.FabHYIw | {"chatId":"573003913251","messageId":"PsoW33GsOE6clbk-wO.FabHYIw"}
[2025-07-01T03:01:39.484Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Claro, Alexander. Para poder darte información más..." | {"userName":"Usuario","preview":"Claro, Alexander. Para poder darte información más..."}
[2025-07-01T03:01:39.485Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T03:01:39.485Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:01:40.008Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:01:40.008Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: PsoW33GsOE6clbk-wO.FabHYIw
[2025-07-01T03:01:40.453Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsoW33GsOE6clbk-wO.FabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338901"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:01:40.826Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsoW33GsOE6clbk-wO.FabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338901"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:01:56.366Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:01:56.366Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:01:56.366Z] [INFO] MANUAL_DETECTED [app.ts]: 👤 Mensaje manual de asesor de reservas para 573003913251: "Tenemos a 220 y 350 la noche..."
[2025-07-01T03:01:56.367Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:01:56.367Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:01:30.735Z","previousThreads":[]}}
[2025-07-01T03:01:56.367Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:01:30.735Z"}
[2025-07-01T03:01:56.367Z] [INFO] MANUAL_BUFFER_CREATE [app.ts]: 📦 Nuevo buffer para mensajes manuales de 573003913251
[2025-07-01T03:01:56.368Z] [INFO] MANUAL_BUFFERING [app.ts]: ⏳ Agrupando mensaje manual (1 en buffer)
[2025-07-01T03:01:57.170Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"dg6pmXWqvXqHSlvNufX4EQ-wMqFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338917"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:01:58.488Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:01:58.488Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:01:58.488Z] [INFO] MANUAL_DETECTED [app.ts]: 👤 Mensaje manual de asesor de reservas para 573003913251: "Por apartamento..."
[2025-07-01T03:01:58.488Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:01:58.489Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:01:30.735Z","previousThreads":[]}}
[2025-07-01T03:01:58.489Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:01:30.735Z"}
[2025-07-01T03:01:58.489Z] [INFO] MANUAL_BUFFERING [app.ts]: ⏳ Agrupando mensaje manual (2 en buffer)
[2025-07-01T03:01:59.593Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"cer3saMuELfeumPVuVHpEA-wM6FabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338920"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:02:01.178Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:02:01.179Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:02:01.179Z] [INFO] MANUAL_DETECTED [app.ts]: 👤 Mensaje manual de asesor de reservas para 573003913251: "Y por..."
[2025-07-01T03:02:01.179Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:02:01.179Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:01:30.735Z","previousThreads":[]}}
[2025-07-01T03:02:01.179Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:01:30.735Z"}
[2025-07-01T03:02:01.180Z] [INFO] MANUAL_BUFFERING [app.ts]: ⏳ Agrupando mensaje manual (3 en buffer)
[2025-07-01T03:02:02.304Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"yFx5rWEJjE.BaR5iSN.kiw-wDaFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338923"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:02:02.748Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:02:02.748Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:02:02.749Z] [INFO] MANUAL_DETECTED [app.ts]: 👤 Mensaje manual de asesor de reservas para 573003913251: "Noche..."
[2025-07-01T03:02:02.749Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:02:02.749Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:01:30.735Z","previousThreads":[]}}
[2025-07-01T03:02:02.749Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:01:30.735Z"}
[2025-07-01T03:02:02.749Z] [INFO] MANUAL_BUFFERING [app.ts]: ⏳ Agrupando mensaje manual (4 en buffer)
[2025-07-01T03:02:03.889Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"DO9TKkHGKwTtJ0X_x53TsQ-wDuFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338924"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:02:10.753Z] [INFO] MANUAL_PROCESSING [app.ts]: 🔄 Procesando 4 mensajes manuales agrupados
[2025-07-01T03:02:10.754Z] [INFO] MANUAL_SYNC_START [app.ts]: 📤 Enviando a OpenAI: "Tenemos a 220 y 350 la noche Por apartamento Y por..."
[2025-07-01T03:02:11.626Z] [SUCCESS] MANUAL_SYNC_SUCCESS [app.ts]: ✅ 4 mensajes manuales sincronizados con OpenAI | {"chatId":"573003913251","agentName":"asesor de reservas","messageCount":4,"totalLength":56,"preview":"Tenemos a 220 y 350 la noche Por apartamento Y por Noche..."}
[2025-07-01T03:02:36.767Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:02:36.767Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:02:36.767Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:02:36.767Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:02:36.767Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Aaa muchas gracias" | {"userName":"Alexander","preview":"Aaa muchas gracias"}
[2025-07-01T03:02:36.767Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:02:36.768Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:02:36.768Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:02:36.768Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:02:11.625Z","previousThreads":[]}}
[2025-07-01T03:02:36.768Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:02:11.625Z"}
[2025-07-01T03:02:36.768Z] [INFO] CONVERSATION_FLOW [app.ts]: 
📱 FLUJO DE CONVERSACIÓN - 573003913251
├─ Cliente: "Aaa muchas gracias..."
├─ Buffer: 1 mensajes
├─ Esperando: 8s para agrupar
└─ Estado: Conversación activa

[2025-07-01T03:02:36.768Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T03:02:38.127Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"CwQ55A.e7RgtXmstnIJnmw-gF.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338958"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:02:44.774Z] [INFO] TIMER [app.ts]: ✅ Procesando 1 mensajes
[2025-07-01T03:02:44.774Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:02:44.774Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:02:44.774Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":18,"preview":"Aaa muchas gracias..."}
[2025-07-01T03:02:44.775Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:02:44.775Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:02:44.775Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:02:44.775Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:02:11.625Z","previousThreads":[]}}
[2025-07-01T03:02:44.776Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:02:11.625Z"}
[2025-07-01T03:02:44.776Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:02:44.776Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:02:44.776Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:02:45.369Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:02:45.369Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":18,"messagePreview":"Aaa muchas gracias"}
[2025-07-01T03:02:45.370Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:02:45.628Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:02:45.628Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:02:45.628Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:02:45.629Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:02:45.629Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "A como fue q me dijo" | {"userName":"Alexander","preview":"A como fue q me dijo"}
[2025-07-01T03:02:45.629Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:02:45.629Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:02:45.630Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:02:45.368Z","previousThreads":[]}}
[2025-07-01T03:02:45.630Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:02:45.368Z"}
[2025-07-01T03:02:45.630Z] [INFO] CONVERSATION_FLOW [app.ts]: 
📱 FLUJO DE CONVERSACIÓN - 573003913251
├─ Cliente: "A como fue q me dijo..."
├─ Buffer: 2 mensajes
├─ Esperando: 8s para agrupar
└─ Estado: Conversación activa

[2025-07-01T03:02:45.630Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (2)
[2025-07-01T03:02:46.465Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_DvlduNwtKpEtYB1DrxgLOHEG"}
[2025-07-01T03:02:47.260Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"_rpM_ykjadTCxwBZ5pqZ6w-gPOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338967"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:02:49.603Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:02:50.395Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4828ms | {"duration":4828,"userName":"Alexander"}
[2025-07-01T03:02:50.396Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":137,"preview":"¡De nada, Alexander! Si tienes más preguntas o necesitas ayuda adicional con la reserva, no dudes en...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:02:50.396Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:02:50.396Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":137,"preview":"¡De nada, Alexander! Si tienes más preguntas o necesitas ayuda adicional con la reserva, no dudes en..."}
[2025-07-01T03:02:53.631Z] [INFO] TIMER [app.ts]: ✅ Procesando 2 mensajes
[2025-07-01T03:02:53.631Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:02:53.632Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:02:53.632Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":40,"preview":"Aaa muchas gracias\n\nA como fue q me dijo..."}
[2025-07-01T03:02:53.632Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:02:53.632Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:02:53.633Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:02:53.633Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:02:45.368Z","previousThreads":[]}}
[2025-07-01T03:02:53.633Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:02:45.368Z"}
[2025-07-01T03:02:53.633Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:02:53.633Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:02:53.633Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:02:53.916Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:02:53.916Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":40,"messagePreview":"Aaa muchas gracias\n\nA como fue q me dijo"}
[2025-07-01T03:02:53.916Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:02:54.090Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado: Psolw4dUL61b7Ng-wIeFabHYIw | {"chatId":"573003913251","messageId":"Psolw4dUL61b7Ng-wIeFabHYIw"}
[2025-07-01T03:02:54.090Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡De nada, Alexander! Si tienes más preguntas o nec..." | {"userName":"Usuario","preview":"¡De nada, Alexander! Si tienes más preguntas o nec..."}
[2025-07-01T03:02:54.090Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T03:02:54.090Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:02:54.575Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:02:54.575Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: Psolw4dUL61b7Ng-wIeFabHYIw
[2025-07-01T03:02:54.790Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_4bjKcbXatFxhVxDHaWugPDPC"}
[2025-07-01T03:02:55.085Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psolw4dUL61b7Ng-wIeFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338975"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:02:55.454Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psolw4dUL61b7Ng-wIeFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338975"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:02:57.469Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:02:57.663Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 3837ms | {"duration":3837,"userName":"Alexander"}
[2025-07-01T03:02:57.664Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":136,"preview":"Los precios son 220 y 350 por noche, dependiendo del apartamento que elijas. Si necesitas más detall...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:02:57.664Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:02:57.664Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":136,"preview":"Los precios son 220 y 350 por noche, dependiendo del apartamento que elijas. Si necesitas más detall..."}
[2025-07-01T03:03:01.110Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado: PspK48SytKKE1Es-wMWFabHYIw | {"chatId":"573003913251","messageId":"PspK48SytKKE1Es-wMWFabHYIw"}
[2025-07-01T03:03:01.111Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Los precios son 220 y 350 por noche, dependiendo d..." | {"userName":"Usuario","preview":"Los precios son 220 y 350 por noche, dependiendo d..."}
[2025-07-01T03:03:01.111Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T03:03:01.111Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:03:01.611Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:03:01.612Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: PspK48SytKKE1Es-wMWFabHYIw
[2025-07-01T03:03:02.086Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PspK48SytKKE1Es-wMWFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338982"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:03:02.464Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PspK48SytKKE1Es-wMWFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751338982"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:03:28.605Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:03:28.606Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:03:28.606Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:03:28.606Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:03:28.607Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Perfecto veo q si tienes contexto" | {"userName":"Alexander","preview":"Perfecto veo q si tienes contexto"}
[2025-07-01T03:03:28.607Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:03:28.607Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:03:28.607Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:03:28.608Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:02:53.915Z","previousThreads":[]}}
[2025-07-01T03:03:28.608Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:02:53.915Z"}
[2025-07-01T03:03:28.608Z] [INFO] CONVERSATION_FLOW [app.ts]: 
📱 FLUJO DE CONVERSACIÓN - 573003913251
├─ Cliente: "Perfecto veo q si tienes conte..."
├─ Buffer: 1 mensajes
├─ Esperando: 8s para agrupar
└─ Estado: Conversación activa

[2025-07-01T03:03:28.608Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T03:03:29.981Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"ZYRaNPXjORvlpDcvj52MfQ-gCmFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339010"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:03:36.615Z] [INFO] TIMER [app.ts]: ✅ Procesando 1 mensajes
[2025-07-01T03:03:36.615Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:03:36.615Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:03:36.616Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":33,"preview":"Perfecto veo q si tienes contexto..."}
[2025-07-01T03:03:36.616Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:03:36.616Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:03:36.616Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:03:36.616Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:02:53.915Z","previousThreads":[]}}
[2025-07-01T03:03:36.616Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:02:53.915Z"}
[2025-07-01T03:03:36.616Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:03:36.616Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:03:36.617Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:03:37.084Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:03:37.084Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":33,"messagePreview":"Perfecto veo q si tienes contexto"}
[2025-07-01T03:03:37.084Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:03:38.129Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_HerfShQ2Zs79VcuSB3GvnaMK"}
[2025-07-01T03:03:40.653Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:03:40.962Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4037ms | {"duration":4037,"userName":"Alexander"}
[2025-07-01T03:03:40.962Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":135,"preview":"¡Así es! Estoy aquí para ayudarte con lo que necesites sobre apartamentos en Cartagena. Si tienes má...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:03:40.963Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:03:40.963Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":135,"preview":"¡Así es! Estoy aquí para ayudarte con lo que necesites sobre apartamentos en Cartagena. Si tienes má..."}
[2025-07-01T03:03:44.464Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado: PsrsmUfKx8twwCs-wIuFabHYIw | {"chatId":"573003913251","messageId":"PsrsmUfKx8twwCs-wIuFabHYIw"}
[2025-07-01T03:03:44.464Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Así es! Estoy aquí para ayudarte con lo que neces..." | {"userName":"Usuario","preview":"¡Así es! Estoy aquí para ayudarte con lo que neces..."}
[2025-07-01T03:03:44.465Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T03:03:44.465Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:03:45.290Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:03:45.291Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: PsrsmUfKx8twwCs-wIuFabHYIw
[2025-07-01T03:03:45.506Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrsmUfKx8twwCs-wIuFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339026"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:03:57.129Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:03:57.129Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:03:57.130Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:03:57.130Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:03:57.130Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Ok" | {"userName":"Alexander","preview":"Ok"}
[2025-07-01T03:03:57.130Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:03:57.130Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:03:57.130Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:03:57.130Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:03:37.084Z","previousThreads":[]}}
[2025-07-01T03:03:57.130Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:03:37.084Z"}
[2025-07-01T03:03:57.131Z] [INFO] CONVERSATION_FLOW [app.ts]: 
📱 FLUJO DE CONVERSACIÓN - 573003913251
├─ Cliente: "Ok..."
├─ Buffer: 1 mensajes
├─ Esperando: 8s para agrupar
└─ Estado: Conversación activa

[2025-07-01T03:03:57.131Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T03:03:58.604Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":".Wvd9C9v6sSFhx3LYlKQ9A-gGKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339038"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:04:05.138Z] [INFO] TIMER [app.ts]: ✅ Procesando 1 mensajes
[2025-07-01T03:04:05.139Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:04:05.139Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:04:05.139Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":2,"preview":"Ok..."}
[2025-07-01T03:04:05.139Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:04:05.139Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:04:05.139Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:04:05.139Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:03:37.084Z","previousThreads":[]}}
[2025-07-01T03:04:05.140Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:03:37.084Z"}
[2025-07-01T03:04:05.140Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:04:05.140Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:04:05.140Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:04:05.589Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:04:05.589Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":2,"messagePreview":"Ok"}
[2025-07-01T03:04:05.589Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:04:06.981Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_UjnJ1XjzhI3JnCV0EdU5Co30"}
[2025-07-01T03:04:09.411Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:04:09.664Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4272ms | {"duration":4272,"userName":"Alexander"}
[2025-07-01T03:04:09.664Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":93,"preview":"¡Genial! Si necesitas algo más, estoy aquí para ayudarte. ¡Que tengas un buen día, Alexander!...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:04:09.664Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:04:09.664Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":93,"preview":"¡Genial! Si necesitas algo más, estoy aquí para ayudarte. ¡Que tengas un buen día, Alexander!..."}
[2025-07-01T03:04:13.184Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado: Psq_JuOs56RLYNA-wHeFabHYIw | {"chatId":"573003913251","messageId":"Psq_JuOs56RLYNA-wHeFabHYIw"}
[2025-07-01T03:04:13.185Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Genial! Si necesitas algo más, estoy aquí para ay..." | {"userName":"Usuario","preview":"¡Genial! Si necesitas algo más, estoy aquí para ay..."}
[2025-07-01T03:04:13.185Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T03:04:13.185Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:04:14.013Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:04:14.013Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: Psq_JuOs56RLYNA-wHeFabHYIw
[2025-07-01T03:04:14.232Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psq_JuOs56RLYNA-wHeFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339054"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:04:14.711Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psq_JuOs56RLYNA-wHeFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339054"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:05:00.828Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:05:00.862Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:05:00.865Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:05:00.865Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:05:00.866Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:05:00.866Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:05:00.867Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:05:00.869Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:05:00.869Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:05:00.870Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:05:00.874Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:05:08.690Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:05:08.690Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:05:08.691Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:05:08.691Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:05:08.691Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:05:08.691Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:05:08.691Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:05:08.692Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:05:08.692Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:47:26.236Z","previousThreads":[]}}
[2025-07-01T03:05:08.692Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z"}
[2025-07-01T03:05:08.692Z] [INFO] CONVERSATION_FLOW [app.ts]: 
📱 FLUJO DE CONVERSACIÓN - 573003913251
├─ Cliente: "Hola..."
├─ Buffer: 1 mensajes
├─ Esperando: 8s para agrupar
└─ Estado: Conversación activa

[2025-07-01T03:05:08.692Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T03:05:10.043Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"mgsvc8D1ZMIrNWmD8zJmyA-gASFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339110"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:05:14.006Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:05:14.006Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:05:14.007Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:05:14.007Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:05:14.007Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo" | {"userName":"Alexander","preview":"Como va todo"}
[2025-07-01T03:05:14.007Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:05:14.007Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:05:14.007Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:47:26.236Z","previousThreads":[]}}
[2025-07-01T03:05:14.008Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z"}
[2025-07-01T03:05:14.008Z] [INFO] CONVERSATION_FLOW [app.ts]: 
📱 FLUJO DE CONVERSACIÓN - 573003913251
├─ Cliente: "Como va todo..."
├─ Buffer: 2 mensajes
├─ Esperando: 8s para agrupar
└─ Estado: Conversación activa

[2025-07-01T03:05:14.008Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (2)
[2025-07-01T03:05:15.607Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"viKY029m3egGkiLqvq1nLg-gKaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339115"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:05:22.013Z] [INFO] TIMER [app.ts]: ✅ Procesando 2 mensajes
[2025-07-01T03:05:22.014Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:05:22.014Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:05:22.014Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":18,"preview":"Hola\n\nComo va todo..."}
[2025-07-01T03:05:22.015Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:05:22.015Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:05:22.015Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:05:22.015Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T02:47:26.236Z","previousThreads":[]}}
[2025-07-01T03:05:22.016Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T02:47:26.236Z"}
[2025-07-01T03:05:22.016Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:05:22.016Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:05:22.016Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:05:22.520Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:05:22.521Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":18,"messagePreview":"Hola\n\nComo va todo"}
[2025-07-01T03:05:22.521Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:05:23.533Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_UCFC9zO3SdvFwjysRcdfxvOB"}
[2025-07-01T03:05:26.049Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:05:26.352Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4034ms | {"duration":4034,"userName":"Alexander"}
[2025-07-01T03:05:26.353Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":104,"preview":"¡Hola, Alexander! Todo va bien. ¿En qué puedo ayudarte hoy con respecto a los apartamentos en Cartag...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:05:26.353Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:05:26.353Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":104,"preview":"¡Hola, Alexander! Todo va bien. ¿En qué puedo ayudarte hoy con respecto a los apartamentos en Cartag..."}
[2025-07-01T03:05:29.900Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado: PsrCw7I6IrUMV7A-wMuFabHYIw | {"chatId":"573003913251","messageId":"PsrCw7I6IrUMV7A-wMuFabHYIw"}
[2025-07-01T03:05:29.900Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo va bien. ¿En qué puedo ayud..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo va bien. ¿En qué puedo ayud..."}
[2025-07-01T03:05:29.901Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T03:05:29.901Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:05:30.655Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:05:30.656Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: PsrCw7I6IrUMV7A-wMuFabHYIw
[2025-07-01T03:05:30.900Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrCw7I6IrUMV7A-wMuFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339131"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:05:58.094Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:05:58.094Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:05:58.095Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:05:58.095Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:05:58.095Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "A como fue q me dijo anteriormente q estaban los p..." | {"userName":"Alexander","preview":"A como fue q me dijo anteriormente q estaban los p..."}
[2025-07-01T03:05:58.095Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:05:58.095Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:05:58.095Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:05:58.096Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:05:22.519Z","previousThreads":[]}}
[2025-07-01T03:05:58.097Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:05:22.519Z"}
[2025-07-01T03:05:58.097Z] [INFO] CONVERSATION_FLOW [app.ts]: 
📱 FLUJO DE CONVERSACIÓN - 573003913251
├─ Cliente: "A como fue q me dijo anteriorm..."
├─ Buffer: 1 mensajes
├─ Esperando: 8s para agrupar
└─ Estado: Conversación activa

[2025-07-01T03:05:58.097Z] [INFO] TIMER [app.ts]: ⏳ Esperando más mensajes... (1)
[2025-07-01T03:05:59.581Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"duZnD_JJ8Hs_pB2tnqjCXA-gCuFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339159"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:06:06.101Z] [INFO] TIMER [app.ts]: ✅ Procesando 1 mensajes
[2025-07-01T03:06:06.101Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:06:06.101Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:06:06.102Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 1 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":56,"preview":"A como fue q me dijo anteriormente q estaban los precios..."}
[2025-07-01T03:06:06.102Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:06:06.102Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:06:06.102Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:06:06.102Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:05:22.519Z","previousThreads":[]}}
[2025-07-01T03:06:06.102Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:05:22.519Z"}
[2025-07-01T03:06:06.102Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:06:06.102Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:06:06.103Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:06:06.554Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:06:06.554Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":56,"messagePreview":"A como fue q me dijo anteriormente q estaban los precios"}
[2025-07-01T03:06:06.554Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:06:08.018Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_V62puEoP1wxqGJevX1z2abiO"}
[2025-07-01T03:06:10.518Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:06:10.846Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4416ms | {"duration":4416,"userName":"Alexander"}
[2025-07-01T03:06:10.846Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":150,"preview":"Los precios son de 220 y 350 por noche, dependiendo del apartamento que elijas. Si necesitas más det...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:06:10.846Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:06:10.846Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":150,"preview":"Los precios son de 220 y 350 por noche, dependiendo del apartamento que elijas. Si necesitas más det..."}
[2025-07-01T03:06:14.757Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado: PsoNqMUIABZmjsc-wK.FabHYIw | {"chatId":"573003913251","messageId":"PsoNqMUIABZmjsc-wK.FabHYIw"}
[2025-07-01T03:06:14.758Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Los precios son de 220 y 350 por noche, dependiend..." | {"userName":"Usuario","preview":"Los precios son de 220 y 350 por noche, dependiend..."}
[2025-07-01T03:06:14.758Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente a 573003913251
[2025-07-01T03:06:14.758Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:06:15.591Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:06:15.591Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: PsoNqMUIABZmjsc-wK.FabHYIw
[2025-07-01T03:06:16.322Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsoNqMUIABZmjsc-wK.FabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339176"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:06:16.644Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsoNqMUIABZmjsc-wK.FabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339177"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:10:45.517Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:10:45.553Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:10:45.555Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:10:45.555Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:10:45.555Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:10:45.556Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:10:45.556Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:10:45.557Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:10:45.557Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:10:45.558Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:10:45.561Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:10:58.002Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:10:58.036Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:10:58.040Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:10:58.041Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:10:58.041Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:10:58.041Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:10:58.041Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:10:58.042Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:10:58.042Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:10:58.043Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:10:58.047Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:11:20.368Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:11:20.400Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:11:20.402Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:11:20.402Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:11:20.403Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:11:20.403Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:11:20.403Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:11:20.404Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:11:20.404Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:11:20.405Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:11:20.409Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:11:43.966Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:11:43.999Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:11:44.002Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:11:44.002Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:11:44.003Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:11:44.003Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:11:44.003Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:11:44.004Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:11:44.005Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:11:44.005Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:11:44.010Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:12:04.585Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:12:04.620Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:12:04.623Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:12:04.623Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:12:04.623Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:12:04.624Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:12:04.624Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:12:04.625Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:12:04.626Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:12:04.626Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:12:04.630Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:12:26.889Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:12:26.925Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:12:26.928Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:12:26.928Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:12:26.929Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:12:26.929Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:12:26.929Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:12:26.930Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:12:26.930Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:12:26.931Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:12:26.936Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:12:41.380Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:12:41.412Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:12:41.417Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:12:41.417Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:12:41.417Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:12:41.417Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:12:41.417Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:12:41.418Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:12:41.418Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:12:41.419Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:12:41.422Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:12:44.166Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:12:44.200Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:12:44.203Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:12:44.203Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:12:44.203Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:12:44.203Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:12:44.204Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:12:44.204Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:12:44.205Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:12:44.205Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:12:44.209Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:12:55.138Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:12:55.174Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:12:55.177Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:12:55.177Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:12:55.177Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:12:55.177Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:12:55.178Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:12:55.178Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:12:55.179Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:12:55.179Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:12:55.183Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:12:58.063Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:12:58.095Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:12:58.101Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:12:58.101Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:12:58.101Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:12:58.102Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:12:58.102Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:12:58.103Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:12:58.103Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:12:58.104Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:12:58.108Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:13:04.634Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:13:04.666Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:13:04.671Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:13:04.671Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:13:04.671Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:13:04.671Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:13:04.672Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:13:04.673Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:13:04.673Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:13:04.673Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:13:04.676Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:13:07.701Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:13:07.733Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:13:07.736Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:13:07.736Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:13:07.736Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:13:07.736Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:13:07.737Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:13:07.737Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:13:07.738Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:13:07.738Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:13:07.742Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:13:28.871Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:13:28.907Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:13:28.911Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:13:28.912Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:13:28.912Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:13:28.912Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:13:28.913Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:13:28.913Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:13:28.914Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:13:28.914Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:13:28.918Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:13:43.471Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:13:43.506Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:13:43.510Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos
[2025-07-01T03:13:43.510Z] [INFO] APP_INIT [app.ts]: Puerto configurado: 3008
[2025-07-01T03:13:43.510Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1}
[2025-07-01T03:13:43.510Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1}
[2025-07-01T03:13:43.511Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados: | {"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}
[2025-07-01T03:13:43.512Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy creado: ./whatsapp-sync-debug.log
[2025-07-01T03:13:43.512Z] [INFO] STARTUP [app.ts]: Iniciando bot en puerto 3008
[2025-07-01T03:13:43.512Z] [SUCCESS] CONFIG [app.ts]: Todas las variables de entorno configuradas correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/"}
[2025-07-01T03:13:43.517Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:13:56.780Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:13:56.813Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:13:56.816Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:13:56.816Z"}
[2025-07-01T03:13:56.816Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:13:56.816Z"}
[2025-07-01T03:13:56.816Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:13:56.817Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:13:56.818Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:13:56.818Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:13:56.823Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:13:59.033Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:13:59.066Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:13:59.071Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:13:59.071Z"}
[2025-07-01T03:13:59.071Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:13:59.071Z"}
[2025-07-01T03:13:59.071Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:13:59.072Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:13:59.072Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:13:59.073Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:13:59.076Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:14:07.298Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:14:07.329Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:14:07.331Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:14:07.331Z"}
[2025-07-01T03:14:07.331Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:14:07.331Z"}
[2025-07-01T03:14:07.332Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:14:07.332Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:14:07.333Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:14:07.333Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:14:07.337Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:14:21.819Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:14:21.850Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:14:21.852Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:14:21.852Z"}
[2025-07-01T03:14:21.853Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:14:21.853Z"}
[2025-07-01T03:14:21.853Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:14:21.853Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:14:21.854Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:14:21.854Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:14:21.858Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:14:36.762Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:14:36.797Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:14:36.802Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:14:36.802Z"}
[2025-07-01T03:14:36.803Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:14:36.803Z"}
[2025-07-01T03:14:36.803Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:14:36.804Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:14:36.805Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:14:36.805Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:14:36.811Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:14:42.146Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:14:42.215Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:14:42.223Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:14:42.223Z"}
[2025-07-01T03:14:42.224Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:14:42.224Z"}
[2025-07-01T03:14:42.225Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:14:42.226Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:14:42.227Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:14:42.228Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:14:42.235Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:14:50.258Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:14:50.300Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:14:50.303Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:14:50.303Z"}
[2025-07-01T03:14:50.303Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:14:50.303Z"}
[2025-07-01T03:14:50.304Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:14:50.304Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:14:50.306Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:14:50.306Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:14:50.311Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:14:53.930Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:14:53.961Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:14:53.964Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:14:53.964Z"}
[2025-07-01T03:14:53.965Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:14:53.965Z"}
[2025-07-01T03:14:53.965Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:14:53.965Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:14:53.967Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:14:53.967Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:14:53.972Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:15:00.077Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:15:00.110Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:15:00.115Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:15:00.115Z"}
[2025-07-01T03:15:00.115Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:15:00.115Z"}
[2025-07-01T03:15:00.116Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:15:00.116Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:15:00.117Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:15:00.117Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:15:00.121Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:15:02.759Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:15:02.790Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:15:02.793Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:15:02.793Z"}
[2025-07-01T03:15:02.793Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:15:02.793Z"}
[2025-07-01T03:15:02.793Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:15:02.794Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:15:02.794Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:15:02.795Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:15:02.801Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:17:52.847Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:17:52.848Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:17:52.848Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:17:52.849Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:17:52.849Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:17:52.850Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:17:52.850Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:17:52.850Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:17:52.851Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:06:06.553Z","previousThreads":[]}}
[2025-07-01T03:17:52.851Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z"}
[2025-07-01T03:17:52.851Z] [INFO] CONVERSATION_FLOW [app.ts]: Flujo de conversación iniciado | {"shortUserId":"573003913251","clientMessage":"Hola","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:17:52.851Z"}
[2025-07-01T03:17:52.852Z] [INFO] TIMER [app.ts]: Cliente esperando agrupación | {"shortUserId":"573003913251","messageCount":1,"timeoutMs":8000}
[2025-07-01T03:17:56.587Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:17:56.587Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:17:56.587Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:17:56.587Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:17:56.587Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo" | {"userName":"Alexander","preview":"Como va todo"}
[2025-07-01T03:17:56.588Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:17:56.588Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:17:56.588Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:06:06.553Z","previousThreads":[]}}
[2025-07-01T03:17:56.588Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z"}
[2025-07-01T03:17:56.588Z] [INFO] CONVERSATION_FLOW [app.ts]: Flujo de conversación iniciado | {"shortUserId":"573003913251","clientMessage":"Como va todo","bufferCount":2,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:17:56.588Z"}
[2025-07-01T03:17:56.589Z] [INFO] TIMER [app.ts]: Cliente esperando agrupación | {"shortUserId":"573003913251","messageCount":2,"timeoutMs":8000}
[2025-07-01T03:18:04.596Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":2,"timeoutCompletedAt":"2025-07-01T03:18:04.596Z"}
[2025-07-01T03:18:04.597Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:18:04.597Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:18:04.597Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando 2 mensajes para 573003913251 | {"userId":"573003913251","chatId":"573003913251@s.whatsapp.net","totalLength":18,"preview":"Hola\n\nComo va todo..."}
[2025-07-01T03:18:04.597Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:18:04.598Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:18:04.598Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:18:04.598Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:06:06.553Z","previousThreads":[]}}
[2025-07-01T03:18:04.598Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z"}
[2025-07-01T03:18:04.598Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:18:04.598Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:18:04.599Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:18:05.410Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:18:05.410Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":18,"messagePreview":"Hola\n\nComo va todo"}
[2025-07-01T03:18:05.410Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:18:06.265Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_6ru4M6TCKqdusRevB7zOKNP1"}
[2025-07-01T03:18:08.740Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:18:09.051Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4142ms | {"duration":4142,"userName":"Alexander"}
[2025-07-01T03:18:09.052Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":102,"preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudarte hoy con respecto a los apartamentos en Cartagen...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:18:09.052Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:18:09.053Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":102,"preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudarte hoy con respecto a los apartamentos en Cartagen..."}
[2025-07-01T03:18:12.892Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado para tracking anti-duplicación | {"shortUserId":"573003913251","messageId":"Psqw9VUCsHQ3.fA-wHiFabHYIw","messageLength":102,"timestamp":"2025-07-01T03:18:12.892Z"}
[2025-07-01T03:18:12.893Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudar..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudar..."}
[2025-07-01T03:18:12.894Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente | {"shortUserId":"573003913251","messageLength":102,"messageId":"Psqw9VUCsHQ3.fA-wHiFabHYIw","responseTime":0}
[2025-07-01T03:18:12.894Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:18:13.703Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:18:13.703Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: Psqw9VUCsHQ3.fA-wHiFabHYIw
[2025-07-01T03:18:14.500Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psqw9VUCsHQ3.fA-wHiFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339894"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:18:14.774Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psqw9VUCsHQ3.fA-wHiFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751339895"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:19:58.946Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:19:58.977Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:19:58.980Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:19:58.980Z"}
[2025-07-01T03:19:58.981Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:19:58.981Z"}
[2025-07-01T03:19:58.981Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:19:58.981Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:19:58.982Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:19:58.982Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:19:58.987Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:20:07.562Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:20:07.600Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:20:07.603Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:20:07.603Z"}
[2025-07-01T03:20:07.604Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:20:07.604Z"}
[2025-07-01T03:20:07.604Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:20:07.605Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:20:07.606Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:20:07.606Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:20:07.610Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:20:11.770Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:20:11.803Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:20:11.806Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:20:11.806Z"}
[2025-07-01T03:20:11.806Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:20:11.806Z"}
[2025-07-01T03:20:11.806Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:20:11.807Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:20:11.808Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:20:11.808Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:20:11.814Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:20:23.178Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:20:23.216Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:20:23.220Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:20:23.220Z"}
[2025-07-01T03:20:23.220Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:20:23.220Z"}
[2025-07-01T03:20:23.221Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:20:23.221Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:20:23.222Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:20:23.222Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:20:23.226Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:20:25.814Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:20:25.845Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:20:25.848Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:20:25.848Z"}
[2025-07-01T03:20:25.848Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:20:25.848Z"}
[2025-07-01T03:20:25.848Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:20:25.849Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:20:25.850Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:20:25.850Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:20:25.855Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:21:00.112Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:21:00.145Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:21:00.148Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:21:00.148Z"}
[2025-07-01T03:21:00.149Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:21:00.149Z"}
[2025-07-01T03:21:00.149Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:21:00.150Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:21:00.151Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:21:00.151Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:21:00.158Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:21:19.764Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:21:19.797Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:21:19.799Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:21:19.799Z"}
[2025-07-01T03:21:19.800Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:21:19.800Z"}
[2025-07-01T03:21:19.800Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:21:19.801Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:21:19.802Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:21:19.802Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:21:19.808Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:21:40.150Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:21:40.183Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:21:40.186Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:21:40.186Z"}
[2025-07-01T03:21:40.186Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:21:40.186Z"}
[2025-07-01T03:21:40.187Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:21:40.187Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:21:40.188Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:21:40.188Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:21:40.193Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:22:01.318Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:22:01.354Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:22:01.356Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:22:01.356Z"}
[2025-07-01T03:22:01.357Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:22:01.357Z"}
[2025-07-01T03:22:01.357Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:22:01.357Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:22:01.358Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:22:01.358Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:22:01.364Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:22:03.216Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:22:03.217Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:22:03.217Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:22:03.217Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:22:03.217Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:22:03.218Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:22:03.218Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:22:03.219Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:22:03.219Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:06:06.553Z","previousThreads":[]}}
[2025-07-01T03:22:03.219Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z"}
[2025-07-01T03:22:03.219Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Hola","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:22:03.219Z"}
[2025-07-01T03:22:08.865Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:22:08.866Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:22:08.866Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:22:08.866Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:22:08.866Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo" | {"userName":"Alexander","preview":"Como va todo"}
[2025-07-01T03:22:08.866Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:22:08.867Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:22:08.867Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:06:06.553Z","previousThreads":[]}}
[2025-07-01T03:22:08.867Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z"}
[2025-07-01T03:22:08.867Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Como va todo","bufferCount":2,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:22:08.867Z"}
[2025-07-01T03:22:12.703Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:22:12.738Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:22:12.740Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:22:12.740Z"}
[2025-07-01T03:22:12.741Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:22:12.741Z"}
[2025-07-01T03:22:12.741Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:22:12.741Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:22:12.742Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:22:12.742Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:22:12.746Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:22:17.820Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:22:17.857Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:22:17.860Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:22:17.860Z"}
[2025-07-01T03:22:17.861Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:22:17.861Z"}
[2025-07-01T03:22:17.862Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:22:17.862Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:22:17.863Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:22:17.863Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:22:17.868Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:22:27.022Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:22:27.056Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:22:27.058Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:22:27.058Z"}
[2025-07-01T03:22:27.058Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:22:27.058Z"}
[2025-07-01T03:22:27.058Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:22:27.059Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:22:27.060Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:22:27.060Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:22:27.065Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:22:39.642Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:22:39.680Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:22:39.684Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:22:39.684Z"}
[2025-07-01T03:22:39.685Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:22:39.685Z"}
[2025-07-01T03:22:39.685Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:22:39.686Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:22:39.687Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:22:39.687Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:22:39.694Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:22:43.297Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:22:43.329Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:22:43.332Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:22:43.332Z"}
[2025-07-01T03:22:43.332Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:22:43.332Z"}
[2025-07-01T03:22:43.332Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:22:43.333Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:22:43.334Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:22:43.334Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:22:43.339Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:22:53.480Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:22:53.512Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:22:53.514Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:22:53.514Z"}
[2025-07-01T03:22:53.515Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:22:53.515Z"}
[2025-07-01T03:22:53.515Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:22:53.516Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:22:53.517Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:22:53.517Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:22:53.522Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:22:59.578Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:22:59.610Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:22:59.613Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:22:59.613Z"}
[2025-07-01T03:22:59.614Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:22:59.614Z"}
[2025-07-01T03:22:59.614Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:22:59.614Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:22:59.615Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:22:59.615Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:22:59.621Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:24:40.577Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:24:40.578Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:24:40.578Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:24:40.578Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:24:40.579Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:24:40.579Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:24:40.580Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:24:40.581Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:24:40.581Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:06:06.553Z","previousThreads":[]}}
[2025-07-01T03:24:40.581Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z"}
[2025-07-01T03:24:40.581Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Hola","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:24:40.581Z"}
[2025-07-01T03:24:46.771Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:24:46.772Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:24:46.772Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:24:46.772Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:24:46.772Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Que tal como va todo" | {"userName":"Alexander","preview":"Que tal como va todo"}
[2025-07-01T03:24:46.772Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:24:46.773Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:24:46.773Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:06:06.553Z","previousThreads":[]}}
[2025-07-01T03:24:46.773Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z"}
[2025-07-01T03:24:46.773Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Que tal como va todo","bufferCount":2,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:24:46.773Z"}
[2025-07-01T03:24:54.781Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":2,"timeoutCompletedAt":"2025-07-01T03:24:54.781Z"}
[2025-07-01T03:24:54.783Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:24:54.784Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:24:54.784Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando mensajes agrupados | {"userId":"573003913251","shortUserId":"573003913251","chatId":"573003913251@s.whatsapp.net","messageCount":2,"totalLength":26,"preview":"Hola\n\nQue tal como va todo..."}
[2025-07-01T03:24:54.784Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:24:54.784Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:24:54.784Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:24:54.785Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:06:06.553Z","previousThreads":[]}}
[2025-07-01T03:24:54.785Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:06:06.553Z"}
[2025-07-01T03:24:54.785Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:24:54.785Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:24:54.785Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:24:55.350Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:24:55.351Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":26,"messagePreview":"Hola\n\nQue tal como va todo"}
[2025-07-01T03:24:55.351Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:24:56.382Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_ogORgGoGjDROAuJAA2Y0Dq8i"}
[2025-07-01T03:24:59.005Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:24:59.292Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4221ms | {"duration":4221,"userName":"Alexander"}
[2025-07-01T03:24:59.293Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":104,"preview":"¡Hola, Alexander! Todo va bien. ¿En qué puedo ayudarte hoy con respecto a los apartamentos en Cartag...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:24:59.294Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:24:59.294Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":104,"preview":"¡Hola, Alexander! Todo va bien. ¿En qué puedo ayudarte hoy con respecto a los apartamentos en Cartag..."}
[2025-07-01T03:25:03.251Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado para tracking anti-duplicación | {"shortUserId":"573003913251","messageId":"PsqC4IJ3GLh0csM-wAqFabHYIw","messageLength":104,"timestamp":"2025-07-01T03:25:03.251Z"}
[2025-07-01T03:25:03.252Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo va bien. ¿En qué puedo ayud..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo va bien. ¿En qué puedo ayud..."}
[2025-07-01T03:25:03.252Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente | {"shortUserId":"573003913251","messageLength":104,"messageId":"PsqC4IJ3GLh0csM-wAqFabHYIw","responseTime":0}
[2025-07-01T03:25:03.253Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:25:04.026Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:25:04.027Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: PsqC4IJ3GLh0csM-wAqFabHYIw
[2025-07-01T03:25:05.002Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqC4IJ3GLh0csM-wAqFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340305"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:25:05.083Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqC4IJ3GLh0csM-wAqFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340305"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:28:39.308Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:28:39.357Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:28:39.363Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:28:39.363Z"}
[2025-07-01T03:28:39.364Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:28:39.364Z"}
[2025-07-01T03:28:39.364Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:28:39.365Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:28:39.366Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:28:39.367Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:28:39.372Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:28:51.391Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:28:51.443Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:28:51.447Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:28:51.447Z"}
[2025-07-01T03:28:51.447Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:28:51.447Z"}
[2025-07-01T03:28:51.448Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:28:51.449Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:28:51.450Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:28:51.451Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:28:51.456Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:28:53.414Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:28:53.414Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:28:53.414Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:28:53.414Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:28:53.415Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:28:53.415Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:28:53.415Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:28:53.415Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:28:53.415Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:28:53.416Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:28:53.416Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Hola","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:28:53.416Z"}
[2025-07-01T03:28:55.060Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:28:55.061Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:28:55.061Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:28:55.061Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:28:55.061Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:28:55.061Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:28:55.061Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:28:55.061Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:28:55.062Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:28:55.062Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Hola","bufferCount":2,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:28:55.062Z"}
[2025-07-01T03:28:57.970Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:28:57.970Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:28:57.970Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:28:57.970Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:28:57.970Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T03:28:57.971Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T03:28:57.971Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:28:57.971Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:28:57.971Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:28:57.972Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Como","bufferCount":3,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:28:57.972Z"}
[2025-07-01T03:28:59.094Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:28:59.094Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:28:59.094Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:28:59.094Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:28:59.095Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va" | {"userName":"Alexander","preview":"Va"}
[2025-07-01T03:28:59.095Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4) | {"total":4}
[2025-07-01T03:28:59.095Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:28:59.096Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:28:59.096Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:28:59.096Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Va","bufferCount":4,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:28:59.096Z"}
[2025-07-01T03:29:01.299Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:29:01.300Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:29:01.300Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:29:01.300Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:29:01.301Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Todo" | {"userName":"Alexander","preview":"Todo"}
[2025-07-01T03:29:01.301Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 5) | {"total":5}
[2025-07-01T03:29:01.301Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:29:01.301Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:29:01.302Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:29:01.302Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Todo","bufferCount":5,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:29:01.302Z"}
[2025-07-01T03:29:05.932Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:29:05.963Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:29:05.966Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:29:05.966Z"}
[2025-07-01T03:29:05.967Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:29:05.967Z"}
[2025-07-01T03:29:05.967Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:29:05.967Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:29:05.968Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:29:05.969Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:29:05.974Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:29:07.509Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:29:07.541Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:29:07.544Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:29:07.544Z"}
[2025-07-01T03:29:07.544Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:29:07.544Z"}
[2025-07-01T03:29:07.544Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:29:07.544Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:29:07.545Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:29:07.546Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:29:07.552Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:29:15.530Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:29:15.563Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:29:15.565Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:29:15.565Z"}
[2025-07-01T03:29:15.566Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:29:15.566Z"}
[2025-07-01T03:29:15.566Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:29:15.566Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:29:15.567Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:29:15.567Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:29:15.573Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:29:18.203Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:29:18.236Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:29:18.238Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:29:18.238Z"}
[2025-07-01T03:29:18.239Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:29:18.239Z"}
[2025-07-01T03:29:18.239Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:29:18.239Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:29:18.240Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:29:18.241Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:29:18.246Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:29:27.176Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:29:27.207Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:29:27.209Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:29:27.209Z"}
[2025-07-01T03:29:27.210Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:29:27.210Z"}
[2025-07-01T03:29:27.210Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:29:27.210Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:29:27.211Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:29:27.211Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:29:27.217Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:29:33.026Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:29:33.027Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:29:33.027Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:29:33.028Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:29:33.028Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:29:33.028Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:29:33.028Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:29:33.029Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:29:33.029Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:29:33.029Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:29:33.029Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Hola","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:29:33.029Z"}
[2025-07-01T03:29:34.127Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:29:34.127Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:29:34.128Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:29:34.128Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:29:34.128Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T03:29:34.128Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:29:34.128Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:29:34.128Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:29:34.128Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:29:34.129Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Como","bufferCount":2,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:29:34.129Z"}
[2025-07-01T03:29:34.902Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:29:34.902Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:29:34.902Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:29:34.903Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:29:34.903Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va" | {"userName":"Alexander","preview":"Va"}
[2025-07-01T03:29:34.903Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T03:29:34.903Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:29:34.903Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:29:34.904Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:29:34.904Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Va","bufferCount":3,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:29:34.904Z"}
[2025-07-01T03:29:40.074Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:29:40.114Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:29:40.119Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:29:40.119Z"}
[2025-07-01T03:29:40.119Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:29:40.119Z"}
[2025-07-01T03:29:40.120Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:29:40.121Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:29:40.122Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:29:40.123Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:29:40.128Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:29:43.206Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:29:43.251Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:29:43.253Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:29:43.253Z"}
[2025-07-01T03:29:43.254Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:29:43.254Z"}
[2025-07-01T03:29:43.254Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:29:43.255Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:29:43.256Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:29:43.257Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:29:43.260Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:29:47.231Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:29:47.269Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:29:47.272Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:29:47.272Z"}
[2025-07-01T03:29:47.273Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:29:47.273Z"}
[2025-07-01T03:29:47.273Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:29:47.274Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:29:47.275Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:29:47.275Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:29:47.281Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:29:48.487Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:29:48.520Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:29:48.526Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:29:48.526Z"}
[2025-07-01T03:29:48.527Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:29:48.527Z"}
[2025-07-01T03:29:48.527Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:29:48.528Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:29:48.529Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:29:48.529Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:29:48.534Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:30:05.957Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:30:05.990Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:30:05.996Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:30:05.996Z"}
[2025-07-01T03:30:05.996Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:30:05.996Z"}
[2025-07-01T03:30:05.997Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:30:05.997Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:30:05.998Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:30:05.999Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:30:06.004Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:30:12.506Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:30:12.538Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:30:12.543Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:30:12.543Z"}
[2025-07-01T03:30:12.544Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:30:12.544Z"}
[2025-07-01T03:30:12.544Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:30:12.544Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:30:12.545Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:30:12.546Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:30:12.550Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:30:13.927Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:30:13.959Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:30:13.961Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:30:13.961Z"}
[2025-07-01T03:30:13.962Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:30:13.962Z"}
[2025-07-01T03:30:13.962Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:30:13.962Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:30:13.963Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:30:13.963Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:30:13.969Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:30:28.426Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:30:28.458Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:30:28.463Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:30:28.463Z"}
[2025-07-01T03:30:28.464Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:30:28.464Z"}
[2025-07-01T03:30:28.464Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:30:28.464Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:30:28.465Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:30:28.466Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:30:28.471Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:30:31.176Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:30:31.207Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:30:31.210Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:30:31.210Z"}
[2025-07-01T03:30:31.210Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:30:31.210Z"}
[2025-07-01T03:30:31.210Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:30:31.211Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:30:31.211Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:30:31.212Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:30:31.217Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:30:58.684Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:30:58.684Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:30:58.684Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:30:58.685Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:30:58.685Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Rodohola" | {"userName":"Alexander","preview":"Rodohola"}
[2025-07-01T03:30:58.685Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:30:58.685Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:30:58.686Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:30:58.686Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:30:58.686Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:30:58.686Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Rodohola","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:30:58.686Z"}
[2025-07-01T03:31:02.182Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:31:02.182Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:31:02.182Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:31:02.183Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:31:02.183Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Que gal" | {"userName":"Alexander","preview":"Que gal"}
[2025-07-01T03:31:02.183Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:31:02.183Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:31:02.184Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:31:02.184Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:31:02.184Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Que gal","bufferCount":2,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:31:02.184Z"}
[2025-07-01T03:31:04.477Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:31:04.477Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:31:04.477Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:31:04.477Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:31:04.478Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo" | {"userName":"Alexander","preview":"Como va todo"}
[2025-07-01T03:31:04.478Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T03:31:04.478Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:31:04.478Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:31:04.479Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:31:04.479Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Como va todo","bufferCount":3,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:31:04.479Z"}
[2025-07-01T03:31:12.490Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":3,"timeoutCompletedAt":"2025-07-01T03:31:12.490Z"}
[2025-07-01T03:31:12.490Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:31:12.491Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 3) | {"total":3}
[2025-07-01T03:31:12.491Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando mensajes agrupados | {"userId":"573003913251","shortUserId":"573003913251","chatId":"573003913251@s.whatsapp.net","messageCount":3,"totalLength":31,"preview":"Rodohola\n\nQue gal\n\nComo va todo..."}
[2025-07-01T03:31:12.491Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:31:12.492Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:31:12.492Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:31:12.492Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:31:12.492Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:31:12.492Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:31:12.492Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:31:12.492Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:31:13.380Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:31:13.381Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":31,"messagePreview":"Rodohola\n\nQue gal\n\nComo va todo"}
[2025-07-01T03:31:13.381Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:31:14.693Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_Au5aWV66ksceRBxqpPFAoDfb"}
[2025-07-01T03:31:17.955Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:31:18.246Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5463ms | {"duration":5463,"userName":"Alexander"}
[2025-07-01T03:31:18.247Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":97,"preview":"¡Hola, Alexander! Todo bien por aquí. ¿Cómo puedo ayudarte hoy con los apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:31:18.247Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:31:18.247Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":97,"preview":"¡Hola, Alexander! Todo bien por aquí. ¿Cómo puedo ayudarte hoy con los apartamentos en Cartagena?..."}
[2025-07-01T03:31:22.150Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado para tracking anti-duplicación | {"shortUserId":"573003913251","messageId":"PsoY_OjG.ersQNk-wGGFabHYIw","messageLength":97,"timestamp":"2025-07-01T03:31:22.150Z"}
[2025-07-01T03:31:22.150Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo bien por aquí. ¿Cómo puedo ..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo bien por aquí. ¿Cómo puedo ..."}
[2025-07-01T03:31:22.151Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente | {"shortUserId":"573003913251","messageLength":97,"messageId":"PsoY_OjG.ersQNk-wGGFabHYIw","responseTime":0}
[2025-07-01T03:31:22.151Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:31:22.889Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:31:22.890Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: PsoY_OjG.ersQNk-wGGFabHYIw
[2025-07-01T03:31:23.047Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsoY_OjG.ersQNk-wGGFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340683"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:32:28.281Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:32:28.316Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:32:28.319Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:32:28.319Z"}
[2025-07-01T03:32:28.320Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:32:28.320Z"}
[2025-07-01T03:32:28.320Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:32:28.320Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:32:28.321Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:32:28.322Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:32:28.326Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:33:44.345Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:33:44.377Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:33:44.379Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:33:44.379Z"}
[2025-07-01T03:33:44.380Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:33:44.380Z"}
[2025-07-01T03:33:44.380Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:33:44.380Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:33:44.381Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:33:44.382Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:33:44.386Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:33:59.121Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:33:59.152Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:33:59.155Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:33:59.155Z"}
[2025-07-01T03:33:59.156Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:33:59.156Z"}
[2025-07-01T03:33:59.156Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:33:59.157Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:33:59.158Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:33:59.158Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:33:59.164Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:34:01.946Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:34:01.988Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:34:01.992Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:34:01.992Z"}
[2025-07-01T03:34:01.993Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:34:01.993Z"}
[2025-07-01T03:34:01.993Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:34:01.994Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:34:01.995Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:34:01.996Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:34:02.004Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:34:09.254Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:34:09.287Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:34:09.289Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:34:09.289Z"}
[2025-07-01T03:34:09.290Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:34:09.290Z"}
[2025-07-01T03:34:09.290Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:34:09.290Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:34:09.291Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:34:09.292Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:34:09.298Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:34:12.239Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:34:12.271Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:34:12.276Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:34:12.276Z"}
[2025-07-01T03:34:12.276Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:34:12.276Z"}
[2025-07-01T03:34:12.276Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:34:12.277Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:34:12.278Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:34:12.278Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:34:12.283Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:34:26.301Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:34:26.333Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:34:26.336Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:34:26.335Z"}
[2025-07-01T03:34:26.336Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:34:26.336Z"}
[2025-07-01T03:34:26.336Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:34:26.337Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:34:26.338Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:34:26.338Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:34:26.344Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:34:38.832Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:34:38.864Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:34:38.869Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:34:38.869Z"}
[2025-07-01T03:34:38.869Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:34:38.869Z"}
[2025-07-01T03:34:38.869Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:34:38.869Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:34:38.870Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:34:38.870Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:34:38.875Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:34:47.922Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:34:47.953Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:34:47.958Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:34:47.958Z"}
[2025-07-01T03:34:47.959Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:34:47.959Z"}
[2025-07-01T03:34:47.959Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:34:47.959Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:34:47.960Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:34:47.961Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:34:47.965Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:34:49.186Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:34:49.219Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:34:49.222Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:34:49.222Z"}
[2025-07-01T03:34:49.223Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:34:49.223Z"}
[2025-07-01T03:34:49.223Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:34:49.224Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:34:49.225Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:34:49.225Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:34:49.230Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:35:04.291Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:35:04.292Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:35:04.292Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:04.293Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:35:04.293Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:35:04.294Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:35:04.294Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:35:04.295Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:04.295Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:35:04.295Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:35:04.296Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Hola","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:35:04.296Z"}
[2025-07-01T03:35:05.479Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:35:05.479Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:35:05.480Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:05.480Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:35:05.480Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T03:35:05.480Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:35:05.480Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:05.481Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:35:05.481Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:35:05.481Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Como","bufferCount":2,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:35:05.481Z"}
[2025-07-01T03:35:06.868Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:35:06.868Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:35:06.868Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:06.869Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:35:06.869Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va" | {"userName":"Alexander","preview":"Va"}
[2025-07-01T03:35:06.869Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T03:35:06.869Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:06.870Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:35:06.870Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:35:06.870Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Va","bufferCount":3,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:35:06.870Z"}
[2025-07-01T03:35:08.604Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:35:08.604Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:35:08.604Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:08.604Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:35:08.604Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Todo" | {"userName":"Alexander","preview":"Todo"}
[2025-07-01T03:35:08.605Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4) | {"total":4}
[2025-07-01T03:35:08.605Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:08.605Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:35:08.605Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:35:08.606Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Todo","bufferCount":4,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:35:08.606Z"}
[2025-07-01T03:35:16.608Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":4,"timeoutCompletedAt":"2025-07-01T03:35:16.608Z"}
[2025-07-01T03:35:16.609Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:16.609Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 4) | {"total":4}
[2025-07-01T03:35:16.609Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando mensajes agrupados | {"userId":"573003913251","shortUserId":"573003913251","chatId":"573003913251@s.whatsapp.net","messageCount":4,"totalLength":20,"preview":"Hola\n\nComo\n\nVa\n\nTodo..."}
[2025-07-01T03:35:16.610Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:16.610Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:35:16.610Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:16.610Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:35:16.611Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:35:16.611Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:35:16.611Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:35:16.611Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:35:17.317Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:35:17.317Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":20,"messagePreview":"Hola\n\nComo\n\nVa\n\nTodo"}
[2025-07-01T03:35:17.317Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:35:18.557Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_ZL4ICLjd7aED2nv2qXg0zA6V"}
[2025-07-01T03:35:21.240Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:35:21.595Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4630ms | {"duration":4630,"userName":"Alexander"}
[2025-07-01T03:35:21.595Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":105,"preview":"¡Hola, Alexander! Todo va bien. ¿En qué puedo asistirte hoy con respecto a los apartamentos en Carta...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:35:21.595Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:35:21.595Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":105,"preview":"¡Hola, Alexander! Todo va bien. ¿En qué puedo asistirte hoy con respecto a los apartamentos en Carta..."}
[2025-07-01T03:35:25.213Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado para tracking anti-duplicación | {"shortUserId":"573003913251","messageId":"PsqsyvOiDGwaoE8-wCKFabHYIw","messageLength":105,"timestamp":"2025-07-01T03:35:25.213Z"}
[2025-07-01T03:35:25.213Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo va bien. ¿En qué puedo asis..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo va bien. ¿En qué puedo asis..."}
[2025-07-01T03:35:25.214Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente | {"shortUserId":"573003913251","messageLength":105,"messageId":"PsqsyvOiDGwaoE8-wCKFabHYIw","responseTime":0}
[2025-07-01T03:35:25.214Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:35:26.012Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:35:26.012Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: PsqsyvOiDGwaoE8-wCKFabHYIw
[2025-07-01T03:35:26.753Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqsyvOiDGwaoE8-wCKFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340927"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:35:27.078Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqsyvOiDGwaoE8-wCKFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340927"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:35:42.137Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:35:42.137Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:35:42.137Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:42.137Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:35:42.138Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "A como me dijiste" | {"userName":"Alexander","preview":"A como me dijiste"}
[2025-07-01T03:35:42.138Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:35:42.138Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:35:42.138Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:42.138Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:35:17.316Z","previousThreads":[]}}
[2025-07-01T03:35:42.138Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:35:17.316Z"}
[2025-07-01T03:35:42.139Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"A como me dijiste","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:35:42.139Z"}
[2025-07-01T03:35:46.936Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:35:46.936Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:35:46.936Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:46.937Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:35:46.937Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Que estaban los apartamentos" | {"userName":"Alexander","preview":"Que estaban los apartamentos"}
[2025-07-01T03:35:46.937Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:35:46.937Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:46.937Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:35:17.316Z","previousThreads":[]}}
[2025-07-01T03:35:46.938Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:35:17.316Z"}
[2025-07-01T03:35:46.938Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Que estaban los apartamentos","bufferCount":2,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:35:46.938Z"}
[2025-07-01T03:35:54.939Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":2,"timeoutCompletedAt":"2025-07-01T03:35:54.939Z"}
[2025-07-01T03:35:54.939Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:54.939Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:35:54.940Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando mensajes agrupados | {"userId":"573003913251","shortUserId":"573003913251","chatId":"573003913251@s.whatsapp.net","messageCount":2,"totalLength":47,"preview":"A como me dijiste\n\nQue estaban los apartamentos..."}
[2025-07-01T03:35:54.940Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:54.940Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:35:54.940Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:35:54.940Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:35:17.316Z","previousThreads":[]}}
[2025-07-01T03:35:54.940Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:35:17.316Z"}
[2025-07-01T03:35:54.940Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:35:54.941Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:35:54.941Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:35:55.460Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:35:55.460Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":47,"messagePreview":"A como me dijiste\n\nQue estaban los apartamentos"}
[2025-07-01T03:35:55.460Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:35:56.576Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_yoVRaafP8TzlMfqRR3lED9A1"}
[2025-07-01T03:35:58.770Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:35:58.980Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 3830ms | {"duration":3830,"userName":"Alexander"}
[2025-07-01T03:35:58.981Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":161,"preview":"Los precios de los apartamentos son de 220 y 350 por noche, dependiendo del tipo de apartamento que ...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:35:58.981Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:35:58.981Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":161,"preview":"Los precios de los apartamentos son de 220 y 350 por noche, dependiendo del tipo de apartamento que ..."}
[2025-07-01T03:35:59.908Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Vu9ivkOSD3u_56xAF.QcBA-gDCFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340956"},{"id":"2vBJ1fzM4tXfwPu1zvqnIw-gOaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340956"},{"id":"zBZoheJiyNwp9LgWXicmZw-gHWFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340956"},{"id":"61rLppicDQ_mSlk78vxUPg-gOeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340957"},{"id":"YTm7h7eTGdKhRSSljtUxEA-gCqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340957"},{"id":"mETVSxMbsRbqmad_ePzCXA-gFyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340957"},{"id":"abOEScw7UMEQdHXFbDqnJg-gIqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340957"},{"id":"LmICL75HX5YCMkMjCfZmng-gPCFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340957"},{"id":"IUEVq7ceCW.DIrRmIWrQRA-gA.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340957"},{"id":"2a47ifMQvzs7C4pGc_sIqg-gJKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340958"},{"id":".E_dmSiKJBzpApKckLbfHA-gK.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340958"},{"id":"b5sx2kjiyHwDOX1EgsH5rw-gLWFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340958"},{"id":"TwurCtxESbjxl_Dy1J.DRQ-gOyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340958"},{"id":"X_6iQw_PRK.qheI5ktYfiw-gHSFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340958"},{"id":"XMSUnMg8kSH6wSDb_AZZ2A-gLWFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340958"},{"id":"eATQm29lDKMj9D9Fmbj44g-gLiFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340958"},{"id":"67Q2izjyM16wBuhi3PNllg-gCuFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340959"},{"id":"SywAlB6bnKTmxz4KHw12mw-gMyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340959"},{"id":"LUIJzqD5JzfxTV6yKKoyiA-gN2FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340959"},{"id":"wa7ZxH4BF8YtajhVvjfoDQ-gDyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340959"},{"id":"1H5IQMFfbBWBbTCZnz9wfg-gPWFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340959"},{"id":"hU.TClZDUSZ7hwA34jWulA-gCqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340959"},{"id":"6Len3PbmlkHk4jI6koYVwQ-gNyFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340960"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:36:02.664Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado para tracking anti-duplicación | {"shortUserId":"573003913251","messageId":"PsrGp3ta.8pVyTg-wC.FabHYIw","messageLength":161,"timestamp":"2025-07-01T03:36:02.664Z"}
[2025-07-01T03:36:02.664Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Los precios de los apartamentos son de 220 y 350 p..." | {"userName":"Usuario","preview":"Los precios de los apartamentos son de 220 y 350 p..."}
[2025-07-01T03:36:02.664Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente | {"shortUserId":"573003913251","messageLength":161,"messageId":"PsrGp3ta.8pVyTg-wC.FabHYIw","responseTime":0}
[2025-07-01T03:36:02.664Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:36:03.161Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:36:03.161Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: PsrGp3ta.8pVyTg-wC.FabHYIw
[2025-07-01T03:36:03.649Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrGp3ta.8pVyTg-wC.FabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340964"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:36:04.016Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsrGp3ta.8pVyTg-wC.FabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340964"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:36:15.153Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:36:15.153Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:36:15.154Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:36:15.154Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:35:55.459Z","previousThreads":[]}}
[2025-07-01T03:36:15.154Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:35:55.459Z"}
[2025-07-01T03:36:15.154Z] [INFO] MANUAL_DETECTED [app.ts]: Mensaje manual del agente detectado | {"shortClientId":"573003913251","agentName":"asesor de reservas","messageText":"También tenemos a 500 mil de 2 alcobas","messageLength":38,"timestamp":"2025-07-01T03:36:15.154Z","chatId":"573003913251@s.whatsapp.net"}
[2025-07-01T03:36:15.154Z] [INFO] MANUAL_BUFFER_CREATE [app.ts]: Buffer manual creado | {"shortClientId":"573003913251","agentName":"asesor de reservas"}
[2025-07-01T03:36:15.154Z] [INFO] MANUAL_BUFFERING [app.ts]: Mensaje manual agregado al buffer | {"shortClientId":"573003913251","bufferCount":1,"agentName":"asesor de reservas","timeoutSeconds":8}
[2025-07-01T03:36:16.093Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"2UiEnzEgs7Na_843CZrwjA-wEuFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751340976"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:36:23.169Z] [INFO] MANUAL_PROCESSING [app.ts]: Procesando mensajes manuales agrupados | {"shortClientId":"573003913251","messageCount":1,"agentName":"asesor de reservas","combinedLength":38,"preview":"También tenemos a 500 mil de 2 alcobas","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:36:23.170Z] [INFO] MANUAL_SYNC_START [app.ts]: Iniciando sincronización con OpenAI | {"shortClientId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messagePreview":"También tenemos a 500 mil de 2 alcobas","agentName":"asesor de reservas"}
[2025-07-01T03:36:24.140Z] [SUCCESS] MANUAL_SYNC_SUCCESS [app.ts]: Mensajes manuales sincronizados exitosamente | {"shortClientId":"573003913251","agentName":"asesor de reservas","messageCount":1,"totalLength":38,"preview":"También tenemos a 500 mil de 2 alcobas","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","timestamp":"2025-07-01T03:36:24.140Z"}
[2025-07-01T03:37:31.093Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:37:31.125Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:37:31.129Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:37:31.129Z"}
[2025-07-01T03:37:31.130Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:37:31.130Z"}
[2025-07-01T03:37:31.130Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:37:31.131Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:37:31.132Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:37:31.132Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:37:31.136Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:37:34.843Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:37:34.877Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:37:34.883Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:37:34.883Z"}
[2025-07-01T03:37:34.883Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:37:34.883Z"}
[2025-07-01T03:37:34.883Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:37:34.884Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:37:34.884Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:37:34.885Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:37:34.889Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:37:42.072Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:37:42.105Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:37:42.110Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:37:42.110Z"}
[2025-07-01T03:37:42.110Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:37:42.110Z"}
[2025-07-01T03:37:42.110Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:37:42.111Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:37:42.112Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:37:42.112Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:37:42.116Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:40:26.349Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:40:26.382Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:40:26.385Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:40:26.385Z"}
[2025-07-01T03:40:26.385Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:40:26.385Z"}
[2025-07-01T03:40:26.386Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:40:26.386Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:40:26.388Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:40:26.388Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:40:26.394Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:40:30.746Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:40:30.778Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:40:30.780Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:40:30.780Z"}
[2025-07-01T03:40:30.781Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:40:30.781Z"}
[2025-07-01T03:40:30.781Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:40:30.781Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:40:30.783Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:40:30.783Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:40:30.789Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:40:41.557Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:40:41.589Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:40:41.592Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:40:41.592Z"}
[2025-07-01T03:40:41.592Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:40:41.592Z"}
[2025-07-01T03:40:41.592Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:40:41.593Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:40:41.593Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:40:41.594Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:40:41.598Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:40:43.723Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:40:43.757Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:40:43.759Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:40:43.759Z"}
[2025-07-01T03:40:43.759Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:40:43.759Z"}
[2025-07-01T03:40:43.759Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:40:43.760Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:40:43.761Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:40:43.761Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:40:43.765Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:40:56.756Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:40:56.788Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:40:56.790Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:40:56.790Z"}
[2025-07-01T03:40:56.790Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:40:56.790Z"}
[2025-07-01T03:40:56.791Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:40:56.791Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:40:56.792Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:40:56.793Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:40:56.798Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:41:05.801Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:41:05.803Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:41:05.804Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:05.804Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:41:05.805Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:41:05.805Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:41:05.805Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:41:05.806Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:05.806Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:41:05.806Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:41:05.807Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Hola","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:41:05.807Z"}
[2025-07-01T03:41:07.008Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:41:07.008Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:41:07.008Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:07.009Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:41:07.009Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T03:41:07.009Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:41:07.009Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:07.009Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:41:07.009Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:41:07.010Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Como","bufferCount":2,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:41:07.010Z"}
[2025-07-01T03:41:07.071Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"_rqF69jaIIsF1NfBy7Y6_g-gPOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341267"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:41:07.879Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:41:07.879Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:41:07.879Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:07.879Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:41:07.879Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va" | {"userName":"Alexander","preview":"Va"}
[2025-07-01T03:41:07.880Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T03:41:07.880Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:07.880Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:41:07.880Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:41:07.880Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Va","bufferCount":3,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:41:07.880Z"}
[2025-07-01T03:41:08.610Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"nIARTHUpMdn9Fz7WduT45w-gL.FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341268"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:41:08.791Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:41:08.791Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:41:08.792Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:08.792Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:41:08.792Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Todo" | {"userName":"Alexander","preview":"Todo"}
[2025-07-01T03:41:08.792Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4) | {"total":4}
[2025-07-01T03:41:08.792Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:08.792Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:41:08.793Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:41:08.793Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Todo","bufferCount":4,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:41:08.793Z"}
[2025-07-01T03:41:09.390Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":".m65hEFljRfaRKIo31AZMQ-gNSFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341269"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:41:10.440Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"zA62PjHhaArWsGWy94IO5A-gBOFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341270"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:41:10.857Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:41:10.858Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:41:10.858Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:10.858Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:41:10.858Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Por allá" | {"userName":"Alexander","preview":"Por allá"}
[2025-07-01T03:41:10.858Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 5) | {"total":5}
[2025-07-01T03:41:10.858Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:10.859Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:41:10.859Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:41:10.859Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Por allá","bufferCount":5,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:41:10.859Z"}
[2025-07-01T03:41:12.447Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PiGhUr_w2tBfWsYwW6bAOA-gI6FabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341272"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:41:18.868Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":5,"timeoutCompletedAt":"2025-07-01T03:41:18.867Z"}
[2025-07-01T03:41:18.868Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:18.868Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 5) | {"total":5}
[2025-07-01T03:41:18.868Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando mensajes agrupados | {"userId":"573003913251","shortUserId":"573003913251","chatId":"573003913251@s.whatsapp.net","messageCount":5,"totalLength":30,"preview":"Hola\n\nComo\n\nVa\n\nTodo\n\nPor allá..."}
[2025-07-01T03:41:18.869Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:18.870Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:41:18.870Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:41:18.870Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:41:18.870Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:41:18.870Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:41:18.870Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:41:18.871Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:41:20.491Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:41:20.523Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:41:20.526Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:41:20.526Z"}
[2025-07-01T03:41:20.526Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:41:20.526Z"}
[2025-07-01T03:41:20.526Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:41:20.527Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:41:20.527Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:41:20.528Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:41:20.533Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:41:25.327Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:41:25.362Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:41:25.365Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:41:25.365Z"}
[2025-07-01T03:41:25.365Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:41:25.365Z"}
[2025-07-01T03:41:25.365Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:41:25.366Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:41:25.367Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:41:25.368Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:41:25.374Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:41:37.735Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:41:37.766Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:41:37.768Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:41:37.768Z"}
[2025-07-01T03:41:37.769Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:41:37.769Z"}
[2025-07-01T03:41:37.769Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:41:37.769Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:41:37.770Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:41:37.771Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:41:37.775Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:41:39.799Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:41:39.830Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:41:39.835Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:41:39.835Z"}
[2025-07-01T03:41:39.835Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:41:39.835Z"}
[2025-07-01T03:41:39.835Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:41:39.836Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:41:39.837Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:41:39.837Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:41:39.841Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:41:50.904Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:41:50.936Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:41:50.939Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:41:50.939Z"}
[2025-07-01T03:41:50.939Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:41:50.939Z"}
[2025-07-01T03:41:50.939Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:41:50.940Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:41:50.940Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:41:50.941Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:41:50.945Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:42:01.063Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:42:01.094Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:42:01.096Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:42:01.096Z"}
[2025-07-01T03:42:01.097Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:42:01.097Z"}
[2025-07-01T03:42:01.097Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:42:01.097Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:42:01.098Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:42:01.099Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:42:01.104Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:42:03.635Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:42:03.667Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:42:03.671Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:42:03.671Z"}
[2025-07-01T03:42:03.672Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:42:03.672Z"}
[2025-07-01T03:42:03.672Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:42:03.672Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:42:03.673Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:42:03.673Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:42:03.677Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:42:12.617Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:42:12.657Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:42:12.660Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:42:12.660Z"}
[2025-07-01T03:42:12.660Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:42:12.660Z"}
[2025-07-01T03:42:12.660Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:42:12.661Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:42:12.661Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:42:12.662Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:42:12.668Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:42:13.766Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:42:13.797Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:42:13.799Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:42:13.799Z"}
[2025-07-01T03:42:13.800Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:42:13.800Z"}
[2025-07-01T03:42:13.800Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:42:13.800Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:42:13.801Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:42:13.802Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:42:13.806Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:42:24.534Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:42:24.567Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:42:24.570Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:42:24.570Z"}
[2025-07-01T03:42:24.570Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:42:24.570Z"}
[2025-07-01T03:42:24.571Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:42:24.571Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:42:24.572Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:42:24.572Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:42:24.579Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:42:29.569Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:42:29.604Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:42:29.607Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:42:29.607Z"}
[2025-07-01T03:42:29.608Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:42:29.608Z"}
[2025-07-01T03:42:29.608Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:42:29.608Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:42:29.610Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:42:29.610Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:42:29.615Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:42:35.334Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:42:35.365Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:42:35.367Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:42:35.367Z"}
[2025-07-01T03:42:35.368Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:42:35.368Z"}
[2025-07-01T03:42:35.368Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:42:35.368Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:42:35.369Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:42:35.369Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:42:35.373Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:42:44.703Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:42:44.736Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:42:44.741Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:42:44.741Z"}
[2025-07-01T03:42:44.742Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:42:44.742Z"}
[2025-07-01T03:42:44.742Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:42:44.742Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:42:44.743Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:42:44.743Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:42:44.748Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:42:49.431Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:42:49.465Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:42:49.470Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:42:49.470Z"}
[2025-07-01T03:42:49.471Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:42:49.471Z"}
[2025-07-01T03:42:49.471Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:42:49.472Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:42:49.472Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:42:49.473Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:42:49.476Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:43:00.141Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:43:00.175Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:43:00.177Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:43:00.177Z"}
[2025-07-01T03:43:00.178Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:43:00.178Z"}
[2025-07-01T03:43:00.178Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:43:00.178Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:43:00.180Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:43:00.181Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:43:00.186Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:43:06.325Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:43:06.358Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:43:06.361Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:43:06.361Z"}
[2025-07-01T03:43:06.361Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:43:06.361Z"}
[2025-07-01T03:43:06.361Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:43:06.362Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:43:06.363Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:43:06.363Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:43:06.368Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:43:13.128Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:43:13.166Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:43:13.168Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:43:13.168Z"}
[2025-07-01T03:43:13.168Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:43:13.168Z"}
[2025-07-01T03:43:13.168Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:43:13.169Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:43:13.170Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:43:13.170Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:43:13.174Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:43:15.182Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:43:15.218Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:43:15.224Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:43:15.224Z"}
[2025-07-01T03:43:15.225Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:43:15.225Z"}
[2025-07-01T03:43:15.225Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:43:15.225Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:43:15.226Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:43:15.226Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:43:15.232Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:43:19.112Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:43:19.153Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:43:19.155Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:43:19.155Z"}
[2025-07-01T03:43:19.156Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:43:19.156Z"}
[2025-07-01T03:43:19.156Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:43:19.156Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:43:19.157Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:43:19.158Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:43:19.162Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:43:29.639Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:43:29.670Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:43:29.673Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:43:29.673Z"}
[2025-07-01T03:43:29.673Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:43:29.673Z"}
[2025-07-01T03:43:29.673Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:43:29.673Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:43:29.674Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:43:29.674Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:43:29.679Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:43:30.960Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:43:30.993Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:43:30.999Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:43:30.998Z"}
[2025-07-01T03:43:30.999Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:43:30.999Z"}
[2025-07-01T03:43:30.999Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:43:31.000Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:43:31.000Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:43:31.001Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:43:31.004Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:43:53.931Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:43:53.932Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:43:53.932Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:43:53.932Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:43:53.932Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:43:53.933Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:43:53.933Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:43:53.933Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:43:53.934Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:43:53.934Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:43:53.934Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Hola","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:43:53.934Z"}
[2025-07-01T03:43:54.946Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:43:54.979Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:43:54.981Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:43:54.981Z"}
[2025-07-01T03:43:54.982Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:43:54.982Z"}
[2025-07-01T03:43:54.982Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:43:54.982Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:43:54.983Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:43:54.984Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:43:54.988Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:43:55.193Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:43:55.193Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:43:55.193Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:43:55.194Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:43:55.194Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como" | {"userName":"Alexander","preview":"Como"}
[2025-07-01T03:43:55.194Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:43:55.194Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:43:55.194Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:43:55.195Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:43:55.195Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:43:55.195Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Como","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:43:55.195Z"}
[2025-07-01T03:43:55.271Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"QsebhyGFAsg5i5FJENGBXg-gJKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341435"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:43:56.672Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"MSYEmGbJOyyEaGI6qa0fkg-gOaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341436"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:43:58.413Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:43:58.414Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:43:58.414Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:43:58.414Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:43:58.414Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Va" | {"userName":"Alexander","preview":"Va"}
[2025-07-01T03:43:58.414Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:43:58.414Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:43:58.415Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:43:58.415Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:43:58.415Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Va","bufferCount":2,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:43:58.415Z"}
[2025-07-01T03:43:59.874Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:43:59.874Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:43:59.874Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:43:59.874Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:43:59.874Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Todo" | {"userName":"Alexander","preview":"Todo"}
[2025-07-01T03:43:59.875Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 3) | {"total":3}
[2025-07-01T03:43:59.875Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:43:59.875Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:43:59.875Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:43:59.875Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Todo","bufferCount":3,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:43:59.875Z"}
[2025-07-01T03:43:59.998Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"GSDGZ67ufA92muCfdb_ujQ-gPKFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341440"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:44:00.568Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"dpnj1xhr7vlhSCYVDgQV_g-gJGFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341440"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:44:01.575Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:44:01.575Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:44:01.575Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:44:01.575Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:44:01.576Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Por alla" | {"userName":"Alexander","preview":"Por alla"}
[2025-07-01T03:44:01.576Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 4) | {"total":4}
[2025-07-01T03:44:01.576Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:44:01.576Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:44:01.577Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:44:01.577Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Por alla","bufferCount":4,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:44:01.577Z"}
[2025-07-01T03:44:03.177Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"4KDpqlsIqQLi0xiXKTSSMw-gGaFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341443"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:44:09.591Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":4,"timeoutCompletedAt":"2025-07-01T03:44:09.591Z"}
[2025-07-01T03:44:09.592Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:44:09.592Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 4) | {"total":4}
[2025-07-01T03:44:09.592Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando mensajes agrupados | {"userId":"573003913251","shortUserId":"573003913251","chatId":"573003913251@s.whatsapp.net","messageCount":4,"totalLength":24,"preview":"Como\n\nVa\n\nTodo\n\nPor alla..."}
[2025-07-01T03:44:09.592Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:44:09.592Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:44:09.593Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:44:09.593Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:44:09.593Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:44:09.593Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:44:09.593Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:44:09.593Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:44:10.146Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:44:10.146Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":24,"messagePreview":"Como\n\nVa\n\nTodo\n\nPor alla"}
[2025-07-01T03:44:10.146Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:44:11.318Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_4imXJ1fy1D1IbqFcCNqNGGDW"}
[2025-07-01T03:44:14.185Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:44:14.618Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4593ms | {"duration":4593,"userName":"Alexander"}
[2025-07-01T03:44:14.618Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":91,"preview":"¡Todo bien por aquí, Alexander! ¿Cómo puedo ayudarte hoy con los apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:44:14.619Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:44:14.619Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":91,"preview":"¡Todo bien por aquí, Alexander! ¿Cómo puedo ayudarte hoy con los apartamentos en Cartagena?..."}
[2025-07-01T03:44:18.799Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado para tracking anti-duplicación | {"shortUserId":"573003913251","messageId":"Psrr1vZ1EJnI0RM-wOqFabHYIw","messageLength":91,"timestamp":"2025-07-01T03:44:18.798Z"}
[2025-07-01T03:44:18.799Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Todo bien por aquí, Alexander! ¿Cómo puedo ayudar..." | {"userName":"Usuario","preview":"¡Todo bien por aquí, Alexander! ¿Cómo puedo ayudar..."}
[2025-07-01T03:44:18.799Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente | {"shortUserId":"573003913251","messageLength":91,"messageId":"Psrr1vZ1EJnI0RM-wOqFabHYIw","responseTime":0}
[2025-07-01T03:44:18.799Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:44:19.622Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:44:19.623Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: Psrr1vZ1EJnI0RM-wOqFabHYIw
[2025-07-01T03:44:19.823Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psrr1vZ1EJnI0RM-wOqFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341460"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:44:20.206Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psrr1vZ1EJnI0RM-wOqFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341460"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:44:49.709Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:44:49.710Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:44:49.710Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:44:49.710Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251@s.whatsapp.net","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:44:10.145Z","previousThreads":[]}}
[2025-07-01T03:44:49.710Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:44:10.145Z"}
[2025-07-01T03:44:49.711Z] [INFO] MANUAL_DETECTED [app.ts]: Mensaje manual del agente detectado | {"shortClientId":"573003913251","agentName":"asesor de reservas","messageText":"Que te cuentas Alexander?","messageLength":25,"timestamp":"2025-07-01T03:44:49.711Z","chatId":"573003913251@s.whatsapp.net"}
[2025-07-01T03:44:49.711Z] [INFO] MANUAL_BUFFER_CREATE [app.ts]: Buffer manual creado | {"shortClientId":"573003913251","agentName":"asesor de reservas"}
[2025-07-01T03:44:49.711Z] [INFO] MANUAL_BUFFERING [app.ts]: Mensaje manual agregado al buffer | {"shortClientId":"573003913251","bufferCount":1,"agentName":"asesor de reservas","timeoutSeconds":8}
[2025-07-01T03:44:50.592Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"9pz_KyoJbhk7mcZKaEbmjQ-wBaFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341491"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:44:57.721Z] [INFO] MANUAL_PROCESSING [app.ts]: Procesando mensajes manuales agrupados | {"shortClientId":"573003913251","messageCount":1,"agentName":"asesor de reservas","combinedLength":25,"preview":"Que te cuentas Alexander?","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:44:57.721Z] [INFO] MANUAL_SYNC_START [app.ts]: Iniciando sincronización con OpenAI | {"shortClientId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messagePreview":"Que te cuentas Alexander?","agentName":"asesor de reservas"}
[2025-07-01T03:44:58.573Z] [SUCCESS] MANUAL_SYNC_SUCCESS [app.ts]: Mensajes manuales sincronizados exitosamente | {"shortClientId":"573003913251","agentName":"asesor de reservas","messageCount":1,"totalLength":25,"preview":"Que te cuentas Alexander?","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","timestamp":"2025-07-01T03:44:58.573Z"}
[2025-07-01T03:45:26.678Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:45:26.679Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:45:26.679Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:45:26.679Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:45:26.679Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "A como fue que me dijiste q estaban los apartament..." | {"userName":"Alexander","preview":"A como fue que me dijiste q estaban los apartament..."}
[2025-07-01T03:45:26.679Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:45:26.679Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:45:26.679Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:45:26.680Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:44:58.572Z","previousThreads":[]}}
[2025-07-01T03:45:26.680Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:44:58.572Z"}
[2025-07-01T03:45:26.680Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"A como fue que me dijiste q estaban los apartament","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:45:26.680Z"}
[2025-07-01T03:45:28.033Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"ADnstik5g.xg8vvPenMTow-gByFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341528"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:45:34.692Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":1,"timeoutCompletedAt":"2025-07-01T03:45:34.692Z"}
[2025-07-01T03:45:34.693Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:45:34.693Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:45:34.693Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando mensajes agrupados | {"userId":"573003913251","shortUserId":"573003913251","chatId":"573003913251@s.whatsapp.net","messageCount":1,"totalLength":65,"preview":"A como fue que me dijiste q estaban los apartamentos a que precio..."}
[2025-07-01T03:45:34.693Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:45:34.693Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:45:34.694Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:45:34.694Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:44:58.572Z","previousThreads":[]}}
[2025-07-01T03:45:34.694Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:44:58.572Z"}
[2025-07-01T03:45:34.694Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:45:34.694Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:45:34.694Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:45:35.529Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:45:35.529Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":65,"messagePreview":"A como fue que me dijiste q estaban los apartamentos a que precio"}
[2025-07-01T03:45:35.529Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:45:36.530Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_y3SrSw37gbUtls1rZMGrR6EG"}
[2025-07-01T03:45:39.246Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:45:39.524Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4553ms | {"duration":4553,"userName":"Alexander"}
[2025-07-01T03:45:39.524Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":156,"preview":"Los apartamentos están disponibles a 220 y 350 por noche, dependiendo del tipo de apartamento que el...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:45:39.524Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:45:39.524Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":156,"preview":"Los apartamentos están disponibles a 220 y 350 por noche, dependiendo del tipo de apartamento que el..."}
[2025-07-01T03:45:43.231Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado para tracking anti-duplicación | {"shortUserId":"573003913251","messageId":"Psp6mgaXJF6jP90-wJmFabHYIw","messageLength":156,"timestamp":"2025-07-01T03:45:43.231Z"}
[2025-07-01T03:45:43.232Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Los apartamentos están disponibles a 220 y 350 por..." | {"userName":"Usuario","preview":"Los apartamentos están disponibles a 220 y 350 por..."}
[2025-07-01T03:45:43.232Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente | {"shortUserId":"573003913251","messageLength":156,"messageId":"Psp6mgaXJF6jP90-wJmFabHYIw","responseTime":0}
[2025-07-01T03:45:43.232Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:45:44.004Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:45:44.004Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: Psp6mgaXJF6jP90-wJmFabHYIw
[2025-07-01T03:45:44.253Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psp6mgaXJF6jP90-wJmFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341545"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:45:52.123Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:45:52.123Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:45:52.123Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:45:52.123Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:45:52.123Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Me hablaste de dos alcobas creo" | {"userName":"Alexander","preview":"Me hablaste de dos alcobas creo"}
[2025-07-01T03:45:52.124Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:45:52.124Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:45:52.124Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:45:52.124Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:45:35.529Z","previousThreads":[]}}
[2025-07-01T03:45:52.124Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:45:35.529Z"}
[2025-07-01T03:45:52.124Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Me hablaste de dos alcobas creo","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:45:52.124Z"}
[2025-07-01T03:45:52.746Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"yUnBE8.dzO3LQQzJ3bO5ww-gKeFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341553"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:46:00.130Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":1,"timeoutCompletedAt":"2025-07-01T03:46:00.130Z"}
[2025-07-01T03:46:00.131Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:46:00.131Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:46:00.131Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando mensajes agrupados | {"userId":"573003913251","shortUserId":"573003913251","chatId":"573003913251@s.whatsapp.net","messageCount":1,"totalLength":31,"preview":"Me hablaste de dos alcobas creo..."}
[2025-07-01T03:46:00.131Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:46:00.131Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:46:00.131Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:46:00.131Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:45:35.529Z","previousThreads":[]}}
[2025-07-01T03:46:00.131Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:45:35.529Z"}
[2025-07-01T03:46:00.132Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:46:00.132Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:46:00.132Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:46:00.642Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:46:00.642Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":31,"messagePreview":"Me hablaste de dos alcobas creo"}
[2025-07-01T03:46:00.642Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:46:02.226Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_7VqCgDN2tAQocBWqgzC8qqZx"}
[2025-07-01T03:46:04.963Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:46:05.225Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 4832ms | {"duration":4832,"userName":"Alexander"}
[2025-07-01T03:46:05.225Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":134,"preview":"Sí, mencioné que hay apartamentos de 2 alcobas disponibles a 500 mil por noche. ¿Te gustaría más inf...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:46:05.226Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:46:05.226Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":134,"preview":"Sí, mencioné que hay apartamentos de 2 alcobas disponibles a 500 mil por noche. ¿Te gustaría más inf..."}
[2025-07-01T03:46:09.006Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado para tracking anti-duplicación | {"shortUserId":"573003913251","messageId":"PsqUGZbBTUdV6hQ-wHyFabHYIw","messageLength":134,"timestamp":"2025-07-01T03:46:09.006Z"}
[2025-07-01T03:46:09.006Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Sí, mencioné que hay apartamentos de 2 alcobas dis..." | {"userName":"Usuario","preview":"Sí, mencioné que hay apartamentos de 2 alcobas dis..."}
[2025-07-01T03:46:09.006Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente | {"shortUserId":"573003913251","messageLength":134,"messageId":"PsqUGZbBTUdV6hQ-wHyFabHYIw","responseTime":0}
[2025-07-01T03:46:09.006Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:46:09.827Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:46:09.827Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: PsqUGZbBTUdV6hQ-wHyFabHYIw
[2025-07-01T03:46:10.030Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsqUGZbBTUdV6hQ-wHyFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341570"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:46:17.159Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:46:17.160Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:46:17.160Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:46:17.160Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:46:17.160Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Oki" | {"userName":"Alexander","preview":"Oki"}
[2025-07-01T03:46:17.161Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:46:17.161Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:46:17.161Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:46:17.161Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:46:00.641Z","previousThreads":[]}}
[2025-07-01T03:46:17.161Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:46:00.641Z"}
[2025-07-01T03:46:17.161Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Oki","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:46:17.161Z"}
[2025-07-01T03:46:18.782Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"GSoBLx_Tq.3WMeMJiKQZFA-gEqFabHYIw","code":4,"status":"read","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341579"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:46:25.170Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":1,"timeoutCompletedAt":"2025-07-01T03:46:25.170Z"}
[2025-07-01T03:46:25.170Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:46:25.170Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:46:25.170Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando mensajes agrupados | {"userId":"573003913251","shortUserId":"573003913251","chatId":"573003913251@s.whatsapp.net","messageCount":1,"totalLength":3,"preview":"Oki..."}
[2025-07-01T03:46:25.170Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:46:25.171Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:46:25.171Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:46:25.171Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:46:00.641Z","previousThreads":[]}}
[2025-07-01T03:46:25.171Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:46:00.641Z"}
[2025-07-01T03:46:25.172Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:46:25.172Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:46:25.172Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:46:25.887Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:46:25.888Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":3,"messagePreview":"Oki"}
[2025-07-01T03:46:25.888Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:46:27.335Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_pdXchI7ogQcHqGpzHDmUYPwm"}
[2025-07-01T03:46:30.789Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:46:31.007Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5618ms | {"duration":5618,"userName":"Alexander"}
[2025-07-01T03:46:31.007Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":121,"preview":"Perfecto, Alexander. Si necesitas más detalles o quieres hacer una reserva, solo házmelo saber. Esto...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:46:31.008Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:46:31.008Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":121,"preview":"Perfecto, Alexander. Si necesitas más detalles o quieres hacer una reserva, solo házmelo saber. Esto..."}
[2025-07-01T03:46:34.698Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado para tracking anti-duplicación | {"shortUserId":"573003913251","messageId":"PsoG7HywKefOhGQ-wEOFabHYIw","messageLength":121,"timestamp":"2025-07-01T03:46:34.698Z"}
[2025-07-01T03:46:34.698Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "Perfecto, Alexander. Si necesitas más detalles o q..." | {"userName":"Usuario","preview":"Perfecto, Alexander. Si necesitas más detalles o q..."}
[2025-07-01T03:46:34.698Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente | {"shortUserId":"573003913251","messageLength":121,"messageId":"PsoG7HywKefOhGQ-wEOFabHYIw","responseTime":0}
[2025-07-01T03:46:34.699Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:46:35.532Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:46:35.532Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: PsoG7HywKefOhGQ-wEOFabHYIw
[2025-07-01T03:46:35.707Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"PsoG7HywKefOhGQ-wEOFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751341596"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:48:46.325Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:48:46.360Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:48:46.366Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:48:46.366Z"}
[2025-07-01T03:48:46.367Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:48:46.367Z"}
[2025-07-01T03:48:46.367Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:48:46.368Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:48:46.369Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:48:46.370Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:48:46.375Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:52:39.772Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:52:39.819Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:52:39.822Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:52:39.822Z"}
[2025-07-01T03:52:39.823Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:52:39.823Z"}
[2025-07-01T03:52:39.824Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:52:39.825Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:52:39.826Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:52:39.826Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:52:39.835Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:52:52.608Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:52:52.671Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:52:52.676Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:52:52.676Z"}
[2025-07-01T03:52:52.677Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:52:52.677Z"}
[2025-07-01T03:52:52.678Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:52:52.679Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:52:52.680Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:52:52.683Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:52:52.692Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:52:54.454Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:52:54.487Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:52:54.490Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:52:54.490Z"}
[2025-07-01T03:52:54.490Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:52:54.490Z"}
[2025-07-01T03:52:54.490Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:52:54.491Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:52:54.492Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:52:54.492Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:52:54.496Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:53:58.524Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:53:58.560Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:53:58.563Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:53:58.563Z"}
[2025-07-01T03:53:58.564Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:53:58.564Z"}
[2025-07-01T03:53:58.564Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:53:58.565Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:53:58.565Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:53:58.566Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:53:58.571Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:53:59.561Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:53:59.598Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:53:59.601Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:53:59.601Z"}
[2025-07-01T03:53:59.602Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:53:59.602Z"}
[2025-07-01T03:53:59.602Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:53:59.603Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:53:59.604Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:53:59.604Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:53:59.610Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:54:09.253Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:54:09.300Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:54:09.307Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:54:09.306Z"}
[2025-07-01T03:54:09.307Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:54:09.307Z"}
[2025-07-01T03:54:09.308Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:54:09.309Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:54:09.312Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:54:09.312Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:54:09.320Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:54:10.738Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:54:10.777Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:54:10.782Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:54:10.782Z"}
[2025-07-01T03:54:10.782Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:54:10.782Z"}
[2025-07-01T03:54:10.783Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:54:10.784Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:54:10.785Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:54:10.785Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:54:10.790Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:54:22.712Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:54:22.747Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:54:22.750Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:54:22.750Z"}
[2025-07-01T03:54:22.750Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:54:22.750Z"}
[2025-07-01T03:54:22.751Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:54:22.751Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:54:22.753Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:54:22.753Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:54:22.756Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:54:35.695Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:54:35.731Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:54:35.734Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:54:35.734Z"}
[2025-07-01T03:54:35.735Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:54:35.735Z"}
[2025-07-01T03:54:35.735Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:54:35.735Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:54:35.736Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:54:35.737Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:54:35.743Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:54:48.582Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:54:48.782Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:54:48.786Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:54:48.786Z"}
[2025-07-01T03:54:48.787Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:54:48.787Z"}
[2025-07-01T03:54:48.787Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:54:48.788Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:54:48.791Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:54:48.792Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:54:48.800Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:54:57.717Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:54:57.755Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:54:57.759Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:54:57.759Z"}
[2025-07-01T03:54:57.759Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:54:57.759Z"}
[2025-07-01T03:54:57.760Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:54:57.760Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:54:57.761Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:54:57.761Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:54:57.765Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
[2025-07-01T03:55:19.164Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:55:19.165Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:55:19.165Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:55:19.166Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:55:19.166Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:55:19.167Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:55:19.167Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:55:19.167Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:55:19.168Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:55:19.168Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:55:19.168Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Hola","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:55:19.168Z"}
[2025-07-01T03:55:21.731Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:55:21.732Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:55:21.732Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:55:21.732Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:55:21.732Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Como va todo" | {"userName":"Alexander","preview":"Como va todo"}
[2025-07-01T03:55:21.732Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:55:21.733Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:55:21.733Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:55:21.733Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:55:21.733Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Como va todo","bufferCount":2,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:55:21.733Z"}
[2025-07-01T03:55:29.748Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":2,"timeoutCompletedAt":"2025-07-01T03:55:29.748Z"}
[2025-07-01T03:55:29.749Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:55:29.749Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 2) | {"total":2}
[2025-07-01T03:55:29.750Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando mensajes agrupados | {"userId":"573003913251","shortUserId":"573003913251","chatId":"573003913251@s.whatsapp.net","messageCount":2,"totalLength":18,"preview":"Hola\n\nComo va todo..."}
[2025-07-01T03:55:29.750Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:55:29.750Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:55:29.750Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:55:29.751Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:24:55.350Z","previousThreads":[]}}
[2025-07-01T03:55:29.751Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z"}
[2025-07-01T03:55:29.751Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:55:29.751Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:55:29.751Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:55:30.314Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:55:30.314Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":18,"messagePreview":"Hola\n\nComo va todo"}
[2025-07-01T03:55:30.314Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:55:32.239Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_XN7X1Gx1KNPtnpffePAIZxEz"}
[2025-07-01T03:55:35.620Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:55:36.044Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5870ms | {"duration":5870,"userName":"Alexander"}
[2025-07-01T03:55:36.044Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":102,"preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudarte hoy con respecto a los apartamentos en Cartagen...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:55:36.044Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:55:36.045Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":102,"preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudarte hoy con respecto a los apartamentos en Cartagen..."}
[2025-07-01T03:55:40.179Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado para tracking anti-duplicación | {"shortUserId":"573003913251","messageId":"Psrb0py0W.Ns_uE-wBWFabHYIw","messageLength":102,"timestamp":"2025-07-01T03:55:40.179Z"}
[2025-07-01T03:55:40.179Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudar..." | {"userName":"Usuario","preview":"¡Hola, Alexander! Todo va bien. ¿Cómo puedo ayudar..."}
[2025-07-01T03:55:40.179Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente | {"shortUserId":"573003913251","messageLength":102,"messageId":"Psrb0py0W.Ns_uE-wBWFabHYIw","responseTime":0}
[2025-07-01T03:55:40.179Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:55:40.976Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:55:40.977Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: Psrb0py0W.Ns_uE-wBWFabHYIw
[2025-07-01T03:55:41.739Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psrb0py0W.Ns_uE-wBWFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751342142"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:55:42.060Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psrb0py0W.Ns_uE-wBWFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751342142"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:57:48.455Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:57:48.455Z] [DEBUG] NAME_EXTRACTION [app.ts]: Nombre limpiado | {"original":"Alexander -","cleaned":"Alexander"}
[2025-07-01T03:57:48.456Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:57:48.456Z] [INFO] WEBHOOK_USER [app.ts]: Usuario detectado: 573003913251 | {"originalChatId":"573003913251@s.whatsapp.net","userId":"573003913251","shortUserId":"573003913251","rawName":"Alexander -","cleanName":"Alexander"}
[2025-07-01T03:57:48.456Z] [INFO] WHATSAPP_IN [app.ts]: 573003913251: "Hola" | {"userName":"Alexander","preview":"Hola"}
[2025-07-01T03:57:48.456Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_created para 573003913251 | {}
[2025-07-01T03:57:48.456Z] [INFO] MESSAGE_BUFFER [app.ts]: message_added para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:57:48.456Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:57:48.456Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:55:30.313Z","previousThreads":[]}}
[2025-07-01T03:57:48.457Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:55:30.313Z"}
[2025-07-01T03:57:48.457Z] [INFO] CONVERSATION_FLOW [app.ts]: Cliente escribiendo | {"shortUserId":"573003913251","clientMessage":"Hola","bufferCount":1,"timeoutSeconds":8,"hasActiveThread":true,"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","timestamp":"2025-07-01T03:57:48.457Z"}
[2025-07-01T03:57:56.469Z] [INFO] TIMER [app.ts]: Timeout completado, procesando mensajes | {"shortUserId":"573003913251","messageCount":1,"timeoutCompletedAt":"2025-07-01T03:57:56.469Z"}
[2025-07-01T03:57:56.469Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:57:56.469Z] [INFO] MESSAGE_BUFFER [app.ts]: processing_combined_messages para 573003913251 (total: 1) | {"total":1}
[2025-07-01T03:57:56.469Z] [INFO] MESSAGE_PROCESS [app.ts]: Procesando mensajes agrupados | {"userId":"573003913251","shortUserId":"573003913251","chatId":"573003913251@s.whatsapp.net","messageCount":1,"totalLength":4,"preview":"Hola..."}
[2025-07-01T03:57:56.470Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:57:56.470Z] [INFO] USER_DEBUG [app.ts]: UserJid para búsqueda: "573003913251" | {"originalFormat":"573003913251","cleanedFormat":"573003913251","chatId":"573003913251@s.whatsapp.net","userName":"Alexander"}
[2025-07-01T03:57:56.470Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251","cleaned":"573003913251"}
[2025-07-01T03:57:56.470Z] [DEBUG] THREAD_LOOKUP [app.ts]: Búsqueda de thread | {"userJid":"573003913251","cleanedId":"573003913251","found":true,"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","threadInfo":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","createdAt":"2025-06-30T21:35:54.940Z","lastActivity":"2025-07-01T03:55:30.313Z","previousThreads":[]}}
[2025-07-01T03:57:56.470Z] [INFO] THREAD_GET [app.ts]: Thread encontrado para 573003913251 (Alexander): thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:55:30.313Z"}
[2025-07-01T03:57:56.470Z] [INFO] THREAD_CHECK [app.ts]: Thread encontrado: thread_iGJlkyZND0iuKp5h7J1d0QY1 | {"userJid":"573003913251","shortUserId":"573003913251","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","totalThreads":1}
[2025-07-01T03:57:56.470Z] [SUCCESS] THREAD_REUSE [app.ts]: Reutilizando thread existente para 573003913251 (Alexander) | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","userJid":"573003913251","cleanedId":"573003913251"}
[2025-07-01T03:57:56.470Z] [INFO] OPENAI_REQUEST [app.ts]: adding_message para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:57:56.972Z] [INFO] OPENAI_REQUEST [app.ts]: message_added para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:57:56.972Z] [DEBUG] MESSAGE_DETAIL [app.ts]: Mensaje agregado al thread | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageLength":4,"messagePreview":"Hola"}
[2025-07-01T03:57:56.972Z] [INFO] OPENAI_REQUEST [app.ts]: creating_run para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:57:58.415Z] [INFO] OPENAI_REQUEST [app.ts]: run_started para 573003913251 | {"threadId":"run_Gqcnijajd4MiRq6y84eYWHFM"}
[2025-07-01T03:58:01.874Z] [INFO] OPENAI_REQUEST [app.ts]: retrieving_messages para 573003913251 | {"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1"}
[2025-07-01T03:58:02.306Z] [SUCCESS] AI_PROCESSING [app.ts]: Respuesta obtenida para 573003913251 en 5404ms | {"duration":5404,"userName":"Alexander"}
[2025-07-01T03:58:02.307Z] [INFO] OPENAI_RESPONSE [app.ts]: Respuesta obtenida para 573003913251 | {"responseLength":91,"preview":"¡Hola, Alexander! ¿En qué puedo asistirte hoy con respecto a los apartamentos en Cartagena?...","threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","messageCount":20,"userName":"Alexander"}
[2025-07-01T03:58:02.307Z] [DEBUG] USER_ID_EXTRACTION [app.ts]: Extrayendo ID de usuario | {"original":"573003913251@s.whatsapp.net","cleaned":"573003913251"}
[2025-07-01T03:58:02.307Z] [INFO] WHATSAPP_SEND [app.ts]: Enviando mensaje a 573003913251 | {"chatId":"573003913251@s.whatsapp.net","messageLength":91,"preview":"¡Hola, Alexander! ¿En qué puedo asistirte hoy con respecto a los apartamentos en Cartagena?..."}
[2025-07-01T03:58:06.018Z] [DEBUG] BOT_MESSAGE_TRACKED [app.ts]: Mensaje del bot registrado para tracking anti-duplicación | {"shortUserId":"573003913251","messageId":"Psq5v.xb.xwDuqw-wNaFabHYIw","messageLength":91,"timestamp":"2025-07-01T03:58:06.018Z"}
[2025-07-01T03:58:06.018Z] [INFO] WHATSAPP_OUT [app.ts]: 573003913251: "¡Hola, Alexander! ¿En qué puedo asistirte hoy con ..." | {"userName":"Usuario","preview":"¡Hola, Alexander! ¿En qué puedo asistirte hoy con ..."}
[2025-07-01T03:58:06.019Z] [SUCCESS] WHATSAPP_SEND [app.ts]: Mensaje enviado exitosamente | {"shortUserId":"573003913251","messageLength":91,"messageId":"Psq5v.xb.xwDuqw-wNaFabHYIw","responseTime":0}
[2025-07-01T03:58:06.019Z] [INFO] MESSAGE_BUFFER [app.ts]: buffer_cleared para 573003913251 | {}
[2025-07-01T03:58:06.831Z] [INFO] WEBHOOK [app.ts]: Procesando 1 mensajes del webhook
[2025-07-01T03:58:06.832Z] [DEBUG] BOT_MESSAGE_FILTERED [app.ts]: Mensaje del bot ignorado: Psq5v.xb.xwDuqw-wNaFabHYIw
[2025-07-01T03:58:07.771Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psq5v.xb.xwDuqw-wNaFabHYIw","code":2,"status":"sent","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751342288"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:58:07.929Z] [WARNING] WEBHOOK [app.ts]: Webhook recibido sin mensajes válidos | {"body":{"statuses":[{"id":"Psq5v.xb.xwDuqw-wNaFabHYIw","code":3,"status":"delivered","recipient_id":"573003913251@s.whatsapp.net","timestamp":"1751342288"}],"event":{"type":"statuses","event":"post"},"channel_id":"PUNISH-5CJRX"}}
[2025-07-01T03:59:17.259Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging detallado inicializado | {"logDir":"logs","bufferInterval":100,"maxBufferSize":50,"currentFile":"logs\\bot-2025-06-30.log"}
[2025-07-01T03:59:17.324Z] [SUCCESS] OPENAI_INIT [app.ts]: SDK de OpenAI inicializado correctamente
[2025-07-01T03:59:17.331Z] [INFO] APP_INIT [app.ts]: Iniciando servidor bot TeAlquilamos | {"port":"3008","timestamp":"2025-07-01T03:59:17.331Z"}
[2025-07-01T03:59:17.332Z] [SUCCESS] THREADS_LOADED [app.ts]: Threads cargados desde archivo | {"totalThreads":1,"activeThreads":1,"timestamp":"2025-07-01T03:59:17.332Z"}
[2025-07-01T03:59:17.333Z] [INFO] THREADS_INFO [app.ts]: 1 threads activos en el sistema | {"activeThreads":1,"totalThreads":1}
[2025-07-01T03:59:17.334Z] [DEBUG] THREADS_DETAIL [app.ts]: Threads cargados detalladamente | {"threads":{"573003913251":{"threadId":"thread_iGJlkyZND0iuKp5h7J1d0QY1","chatId":"573003913251@s.whatsapp.net","userName":"Alexander","lastActivity":"2025-07-01T03:24:55.350Z","createdAt":"2025-06-30T21:35:54.940Z","previousThreads":0}}}
[2025-07-01T03:59:17.335Z] [INFO] DEBUG_FILE [app.ts]: Archivo de debug legacy inicializado | {"path":"./whatsapp-sync-debug.log","debugMode":true}
[2025-07-01T03:59:17.335Z] [SUCCESS] CONFIG [app.ts]: Configuración validada correctamente | {"port":"3008","hasAssistantId":true,"hasWhapiToken":true,"whapiUrl":"https://gate.whapi.cloud/","debugMode":true}
[2025-07-01T03:59:17.340Z] [SUCCESS] SERVER_START [app.ts]: Bot con sincronización manual iniciado exitosamente | {"port":"3008","clientTimeout":"8000ms","manualTimeout":"8000ms","features":["client_grouping","manual_sync","bot_message_filtering"],"debugMode":true,"loadedThreads":{"totalThreads":1,"activeThreads":1},"botTracking":true,"manualBuffering":true}
