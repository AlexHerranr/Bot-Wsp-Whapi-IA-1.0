Starting Container

> tealquilamos-bot@1.0.0 start
> node dist/app-unified.js

üìÅ Logs de esta sesi√≥n: logs/bot-session-2025-07-26T17-14-27.log
üîÑ Manteniendo m√°ximo 5 sesiones
[2025-07-26T17:14:27.939Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging por sesi√≥n inicializado | {"sessionId":"session-2025-07-26T17-14-27","logFile":"logs/bot-session-2025-07-26T17-14-27.log","maxSessions":5,"maxBufferSizeLocal":50,"maxBufferSizeRailway":400,"bufferInterval":100}
2025-07-26T22:14:28.017446062Z [INFO] [THREAD_PERSIST] Directorio creado: tmp/backups jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:14:28.014Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:28.014Z"
2025-07-26T22:14:28.017482905Z [INFO] [THREAD_PERSIST] No se encontr√≥ archivo de threads, iniciando vac√≠o jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:14:28.015Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:28.015Z"
2025-07-26T22:14:28.017515517Z [INFO] [THREAD_PERSIST] Auto-guardado optimizado configurado cada 5 minutos jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:14:28.016Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:28.016Z"
2025-07-26T22:14:28.084460607Z [INFO] [GUEST_MEMORY] Sistema de cache de labels inicializado (TTL: 300s, limpieza: 10min) jsonPayload={"category":"GUEST_MEMORY","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:14:28.082Z"} labels={"app":"whatsapp-bot","category":"GUEST_MEMORY","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:28.082Z"

üöÄ TeAlquilamos Bot - Iniciando...
üìÖ Timestamp: 2025-07-26T22:14:28.086Z
üîß Node.js: v18.20.8
üíæ Memoria inicial: 27MB
üåç Entorno: production
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üîç Detectando entorno...
   RAILWAY_ENVIRONMENT: production
   RAILWAY_PROJECT_ID: 84017f88-1aab-4519-afd2-4e55a45cee90
   K_SERVICE: not set
   NODE_ENV: production
‚úÖ Detectado: Railway
üîß Puerto detectado: 8080 (process.env.PORT: 8080)
üîß Forzando NODE_ENV=production para Railway
üîß Configuraci√≥n del Entorno:
   üìç Entorno: cloud-run
   üåê Puerto: 8080
   ÔøΩÔøΩ Webhook: https://bot-wsp-whapi-ia-10-production.up.railway.app/hook
   üìä Log Level: production
   üîç Logs Detallados: S√≠
   ‚è±Ô∏è  Buffer de Mensajes: Activo (10s)
   ‚òÅÔ∏è  Modo: Cloud Run
   üöÄ Producci√≥n: Activo
   üîë Secretos: Cargados
   üìú Inyecci√≥n Historial: Inactiva (3 meses, 200 msgs)
   ‚è±Ô∏è Cache TTL: 3600 segundos (1h)
2025-07-26T22:14:28.093313299Z [INFO] [THREAD_PERSIST] Cleanup inicial ejecutado con 3 meses jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:14:28.091Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:28.091Z"
2025-07-26T22:14:28.093349870Z [INFO] [THREAD_PERSIST] Cleanup peri√≥dico configurado cada 5 minutos jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:14:28.091Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:28.091Z"
2025-07-26T22:14:28.112610261Z [INFO] [SERVER_START] Servidor HTTP iniciado jsonPayload={"category":"SERVER_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"host":"0.0.0.0","level":"INFO","port":8080,"timestamp":"2025-07-26T22:14:28.102Z","webhookUrl":"https://bot-wsp-whapi-ia-10-production.up.railway.app/hook"} labels={"app":"whatsapp-bot","category":"SERVER_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:28.102Z"

=== Bot TeAlquilamos Iniciado ===
üöÄ Servidor: 0.0.0.0:8080
üîó Webhook: https://bot-wsp-whapi-ia-10-production.up.railway.app/hook
‚úÖ Sistema listo

2025-07-26T22:14:28.112760975Z [INFO] [BOT_INIT] Cleanup autom√°tico de threads y cache configurado jsonPayload={"category":"BOT_INIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:14:28.103Z"} labels={"app":"whatsapp-bot","category":"BOT_INIT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:28.103Z"
2025-07-26T22:14:28.112802796Z [INFO] [CACHE_INIT] Estad√≠sticas de cache al inicio jsonPayload={"category":"CACHE_INIT","contextCache":{"size":0,"ttlMinutes":1},"environment":"cloud-run","flow":{"stage":"0_unknown"},"historyCache":{"size":0,"ttlMinutes":60},"injectionCache":{"size":0,"ttlMinutes":5},"level":"INFO","timestamp":"2025-07-26T22:14:28.103Z"} labels={"app":"whatsapp-bot","category":"CACHE_INIT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:28.103Z"
2025-07-26T22:14:33.108817521Z [INFO] [ORPHANED_RUNS_RECOVERY_START] Iniciando recuperaci√≥n de runs hu√©rfanos jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:14:33.107Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:33.107Z"
2025-07-26T22:14:33.110246451Z [INFO] [ORPHANED_RUNS_RECOVERY_START] Iniciando recuperaci√≥n de runs hu√©rfanos jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:14:33.108Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:33.108Z"
2025-07-26T22:14:33.110288111Z [INFO] [ORPHANED_RUNS_RECOVERY_COMPLETE] Recuperaci√≥n de runs hu√©rfanos completada jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_COMPLETE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","runsCancelled":0,"runsChecked":0,"timestamp":"2025-07-26T22:14:33.109Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T22:14:33.109Z"
2025-07-26T22:14:33.110324663Z [INFO] [ORPHANED_RUNS_RECOVERY_COMPLETE] Recuperaci√≥n de runs hu√©rfanos completada jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_COMPLETE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","timestamp":"2025-07-26T22:14:33.109Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T22:14:33.109Z"
2025-07-26T22:15:13.115522604Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T22:15:05.591Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:05.591Z"
2025-07-26T22:15:13.115559909Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: recording jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"recording","timestamp":"2025-07-26T22:15:05.592Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:05.592Z"
2025-07-26T22:15:13.115594882Z [INFO] [BUFFER_TIMER_SET] Timer inteligente configurado jsonPayload={"bufferSize":0,"category":"BUFFER_TIMER_SET","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timerMs":10000,"timestamp":"2025-07-26T22:15:05.592Z","triggerType":"recording","userJid":"573003913251","userName":"573003913251","wasReconfigured":true} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_SET","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:05.592Z"
üéôÔ∏è 573003913251 est√° grabando...
2025-07-26T22:15:13.115637071Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T22:15:09.077Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:09.077Z"
2025-07-26T22:15:13.115663349Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: online jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"online","timestamp":"2025-07-26T22:15:09.077Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:09.077Z"
üé§ Sr Alex: [Nota de voz recibida]
‚ùå Error al procesar audio ‚Üí Sr Alex: File is not defined
2025-07-26T22:15:13.115761998Z [INFO] [TRANSCRIPTION_ERROR] Error en transcripci√≥n de audio jsonPayload={"category":"TRANSCRIPTION_ERROR","environment":"cloud-run","error":"File is not defined","flow":{"stage":"0_unknown"},"level":"ERROR","timestamp":"2025-07-26T22:15:11.167Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"TRANSCRIPTION_ERROR","flow_stage":"0_unknown","level":"ERROR","user_id":"573003913251"} timestamp="2025-07-26T22:15:11.167Z"
‚ùå Error transcribiendo audio: ReferenceError: File is not defined
    at transcribeAudio (/app/dist/app-unified.js:275:27)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async processWebhook (/app/dist/app-unified.js:3018:59)
    at async /app/dist/app-unified.js:486:13
2025-07-26T22:15:13.115920889Z [INFO] [VOICE_TRANSCRIPTION_ERROR] Error transcribiendo audio jsonPayload={"category":"VOICE_TRANSCRIPTION_ERROR","environment":"cloud-run","error":"File is not defined","flow":{"stage":"0_unknown"},"level":"ERROR","timestamp":"2025-07-26T22:15:11.169Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"VOICE_TRANSCRIPTION_ERROR","flow_stage":"0_unknown","level":"ERROR","user_id":"573003913251"} timestamp="2025-07-26T22:15:11.169Z"
2025-07-26T22:15:13.115960155Z [INFO] [BUFFER_TIMER_RESPECTED] Timer existente respetado (delay actual es suficiente) jsonPayload={"bufferSize":1,"category":"BUFFER_TIMER_RESPECTED","currentDelay":10000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","requestedDelay":8000,"timestamp":"2025-07-26T22:15:11.169Z","triggerType":"voice","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_RESPECTED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:11.169Z"
2025-07-26T22:15:13.116009233Z [INFO] [GLOBAL_BUFFER_ADD] Mensaje agregado al buffer global jsonPayload={"bufferSize":1,"category":"GLOBAL_BUFFER_ADD","delay":5000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isMedia":true,"level":"INFO","messageText":"üé§ Error en transcripci√≥n...","timestamp":"2025-07-26T22:15:11.170Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_ADD","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:11.170Z"
‚è∞ üéôÔ∏è Sr Alex dej√≥ de grabar.
2025-07-26T22:15:15.599478929Z [INFO] [GLOBAL_BUFFER_PROCESS] Procesando buffer global despu√©s de 5 segundos jsonPayload={"category":"GLOBAL_BUFFER_PROCESS","combinedText":"üé§ Error en transcripci√≥n...","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","messageCount":1,"timestamp":"2025-07-26T22:15:15.594Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_PROCESS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:15.594Z"
2025-07-26T22:15:15.599509980Z [INFO] [QUEUE_ITEM_ADDED] Mensaje agregado a cola de usuario jsonPayload={"category":"QUEUE_ITEM_ADDED","environment":"cloud-run","flow":{"sequence":1,"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","messageId":"msg_1753568115595_t0usplsls","queueLength":1,"timestamp":"2025-07-26T22:15:15.595Z","totalQueues":1,"userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_ADDED","flow_stage":"0_unknown","level":"INFO","message_id":"msg_1753568115595_t0usplsls","user_id":"573003913251"} timestamp="2025-07-26T22:15:15.595Z"
2025-07-26T22:15:15.599535623Z [INFO] [QUEUE_PROCESSING_START] Procesando cola de usuario jsonPayload={"category":"QUEUE_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","queueLength":1,"timestamp":"2025-07-26T22:15:15.595Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_START","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:15.595Z"
2025-07-26T22:15:15.599561277Z [INFO] [QUEUE_ITEM_PROCESSING] Procesando mensaje de cola jsonPayload={"category":"QUEUE_ITEM_PROCESSING","environment":"cloud-run","flow":{"sequence":2,"stage":"0_unknown"},"level":"TRACE","messageId":"msg_1753568115595_t0usplsls","remainingInQueue":0,"timestamp":"2025-07-26T22:15:15.595Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_PROCESSING","flow_stage":"0_unknown","level":"TRACE","message_id":"msg_1753568115595_t0usplsls","user_id":"573003913251"} timestamp="2025-07-26T22:15:15.595Z"
2025-07-26T22:15:16.094427753Z [INFO] [RECORDING_INDICATOR_SENT] Recording indicator enviado para procesamiento de audio jsonPayload={"category":"RECORDING_INDICATOR_SENT","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:15:16.087Z"} labels={"app":"whatsapp-bot","category":"RECORDING_INDICATOR_SENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:16.087Z"
2025-07-26T22:15:16.376772059Z [INFO] [THREAD_PERSIST] Thread creado para 573003913251 jsonPayload={"category":"THREAD_PERSIST","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","operation":"created","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:15:16.370Z","userId":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:16.370Z"

üì® Nueva conversaci√≥n con Sr Alex
2025-07-26T22:15:16.376844038Z [INFO] [THREAD_CREATED] Thread creado jsonPayload={"category":"THREAD_CREATED","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:15:16.371Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_CREATED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:16.371Z"
2025-07-26T22:15:16.376876200Z [INFO] [OPENAI_PROCESSING_START] Procesando mensaje de Sr Alex jsonPayload={"category":"OPENAI_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","timestamp":"2025-07-26T22:15:16.371Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"OPENAI_PROCESSING_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:16.371Z"
2025-07-26T22:15:16.376908079Z [INFO] [PRESENCE_SUBSCRIBE_ATTEMPT] Intentando suscribirse a presencia de 573003913251 jsonPayload={"category":"PRESENCE_SUBSCRIBE_ATTEMPT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:15:16.371Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_SUBSCRIBE_ATTEMPT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:16.371Z"
2025-07-26T22:15:16.832803845Z [INFO] [PRESENCE_ALREADY_SUBSCRIBED_API] Usuario 573003913251 ya suscrito (409) jsonPayload={"category":"PRESENCE_ALREADY_SUBSCRIBED_API","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":409,"timestamp":"2025-07-26T22:15:16.826Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_ALREADY_SUBSCRIBED_API","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:16.826Z"
2025-07-26T22:15:17.128990141Z [INFO] [WHAPI_LABELS] Obteniendo info del chat para 573003913251 jsonPayload={"category":"WHAPI_LABELS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:15:17.126Z"} labels={"app":"whatsapp-bot","category":"WHAPI_LABELS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:17.126Z"
2025-07-26T22:15:17.513653112Z [INFO] [WHAPI_LABELS] Info del chat obtenida. Etiquetas: 2 jsonPayload={"category":"WHAPI_LABELS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","timestamp":"2025-07-26T22:15:17.509Z"} labels={"app":"whatsapp-bot","category":"WHAPI_LABELS","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T22:15:17.509Z"
2025-07-26T22:15:17.513683728Z [INFO] [GUEST_MEMORY] Sincronizado con Whapi: 2 etiquetas para 573003913251 jsonPayload={"category":"GUEST_MEMORY","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:15:17.509Z"} labels={"app":"whatsapp-bot","category":"GUEST_MEMORY","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:17.509Z"
2025-07-26T22:15:17.513723682Z [INFO] [SYNC_NEEDED] Sync needed for 573003913251 jsonPayload={"category":"SYNC_NEEDED","environment":"cloud-run","flow":{"stage":"0_unknown"},"force":false,"isNewThread":true,"isThreadOld":false,"level":"INFO","reason":"new_thread","requestId":null,"timestamp":"2025-07-26T22:15:17.510Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"SYNC_NEEDED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:17.510Z"
2025-07-26T22:15:17.513755090Z [INFO] [GUEST_MEMORY] Nuevo perfil creado para 573003913251 con 2 etiquetas jsonPayload={"category":"GUEST_MEMORY","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:15:17.510Z"} labels={"app":"whatsapp-bot","category":"GUEST_MEMORY","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:17.510Z"
2025-07-26T22:15:17.513786190Z [INFO] [WHAPI_LABELS] Obteniendo info del chat para 573003913251 jsonPayload={"category":"WHAPI_LABELS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:15:17.510Z"} labels={"app":"whatsapp-bot","category":"WHAPI_LABELS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:17.510Z"
2025-07-26T22:15:17.908599241Z [INFO] [WHAPI_LABELS] Info del chat obtenida. Etiquetas: 2 jsonPayload={"category":"WHAPI_LABELS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","timestamp":"2025-07-26T22:15:17.899Z"} labels={"app":"whatsapp-bot","category":"WHAPI_LABELS","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T22:15:17.899Z"
2025-07-26T22:15:17.908636189Z [INFO] [CONTEXT_FRESH_RESTART] Generando contexto fresco despu√©s del reinicio jsonPayload={"cacheAge":"none","category":"CONTEXT_FRESH_RESTART","environment":"cloud-run","flow":{"stage":"0_unknown"},"hadCachedContext":false,"level":"INFO","timestamp":"2025-07-26T22:15:17.900Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CONTEXT_FRESH_RESTART","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:17.900Z"
2025-07-26T22:15:17.908671822Z [INFO] [CACHE_HIT] Chat info desde cache jsonPayload={"cacheAge":0,"category":"CACHE_HIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:15:17.900Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CACHE_HIT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:17.900Z"
2025-07-26T22:15:17.940104052Z [INFO] [CONTEXT_INJECTION] Contexto temporal generado jsonPayload={"category":"CONTEXT_INJECTION","clientName":"Sr Alex","contactName":"Sr Alex","contextLength":150,"environment":"cloud-run","flow":{"stage":"0_unknown"},"hasChatInfo":true,"hasProfile":true,"isFirstMessageAfterRestart":true,"labelsCount":2,"level":"INFO","timestamp":"2025-07-26T22:15:17.936Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CONTEXT_INJECTION","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:17.936Z"
2025-07-26T22:15:17.940166183Z [INFO] [CONTEXT_DEBUG] Contexto enviado a OpenAI jsonPayload={"category":"CONTEXT_DEBUG","contextPreview":"Fecha: 26/07/2025 | Hora: 5:15 PM (Colombia)\nCliente: Sr Alex | Contacto WhatsApp: Sr Alex | Status: Colega Jefe, cotizaci√≥n\n---\nMensaje del cliente:\n","contextReason":"cambio_labels","contextTokensSaved":0,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isVoiceMessage":true,"level":"INFO","messagePreview":"üé§ Error en transcripci√≥n","needsTemporalContext":true,"shortUserId":"573003913251","timestamp":"2025-07-26T22:15:17.936Z","totalLength":175} labels={"app":"whatsapp-bot","category":"CONTEXT_DEBUG","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:17.936Z"
2025-07-26T22:15:18.262172929Z [INFO] [CACHE_HIT] Chat info desde cache jsonPayload={"cacheAge":1,"category":"CACHE_HIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:15:18.257Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CACHE_HIT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:18.257Z"
2025-07-26T22:15:18.262236648Z [INFO] [THREAD_PERSIST] Metadatos actualizados para 573003913251 jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"labels":["Colega Jefe","cotizaci√≥n"],"level":"SUCCESS","timestamp":"2025-07-26T22:15:18.258Z","updates":["labels"],"userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T22:15:18.258Z"
2025-07-26T22:15:18.262268787Z [INFO] [THREAD_METADATA_UPDATED] Metadatos del thread actualizados jsonPayload={"category":"THREAD_METADATA_UPDATED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","reason":"cambio_labels","shortUserId":"573003913251","timestamp":"2025-07-26T22:15:18.258Z","updates":["labels"]} labels={"app":"whatsapp-bot","category":"THREAD_METADATA_UPDATED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:18.258Z"
2025-07-26T22:15:20.515538538Z [INFO] [OPENAI_POLLING] Esperando... jsonPayload={"attempts":1,"category":"OPENAI_POLLING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_T0n5PHgesAmVmwTVSegnodJn","shortUserId":"573003913251","status":"in_progress","timestamp":"2025-07-26T22:15:20.513Z"} labels={"app":"whatsapp-bot","category":"OPENAI_POLLING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:20.513Z"
2025-07-26T22:15:22.007424552Z [INFO] [TOKEN_USAGE] Tokens utilizados jsonPayload={"category":"TOKEN_USAGE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:15:22.006Z","totalTokens":3462} labels={"app":"whatsapp-bot","category":"TOKEN_USAGE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:22.006Z"
2025-07-26T22:15:22.167451190Z [INFO] [OPENAI_RESPONSE_RAW] Respuesta exacta recibida de OpenAI jsonPayload={"category":"OPENAI_RESPONSE_RAW","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasDoubleAsterisks":false,"level":"INFO","responseLength":59,"responsePreview":"¬øPodr√≠as repetirlo o escribirlo? As√≠ te puedo ayudar mejor.","responseText":"¬øPodr√≠as repetirlo o escribirlo? As√≠ te puedo ayudar mejor.","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:15:22.165Z"} labels={"app":"whatsapp-bot","category":"OPENAI_RESPONSE_RAW","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:22.165Z"
2025-07-26T22:15:22.167489100Z [INFO] [PERFORMANCE_METRICS] Procesamiento completado exitosamente jsonPayload={"category":"PERFORMANCE_METRICS","contextTokens":0,"environment":"cloud-run","flow":{"stage":"9_complete"},"isEfficient":false,"level":"INFO","memory":{"heapTotalMB":29,"heapUsedMB":27,"rssMB":87},"responseLength":59,"shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:15:22.165Z","tokensPerSecond":570,"totalDurationMs":6078,"totalTokens":3462} labels={"app":"whatsapp-bot","category":"PERFORMANCE_METRICS","flow_stage":"9_complete","level":"INFO"} timestamp="2025-07-26T22:15:22.165Z"
ü§ñ OpenAI ‚Üí Sr Alex (0.0s)
üé§ Generando voz para 573003913251: "¬øPodr√≠as repetirlo o escribirlo? As√≠ te puedo ayud..."
2025-07-26T22:15:25.390004508Z [INFO] [VOICE_RESPONSE_SENT] Respuesta de voz enviada exitosamente jsonPayload={"category":"VOICE_RESPONSE_SENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","messageLength":59,"timestamp":"2025-07-26T22:15:25.387Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"VOICE_RESPONSE_SENT","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T22:15:25.387Z"
2025-07-26T22:15:25.390046229Z [INFO] [QUEUE_ITEM_SUCCESS] Mensaje procesado exitosamente jsonPayload={"category":"QUEUE_ITEM_SUCCESS","environment":"cloud-run","flow":{"sequence":3,"stage":"0_unknown"},"level":"SUCCESS","messageId":"msg_1753568115595_t0usplsls","processedCount":1,"remainingInQueue":0,"timestamp":"2025-07-26T22:15:25.387Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_SUCCESS","flow_stage":"0_unknown","level":"SUCCESS","message_id":"msg_1753568115595_t0usplsls","user_id":"573003913251"} timestamp="2025-07-26T22:15:25.387Z"
2025-07-26T22:15:25.390077169Z [INFO] [LOCK_ALREADY_RELEASED] Lock ya liberado para usuario jsonPayload={"activeLocks":0,"category":"LOCK_ALREADY_RELEASED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"TRACE","timestamp":"2025-07-26T22:15:25.388Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"LOCK_ALREADY_RELEASED","flow_stage":"0_unknown","level":"TRACE","user_id":"573003913251"} timestamp="2025-07-26T22:15:25.388Z"
2025-07-26T22:15:25.390744580Z [INFO] [QUEUE_PROCESSING_COMPLETE] Cola de usuario procesada completamente jsonPayload={"averageTimePerMessage":"9793ms","category":"QUEUE_PROCESSING_COMPLETE","environment":"cloud-run","errorCount":0,"flow":{"stage":"0_unknown"},"initialQueueLength":1,"level":"SUCCESS","processedCount":1,"processingDuration":"9793ms","remainingQueues":0,"timestamp":"2025-07-26T22:15:25.388Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T22:15:25.388Z"
2025-07-26T22:15:34.380661779Z [INFO] [BUFFER_TIMER_SET] Timer inteligente configurado jsonPayload={"bufferSize":0,"category":"BUFFER_TIMER_SET","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timerMs":10000,"timestamp":"2025-07-26T22:15:34.380Z","triggerType":"recording","userJid":"573003913251","userName":"573003913251","wasReconfigured":true} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_SET","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:34.380Z"
üéôÔ∏è 573003913251 est√° grabando...
2025-07-26T22:15:34.381280590Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T22:15:34.379Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:34.379Z"
2025-07-26T22:15:34.381915250Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: recording jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"recording","timestamp":"2025-07-26T22:15:34.379Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:34.379Z"
2025-07-26T22:15:37.338117480Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T22:15:37.331Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:37.331Z"
2025-07-26T22:15:37.338153435Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: online jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"online","timestamp":"2025-07-26T22:15:37.331Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:37.331Z"
üé§ Sr Alex: [Nota de voz recibida]
‚ùå Error al procesar audio ‚Üí Sr Alex: File is not defined
2025-07-26T22:15:39.015576689Z [INFO] [GLOBAL_BUFFER_ADD] Mensaje agregado al buffer global jsonPayload={"bufferSize":1,"category":"GLOBAL_BUFFER_ADD","delay":5000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isMedia":true,"level":"INFO","messageText":"üé§ Error en transcripci√≥n...","timestamp":"2025-07-26T22:15:39.013Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_ADD","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:39.013Z"
2025-07-26T22:15:39.015884071Z [INFO] [TRANSCRIPTION_ERROR] Error en transcripci√≥n de audio jsonPayload={"category":"TRANSCRIPTION_ERROR","environment":"cloud-run","error":"File is not defined","flow":{"stage":"0_unknown"},"level":"ERROR","timestamp":"2025-07-26T22:15:39.013Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"TRANSCRIPTION_ERROR","flow_stage":"0_unknown","level":"ERROR","user_id":"573003913251"} timestamp="2025-07-26T22:15:39.013Z"
‚ùå Error transcribiendo audio: ReferenceError: File is not defined
    at transcribeAudio (/app/dist/app-unified.js:275:27)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async processWebhook (/app/dist/app-unified.js:3018:59)
    at async /app/dist/app-unified.js:486:13
2025-07-26T22:15:39.016028426Z [INFO] [VOICE_TRANSCRIPTION_ERROR] Error transcribiendo audio jsonPayload={"category":"VOICE_TRANSCRIPTION_ERROR","environment":"cloud-run","error":"File is not defined","flow":{"stage":"0_unknown"},"level":"ERROR","timestamp":"2025-07-26T22:15:39.013Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"VOICE_TRANSCRIPTION_ERROR","flow_stage":"0_unknown","level":"ERROR","user_id":"573003913251"} timestamp="2025-07-26T22:15:39.013Z"
2025-07-26T22:15:39.016066198Z [INFO] [BUFFER_TIMER_RESPECTED] Timer existente respetado (delay actual es suficiente) jsonPayload={"bufferSize":1,"category":"BUFFER_TIMER_RESPECTED","currentDelay":10000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","requestedDelay":8000,"timestamp":"2025-07-26T22:15:39.013Z","triggerType":"voice","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_RESPECTED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:39.013Z"
‚è∞ üéôÔ∏è Sr Alex dej√≥ de grabar.
2025-07-26T22:15:44.386006695Z [INFO] [GLOBAL_BUFFER_PROCESS] Procesando buffer global despu√©s de 5 segundos jsonPayload={"category":"GLOBAL_BUFFER_PROCESS","combinedText":"üé§ Error en transcripci√≥n...","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","messageCount":1,"timestamp":"2025-07-26T22:15:44.380Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_PROCESS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:44.380Z"
2025-07-26T22:15:45.136417668Z [INFO] [QUEUE_ITEM_ADDED] Mensaje agregado a cola de usuario jsonPayload={"category":"QUEUE_ITEM_ADDED","environment":"cloud-run","flow":{"sequence":1,"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","messageId":"msg_1753568145132_vgm544he5","queueLength":1,"timestamp":"2025-07-26T22:15:45.132Z","totalQueues":1,"userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_ADDED","flow_stage":"0_unknown","level":"INFO","message_id":"msg_1753568145132_vgm544he5","user_id":"573003913251"} timestamp="2025-07-26T22:15:45.132Z"
2025-07-26T22:15:45.136463320Z [INFO] [QUEUE_PROCESSING_START] Procesando cola de usuario jsonPayload={"category":"QUEUE_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","queueLength":1,"timestamp":"2025-07-26T22:15:45.132Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_START","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:45.132Z"
2025-07-26T22:15:45.136503546Z [INFO] [QUEUE_ITEM_PROCESSING] Procesando mensaje de cola jsonPayload={"category":"QUEUE_ITEM_PROCESSING","environment":"cloud-run","flow":{"sequence":2,"stage":"0_unknown"},"level":"TRACE","messageId":"msg_1753568145132_vgm544he5","remainingInQueue":0,"timestamp":"2025-07-26T22:15:45.132Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_PROCESSING","flow_stage":"0_unknown","level":"TRACE","message_id":"msg_1753568145132_vgm544he5","user_id":"573003913251"} timestamp="2025-07-26T22:15:45.132Z"
2025-07-26T22:15:45.819603223Z [INFO] [RECORDING_INDICATOR_SENT] Recording indicator enviado para procesamiento de audio jsonPayload={"category":"RECORDING_INDICATOR_SENT","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:15:45.816Z"} labels={"app":"whatsapp-bot","category":"RECORDING_INDICATOR_SENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:45.816Z"
2025-07-26T22:15:45.819642579Z [INFO] [THREAD_REUSE] Thread reutilizado para 573003913251 jsonPayload={"category":"THREAD_REUSE","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:15:45.816Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_REUSE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:45.816Z"
2025-07-26T22:15:45.819670689Z [INFO] [HISTORY_SKIP] Skip fetch historial: Thread existe jsonPayload={"category":"HISTORY_SKIP","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","reason":"thread_already_exists","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:15:45.816Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"HISTORY_SKIP","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:45.816Z"
2025-07-26T22:15:45.819707934Z [INFO] [OPENAI_PROCESSING_START] Procesando mensaje de Sr Alex jsonPayload={"category":"OPENAI_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","timestamp":"2025-07-26T22:15:45.816Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"OPENAI_PROCESSING_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:45.816Z"
2025-07-26T22:15:46.162967030Z [INFO] [CACHE_HIT] Chat info desde cache jsonPayload={"cacheAge":29,"category":"CACHE_HIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:15:46.161Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CACHE_HIT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:15:46.161Z"
2025-07-26T22:15:46.163005336Z [INFO] [CONTEXT_DEBUG] Contexto enviado a OpenAI jsonPayload={"category":"CONTEXT_DEBUG","contextPreview":"NO_CONTEXT","contextReason":"no_cambios","contextTokensSaved":-151,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isVoiceMessage":true,"level":"INFO","messagePreview":"üé§ Error en transcripci√≥n","needsTemporalContext":false,"shortUserId":"573003913251","timestamp":"2025-07-26T22:15:46.161Z","totalLength":25} labels={"app":"whatsapp-bot","category":"CONTEXT_DEBUG","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:46.161Z"
2025-07-26T22:15:48.820667476Z [INFO] [OPENAI_POLLING] Esperando... jsonPayload={"attempts":1,"category":"OPENAI_POLLING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_FyzL2qrXrM5hwsKPzu8GsuHr","shortUserId":"573003913251","status":"queued","timestamp":"2025-07-26T22:15:48.819Z"} labels={"app":"whatsapp-bot","category":"OPENAI_POLLING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:48.819Z"
2025-07-26T22:15:51.390396512Z [INFO] [TOKEN_USAGE] Tokens utilizados jsonPayload={"category":"TOKEN_USAGE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:15:51.386Z","totalTokens":3506} labels={"app":"whatsapp-bot","category":"TOKEN_USAGE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:51.386Z"
2025-07-26T22:15:51.521178612Z [INFO] [OPENAI_RESPONSE_RAW] Respuesta exacta recibida de OpenAI jsonPayload={"category":"OPENAI_RESPONSE_RAW","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasDoubleAsterisks":false,"level":"INFO","responseLength":135,"responsePreview":"Parece que hay un problema con la transcripci√≥n de tu mensaje. ¬øPodr√≠as intentar escribirme lo que necesitas? Estoy aqu√≠ para ayudarte.","responseText":"Parece que hay un problema con la transcripci√≥n de tu mensaje. ¬øPodr√≠as intentar escribirme lo que necesitas? Estoy aqu√≠ para ayudarte.","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:15:51.518Z"} labels={"app":"whatsapp-bot","category":"OPENAI_RESPONSE_RAW","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:15:51.518Z"
2025-07-26T22:15:51.521225664Z [INFO] [PERFORMANCE_METRICS] Procesamiento completado exitosamente jsonPayload={"category":"PERFORMANCE_METRICS","contextTokens":0,"environment":"cloud-run","flow":{"stage":"9_complete"},"isEfficient":false,"level":"INFO","memory":{"heapTotalMB":30,"heapUsedMB":28,"rssMB":88},"responseLength":135,"shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:15:51.518Z","tokensPerSecond":615,"totalDurationMs":5702,"totalTokens":3506} labels={"app":"whatsapp-bot","category":"PERFORMANCE_METRICS","flow_stage":"9_complete","level":"INFO"} timestamp="2025-07-26T22:15:51.518Z"
ü§ñ OpenAI ‚Üí Sr Alex (0.0s)
üé§ Generando voz para 573003913251: "Parece que hay un problema con la transcripci√≥n de..."
2025-07-26T22:15:56.789244105Z [INFO] [VOICE_RESPONSE_SENT] Respuesta de voz enviada exitosamente jsonPayload={"category":"VOICE_RESPONSE_SENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","messageLength":135,"timestamp":"2025-07-26T22:15:56.788Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"VOICE_RESPONSE_SENT","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T22:15:56.788Z"
2025-07-26T22:15:56.789279889Z [INFO] [QUEUE_ITEM_SUCCESS] Mensaje procesado exitosamente jsonPayload={"category":"QUEUE_ITEM_SUCCESS","environment":"cloud-run","flow":{"sequence":3,"stage":"0_unknown"},"level":"SUCCESS","messageId":"msg_1753568145132_vgm544he5","processedCount":1,"remainingInQueue":0,"timestamp":"2025-07-26T22:15:56.788Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_SUCCESS","flow_stage":"0_unknown","level":"SUCCESS","message_id":"msg_1753568145132_vgm544he5","user_id":"573003913251"} timestamp="2025-07-26T22:15:56.788Z"
2025-07-26T22:15:56.789305470Z [INFO] [LOCK_ALREADY_RELEASED] Lock ya liberado para usuario jsonPayload={"activeLocks":0,"category":"LOCK_ALREADY_RELEASED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"TRACE","timestamp":"2025-07-26T22:15:56.788Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"LOCK_ALREADY_RELEASED","flow_stage":"0_unknown","level":"TRACE","user_id":"573003913251"} timestamp="2025-07-26T22:15:56.788Z"
2025-07-26T22:15:56.789350648Z [INFO] [QUEUE_PROCESSING_COMPLETE] Cola de usuario procesada completamente jsonPayload={"averageTimePerMessage":"11656ms","category":"QUEUE_PROCESSING_COMPLETE","environment":"cloud-run","errorCount":0,"flow":{"stage":"0_unknown"},"initialQueueLength":1,"level":"SUCCESS","processedCount":1,"processingDuration":"11656ms","remainingQueues":0,"timestamp":"2025-07-26T22:15:56.788Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T22:15:56.788Z"
2025-07-26T22:16:16.787525199Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T22:16:08.406Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:08.406Z"
2025-07-26T22:16:16.787558355Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: typing jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"typing","timestamp":"2025-07-26T22:16:08.406Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:16:08.406Z"
2025-07-26T22:16:16.787582635Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T22:16:12.529Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:12.529Z"
2025-07-26T22:16:16.787595542Z [INFO] [BUFFER_TIMER_SET] Timer inteligente configurado jsonPayload={"bufferSize":0,"category":"BUFFER_TIMER_SET","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timerMs":10000,"timestamp":"2025-07-26T22:16:08.406Z","triggerType":"typing","userJid":"573003913251","userName":"573003913251","wasReconfigured":true} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_SET","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:08.406Z"
2025-07-26T22:16:16.787615072Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: online jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"online","timestamp":"2025-07-26T22:16:12.529Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:16:12.529Z"
‚úçÔ∏è 573003913251 est√° escribiendo...
‚è∞ ‚úçÔ∏è Sr Alex dej√≥ de escribir.
üë§ Sr Alex: "Que como va todo"
2025-07-26T22:16:16.787657495Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T22:16:12.725Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:12.725Z"
2025-07-26T22:16:16.787677266Z [INFO] [BUFFER_TIMER_RESPECTED] Timer existente respetado (delay actual es suficiente) jsonPayload={"bufferSize":1,"category":"BUFFER_TIMER_RESPECTED","currentDelay":10000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","requestedDelay":5000,"timestamp":"2025-07-26T22:16:12.016Z","triggerType":"message","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_RESPECTED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:12.016Z"
2025-07-26T22:16:16.787682012Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: typing jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"typing","timestamp":"2025-07-26T22:16:12.725Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:16:12.725Z"
2025-07-26T22:16:16.787713606Z [INFO] [BUFFER_TIMER_RESPECTED] Timer existente respetado (delay actual es suficiente) jsonPayload={"bufferSize":1,"category":"BUFFER_TIMER_RESPECTED","currentDelay":10000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","requestedDelay":10000,"timestamp":"2025-07-26T22:16:12.725Z","triggerType":"typing","userJid":"573003913251","userName":"573003913251"} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_RESPECTED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:12.725Z"
üë§ Sr Alex: "Por all√°"
2025-07-26T22:16:16.787736754Z [INFO] [GLOBAL_BUFFER_ADD] Mensaje agregado al buffer global jsonPayload={"bufferSize":1,"category":"GLOBAL_BUFFER_ADD","delay":5000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isMedia":false,"level":"INFO","messageText":"üìù Que como va todo...","timestamp":"2025-07-26T22:16:12.016Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_ADD","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:12.016Z"
2025-07-26T22:16:16.787756999Z [INFO] [BUFFER_TIMER_RESPECTED] Timer existente respetado (delay actual es suficiente) jsonPayload={"bufferSize":2,"category":"BUFFER_TIMER_RESPECTED","currentDelay":10000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","requestedDelay":5000,"timestamp":"2025-07-26T22:16:14.575Z","triggerType":"message","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_RESPECTED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:14.575Z"
2025-07-26T22:16:16.787766892Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T22:16:12.050Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:12.050Z"
2025-07-26T22:16:16.787783497Z [INFO] [GLOBAL_BUFFER_ADD] Mensaje agregado al buffer global jsonPayload={"bufferSize":2,"category":"GLOBAL_BUFFER_ADD","delay":5000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isMedia":false,"level":"INFO","messageText":"üìù Por all√°...","timestamp":"2025-07-26T22:16:14.575Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_ADD","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:14.575Z"
2025-07-26T22:16:16.787798536Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: typing jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"typing","timestamp":"2025-07-26T22:16:12.050Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:16:12.050Z"
2025-07-26T22:16:16.787834494Z [INFO] [BUFFER_TIMER_RESPECTED] Timer existente respetado (delay actual es suficiente) jsonPayload={"bufferSize":1,"category":"BUFFER_TIMER_RESPECTED","currentDelay":10000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","requestedDelay":10000,"timestamp":"2025-07-26T22:16:12.050Z","triggerType":"typing","userJid":"573003913251","userName":"573003913251"} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_RESPECTED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:12.050Z"
‚è∞ ‚úçÔ∏è Sr Alex dej√≥ de escribir.
2025-07-26T22:16:18.418779082Z [INFO] [GLOBAL_BUFFER_PROCESS] Procesando buffer global despu√©s de 5 segundos jsonPayload={"category":"GLOBAL_BUFFER_PROCESS","combinedText":"üìù Que como va todo\nüìù Por all√°...","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","messageCount":2,"timestamp":"2025-07-26T22:16:18.407Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_PROCESS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:18.407Z"
2025-07-26T22:16:19.228905146Z [INFO] [QUEUE_ITEM_ADDED] Mensaje agregado a cola de usuario jsonPayload={"category":"QUEUE_ITEM_ADDED","environment":"cloud-run","flow":{"sequence":1,"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","messageId":"msg_1753568179221_7uu49cze8","queueLength":1,"timestamp":"2025-07-26T22:16:19.221Z","totalQueues":1,"userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_ADDED","flow_stage":"0_unknown","level":"INFO","message_id":"msg_1753568179221_7uu49cze8","user_id":"573003913251"} timestamp="2025-07-26T22:16:19.221Z"
2025-07-26T22:16:19.228936004Z [INFO] [QUEUE_PROCESSING_START] Procesando cola de usuario jsonPayload={"category":"QUEUE_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","queueLength":1,"timestamp":"2025-07-26T22:16:19.221Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_START","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:16:19.221Z"
2025-07-26T22:16:19.228965484Z [INFO] [QUEUE_ITEM_PROCESSING] Procesando mensaje de cola jsonPayload={"category":"QUEUE_ITEM_PROCESSING","environment":"cloud-run","flow":{"sequence":2,"stage":"0_unknown"},"level":"TRACE","messageId":"msg_1753568179221_7uu49cze8","remainingInQueue":0,"timestamp":"2025-07-26T22:16:19.221Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_PROCESSING","flow_stage":"0_unknown","level":"TRACE","message_id":"msg_1753568179221_7uu49cze8","user_id":"573003913251"} timestamp="2025-07-26T22:16:19.221Z"
2025-07-26T22:16:20.088998854Z [INFO] [TYPING_INDICATOR_SENT] Typing indicator enviado inmediatamente jsonPayload={"category":"TYPING_INDICATOR_SENT","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:16:20.087Z"} labels={"app":"whatsapp-bot","category":"TYPING_INDICATOR_SENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:20.087Z"
2025-07-26T22:16:20.089056682Z [INFO] [THREAD_REUSE] Thread reutilizado para 573003913251 jsonPayload={"category":"THREAD_REUSE","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:16:20.088Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_REUSE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:20.088Z"
2025-07-26T22:16:20.089090741Z [INFO] [HISTORY_SKIP] Skip fetch historial: Thread existe jsonPayload={"category":"HISTORY_SKIP","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","reason":"thread_already_exists","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:16:20.088Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"HISTORY_SKIP","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:16:20.088Z"
2025-07-26T22:16:20.089120689Z [INFO] [OPENAI_PROCESSING_START] Procesando mensaje de Sr Alex jsonPayload={"category":"OPENAI_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","timestamp":"2025-07-26T22:16:20.088Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"OPENAI_PROCESSING_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:20.088Z"
2025-07-26T22:16:20.523586186Z [INFO] [CACHE_HIT] Chat info desde cache jsonPayload={"cacheAge":63,"category":"CACHE_HIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:16:20.520Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CACHE_HIT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:16:20.520Z"
2025-07-26T22:16:20.523627818Z [INFO] [CONTEXT_DEBUG] Contexto enviado a OpenAI jsonPayload={"category":"CONTEXT_DEBUG","contextPreview":"NO_CONTEXT","contextReason":"no_cambios","contextTokensSaved":-151,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isVoiceMessage":false,"level":"INFO","messagePreview":"üìù Que como va todo\nüìù Por all√°","needsTemporalContext":false,"shortUserId":"573003913251","timestamp":"2025-07-26T22:16:20.520Z","totalLength":31} labels={"app":"whatsapp-bot","category":"CONTEXT_DEBUG","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:20.520Z"
2025-07-26T22:16:23.656555988Z [INFO] [OPENAI_POLLING] Esperando... jsonPayload={"attempts":1,"category":"OPENAI_POLLING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_t1YL8kEWiVRKsN4zddnMYWsp","shortUserId":"573003913251","status":"in_progress","timestamp":"2025-07-26T22:16:23.655Z"} labels={"app":"whatsapp-bot","category":"OPENAI_POLLING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:23.655Z"
2025-07-26T22:16:24.966719000Z [INFO] [TOKEN_USAGE] Tokens utilizados jsonPayload={"category":"TOKEN_USAGE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:16:24.964Z","totalTokens":3550} labels={"app":"whatsapp-bot","category":"TOKEN_USAGE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:24.964Z"
2025-07-26T22:16:25.125691204Z [INFO] [OPENAI_RESPONSE_RAW] Respuesta exacta recibida de OpenAI jsonPayload={"category":"OPENAI_RESPONSE_RAW","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasDoubleAsterisks":false,"level":"INFO","responseLength":89,"responsePreview":"Hola, todo va muy bien por aqu√≠ üòä ¬øY t√∫ qu√© tal? ¬øHay algo en lo que pueda ayudarte hoy?","responseText":"Hola, todo va muy bien por aqu√≠ üòä ¬øY t√∫ qu√© tal? ¬øHay algo en lo que pueda ayudarte hoy?","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:16:25.121Z"} labels={"app":"whatsapp-bot","category":"OPENAI_RESPONSE_RAW","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:16:25.121Z"
2025-07-26T22:16:25.125839432Z [INFO] [PERFORMANCE_METRICS] Procesamiento completado exitosamente jsonPayload={"category":"PERFORMANCE_METRICS","contextTokens":0,"environment":"cloud-run","flow":{"stage":"9_complete"},"isEfficient":false,"level":"INFO","memory":{"heapTotalMB":31,"heapUsedMB":29,"rssMB":88},"responseLength":89,"shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:16:25.122Z","tokensPerSecond":705,"totalDurationMs":5034,"totalTokens":3550} labels={"app":"whatsapp-bot","category":"PERFORMANCE_METRICS","flow_stage":"9_complete","level":"INFO"} timestamp="2025-07-26T22:16:25.122Z"
ü§ñ OpenAI ‚Üí Sr Alex (0.0s)
2025-07-26T22:16:25.125902679Z [INFO] [WHATSAPP_SEND] Enviando mensaje a 573003913251 jsonPayload={"category":"WHATSAPP_SEND","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"8_send"},"level":"INFO","messageLength":89,"preview":"Hola, todo va muy bien por aqu√≠ üòä ¬øY t√∫ qu√© tal? ¬øHay algo en lo que pueda ayudarte hoy?...","timestamp":"2025-07-26T22:16:25.122Z"} labels={"app":"whatsapp-bot","category":"WHATSAPP_SEND","flow_stage":"8_send","level":"INFO"} timestamp="2025-07-26T22:16:25.122Z"
2025-07-26T22:16:28.701816417Z [INFO] [QUEUE_ITEM_SUCCESS] Mensaje procesado exitosamente jsonPayload={"category":"QUEUE_ITEM_SUCCESS","environment":"cloud-run","flow":{"sequence":3,"stage":"0_unknown"},"level":"SUCCESS","messageId":"msg_1753568179221_7uu49cze8","processedCount":1,"remainingInQueue":0,"timestamp":"2025-07-26T22:16:28.701Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_SUCCESS","flow_stage":"0_unknown","level":"SUCCESS","message_id":"msg_1753568179221_7uu49cze8","user_id":"573003913251"} timestamp="2025-07-26T22:16:28.701Z"
2025-07-26T22:16:28.701841307Z [INFO] [LOCK_ALREADY_RELEASED] Lock ya liberado para usuario jsonPayload={"activeLocks":0,"category":"LOCK_ALREADY_RELEASED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"TRACE","timestamp":"2025-07-26T22:16:28.701Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"LOCK_ALREADY_RELEASED","flow_stage":"0_unknown","level":"TRACE","user_id":"573003913251"} timestamp="2025-07-26T22:16:28.701Z"
2025-07-26T22:16:28.701887812Z [INFO] [QUEUE_PROCESSING_COMPLETE] Cola de usuario procesada completamente jsonPayload={"averageTimePerMessage":"9480ms","category":"QUEUE_PROCESSING_COMPLETE","environment":"cloud-run","errorCount":0,"flow":{"stage":"0_unknown"},"initialQueueLength":1,"level":"SUCCESS","processedCount":1,"processingDuration":"9480ms","remainingQueues":0,"timestamp":"2025-07-26T22:16:28.701Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T22:16:28.701Z"
2025-07-26T22:19:28.842665118Z [INFO] [THREAD_PERSIST] 1 threads guardados jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","file":"tmp/threads.json","flow":{"stage":"0_unknown"},"level":"INFO","source":"save_operation","threadsCount":1,"timestamp":"2025-07-26T22:19:28.044Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:19:28.044Z"
2025-07-26T22:19:28.842709137Z [INFO] [THREAD_PERSIST] Auto-guardado ejecutado (hab√≠a cambios pendientes) jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:19:28.045Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:19:28.045Z"
2025-07-26T22:19:28.842771321Z [INFO] [MEMORY_USAGE] M√©tricas de memoria del sistema jsonPayload={"caches":{"centralizedCache":"Caches centralizados en historyInjection.ts","globalBuffers":0},"category":"MEMORY_USAGE","cpu":{"system":"493ms","user":"1706ms"},"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","logReason":"memory_leak","memory":{"external":"4MB","heapTotal":"31MB","heapUsagePercent":"95%","heapUsed":"29MB","rss":"89MB"},"threads":{"active":1,"total":1},"timestamp":"2025-07-26T22:19:28.105Z","uptime":"301s"} labels={"app":"whatsapp-bot","category":"MEMORY_USAGE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:19:28.105Z"
2025-07-26T22:19:28.842815294Z [INFO] [MEMORY_LEAK_DETECTED] Posible memory leak cr√≠tico detectado jsonPayload={"category":"MEMORY_LEAK_DETECTED","environment":"cloud-run","flow":{"stage":"0_unknown"},"heapUsagePercent":"95%","heapUsedMB":29,"level":"FATAL","recommendation":"Uso de memoria cr√≠tico - considerar optimizaci√≥n o restart inmediato","threshold":95,"timestamp":"2025-07-26T22:19:28.105Z"} labels={"app":"whatsapp-bot","category":"MEMORY_LEAK_DETECTED","flow_stage":"0_unknown","level":"FATAL"} timestamp="2025-07-26T22:19:28.105Z"
2025-07-26T22:24:29.010062044Z [INFO] [MEMORY_USAGE] M√©tricas de memoria del sistema jsonPayload={"caches":{"centralizedCache":"Caches centralizados en historyInjection.ts","globalBuffers":0},"category":"MEMORY_USAGE","cpu":{"system":"494ms","user":"1710ms"},"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","logReason":"memory_leak","memory":{"external":"4MB","heapTotal":"31MB","heapUsagePercent":"95%","heapUsed":"29MB","rss":"89MB"},"threads":{"active":1,"total":1},"timestamp":"2025-07-26T22:24:28.104Z","uptime":"601s"} labels={"app":"whatsapp-bot","category":"MEMORY_USAGE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:28.104Z"
2025-07-26T22:24:29.010111471Z [INFO] [MEMORY_LEAK_DETECTED] Posible memory leak cr√≠tico detectado jsonPayload={"category":"MEMORY_LEAK_DETECTED","environment":"cloud-run","flow":{"stage":"0_unknown"},"heapUsagePercent":"95%","heapUsedMB":29,"level":"FATAL","recommendation":"Uso de memoria cr√≠tico - considerar optimizaci√≥n o restart inmediato","threshold":95,"timestamp":"2025-07-26T22:24:28.105Z"} labels={"app":"whatsapp-bot","category":"MEMORY_LEAK_DETECTED","flow_stage":"0_unknown","level":"FATAL"} timestamp="2025-07-26T22:24:28.105Z"
2025-07-26T22:24:33.457661313Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T22:24:33.446Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:33.446Z"
2025-07-26T22:24:33.457696296Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: recording jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"recording","timestamp":"2025-07-26T22:24:33.446Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:24:33.446Z"
2025-07-26T22:24:33.457727309Z [INFO] [BUFFER_TIMER_SET] Timer inteligente configurado jsonPayload={"bufferSize":0,"category":"BUFFER_TIMER_SET","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timerMs":10000,"timestamp":"2025-07-26T22:24:33.446Z","triggerType":"recording","userJid":"573003913251","userName":"573003913251","wasReconfigured":true} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_SET","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:33.446Z"
üéôÔ∏è 573003913251 est√° grabando...
2025-07-26T22:24:35.812068341Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T22:24:35.807Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:35.807Z"
2025-07-26T22:24:35.812099751Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: online jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"online","timestamp":"2025-07-26T22:24:35.807Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:24:35.807Z"
üé§ Sr Alex: [Nota de voz recibida]
‚ùå Error al procesar audio ‚Üí Sr Alex: File is not defined
2025-07-26T22:24:38.817998232Z [INFO] [TRANSCRIPTION_ERROR] Error en transcripci√≥n de audio jsonPayload={"category":"TRANSCRIPTION_ERROR","environment":"cloud-run","error":"File is not defined","flow":{"stage":"0_unknown"},"level":"ERROR","timestamp":"2025-07-26T22:24:38.814Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"TRANSCRIPTION_ERROR","flow_stage":"0_unknown","level":"ERROR","user_id":"573003913251"} timestamp="2025-07-26T22:24:38.814Z"
‚ùå Error transcribiendo audio: ReferenceError: File is not defined
    at transcribeAudio (/app/dist/app-unified.js:275:27)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async processWebhook (/app/dist/app-unified.js:3018:59)
    at async /app/dist/app-unified.js:486:13
2025-07-26T22:24:38.818151625Z [INFO] [VOICE_TRANSCRIPTION_ERROR] Error transcribiendo audio jsonPayload={"category":"VOICE_TRANSCRIPTION_ERROR","environment":"cloud-run","error":"File is not defined","flow":{"stage":"0_unknown"},"level":"ERROR","timestamp":"2025-07-26T22:24:38.815Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"VOICE_TRANSCRIPTION_ERROR","flow_stage":"0_unknown","level":"ERROR","user_id":"573003913251"} timestamp="2025-07-26T22:24:38.815Z"
2025-07-26T22:24:38.818190518Z [INFO] [BUFFER_TIMER_RESPECTED] Timer existente respetado (delay actual es suficiente) jsonPayload={"bufferSize":1,"category":"BUFFER_TIMER_RESPECTED","currentDelay":10000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","requestedDelay":8000,"timestamp":"2025-07-26T22:24:38.815Z","triggerType":"voice","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_RESPECTED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:38.815Z"
2025-07-26T22:24:38.818239627Z [INFO] [GLOBAL_BUFFER_ADD] Mensaje agregado al buffer global jsonPayload={"bufferSize":1,"category":"GLOBAL_BUFFER_ADD","delay":5000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isMedia":true,"level":"INFO","messageText":"üé§ Error en transcripci√≥n...","timestamp":"2025-07-26T22:24:38.815Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_ADD","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:38.815Z"
‚è∞ üéôÔ∏è Sr Alex dej√≥ de grabar.
2025-07-26T22:24:43.456609613Z [INFO] [GLOBAL_BUFFER_PROCESS] Procesando buffer global despu√©s de 5 segundos jsonPayload={"category":"GLOBAL_BUFFER_PROCESS","combinedText":"üé§ Error en transcripci√≥n...","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","messageCount":1,"timestamp":"2025-07-26T22:24:43.448Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_PROCESS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:43.448Z"
2025-07-26T22:24:44.157798423Z [INFO] [QUEUE_ITEM_ADDED] Mensaje agregado a cola de usuario jsonPayload={"category":"QUEUE_ITEM_ADDED","environment":"cloud-run","flow":{"sequence":1,"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","messageId":"msg_1753568684153_09b970wc3","queueLength":1,"timestamp":"2025-07-26T22:24:44.153Z","totalQueues":1,"userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_ADDED","flow_stage":"0_unknown","level":"INFO","message_id":"msg_1753568684153_09b970wc3","user_id":"573003913251"} timestamp="2025-07-26T22:24:44.153Z"
2025-07-26T22:24:44.157854054Z [INFO] [QUEUE_PROCESSING_START] Procesando cola de usuario jsonPayload={"category":"QUEUE_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","queueLength":1,"timestamp":"2025-07-26T22:24:44.154Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_START","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:24:44.154Z"
2025-07-26T22:24:44.157901235Z [INFO] [QUEUE_ITEM_PROCESSING] Procesando mensaje de cola jsonPayload={"category":"QUEUE_ITEM_PROCESSING","environment":"cloud-run","flow":{"sequence":2,"stage":"0_unknown"},"level":"TRACE","messageId":"msg_1753568684153_09b970wc3","remainingInQueue":0,"timestamp":"2025-07-26T22:24:44.154Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_PROCESSING","flow_stage":"0_unknown","level":"TRACE","message_id":"msg_1753568684153_09b970wc3","user_id":"573003913251"} timestamp="2025-07-26T22:24:44.154Z"
2025-07-26T22:24:45.277313832Z [INFO] [RECORDING_INDICATOR_SENT] Recording indicator enviado para procesamiento de audio jsonPayload={"category":"RECORDING_INDICATOR_SENT","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:24:45.275Z"} labels={"app":"whatsapp-bot","category":"RECORDING_INDICATOR_SENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:45.275Z"
2025-07-26T22:24:45.277363693Z [INFO] [THREAD_REUSE] Thread reutilizado para 573003913251 jsonPayload={"category":"THREAD_REUSE","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:24:45.275Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_REUSE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:45.275Z"
2025-07-26T22:24:45.277398295Z [INFO] [HISTORY_SKIP] Skip fetch historial: Thread existe jsonPayload={"category":"HISTORY_SKIP","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","reason":"thread_already_exists","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:24:45.275Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"HISTORY_SKIP","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T22:24:45.275Z"
2025-07-26T22:24:45.277431405Z [INFO] [OPENAI_PROCESSING_START] Procesando mensaje de Sr Alex jsonPayload={"category":"OPENAI_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","timestamp":"2025-07-26T22:24:45.275Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"OPENAI_PROCESSING_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:45.275Z"
2025-07-26T22:24:45.718351786Z [INFO] [WHAPI_LABELS] Obteniendo info del chat para 573003913251 jsonPayload={"category":"WHAPI_LABELS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:24:45.713Z"} labels={"app":"whatsapp-bot","category":"WHAPI_LABELS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:45.713Z"
2025-07-26T22:24:46.043520913Z [INFO] [WHAPI_LABELS] Info del chat obtenida. Etiquetas: 2 jsonPayload={"category":"WHAPI_LABELS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","timestamp":"2025-07-26T22:24:46.027Z"} labels={"app":"whatsapp-bot","category":"WHAPI_LABELS","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T22:24:46.027Z"
2025-07-26T22:24:46.043586587Z [INFO] [CONTEXT_DEBUG] Contexto enviado a OpenAI jsonPayload={"category":"CONTEXT_DEBUG","contextPreview":"NO_CONTEXT","contextReason":"no_cambios","contextTokensSaved":-151,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isVoiceMessage":true,"level":"INFO","messagePreview":"üé§ Error en transcripci√≥n","needsTemporalContext":false,"shortUserId":"573003913251","timestamp":"2025-07-26T22:24:46.027Z","totalLength":25} labels={"app":"whatsapp-bot","category":"CONTEXT_DEBUG","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:46.027Z"
2025-07-26T22:24:48.673891378Z [INFO] [OPENAI_POLLING] Esperando... jsonPayload={"attempts":1,"category":"OPENAI_POLLING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_szEkXaLlIsCAcaY9FjyRUlG6","shortUserId":"573003913251","status":"in_progress","timestamp":"2025-07-26T22:24:48.672Z"} labels={"app":"whatsapp-bot","category":"OPENAI_POLLING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:48.672Z"
2025-07-26T22:24:49.999402678Z [INFO] [TOKEN_USAGE] Tokens utilizados jsonPayload={"category":"TOKEN_USAGE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:24:49.998Z","totalTokens":3586} labels={"app":"whatsapp-bot","category":"TOKEN_USAGE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:49.998Z"
2025-07-26T22:24:50.140967801Z [INFO] [OPENAI_RESPONSE_RAW] Respuesta exacta recibida de OpenAI jsonPayload={"category":"OPENAI_RESPONSE_RAW","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasDoubleAsterisks":false,"level":"INFO","responseLength":91,"responsePreview":"No te preocupes, si prefieres puedes escribirme el mensaje. As√≠ podr√© asistirte m√°s r√°pido.","responseText":"No te preocupes, si prefieres puedes escribirme el mensaje. As√≠ podr√© asistirte m√°s r√°pido.","shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:24:50.132Z"} labels={"app":"whatsapp-bot","category":"OPENAI_RESPONSE_RAW","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:24:50.132Z"
2025-07-26T22:24:50.141018725Z [INFO] [PERFORMANCE_METRICS] Procesamiento completado exitosamente jsonPayload={"category":"PERFORMANCE_METRICS","contextTokens":0,"environment":"cloud-run","flow":{"stage":"9_complete"},"isEfficient":false,"level":"INFO","memory":{"heapTotalMB":32,"heapUsedMB":30,"rssMB":89},"responseLength":91,"shortUserId":"573003913251","threadId":"thread_pF7JINOlmLSEdMrw5YtWvDRX","timestamp":"2025-07-26T22:24:50.132Z","tokensPerSecond":738,"totalDurationMs":4857,"totalTokens":3586} labels={"app":"whatsapp-bot","category":"PERFORMANCE_METRICS","flow_stage":"9_complete","level":"INFO"} timestamp="2025-07-26T22:24:50.132Z"
ü§ñ OpenAI ‚Üí Sr Alex (0.0s)
üé§ Generando voz para 573003913251: "No te preocupes, si prefieres puedes escribirme el..."
2025-07-26T22:24:53.515484617Z [INFO] [VOICE_RESPONSE_SENT] Respuesta de voz enviada exitosamente jsonPayload={"category":"VOICE_RESPONSE_SENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","messageLength":91,"timestamp":"2025-07-26T22:24:53.512Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"VOICE_RESPONSE_SENT","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T22:24:53.512Z"
2025-07-26T22:24:53.515537515Z [INFO] [QUEUE_ITEM_SUCCESS] Mensaje procesado exitosamente jsonPayload={"category":"QUEUE_ITEM_SUCCESS","environment":"cloud-run","flow":{"sequence":3,"stage":"0_unknown"},"level":"SUCCESS","messageId":"msg_1753568684153_09b970wc3","processedCount":1,"remainingInQueue":0,"timestamp":"2025-07-26T22:24:53.512Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_SUCCESS","flow_stage":"0_unknown","level":"SUCCESS","message_id":"msg_1753568684153_09b970wc3","user_id":"573003913251"} timestamp="2025-07-26T22:24:53.512Z"
2025-07-26T22:24:53.515573225Z [INFO] [LOCK_ALREADY_RELEASED] Lock ya liberado para usuario jsonPayload={"activeLocks":0,"category":"LOCK_ALREADY_RELEASED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"TRACE","timestamp":"2025-07-26T22:24:53.514Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"LOCK_ALREADY_RELEASED","flow_stage":"0_unknown","level":"TRACE","user_id":"573003913251"} timestamp="2025-07-26T22:24:53.514Z"
2025-07-26T22:24:53.515614633Z [INFO] [QUEUE_PROCESSING_COMPLETE] Cola de usuario procesada completamente jsonPayload={"averageTimePerMessage":"9360ms","category":"QUEUE_PROCESSING_COMPLETE","environment":"cloud-run","errorCount":0,"flow":{"stage":"0_unknown"},"initialQueueLength":1,"level":"SUCCESS","processedCount":1,"processingDuration":"9360ms","remainingQueues":0,"timestamp":"2025-07-26T22:24:53.514Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T22:24:53.514Z"
Stopping Container
[2025-07-26T17:14:27.939Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging por sesi√≥n inicializado | {"sessionId":"session-2025-07-26T17-14-27","logFile":"logs/bot-session-2025-07-26T17-14-27.log","maxSessions":5,"maxBufferSizeLocal":50,"maxBufferSizeRailway":400,"bufferInterval":100}
‚úÖ Logs guardados en: logs/bot-session-2025-07-26T17-14-27.log

üìÅ Sesiones disponibles (1/5):
   1. bot-session-2025-07-26T17-14-27.log (0.7KB - 26/7/2025, 10:26:29 p.¬†m.)
2025-07-26T22:26:33.547191250Z [INFO] [THREAD_PERSIST] Guardando threads antes de cerrar... jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:26:29.502Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:26:29.502Z"
2025-07-26T22:26:33.547247329Z [INFO] [THREAD_PERSIST] 1 threads guardados jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","file":"tmp/threads.json","flow":{"stage":"0_unknown"},"level":"INFO","source":"save_operation","threadsCount":1,"timestamp":"2025-07-26T22:26:29.504Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:26:29.504Z"
‚úÖ Logs guardados en: logs/bot-session-2025-07-26T17-14-27.log

üìÅ Sesiones disponibles (1/5):
   1. bot-session-2025-07-26T17-14-27.log (0.9KB - 26/7/2025, 10:26:29 p.¬†m.)
npm notice
npm notice New major version of npm available! 10.8.2 -> 11.5.1
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.5.1
npm notice To update run: npm install -g npm@11.5.1
npm notice
