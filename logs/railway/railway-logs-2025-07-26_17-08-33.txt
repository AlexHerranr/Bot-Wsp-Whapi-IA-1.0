Starting Container

> tealquilamos-bot@1.0.0 start
> node dist/app-unified.js

ðŸ“ Logs de esta sesiÃ³n: logs/bot-session-2025-07-26T17-06-08.log
ðŸ”„ Manteniendo mÃ¡ximo 5 sesiones
[2025-07-26T17:06:08.675Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging por sesiÃ³n inicializado | {"sessionId":"session-2025-07-26T17-06-08","logFile":"logs/bot-session-2025-07-26T17-06-08.log","maxSessions":5,"maxBufferSizeLocal":50,"maxBufferSizeRailway":400,"bufferInterval":100}
2025-07-26T22:06:08.846148151Z [INFO] [THREAD_PERSIST] Directorio creado: tmp/backups jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:06:08.741Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:06:08.741Z"
2025-07-26T22:06:08.846169931Z [INFO] [THREAD_PERSIST] No se encontrÃ³ archivo de threads, iniciando vacÃ­o jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:06:08.742Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:06:08.742Z"
2025-07-26T22:06:08.846191665Z [INFO] [THREAD_PERSIST] Auto-guardado optimizado configurado cada 5 minutos jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:06:08.742Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:06:08.742Z"
2025-07-26T22:06:08.846327577Z [INFO] [GUEST_MEMORY] Sistema de cache de labels inicializado (TTL: 300s, limpieza: 10min) jsonPayload={"category":"GUEST_MEMORY","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:06:08.783Z"} labels={"app":"whatsapp-bot","category":"GUEST_MEMORY","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:06:08.783Z"

ðŸš€ TeAlquilamos Bot - Iniciando...
ðŸ“… Timestamp: 2025-07-26T22:06:08.787Z
ðŸ”§ Node.js: v18.20.8
ðŸ’¾ Memoria inicial: 27MB
ðŸŒ Entorno: production
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ðŸ” Detectando entorno...
   RAILWAY_ENVIRONMENT: production
   RAILWAY_PROJECT_ID: 84017f88-1aab-4519-afd2-4e55a45cee90
   K_SERVICE: not set
   NODE_ENV: production
âœ… Detectado: Railway
ðŸ”§ Puerto detectado: 8080 (process.env.PORT: 8080)
ðŸ”§ Forzando NODE_ENV=production para Railway
ðŸ”§ ConfiguraciÃ³n del Entorno:
   ðŸ“ Entorno: cloud-run
   ðŸŒ Puerto: 8080
   ï¿½ï¿½ Webhook: https://bot-wsp-whapi-ia-10-production.up.railway.app/hook
   ðŸ“Š Log Level: production
   ðŸ” Logs Detallados: SÃ­
   â±ï¸  Buffer de Mensajes: Activo (10s)
   â˜ï¸  Modo: Cloud Run
   ðŸš€ ProducciÃ³n: Activo
   ðŸ”‘ Secretos: Cargados
   ðŸ“œ InyecciÃ³n Historial: Inactiva (3 meses, 200 msgs)
   â±ï¸ Cache TTL: 3600 segundos (1h)
2025-07-26T22:06:08.846806243Z [INFO] [THREAD_PERSIST] Cleanup inicial ejecutado con 3 meses jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:06:08.790Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:06:08.790Z"
2025-07-26T22:06:08.846825590Z [INFO] [THREAD_PERSIST] Cleanup periÃ³dico configurado cada 5 minutos jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:06:08.790Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:06:08.790Z"
2025-07-26T22:06:08.846859580Z [INFO] [SERVER_START] Servidor HTTP iniciado jsonPayload={"category":"SERVER_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"host":"0.0.0.0","level":"INFO","port":8080,"timestamp":"2025-07-26T22:06:08.796Z","webhookUrl":"https://bot-wsp-whapi-ia-10-production.up.railway.app/hook"} labels={"app":"whatsapp-bot","category":"SERVER_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:06:08.796Z"

=== Bot TeAlquilamos Iniciado ===
ðŸš€ Servidor: 0.0.0.0:8080
ðŸ”— Webhook: https://bot-wsp-whapi-ia-10-production.up.railway.app/hook
âœ… Sistema listo

2025-07-26T22:06:08.847076979Z [INFO] [BOT_INIT] Cleanup automÃ¡tico de threads y cache configurado jsonPayload={"category":"BOT_INIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:06:08.797Z"} labels={"app":"whatsapp-bot","category":"BOT_INIT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:06:08.797Z"
2025-07-26T22:06:08.847103444Z [INFO] [CACHE_INIT] EstadÃ­sticas de cache al inicio jsonPayload={"category":"CACHE_INIT","contextCache":{"size":0,"ttlMinutes":1},"environment":"cloud-run","flow":{"stage":"0_unknown"},"historyCache":{"size":0,"ttlMinutes":60},"injectionCache":{"size":0,"ttlMinutes":5},"level":"INFO","timestamp":"2025-07-26T22:06:08.797Z"} labels={"app":"whatsapp-bot","category":"CACHE_INIT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:06:08.797Z"
2025-07-26T22:06:13.804162574Z [INFO] [ORPHANED_RUNS_RECOVERY_START] Iniciando recuperaciÃ³n de runs huÃ©rfanos jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:06:13.798Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:06:13.798Z"
2025-07-26T22:06:13.804197651Z [INFO] [ORPHANED_RUNS_RECOVERY_START] Iniciando recuperaciÃ³n de runs huÃ©rfanos jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:06:13.799Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:06:13.799Z"
2025-07-26T22:06:13.804234210Z [INFO] [ORPHANED_RUNS_RECOVERY_COMPLETE] RecuperaciÃ³n de runs huÃ©rfanos completada jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_COMPLETE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","runsCancelled":0,"runsChecked":0,"timestamp":"2025-07-26T22:06:13.799Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T22:06:13.799Z"
2025-07-26T22:06:13.804264837Z [INFO] [ORPHANED_RUNS_RECOVERY_COMPLETE] RecuperaciÃ³n de runs huÃ©rfanos completada jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_COMPLETE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","timestamp":"2025-07-26T22:06:13.800Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T22:06:13.800Z"
Stopping Container
[2025-07-26T17:06:08.675Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging por sesiÃ³n inicializado | {"sessionId":"session-2025-07-26T17-06-08","logFile":"logs/bot-session-2025-07-26T17-06-08.log","maxSessions":5,"maxBufferSizeLocal":50,"maxBufferSizeRailway":400,"bufferInterval":100}
âœ… Logs guardados en: logs/bot-session-2025-07-26T17-06-08.log

ðŸ“ Sesiones disponibles (1/5):
   1. bot-session-2025-07-26T17-06-08.log (0.7KB - 26/7/2025, 10:14:30 p.Â m.)
2025-07-26T22:14:34.005718992Z [INFO] [THREAD_PERSIST] Guardando threads antes de cerrar... jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T22:14:30.096Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:30.096Z"
2025-07-26T22:14:34.005741041Z [INFO] [THREAD_PERSIST] 0 threads guardados jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","file":"tmp/threads.json","flow":{"stage":"0_unknown"},"level":"INFO","source":"save_operation","threadsCount":0,"timestamp":"2025-07-26T22:14:30.096Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T22:14:30.096Z"
âœ… Logs guardados en: logs/bot-session-2025-07-26T17-06-08.log

ðŸ“ Sesiones disponibles (1/5):
   1. bot-session-2025-07-26T17-06-08.log (0.9KB - 26/7/2025, 10:14:30 p.Â m.)
npm notice
npm notice New major version of npm available! 10.8.2 -> 11.5.1
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.5.1
npm notice To update run: npm install -g npm@11.5.1
npm notice
