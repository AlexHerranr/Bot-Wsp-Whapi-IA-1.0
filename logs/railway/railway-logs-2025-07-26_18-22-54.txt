Starting Container

> tealquilamos-bot@1.0.0 start
> node dist/app-unified.js

üìÅ Logs de esta sesi√≥n: logs/bot-session-2025-07-26T18-19-05.log
üîÑ Manteniendo m√°ximo 5 sesiones
[2025-07-26T18:19:05.567Z] [SUCCESS] LOGGER_INIT [unknown.ts]: Sistema de logging por sesi√≥n inicializado | {"sessionId":"session-2025-07-26T18-19-05","logFile":"logs/bot-session-2025-07-26T18-19-05.log","maxSessions":5,"maxBufferSizeLocal":50,"maxBufferSizeRailway":400,"bufferInterval":100}
2025-07-26T23:19:05.624020425Z [INFO] [THREAD_PERSIST] Directorio creado: tmp/backups jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:05.618Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:05.618Z"
2025-07-26T23:19:05.624064312Z [INFO] [THREAD_PERSIST] No se encontr√≥ archivo de threads, iniciando vac√≠o jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:05.618Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:05.618Z"
2025-07-26T23:19:05.624093797Z [INFO] [THREAD_PERSIST] Auto-guardado optimizado configurado cada 5 minutos jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:05.619Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:05.619Z"
2025-07-26T23:19:05.665661351Z [INFO] [GUEST_MEMORY] Sistema de cache de labels inicializado (TTL: 300s, limpieza: 10min) jsonPayload={"category":"GUEST_MEMORY","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:05.664Z"} labels={"app":"whatsapp-bot","category":"GUEST_MEMORY","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:05.664Z"

üöÄ TeAlquilamos Bot - Iniciando...
üìÖ Timestamp: 2025-07-26T23:19:05.668Z
üîß Node.js: v18.20.8
üíæ Memoria inicial: 28MB
üåç Entorno: production
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üîç Detectando entorno...
   RAILWAY_ENVIRONMENT: production
   RAILWAY_PROJECT_ID: 84017f88-1aab-4519-afd2-4e55a45cee90
   K_SERVICE: not set
   NODE_ENV: production
‚úÖ Detectado: Railway
üîß Puerto detectado: 8080 (process.env.PORT: 8080)
üîß Forzando NODE_ENV=production para Railway
üîß Configuraci√≥n del Entorno:
   üìç Entorno: cloud-run
   üåê Puerto: 8080
   ÔøΩÔøΩ Webhook: https://bot-wsp-whapi-ia-10-production.up.railway.app/hook
   üìä Log Level: production
   üîç Logs Detallados: S√≠
   ‚è±Ô∏è  Buffer de Mensajes: Activo (10s)
   ‚òÅÔ∏è  Modo: Cloud Run
   üöÄ Producci√≥n: Activo
   üîë Secretos: Cargados
   üìú Inyecci√≥n Historial: Inactiva (3 meses, 200 msgs)
   ‚è±Ô∏è Cache TTL: 3600 segundos (1h)
2025-07-26T23:19:05.674956846Z [INFO] [THREAD_PERSIST] Cleanup inicial ejecutado con 3 meses jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:05.672Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:05.672Z"
2025-07-26T23:19:05.674983675Z [INFO] [THREAD_PERSIST] Cleanup peri√≥dico configurado cada 5 minutos jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:05.672Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:05.672Z"
2025-07-26T23:19:05.719244972Z [INFO] [SERVER_START] Servidor HTTP iniciado jsonPayload={"category":"SERVER_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"host":"0.0.0.0","level":"INFO","port":8080,"timestamp":"2025-07-26T23:19:05.708Z","webhookUrl":"https://bot-wsp-whapi-ia-10-production.up.railway.app/hook"} labels={"app":"whatsapp-bot","category":"SERVER_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:05.708Z"

=== Bot TeAlquilamos Iniciado ===
üöÄ Servidor: 0.0.0.0:8080
üîó Webhook: https://bot-wsp-whapi-ia-10-production.up.railway.app/hook
‚úÖ Sistema listo

2025-07-26T23:19:05.719376582Z [INFO] [BOT_INIT] Cleanup autom√°tico de threads y cache configurado jsonPayload={"category":"BOT_INIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:05.709Z"} labels={"app":"whatsapp-bot","category":"BOT_INIT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:05.709Z"
2025-07-26T23:19:05.719409497Z [INFO] [CACHE_INIT] Estad√≠sticas de cache al inicio jsonPayload={"category":"CACHE_INIT","contextCache":{"size":0,"ttlMinutes":1},"environment":"cloud-run","flow":{"stage":"0_unknown"},"historyCache":{"size":0,"ttlMinutes":60},"injectionCache":{"size":0,"ttlMinutes":5},"level":"INFO","timestamp":"2025-07-26T23:19:05.709Z"} labels={"app":"whatsapp-bot","category":"CACHE_INIT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:05.709Z"
2025-07-26T23:19:10.717589061Z [INFO] [ORPHANED_RUNS_RECOVERY_START] Iniciando recuperaci√≥n de runs hu√©rfanos jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:10.713Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:10.713Z"
2025-07-26T23:19:10.717611869Z [INFO] [ORPHANED_RUNS_RECOVERY_START] Iniciando recuperaci√≥n de runs hu√©rfanos jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:10.713Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:10.713Z"
2025-07-26T23:19:10.717638090Z [INFO] [ORPHANED_RUNS_RECOVERY_COMPLETE] Recuperaci√≥n de runs hu√©rfanos completada jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_COMPLETE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","runsCancelled":0,"runsChecked":0,"timestamp":"2025-07-26T23:19:10.714Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T23:19:10.714Z"
2025-07-26T23:19:10.717664748Z [INFO] [ORPHANED_RUNS_RECOVERY_COMPLETE] Recuperaci√≥n de runs hu√©rfanos completada jsonPayload={"category":"ORPHANED_RUNS_RECOVERY_COMPLETE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","timestamp":"2025-07-26T23:19:10.714Z"} labels={"app":"whatsapp-bot","category":"ORPHANED_RUNS_RECOVERY_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T23:19:10.714Z"
2025-07-26T23:19:40.685110508Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T23:19:31.423Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:31.423Z"
2025-07-26T23:19:40.685147286Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: recording jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"recording","timestamp":"2025-07-26T23:19:31.424Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:19:31.423Z"
2025-07-26T23:19:40.685186565Z [INFO] [BUFFER_TIMER_SET] Timer inteligente configurado jsonPayload={"bufferSize":0,"category":"BUFFER_TIMER_SET","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timerMs":10000,"timestamp":"2025-07-26T23:19:31.424Z","triggerType":"recording","userJid":"573003913251","userName":"573003913251","wasReconfigured":true} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_SET","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:31.424Z"
üéôÔ∏è 573003913251 est√° grabando...
Error renderizando dashboard: [Error: ENOENT: no such file or directory, open '/app/dist/web/dashboard/templates/dashboard.html'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/app/dist/web/dashboard/templates/dashboard.html'
}
2025-07-26T23:19:40.685366267Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T23:19:34.593Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:34.593Z"
2025-07-26T23:19:40.685399822Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: online jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"online","timestamp":"2025-07-26T23:19:34.593Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:19:34.593Z"
üé§ Sr Alex: [Nota de voz recibida]
2025-07-26T23:19:40.685450801Z [INFO] [AUDIO_TRANSCRIBED] Audio transcrito exitosamente jsonPayload={"category":"AUDIO_TRANSCRIBED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","preview":"hola qu√© tal c√≥mo va todo por all√°","timestamp":"2025-07-26T23:19:38.034Z","transcriptionLength":34,"userId":"573003913251"} labels={"app":"whatsapp-bot","category":"AUDIO_TRANSCRIBED","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T23:19:38.034Z"
üë§ Sr Alex: "hola qu√© tal c√≥mo va todo por all√°}"
2025-07-26T23:19:40.685499119Z [INFO] [BUFFER_TIMER_RESPECTED] Timer existente respetado (delay actual es suficiente) jsonPayload={"bufferSize":1,"category":"BUFFER_TIMER_RESPECTED","currentDelay":10000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","requestedDelay":8000,"timestamp":"2025-07-26T23:19:38.035Z","triggerType":"voice","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_RESPECTED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:38.035Z"
2025-07-26T23:19:40.685535568Z [INFO] [GLOBAL_BUFFER_ADD] Mensaje agregado al buffer global jsonPayload={"bufferSize":1,"category":"GLOBAL_BUFFER_ADD","delay":5000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isMedia":true,"level":"INFO","messageText":"üé§ hola qu√© tal c√≥mo va todo por all√°...","timestamp":"2025-07-26T23:19:38.035Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_ADD","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:38.035Z"
‚è∞ üéôÔ∏è Sr Alex dej√≥ de grabar.
2025-07-26T23:19:41.459452150Z [INFO] [GLOBAL_BUFFER_PROCESS] Procesando buffer global despu√©s de 5 segundos jsonPayload={"category":"GLOBAL_BUFFER_PROCESS","combinedText":"üé§ hola qu√© tal c√≥mo va todo por all√°...","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","messageCount":1,"timestamp":"2025-07-26T23:19:41.425Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_PROCESS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:41.425Z"
2025-07-26T23:19:41.459480606Z [INFO] [QUEUE_ITEM_ADDED] Mensaje agregado a cola de usuario jsonPayload={"category":"QUEUE_ITEM_ADDED","environment":"cloud-run","flow":{"sequence":1,"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","messageId":"msg_1753571981426_50znsvkqn","queueLength":1,"timestamp":"2025-07-26T23:19:41.426Z","totalQueues":1,"userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_ADDED","flow_stage":"0_unknown","level":"INFO","message_id":"msg_1753571981426_50znsvkqn","user_id":"573003913251"} timestamp="2025-07-26T23:19:41.426Z"
2025-07-26T23:19:41.459504355Z [INFO] [QUEUE_PROCESSING_START] Procesando cola de usuario jsonPayload={"category":"QUEUE_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","queueLength":1,"timestamp":"2025-07-26T23:19:41.426Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_START","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:19:41.426Z"
2025-07-26T23:19:41.459536921Z [INFO] [QUEUE_ITEM_PROCESSING] Procesando mensaje de cola jsonPayload={"category":"QUEUE_ITEM_PROCESSING","environment":"cloud-run","flow":{"sequence":2,"stage":"0_unknown"},"level":"TRACE","messageId":"msg_1753571981426_50znsvkqn","remainingInQueue":0,"timestamp":"2025-07-26T23:19:41.426Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_PROCESSING","flow_stage":"0_unknown","level":"TRACE","message_id":"msg_1753571981426_50znsvkqn","user_id":"573003913251"} timestamp="2025-07-26T23:19:41.426Z"
2025-07-26T23:19:41.644114643Z [INFO] [RECORDING_INDICATOR_SENT] Recording indicator enviado para procesamiento de audio jsonPayload={"category":"RECORDING_INDICATOR_SENT","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:41.640Z"} labels={"app":"whatsapp-bot","category":"RECORDING_INDICATOR_SENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:41.640Z"
2025-07-26T23:19:41.967610609Z [INFO] [THREAD_PERSIST] Thread creado para 573003913251 jsonPayload={"category":"THREAD_PERSIST","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","operation":"created","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:19:41.918Z","userId":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:19:41.918Z"

üì® Nueva conversaci√≥n con Sr Alex
2025-07-26T23:19:41.967679663Z [INFO] [THREAD_CREATED] Thread creado jsonPayload={"category":"THREAD_CREATED","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:19:41.918Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_CREATED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:41.918Z"
2025-07-26T23:19:41.967712093Z [INFO] [OPENAI_PROCESSING_START] Procesando mensaje de Sr Alex jsonPayload={"category":"OPENAI_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","timestamp":"2025-07-26T23:19:41.918Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"OPENAI_PROCESSING_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:41.918Z"
2025-07-26T23:19:41.967749043Z [INFO] [PRESENCE_SUBSCRIBE_ATTEMPT] Intentando suscribirse a presencia de 573003913251 jsonPayload={"category":"PRESENCE_SUBSCRIBE_ATTEMPT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:41.918Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_SUBSCRIBE_ATTEMPT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:19:41.918Z"
2025-07-26T23:19:42.116892821Z [INFO] [PRESENCE_ALREADY_SUBSCRIBED_API] Usuario 573003913251 ya suscrito (409) jsonPayload={"category":"PRESENCE_ALREADY_SUBSCRIBED_API","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":409,"timestamp":"2025-07-26T23:19:42.099Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_ALREADY_SUBSCRIBED_API","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:19:42.099Z"
2025-07-26T23:19:42.323344093Z [INFO] [WHAPI_LABELS] Obteniendo info del chat para 573003913251 jsonPayload={"category":"WHAPI_LABELS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:42.319Z"} labels={"app":"whatsapp-bot","category":"WHAPI_LABELS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:42.319Z"
2025-07-26T23:19:42.674994218Z [INFO] [WHAPI_LABELS] Info del chat obtenida. Etiquetas: 2 jsonPayload={"category":"WHAPI_LABELS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","timestamp":"2025-07-26T23:19:42.602Z"} labels={"app":"whatsapp-bot","category":"WHAPI_LABELS","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T23:19:42.602Z"
2025-07-26T23:19:42.675026200Z [INFO] [GUEST_MEMORY] Sincronizado con Whapi: 2 etiquetas para 573003913251 jsonPayload={"category":"GUEST_MEMORY","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:42.602Z"} labels={"app":"whatsapp-bot","category":"GUEST_MEMORY","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:42.602Z"
2025-07-26T23:19:42.675076313Z [INFO] [SYNC_NEEDED] Sync needed for 573003913251 jsonPayload={"category":"SYNC_NEEDED","environment":"cloud-run","flow":{"stage":"0_unknown"},"force":false,"isNewThread":true,"isThreadOld":false,"level":"INFO","reason":"new_thread","requestId":null,"timestamp":"2025-07-26T23:19:42.602Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"SYNC_NEEDED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:19:42.602Z"
2025-07-26T23:19:42.675114691Z [INFO] [GUEST_MEMORY] Nuevo perfil creado para 573003913251 con 2 etiquetas jsonPayload={"category":"GUEST_MEMORY","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:42.602Z"} labels={"app":"whatsapp-bot","category":"GUEST_MEMORY","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:42.602Z"
2025-07-26T23:19:42.675153490Z [INFO] [WHAPI_LABELS] Obteniendo info del chat para 573003913251 jsonPayload={"category":"WHAPI_LABELS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:42.602Z"} labels={"app":"whatsapp-bot","category":"WHAPI_LABELS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:42.602Z"
2025-07-26T23:19:42.885955747Z [INFO] [WHAPI_LABELS] Info del chat obtenida. Etiquetas: 2 jsonPayload={"category":"WHAPI_LABELS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","timestamp":"2025-07-26T23:19:42.879Z"} labels={"app":"whatsapp-bot","category":"WHAPI_LABELS","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T23:19:42.879Z"
2025-07-26T23:19:42.886006187Z [INFO] [CONTEXT_FRESH_RESTART] Generando contexto fresco despu√©s del reinicio jsonPayload={"cacheAge":"none","category":"CONTEXT_FRESH_RESTART","environment":"cloud-run","flow":{"stage":"0_unknown"},"hadCachedContext":false,"level":"INFO","timestamp":"2025-07-26T23:19:42.880Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CONTEXT_FRESH_RESTART","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:19:42.880Z"
2025-07-26T23:19:42.886041384Z [INFO] [CACHE_HIT] Chat info desde cache jsonPayload={"cacheAge":0,"category":"CACHE_HIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:42.880Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CACHE_HIT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:19:42.880Z"
2025-07-26T23:19:42.921608153Z [INFO] [CONTEXT_INJECTION] Contexto temporal generado jsonPayload={"category":"CONTEXT_INJECTION","clientName":"Sr Alex","contactName":"Sr Alex","contextLength":150,"environment":"cloud-run","flow":{"stage":"0_unknown"},"hasChatInfo":true,"hasProfile":true,"isFirstMessageAfterRestart":true,"labelsCount":2,"level":"INFO","timestamp":"2025-07-26T23:19:42.912Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CONTEXT_INJECTION","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:19:42.912Z"
2025-07-26T23:19:42.921669466Z [INFO] [CONTEXT_DEBUG] Contexto enviado a OpenAI jsonPayload={"category":"CONTEXT_DEBUG","contextPreview":"Fecha: 26/07/2025 | Hora: 6:19 PM (Colombia)\nCliente: Sr Alex | Contacto WhatsApp: Sr Alex | Status: Colega Jefe, cotizaci√≥n\n---\nMensaje del cliente:\n","contextReason":"cambio_labels","contextTokensSaved":0,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isVoiceMessage":true,"level":"INFO","messagePreview":"üé§ hola qu√© tal c√≥mo va todo por all√°","needsTemporalContext":true,"shortUserId":"573003913251","timestamp":"2025-07-26T23:19:42.913Z","totalLength":187} labels={"app":"whatsapp-bot","category":"CONTEXT_DEBUG","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:42.913Z"
2025-07-26T23:19:43.266899442Z [INFO] [CACHE_HIT] Chat info desde cache jsonPayload={"cacheAge":1,"category":"CACHE_HIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:19:43.258Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CACHE_HIT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:19:43.258Z"
2025-07-26T23:19:43.266938125Z [INFO] [THREAD_PERSIST] Metadatos actualizados para 573003913251 jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"labels":["Colega Jefe","cotizaci√≥n"],"level":"SUCCESS","timestamp":"2025-07-26T23:19:43.258Z","updates":["labels"],"userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T23:19:43.258Z"
2025-07-26T23:19:43.266972828Z [INFO] [THREAD_METADATA_UPDATED] Metadatos del thread actualizados jsonPayload={"category":"THREAD_METADATA_UPDATED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","reason":"cambio_labels","shortUserId":"573003913251","timestamp":"2025-07-26T23:19:43.258Z","updates":["labels"]} labels={"app":"whatsapp-bot","category":"THREAD_METADATA_UPDATED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:43.258Z"
2025-07-26T23:19:45.550242296Z [INFO] [OPENAI_POLLING] Esperando... jsonPayload={"attempts":1,"category":"OPENAI_POLLING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_nED17ewAfGoen8DnjWmfQLVR","shortUserId":"573003913251","status":"queued","timestamp":"2025-07-26T23:19:45.541Z"} labels={"app":"whatsapp-bot","category":"OPENAI_POLLING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:45.541Z"
2025-07-26T23:19:48.113807038Z [INFO] [TOKEN_USAGE] Tokens utilizados jsonPayload={"category":"TOKEN_USAGE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:19:48.098Z","totalTokens":3473} labels={"app":"whatsapp-bot","category":"TOKEN_USAGE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:48.098Z"
2025-07-26T23:19:48.256100497Z [INFO] [OPENAI_RESPONSE_RAW] Respuesta exacta recibida de OpenAI jsonPayload={"category":"OPENAI_RESPONSE_RAW","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasDoubleAsterisks":false,"level":"INFO","responseLength":98,"responsePreview":"Hola Alex, todo muy bien por aqu√≠. Espero que t√∫ tambi√©n est√©s bien üòä ¬øEn qu√© puedo ayudarte hoy?","responseText":"Hola Alex, todo muy bien por aqu√≠. Espero que t√∫ tambi√©n est√©s bien üòä ¬øEn qu√© puedo ayudarte hoy?","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:19:48.199Z"} labels={"app":"whatsapp-bot","category":"OPENAI_RESPONSE_RAW","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:19:48.199Z"
2025-07-26T23:19:48.256130854Z [INFO] [PERFORMANCE_METRICS] Procesamiento completado exitosamente jsonPayload={"category":"PERFORMANCE_METRICS","contextTokens":0,"environment":"cloud-run","flow":{"stage":"9_complete"},"isEfficient":false,"level":"INFO","memory":{"heapTotalMB":31,"heapUsedMB":29,"rssMB":90},"responseLength":98,"shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:19:48.199Z","tokensPerSecond":530,"totalDurationMs":6559,"totalTokens":3473} labels={"app":"whatsapp-bot","category":"PERFORMANCE_METRICS","flow_stage":"9_complete","level":"INFO"} timestamp="2025-07-26T23:19:48.199Z"
ü§ñ OpenAI ‚Üí Sr Alex (0.0s)
üé§ Generando voz para 573003913251: "Hola Alex, todo muy bien por aqu√≠. Espero que t√∫ t..."
2025-07-26T23:19:52.291822012Z [INFO] [VOICE_RESPONSE_SENT] Respuesta de voz enviada exitosamente jsonPayload={"category":"VOICE_RESPONSE_SENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","messageLength":98,"timestamp":"2025-07-26T23:19:52.290Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"VOICE_RESPONSE_SENT","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T23:19:52.290Z"
2025-07-26T23:19:52.291849536Z [INFO] [QUEUE_ITEM_SUCCESS] Mensaje procesado exitosamente jsonPayload={"category":"QUEUE_ITEM_SUCCESS","environment":"cloud-run","flow":{"sequence":3,"stage":"0_unknown"},"level":"SUCCESS","messageId":"msg_1753571981426_50znsvkqn","processedCount":1,"remainingInQueue":0,"timestamp":"2025-07-26T23:19:52.290Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_SUCCESS","flow_stage":"0_unknown","level":"SUCCESS","message_id":"msg_1753571981426_50znsvkqn","user_id":"573003913251"} timestamp="2025-07-26T23:19:52.290Z"
2025-07-26T23:19:52.291872349Z [INFO] [LOCK_ALREADY_RELEASED] Lock ya liberado para usuario jsonPayload={"activeLocks":0,"category":"LOCK_ALREADY_RELEASED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"TRACE","timestamp":"2025-07-26T23:19:52.291Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"LOCK_ALREADY_RELEASED","flow_stage":"0_unknown","level":"TRACE","user_id":"573003913251"} timestamp="2025-07-26T23:19:52.291Z"
2025-07-26T23:19:52.291899630Z [INFO] [QUEUE_PROCESSING_COMPLETE] Cola de usuario procesada completamente jsonPayload={"averageTimePerMessage":"10865ms","category":"QUEUE_PROCESSING_COMPLETE","environment":"cloud-run","errorCount":0,"flow":{"stage":"0_unknown"},"initialQueueLength":1,"level":"SUCCESS","processedCount":1,"processingDuration":"10865ms","remainingQueues":0,"timestamp":"2025-07-26T23:19:52.291Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T23:19:52.291Z"
2025-07-26T23:20:00.451210500Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T23:20:00.445Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:00.445Z"
2025-07-26T23:20:00.451244972Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: recording jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"recording","timestamp":"2025-07-26T23:20:00.445Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:20:00.445Z"
2025-07-26T23:20:00.451275620Z [INFO] [BUFFER_TIMER_SET] Timer inteligente configurado jsonPayload={"bufferSize":0,"category":"BUFFER_TIMER_SET","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timerMs":10000,"timestamp":"2025-07-26T23:20:00.445Z","triggerType":"recording","userJid":"573003913251","userName":"573003913251","wasReconfigured":true} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_SET","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:00.445Z"
üéôÔ∏è 573003913251 est√° grabando...
2025-07-26T23:20:05.230177492Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T23:20:05.228Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:05.228Z"
2025-07-26T23:20:05.230228512Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: online jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"online","timestamp":"2025-07-26T23:20:05.228Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:20:05.228Z"
üé§ Sr Alex: [Nota de voz recibida]
2025-07-26T23:20:08.111732035Z [INFO] [AUDIO_TRANSCRIBED] Audio transcrito exitosamente jsonPayload={"category":"AUDIO_TRANSCRIBED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","preview":"¬øQu√© tiempo hay disponible para hoy? ¬øPor dos noches?","timestamp":"2025-07-26T23:20:08.086Z","transcriptionLength":53,"userId":"573003913251"} labels={"app":"whatsapp-bot","category":"AUDIO_TRANSCRIBED","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T23:20:08.086Z"
üë§ Sr Alex: "¬øQu√© tiempo hay disponible para hoy? ¬øPor dos noches?}"
2025-07-26T23:20:08.111776967Z [INFO] [BUFFER_TIMER_RESPECTED] Timer existente respetado (delay actual es suficiente) jsonPayload={"bufferSize":1,"category":"BUFFER_TIMER_RESPECTED","currentDelay":10000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","requestedDelay":8000,"timestamp":"2025-07-26T23:20:08.086Z","triggerType":"voice","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_RESPECTED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:08.086Z"
2025-07-26T23:20:08.111807026Z [INFO] [GLOBAL_BUFFER_ADD] Mensaje agregado al buffer global jsonPayload={"bufferSize":1,"category":"GLOBAL_BUFFER_ADD","delay":5000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isMedia":true,"level":"INFO","messageText":"üé§ ¬øQu√© tiempo hay disponible para hoy? ¬øPor dos n...","timestamp":"2025-07-26T23:20:08.086Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_ADD","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:08.086Z"
‚è∞ üéôÔ∏è Sr Alex dej√≥ de grabar.
2025-07-26T23:20:10.450801958Z [INFO] [GLOBAL_BUFFER_PROCESS] Procesando buffer global despu√©s de 5 segundos jsonPayload={"category":"GLOBAL_BUFFER_PROCESS","combinedText":"üé§ ¬øQu√© tiempo hay disponible para hoy? ¬øPor dos noches?...","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","messageCount":1,"timestamp":"2025-07-26T23:20:10.446Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_PROCESS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:10.446Z"
2025-07-26T23:20:11.287831358Z [INFO] [QUEUE_ITEM_ADDED] Mensaje agregado a cola de usuario jsonPayload={"category":"QUEUE_ITEM_ADDED","environment":"cloud-run","flow":{"sequence":1,"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","messageId":"msg_1753572011275_8rtc1jh8a","queueLength":1,"timestamp":"2025-07-26T23:20:11.275Z","totalQueues":1,"userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_ADDED","flow_stage":"0_unknown","level":"INFO","message_id":"msg_1753572011275_8rtc1jh8a","user_id":"573003913251"} timestamp="2025-07-26T23:20:11.275Z"
2025-07-26T23:20:11.287856697Z [INFO] [QUEUE_PROCESSING_START] Procesando cola de usuario jsonPayload={"category":"QUEUE_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","queueLength":1,"timestamp":"2025-07-26T23:20:11.275Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_START","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:20:11.275Z"
2025-07-26T23:20:11.287886478Z [INFO] [QUEUE_ITEM_PROCESSING] Procesando mensaje de cola jsonPayload={"category":"QUEUE_ITEM_PROCESSING","environment":"cloud-run","flow":{"sequence":2,"stage":"0_unknown"},"level":"TRACE","messageId":"msg_1753572011275_8rtc1jh8a","remainingInQueue":0,"timestamp":"2025-07-26T23:20:11.275Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_PROCESSING","flow_stage":"0_unknown","level":"TRACE","message_id":"msg_1753572011275_8rtc1jh8a","user_id":"573003913251"} timestamp="2025-07-26T23:20:11.275Z"
2025-07-26T23:20:11.881668117Z [INFO] [RECORDING_INDICATOR_SENT] Recording indicator enviado para procesamiento de audio jsonPayload={"category":"RECORDING_INDICATOR_SENT","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:20:11.857Z"} labels={"app":"whatsapp-bot","category":"RECORDING_INDICATOR_SENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:11.857Z"
2025-07-26T23:20:11.881713530Z [INFO] [THREAD_REUSE] Thread reutilizado para 573003913251 jsonPayload={"category":"THREAD_REUSE","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:20:11.858Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_REUSE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:11.858Z"
2025-07-26T23:20:11.881741506Z [INFO] [HISTORY_SKIP] Skip fetch historial: Thread existe jsonPayload={"category":"HISTORY_SKIP","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","reason":"thread_already_exists","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:20:11.858Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"HISTORY_SKIP","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:20:11.858Z"
2025-07-26T23:20:11.881766763Z [INFO] [OPENAI_PROCESSING_START] Procesando mensaje de Sr Alex jsonPayload={"category":"OPENAI_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","timestamp":"2025-07-26T23:20:11.858Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"OPENAI_PROCESSING_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:11.858Z"
2025-07-26T23:20:12.179949091Z [INFO] [CACHE_HIT] Chat info desde cache jsonPayload={"cacheAge":30,"category":"CACHE_HIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:20:12.169Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CACHE_HIT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:20:12.169Z"
2025-07-26T23:20:12.180007363Z [INFO] [CONTEXT_DEBUG] Contexto enviado a OpenAI jsonPayload={"category":"CONTEXT_DEBUG","contextPreview":"NO_CONTEXT","contextReason":"no_cambios","contextTokensSaved":-151,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isVoiceMessage":true,"level":"INFO","messagePreview":"üé§ ¬øQu√© tiempo hay disponible para hoy? ¬øPor dos noches?","needsTemporalContext":false,"shortUserId":"573003913251","timestamp":"2025-07-26T23:20:12.169Z","totalLength":56} labels={"app":"whatsapp-bot","category":"CONTEXT_DEBUG","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:12.169Z"
2025-07-26T23:20:14.933033413Z [INFO] [OPENAI_POLLING] Esperando... jsonPayload={"attempts":1,"category":"OPENAI_POLLING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_BxsIlmy4PHdlqUbh61bRDruP","shortUserId":"573003913251","status":"in_progress","timestamp":"2025-07-26T23:20:14.908Z"} labels={"app":"whatsapp-bot","category":"OPENAI_POLLING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:14.908Z"
2025-07-26T23:20:16.228343299Z [INFO] [TOKEN_USAGE] Tokens utilizados jsonPayload={"category":"TOKEN_USAGE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:20:16.209Z","totalTokens":3536} labels={"app":"whatsapp-bot","category":"TOKEN_USAGE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:16.209Z"
2025-07-26T23:20:16.371671312Z [INFO] [OPENAI_RESPONSE_RAW] Respuesta exacta recibida de OpenAI jsonPayload={"category":"OPENAI_RESPONSE_RAW","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasDoubleAsterisks":false,"level":"INFO","responseLength":184,"responsePreview":"Para confirmar la disponibilidad, necesito saber cu√°ntas personas se quedar√≠an. ¬øMe podr√≠as dar ese detalle? Una vez lo tenga, verifico lo que tenemos disponible para hoy y dos noches.","responseText":"Para confirmar la disponibilidad, necesito saber cu√°ntas personas se quedar√≠an. ¬øMe podr√≠as dar ese detalle? Una vez lo tenga, verifico lo que tenemos disponible para hoy y dos noches.","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:20:16.369Z"} labels={"app":"whatsapp-bot","category":"OPENAI_RESPONSE_RAW","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:16.369Z"
2025-07-26T23:20:16.371718019Z [INFO] [PERFORMANCE_METRICS] Procesamiento completado exitosamente jsonPayload={"category":"PERFORMANCE_METRICS","contextTokens":0,"environment":"cloud-run","flow":{"stage":"9_complete"},"isEfficient":false,"level":"INFO","memory":{"heapTotalMB":31,"heapUsedMB":29,"rssMB":91},"responseLength":184,"shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:20:16.369Z","tokensPerSecond":784,"totalDurationMs":4511,"totalTokens":3536} labels={"app":"whatsapp-bot","category":"PERFORMANCE_METRICS","flow_stage":"9_complete","level":"INFO"} timestamp="2025-07-26T23:20:16.369Z"
ü§ñ OpenAI ‚Üí Sr Alex (0.0s)
üé§ Generando voz para 573003913251: "Para confirmar la disponibilidad, necesito saber c..."
2025-07-26T23:20:20.171193419Z [INFO] [VOICE_RESPONSE_SENT] Respuesta de voz enviada exitosamente jsonPayload={"category":"VOICE_RESPONSE_SENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","messageLength":184,"timestamp":"2025-07-26T23:20:20.158Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"VOICE_RESPONSE_SENT","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T23:20:20.158Z"
2025-07-26T23:20:20.171240561Z [INFO] [QUEUE_ITEM_SUCCESS] Mensaje procesado exitosamente jsonPayload={"category":"QUEUE_ITEM_SUCCESS","environment":"cloud-run","flow":{"sequence":3,"stage":"0_unknown"},"level":"SUCCESS","messageId":"msg_1753572011275_8rtc1jh8a","processedCount":1,"remainingInQueue":0,"timestamp":"2025-07-26T23:20:20.158Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_SUCCESS","flow_stage":"0_unknown","level":"SUCCESS","message_id":"msg_1753572011275_8rtc1jh8a","user_id":"573003913251"} timestamp="2025-07-26T23:20:20.158Z"
2025-07-26T23:20:20.171269186Z [INFO] [LOCK_ALREADY_RELEASED] Lock ya liberado para usuario jsonPayload={"activeLocks":0,"category":"LOCK_ALREADY_RELEASED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"TRACE","timestamp":"2025-07-26T23:20:20.158Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"LOCK_ALREADY_RELEASED","flow_stage":"0_unknown","level":"TRACE","user_id":"573003913251"} timestamp="2025-07-26T23:20:20.158Z"
2025-07-26T23:20:20.171301216Z [INFO] [QUEUE_PROCESSING_COMPLETE] Cola de usuario procesada completamente jsonPayload={"averageTimePerMessage":"8883ms","category":"QUEUE_PROCESSING_COMPLETE","environment":"cloud-run","errorCount":0,"flow":{"stage":"0_unknown"},"initialQueueLength":1,"level":"SUCCESS","processedCount":1,"processingDuration":"8883ms","remainingQueues":0,"timestamp":"2025-07-26T23:20:20.158Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T23:20:20.158Z"
2025-07-26T23:20:40.174238739Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T23:20:32.662Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:32.662Z"
2025-07-26T23:20:40.174275335Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: recording jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"recording","timestamp":"2025-07-26T23:20:32.662Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:20:32.662Z"
2025-07-26T23:20:40.174307123Z [INFO] [BUFFER_TIMER_SET] Timer inteligente configurado jsonPayload={"bufferSize":0,"category":"BUFFER_TIMER_SET","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timerMs":10000,"timestamp":"2025-07-26T23:20:32.662Z","triggerType":"recording","userJid":"573003913251","userName":"573003913251","wasReconfigured":true} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_SET","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:32.662Z"
üéôÔ∏è 573003913251 est√° grabando...
2025-07-26T23:20:40.174356389Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T23:20:38.062Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:38.062Z"
2025-07-26T23:20:40.174381206Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: online jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"online","timestamp":"2025-07-26T23:20:38.062Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:20:38.062Z"
üé§ Sr Alex: [Nota de voz recibida]
2025-07-26T23:20:41.004374431Z [INFO] [AUDIO_TRANSCRIBED] Audio transcrito exitosamente jsonPayload={"category":"AUDIO_TRANSCRIBED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","preview":"Seriamos dos personitas solamente. Algo baratico ah√≠ por favor.","timestamp":"2025-07-26T23:20:40.999Z","transcriptionLength":63,"userId":"573003913251"} labels={"app":"whatsapp-bot","category":"AUDIO_TRANSCRIBED","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T23:20:40.999Z"
üë§ Sr Alex: "Seriamos dos personitas solamente. Algo baratico ah√≠ por fav...}"
2025-07-26T23:20:41.004448451Z [INFO] [BUFFER_TIMER_RESPECTED] Timer existente respetado (delay actual es suficiente) jsonPayload={"bufferSize":1,"category":"BUFFER_TIMER_RESPECTED","currentDelay":10000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","requestedDelay":8000,"timestamp":"2025-07-26T23:20:40.999Z","triggerType":"voice","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_RESPECTED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:40.999Z"
2025-07-26T23:20:41.004484317Z [INFO] [GLOBAL_BUFFER_ADD] Mensaje agregado al buffer global jsonPayload={"bufferSize":1,"category":"GLOBAL_BUFFER_ADD","delay":5000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isMedia":true,"level":"INFO","messageText":"üé§ Seriamos dos personitas solamente. Algo baratic...","timestamp":"2025-07-26T23:20:40.999Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_ADD","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:40.999Z"
‚è∞ üéôÔ∏è Sr Alex dej√≥ de grabar.
2025-07-26T23:20:42.691465340Z [INFO] [GLOBAL_BUFFER_PROCESS] Procesando buffer global despu√©s de 5 segundos jsonPayload={"category":"GLOBAL_BUFFER_PROCESS","combinedText":"üé§ Seriamos dos personitas solamente. Algo baratico ah√≠ por favor....","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","messageCount":1,"timestamp":"2025-07-26T23:20:42.664Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_PROCESS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:42.664Z"
2025-07-26T23:20:43.457398336Z [INFO] [QUEUE_ITEM_ADDED] Mensaje agregado a cola de usuario jsonPayload={"category":"QUEUE_ITEM_ADDED","environment":"cloud-run","flow":{"sequence":1,"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","messageId":"msg_1753572043447_bgg3ouvpb","queueLength":1,"timestamp":"2025-07-26T23:20:43.447Z","totalQueues":1,"userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_ADDED","flow_stage":"0_unknown","level":"INFO","message_id":"msg_1753572043447_bgg3ouvpb","user_id":"573003913251"} timestamp="2025-07-26T23:20:43.447Z"
2025-07-26T23:20:43.457439184Z [INFO] [QUEUE_PROCESSING_START] Procesando cola de usuario jsonPayload={"category":"QUEUE_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","queueLength":1,"timestamp":"2025-07-26T23:20:43.448Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_START","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:20:43.448Z"
2025-07-26T23:20:43.457475115Z [INFO] [QUEUE_ITEM_PROCESSING] Procesando mensaje de cola jsonPayload={"category":"QUEUE_ITEM_PROCESSING","environment":"cloud-run","flow":{"sequence":2,"stage":"0_unknown"},"level":"TRACE","messageId":"msg_1753572043447_bgg3ouvpb","remainingInQueue":0,"timestamp":"2025-07-26T23:20:43.448Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_PROCESSING","flow_stage":"0_unknown","level":"TRACE","message_id":"msg_1753572043447_bgg3ouvpb","user_id":"573003913251"} timestamp="2025-07-26T23:20:43.448Z"
2025-07-26T23:20:44.181423803Z [INFO] [RECORDING_INDICATOR_SENT] Recording indicator enviado para procesamiento de audio jsonPayload={"category":"RECORDING_INDICATOR_SENT","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:20:44.065Z"} labels={"app":"whatsapp-bot","category":"RECORDING_INDICATOR_SENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:44.065Z"
2025-07-26T23:20:44.181458591Z [INFO] [THREAD_REUSE] Thread reutilizado para 573003913251 jsonPayload={"category":"THREAD_REUSE","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:20:44.065Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_REUSE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:44.065Z"
2025-07-26T23:20:44.181491290Z [INFO] [HISTORY_SKIP] Skip fetch historial: Thread existe jsonPayload={"category":"HISTORY_SKIP","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","reason":"thread_already_exists","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:20:44.065Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"HISTORY_SKIP","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:20:44.065Z"
2025-07-26T23:20:44.181522073Z [INFO] [OPENAI_PROCESSING_START] Procesando mensaje de Sr Alex jsonPayload={"category":"OPENAI_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","timestamp":"2025-07-26T23:20:44.065Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"OPENAI_PROCESSING_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:44.065Z"
2025-07-26T23:20:44.457651326Z [INFO] [CACHE_HIT] Chat info desde cache jsonPayload={"cacheAge":62,"category":"CACHE_HIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:20:44.413Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CACHE_HIT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:20:44.413Z"
2025-07-26T23:20:44.457703452Z [INFO] [CONTEXT_DEBUG] Contexto enviado a OpenAI jsonPayload={"category":"CONTEXT_DEBUG","contextPreview":"NO_CONTEXT","contextReason":"no_cambios","contextTokensSaved":-151,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isVoiceMessage":true,"level":"INFO","messagePreview":"üé§ Seriamos dos personitas solamente. Algo baratico ah√≠ por favor.","needsTemporalContext":false,"shortUserId":"573003913251","timestamp":"2025-07-26T23:20:44.413Z","totalLength":66} labels={"app":"whatsapp-bot","category":"CONTEXT_DEBUG","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:44.413Z"
2025-07-26T23:20:50.955404785Z [INFO] [OPENAI_POLLING] Esperando... jsonPayload={"attempts":1,"category":"OPENAI_POLLING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_2dT1LNI8uStNZJKu0DPUE8Av","shortUserId":"573003913251","status":"in_progress","timestamp":"2025-07-26T23:20:50.954Z"} labels={"app":"whatsapp-bot","category":"OPENAI_POLLING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:50.954Z"
2025-07-26T23:20:53.502290467Z [INFO] [FUNCTION_CALLING_START] function_calling_required jsonPayload={"category":"FUNCTION_CALLING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_2dT1LNI8uStNZJKu0DPUE8Av","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:20:53.501Z","toolCallsCount":1} labels={"app":"whatsapp-bot","category":"FUNCTION_CALLING_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:53.501Z"
2025-07-26T23:20:53.502322051Z [INFO] [FUNCTION_EXECUTING] function_executing jsonPayload={"args":{"endDate":"2025-07-28","startDate":"2025-07-26"},"category":"FUNCTION_EXECUTING","environment":"cloud-run","flow":{"stage":"0_unknown"},"functionName":"check_availability","level":"INFO","shortUserId":"573003913251","timestamp":"2025-07-26T23:20:53.501Z","toolCallId":"call_DO83DiI7X6HWrSqw1hYYwLWq"} labels={"app":"whatsapp-bot","category":"FUNCTION_EXECUTING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:53.501Z"
‚öôÔ∏è check_availability(07/26-07/28, 2 noches)
2025-07-26T23:20:53.508955893Z [INFO] [BEDS24_REQUEST] Procesando consulta de disponibilidad jsonPayload={"category":"BEDS24_REQUEST","dateAdjusted":false,"endDate":"2025-07-28","environment":"cloud-run","flow":{"stage":"4_beds_request"},"hasSpecificProperty":false,"hasSpecificRoom":false,"level":"INFO","maxTransfers":3,"nights":2,"originalEndDate":"2025-07-28","originalStartDate":"2025-07-26","propertyId":null,"requestType":"availability_check","roomId":null,"startDate":"2025-07-26","timestamp":"2025-07-26T23:20:53.508Z"} labels={"app":"whatsapp-bot","category":"BEDS24_REQUEST","flow_stage":"4_beds_request","level":"INFO"} timestamp="2025-07-26T23:20:53.508Z"
2025-07-26T23:20:53.508999675Z [INFO] [AVAILABILITY_HANDLER] Procesando consulta de disponibilidad jsonPayload={"category":"AVAILABILITY_HANDLER","dateAdjusted":false,"endDate":"2025-07-28","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","propertyId":null,"roomId":null,"startDate":"2025-07-26","timestamp":"2025-07-26T23:20:53.508Z"} labels={"app":"whatsapp-bot","category":"AVAILABILITY_HANDLER","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:53.508Z"
2025-07-26T23:20:53.512297312Z [INFO] [BEDS24_CACHE_MISS] Cache de disponibilidad no encontrado o expirado jsonPayload={"cacheKey":"availability_2025-07-26_2025-07-28_any_any","category":"BEDS24_CACHE_MISS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:20:53.508Z"} labels={"app":"whatsapp-bot","category":"BEDS24_CACHE_MISS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:53.508Z"
2025-07-26T23:20:53.512326816Z [INFO] [BEDS24_PROCESSING] Calculando noches de estad√≠a jsonPayload={"category":"BEDS24_PROCESSING","dateCalculation":"stay_nights_only","endDate":"2025-07-28","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","nightsRange":["2025-07-26","2025-07-27"],"startDate":"2025-07-26","timestamp":"2025-07-26T23:20:53.509Z","totalNights":2} labels={"app":"whatsapp-bot","category":"BEDS24_PROCESSING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:53.509Z"
2025-07-26T23:20:54.080132305Z [INFO] [BEDS24_API_CALL] Consulta optimizada a Beds24 (solo calendar) jsonPayload={"category":"BEDS24_API_CALL","dateRange":"2025-07-26 - 2025-07-28","endpoint":"inventory/rooms/calendar","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","method":"GET","nightsCalculated":2,"optimization":"single-endpoint","parameters":{"endDate":"2025-07-28","includeMaxStay":true,"includeMinStay":true,"includeMultiplier":true,"includeNumAvail":true,"includeOverride":true,"includePrices":true,"startDate":"2025-07-26"},"success":true,"timestamp":"2025-07-26T23:20:54.038Z","totalProperties":7} labels={"app":"whatsapp-bot","category":"BEDS24_API_CALL","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:54.038Z"
2025-07-26T23:20:54.080178778Z [INFO] [BEDS24_RESPONSE_DETAIL] Respuesta cruda de Beds24 API jsonPayload={"category":"BEDS24_RESPONSE_DETAIL","environment":"cloud-run","firstRoom":{"calendarEntries":2,"name":"Apartamento 2005-A","propertyId":173207,"roomId":378110,"sampleEntry":{"from":"2025-07-26","maxStay":365,"minStay":3,"multiplier":1,"numAvail":0,"override":"none","price1":205000,"to":"2025-07-27"}},"flow":{"stage":"0_unknown"},"level":"INFO","responseSize":1923,"responseStructure":["roomId","propertyId","name","calendar"],"success":true,"timestamp":"2025-07-26T23:20:54.038Z","totalRooms":7} labels={"app":"whatsapp-bot","category":"BEDS24_RESPONSE_DETAIL","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:54.038Z"
2025-07-26T23:20:54.080214010Z [INFO] [BEDS24_DATA_MAPPING] Procesando datos de Beds24 jsonPayload={"beds24DataCount":7,"category":"BEDS24_DATA_MAPPING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","originalEndDate":"2025-07-28","originalStartDate":"2025-07-26","timestamp":"2025-07-26T23:20:54.038Z"} labels={"app":"whatsapp-bot","category":"BEDS24_DATA_MAPPING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:54.038Z"
2025-07-26T23:20:54.080245524Z [INFO] [BEDS24_CLASSIFICATION] Propiedades clasificadas jsonPayload={"category":"BEDS24_CLASSIFICATION","completeOptions":1,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","nightsAnalyzed":2,"partialOptions":1,"timestamp":"2025-07-26T23:20:54.039Z","willGenerateSplits":true} labels={"app":"whatsapp-bot","category":"BEDS24_CLASSIFICATION","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:54.039Z"
2025-07-26T23:20:54.080282813Z [INFO] [BEDS24_RESPONSE_SUMMARY] Encontradas 1 opciones completas y 0 opciones con traslado jsonPayload={"category":"BEDS24_RESPONSE_SUMMARY","completeOptionsDetail":[{"pricePerNight":190000,"propertyName":"Apartamento 1722-A","totalPrice":380000}],"dateRange":"2025-07-26 al 2025-07-28","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","splitOptionsDetail":[],"timestamp":"2025-07-26T23:20:54.040Z","totalNights":2} labels={"app":"whatsapp-bot","category":"BEDS24_RESPONSE_SUMMARY","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:54.040Z"
2025-07-26T23:20:54.080326121Z [INFO] [BEDS24_DEBUG_OUTPUT] Respuesta formateada para OpenAI jsonPayload={"category":"BEDS24_DEBUG_OUTPUT","environment":"cloud-run","estimatedTokens":41,"flow":{"stage":"0_unknown"},"hasCompleteOptions":true,"hasSplitOptions":false,"level":"INFO","responseLength":161,"responsePreview":"üìÖ Disponibilidad: 26/07/2025 al 28/07/2025 (2 noches)\n\n‚úÖ APARTAMENTOS DISPONIBLES (1 Apto Disponible):\nüè† Apartamento 1722-A - $380,000 total ($190,000/noche)\n\n","timestamp":"2025-07-26T23:20:54.046Z"} labels={"app":"whatsapp-bot","category":"BEDS24_DEBUG_OUTPUT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:54.046Z"
2025-07-26T23:20:54.080387965Z [INFO] [BEDS24_RESPONSE_DETAIL] Respuesta completa de Beds24 enviada a OpenAI jsonPayload={"category":"BEDS24_RESPONSE_DETAIL","completeOptionsCount":1,"environment":"cloud-run","estimatedTokens":41,"flow":{"stage":"0_unknown"},"fullResponse":"üìÖ Disponibilidad: 26/07/2025 al 28/07/2025 (2 noches)\n\n‚úÖ APARTAMENTOS DISPONIBLES (1 Apto Disponible):\nüè† Apartamento 1722-A - $380,000 total ($190,000/noche)\n\n","hasCompleteOptions":true,"hasSplitOptions":false,"level":"INFO","responseLength":161,"responsePreview":"üìÖ Disponibilidad: 26/07/2025 al 28/07/2025 (2 noches)\n\n‚úÖ APARTAMENTOS DISPONIBLES (1 Apto Disponible):\nüè† Apartamento 1722-A - $380,000 total ($190,000/noche)\n\n","splitOptionsCount":0,"timestamp":"2025-07-26T23:20:54.046Z","totalNights":2} labels={"app":"whatsapp-bot","category":"BEDS24_RESPONSE_DETAIL","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:54.046Z"
2025-07-26T23:20:54.080423169Z [INFO] [AVAILABILITY_HANDLER] Consulta completada exitosamente jsonPayload={"apiResponseSize":265,"category":"AVAILABILITY_HANDLER","completeOptions":1,"dateAdjusted":false,"dateRange":"2025-07-26 a 2025-07-28","environment":"cloud-run","flow":{"stage":"0_unknown"},"isEfficient":true,"level":"SUCCESS","processingMs":539,"responseSize":265,"splitOptions":0,"timestamp":"2025-07-26T23:20:54.046Z"} labels={"app":"whatsapp-bot","category":"AVAILABILITY_HANDLER","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T23:20:54.046Z"
2025-07-26T23:20:54.080448531Z [INFO] [FUNCTION_HANDLER] function_success jsonPayload={"category":"FUNCTION_HANDLER","environment":"cloud-run","flow":{"stage":"0_unknown"},"functionName":"check_availability","level":"INFO","resultLength":161,"shortUserId":"573003913251","status":"success","timestamp":"2025-07-26T23:20:54.046Z","toolCallId":"call_DO83DiI7X6HWrSqw1hYYwLWq"} labels={"app":"whatsapp-bot","category":"FUNCTION_HANDLER","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:54.046Z"
2025-07-26T23:20:54.698717360Z [INFO] [TOOL_OUTPUTS_SUBMITTED] Tool outputs enviados a OpenAI jsonPayload={"category":"TOOL_OUTPUTS_SUBMITTED","environment":"cloud-run","flow":{"stage":"6_ai_request"},"level":"INFO","outputs":[{"id":"call_DO83DiI7X6HWrSqw1hYYwLWq","outputLength":161,"outputPreview":"üìÖ Disponibilidad: 26/07/2025 al 28/07/2025 (2 noches)\n\n‚úÖ APARTAMENTOS DISPONIBLES (1 Apto Disponibl..."}],"runId":"run_2dT1LNI8uStNZJKu0DPUE8Av","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:20:54.698Z","totalOutputs":1} labels={"app":"whatsapp-bot","category":"TOOL_OUTPUTS_SUBMITTED","flow_stage":"6_ai_request","level":"INFO"} timestamp="2025-07-26T23:20:54.698Z"
2025-07-26T23:20:54.698758137Z [INFO] [POST_SUBMIT_STATUS] Status despu√©s de submit tool outputs jsonPayload={"category":"POST_SUBMIT_STATUS","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_2dT1LNI8uStNZJKu0DPUE8Av","runStatus":"requires_action","shortUserId":"573003913251","timestamp":"2025-07-26T23:20:54.698Z"} labels={"app":"whatsapp-bot","category":"POST_SUBMIT_STATUS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:54.698Z"
2025-07-26T23:20:55.966258620Z [INFO] [POST_TOOL_POLLING] Polling post-tool - Intento 1/10 jsonPayload={"attempt":1,"category":"POST_TOOL_POLLING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_2dT1LNI8uStNZJKu0DPUE8Av","shortUserId":"573003913251","status":"in_progress","timestamp":"2025-07-26T23:20:55.961Z"} labels={"app":"whatsapp-bot","category":"POST_TOOL_POLLING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:55.961Z"
2025-07-26T23:20:56.801434710Z [INFO] [POST_TOOL_POLLING] Polling post-tool - Intento 2/10 jsonPayload={"attempt":2,"category":"POST_TOOL_POLLING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_2dT1LNI8uStNZJKu0DPUE8Av","shortUserId":"573003913251","status":"in_progress","timestamp":"2025-07-26T23:20:56.797Z"} labels={"app":"whatsapp-bot","category":"POST_TOOL_POLLING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:56.797Z"
2025-07-26T23:20:58.152164682Z [INFO] [POST_TOOL_POLLING] Polling post-tool - Intento 3/10 jsonPayload={"attempt":3,"category":"POST_TOOL_POLLING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_2dT1LNI8uStNZJKu0DPUE8Av","shortUserId":"573003913251","status":"completed","timestamp":"2025-07-26T23:20:58.134Z"} labels={"app":"whatsapp-bot","category":"POST_TOOL_POLLING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:58.134Z"
2025-07-26T23:20:58.152197688Z [INFO] [POST_TOOL_POLLING_COMPLETE] Polling post-tool completado jsonPayload={"attempts":2,"category":"POST_TOOL_POLLING_COMPLETE","environment":"cloud-run","finalStatus":"completed","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_2dT1LNI8uStNZJKu0DPUE8Av","shortUserId":"573003913251","timestamp":"2025-07-26T23:20:58.134Z"} labels={"app":"whatsapp-bot","category":"POST_TOOL_POLLING_COMPLETE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:58.134Z"
2025-07-26T23:20:58.283525287Z [INFO] [OPENAI_RESPONSE_RAW_FUNCTION] Respuesta exacta recibida de OpenAI despu√©s de function calling jsonPayload={"category":"OPENAI_RESPONSE_RAW_FUNCTION","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasDoubleAsterisks":false,"level":"INFO","responseLength":455,"responsePreview":"Tenemos disponibilidad para hoy hasta el 28 de julio, dos noches, en el Apartaestudio 1722-B. Este se encuentra en el piso 17 con una preciosa vista al mar y es ideal para dos personas.\n\nEl costo tota...","responseText":"Tenemos disponibilidad para hoy hasta el 28 de julio, dos noches, en el Apartaestudio 1722-B. Este se encuentra en el piso 17 con una preciosa vista al mar y es ideal para dos personas.\n\nEl costo total ser√≠a de $380,000 COP por las dos noches ($190,000 por noche) üòä\n\nAqu√≠ te dejo el enlace con las fotos del apartamento para que le eches un vistazo:\n\nhttps://wa.me/p/4930899063598676/573023371476\n\nD√©jame saber si deseas reservar o si necesitas algo m√°s.","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:20:58.252Z"} labels={"app":"whatsapp-bot","category":"OPENAI_RESPONSE_RAW_FUNCTION","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:58.252Z"
2025-07-26T23:20:58.283562870Z [INFO] [FUNCTION_CALLING_RESPONSE] Respuesta final recibida despu√©s de function calling jsonPayload={"category":"FUNCTION_CALLING_RESPONSE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"SUCCESS","responseLength":455,"shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:20:58.252Z","toolCallsExecuted":1} labels={"app":"whatsapp-bot","category":"FUNCTION_CALLING_RESPONSE","flow_stage":"0_unknown","level":"SUCCESS"} timestamp="2025-07-26T23:20:58.252Z"
ü§ñ OpenAI ‚Üí Sr Alex (0.0s)
2025-07-26T23:20:58.283618415Z [INFO] [VOICE_FORCED_TO_TEXT] Respuesta forzada a texto por contenido sensible (precios/n√∫meros/enlaces) jsonPayload={"category":"VOICE_FORCED_TO_TEXT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","messagePreview":"Tenemos disponibilidad para hoy hasta el 28 de jul","timestamp":"2025-07-26T23:20:58.252Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"VOICE_FORCED_TO_TEXT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:20:58.252Z"
2025-07-26T23:20:58.284181619Z [INFO] [WHATSAPP_SEND_CHUNKS] Enviando mensaje en 5 partes a 573003913251 jsonPayload={"category":"WHATSAPP_SEND_CHUNKS","chatId":"573003913251@s.whatsapp.net","chunks":5,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:20:58.252Z","totalLength":455} labels={"app":"whatsapp-bot","category":"WHATSAPP_SEND_CHUNKS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:20:58.252Z"
2025-07-26T23:21:18.295531434Z [INFO] [QUEUE_ITEM_SUCCESS] Mensaje procesado exitosamente jsonPayload={"category":"QUEUE_ITEM_SUCCESS","environment":"cloud-run","flow":{"sequence":3,"stage":"0_unknown"},"level":"SUCCESS","messageId":"msg_1753572043447_bgg3ouvpb","processedCount":1,"remainingInQueue":0,"timestamp":"2025-07-26T23:21:15.848Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_SUCCESS","flow_stage":"0_unknown","level":"SUCCESS","message_id":"msg_1753572043447_bgg3ouvpb","user_id":"573003913251"} timestamp="2025-07-26T23:21:15.848Z"
2025-07-26T23:21:18.295556880Z [INFO] [LOCK_ALREADY_RELEASED] Lock ya liberado para usuario jsonPayload={"activeLocks":0,"category":"LOCK_ALREADY_RELEASED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"TRACE","timestamp":"2025-07-26T23:21:15.848Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"LOCK_ALREADY_RELEASED","flow_stage":"0_unknown","level":"TRACE","user_id":"573003913251"} timestamp="2025-07-26T23:21:15.848Z"
2025-07-26T23:21:18.295590049Z [INFO] [QUEUE_PROCESSING_COMPLETE] Cola de usuario procesada completamente jsonPayload={"averageTimePerMessage":"32400ms","category":"QUEUE_PROCESSING_COMPLETE","environment":"cloud-run","errorCount":0,"flow":{"stage":"0_unknown"},"initialQueueLength":1,"level":"SUCCESS","processedCount":1,"processingDuration":"32400ms","remainingQueues":0,"timestamp":"2025-07-26T23:21:15.848Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T23:21:15.848Z"
2025-07-26T23:24:08.459024071Z [INFO] [THREAD_PERSIST] 1 threads guardados jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","file":"tmp/threads.json","flow":{"stage":"0_unknown"},"level":"INFO","source":"save_operation","threadsCount":1,"timestamp":"2025-07-26T23:24:05.638Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:05.638Z"
2025-07-26T23:24:08.459054552Z [INFO] [THREAD_PERSIST] Auto-guardado ejecutado (hab√≠a cambios pendientes) jsonPayload={"category":"THREAD_PERSIST","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:24:05.638Z"} labels={"app":"whatsapp-bot","category":"THREAD_PERSIST","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:05.638Z"
2025-07-26T23:24:14.401744376Z [INFO] [PRESENCE_EVENT] Procesando 1 eventos de presencia jsonPayload={"category":"PRESENCE_EVENT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","presenceCount":1,"timestamp":"2025-07-26T23:24:14.396Z"} labels={"app":"whatsapp-bot","category":"PRESENCE_EVENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:14.396Z"
2025-07-26T23:24:14.401799078Z [INFO] [PRESENCE_RECEIVED] Presencia para 573003913251: typing jsonPayload={"category":"PRESENCE_RECEIVED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","status":"typing","timestamp":"2025-07-26T23:24:14.396Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"PRESENCE_RECEIVED","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:24:14.396Z"
2025-07-26T23:24:14.401842375Z [INFO] [BUFFER_TIMER_SET] Timer inteligente configurado jsonPayload={"bufferSize":0,"category":"BUFFER_TIMER_SET","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timerMs":10000,"timestamp":"2025-07-26T23:24:14.396Z","triggerType":"typing","userJid":"573003913251","userName":"573003913251","wasReconfigured":true} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_SET","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:14.396Z"
‚úçÔ∏è 573003913251 est√° escribiendo...
üë§ Sr Alex: "Ok}"
2025-07-26T23:24:15.802057924Z [INFO] [BUFFER_TIMER_RESPECTED] Timer existente respetado (delay actual es suficiente) jsonPayload={"bufferSize":1,"category":"BUFFER_TIMER_RESPECTED","currentDelay":10000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","requestedDelay":5000,"timestamp":"2025-07-26T23:24:15.796Z","triggerType":"message","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"BUFFER_TIMER_RESPECTED","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:15.796Z"
2025-07-26T23:24:15.802089962Z [INFO] [GLOBAL_BUFFER_ADD] Mensaje agregado al buffer global jsonPayload={"bufferSize":1,"category":"GLOBAL_BUFFER_ADD","delay":5000,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isMedia":false,"level":"INFO","messageText":"üìù Ok...","timestamp":"2025-07-26T23:24:15.796Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_ADD","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:15.796Z"
‚è∞ ‚úçÔ∏è Sr Alex dej√≥ de escribir.
2025-07-26T23:24:24.449481204Z [INFO] [GLOBAL_BUFFER_PROCESS] Procesando buffer global despu√©s de 5 segundos jsonPayload={"category":"GLOBAL_BUFFER_PROCESS","combinedText":"üìù Ok...","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","messageCount":1,"timestamp":"2025-07-26T23:24:24.400Z","userJid":"573003913251","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"GLOBAL_BUFFER_PROCESS","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:24.400Z"
2025-07-26T23:24:25.353123997Z [INFO] [QUEUE_ITEM_ADDED] Mensaje agregado a cola de usuario jsonPayload={"category":"QUEUE_ITEM_ADDED","environment":"cloud-run","flow":{"sequence":1,"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","messageId":"msg_1753572265335_0pei7v989","queueLength":1,"timestamp":"2025-07-26T23:24:25.336Z","totalQueues":1,"userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_ADDED","flow_stage":"0_unknown","level":"INFO","message_id":"msg_1753572265335_0pei7v989","user_id":"573003913251"} timestamp="2025-07-26T23:24:25.336Z"
2025-07-26T23:24:25.353159332Z [INFO] [QUEUE_PROCESSING_START] Procesando cola de usuario jsonPayload={"category":"QUEUE_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasActiveLock":false,"level":"INFO","queueLength":1,"timestamp":"2025-07-26T23:24:25.336Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_START","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:24:25.336Z"
2025-07-26T23:24:25.353198447Z [INFO] [QUEUE_ITEM_PROCESSING] Procesando mensaje de cola jsonPayload={"category":"QUEUE_ITEM_PROCESSING","environment":"cloud-run","flow":{"sequence":2,"stage":"0_unknown"},"level":"TRACE","messageId":"msg_1753572265335_0pei7v989","remainingInQueue":0,"timestamp":"2025-07-26T23:24:25.336Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_PROCESSING","flow_stage":"0_unknown","level":"TRACE","message_id":"msg_1753572265335_0pei7v989","user_id":"573003913251"} timestamp="2025-07-26T23:24:25.336Z"
2025-07-26T23:24:26.322870019Z [INFO] [TYPING_INDICATOR_SENT] Typing indicator enviado inmediatamente jsonPayload={"category":"TYPING_INDICATOR_SENT","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:24:26.315Z"} labels={"app":"whatsapp-bot","category":"TYPING_INDICATOR_SENT","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:26.315Z"
2025-07-26T23:24:26.322910834Z [INFO] [THREAD_REUSE] Thread reutilizado para 573003913251 jsonPayload={"category":"THREAD_REUSE","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:24:26.315Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"THREAD_REUSE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:26.315Z"
2025-07-26T23:24:26.322946508Z [INFO] [HISTORY_SKIP] Skip fetch historial: Thread existe jsonPayload={"category":"HISTORY_SKIP","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","reason":"thread_already_exists","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:24:26.315Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"HISTORY_SKIP","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:24:26.315Z"
2025-07-26T23:24:26.322979219Z [INFO] [OPENAI_PROCESSING_START] Procesando mensaje de Sr Alex jsonPayload={"category":"OPENAI_PROCESSING_START","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","timestamp":"2025-07-26T23:24:26.315Z","userName":"Sr Alex"} labels={"app":"whatsapp-bot","category":"OPENAI_PROCESSING_START","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:26.315Z"
2025-07-26T23:24:26.718276915Z [INFO] [CACHE_HIT] Chat info desde cache jsonPayload={"cacheAge":284,"category":"CACHE_HIT","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","timestamp":"2025-07-26T23:24:26.716Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"CACHE_HIT","flow_stage":"0_unknown","level":"INFO","user_id":"573003913251"} timestamp="2025-07-26T23:24:26.716Z"
2025-07-26T23:24:26.718329079Z [INFO] [CONTEXT_DEBUG] Contexto enviado a OpenAI jsonPayload={"category":"CONTEXT_DEBUG","contextPreview":"NO_CONTEXT","contextReason":"no_cambios","contextTokensSaved":-151,"environment":"cloud-run","flow":{"stage":"0_unknown"},"isVoiceMessage":false,"level":"INFO","messagePreview":"üìù Ok","needsTemporalContext":false,"shortUserId":"573003913251","timestamp":"2025-07-26T23:24:26.716Z","totalLength":5} labels={"app":"whatsapp-bot","category":"CONTEXT_DEBUG","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:26.716Z"
2025-07-26T23:24:29.437491484Z [INFO] [OPENAI_POLLING] Esperando... jsonPayload={"attempts":1,"category":"OPENAI_POLLING","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","runId":"run_SQBEVz9395qyV1Hp2yNok7Jx","shortUserId":"573003913251","status":"in_progress","timestamp":"2025-07-26T23:24:29.424Z"} labels={"app":"whatsapp-bot","category":"OPENAI_POLLING","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:29.424Z"
2025-07-26T23:24:30.690750454Z [INFO] [TOKEN_USAGE] Tokens utilizados jsonPayload={"category":"TOKEN_USAGE","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"INFO","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:24:30.688Z","totalTokens":3865} labels={"app":"whatsapp-bot","category":"TOKEN_USAGE","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:30.688Z"
2025-07-26T23:24:30.900146725Z [INFO] [OPENAI_RESPONSE_RAW] Respuesta exacta recibida de OpenAI jsonPayload={"category":"OPENAI_RESPONSE_RAW","environment":"cloud-run","flow":{"stage":"0_unknown"},"hasDoubleAsterisks":false,"level":"INFO","responseLength":163,"responsePreview":"Excelente, ¬øte gustar√≠a proceder con la reserva para el Apartaestudio 1722-B? Si necesitas m√°s informaci√≥n o tienes alguna otra consulta, estoy aqu√≠ para ayudarte.","responseText":"Excelente, ¬øte gustar√≠a proceder con la reserva para el Apartaestudio 1722-B? Si necesitas m√°s informaci√≥n o tienes alguna otra consulta, estoy aqu√≠ para ayudarte.","shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:24:30.885Z"} labels={"app":"whatsapp-bot","category":"OPENAI_RESPONSE_RAW","flow_stage":"0_unknown","level":"INFO"} timestamp="2025-07-26T23:24:30.885Z"
2025-07-26T23:24:30.900196840Z [INFO] [PERFORMANCE_METRICS] Procesamiento completado exitosamente jsonPayload={"category":"PERFORMANCE_METRICS","contextTokens":0,"environment":"cloud-run","flow":{"stage":"9_complete"},"isEfficient":false,"level":"INFO","memory":{"heapTotalMB":33,"heapUsedMB":29,"rssMB":93},"responseLength":163,"shortUserId":"573003913251","threadId":"thread_AB6vVChGkDQx0qsuG3i15TMw","timestamp":"2025-07-26T23:24:30.885Z","tokensPerSecond":846,"totalDurationMs":4570,"totalTokens":3865} labels={"app":"whatsapp-bot","category":"PERFORMANCE_METRICS","flow_stage":"9_complete","level":"INFO"} timestamp="2025-07-26T23:24:30.885Z"
ü§ñ OpenAI ‚Üí Sr Alex (0.0s)
2025-07-26T23:24:30.900260565Z [INFO] [WHATSAPP_SEND] Enviando mensaje a 573003913251 jsonPayload={"category":"WHATSAPP_SEND","chatId":"573003913251@s.whatsapp.net","environment":"cloud-run","flow":{"stage":"8_send"},"level":"INFO","messageLength":163,"preview":"Excelente, ¬øte gustar√≠a proceder con la reserva para el Apartaestudio 1722-B? Si necesitas m√°s infor...","timestamp":"2025-07-26T23:24:30.886Z"} labels={"app":"whatsapp-bot","category":"WHATSAPP_SEND","flow_stage":"8_send","level":"INFO"} timestamp="2025-07-26T23:24:30.886Z"
2025-07-26T23:24:36.612545102Z [INFO] [QUEUE_ITEM_SUCCESS] Mensaje procesado exitosamente jsonPayload={"category":"QUEUE_ITEM_SUCCESS","environment":"cloud-run","flow":{"sequence":3,"stage":"0_unknown"},"level":"SUCCESS","messageId":"msg_1753572265335_0pei7v989","processedCount":1,"remainingInQueue":0,"timestamp":"2025-07-26T23:24:36.608Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_ITEM_SUCCESS","flow_stage":"0_unknown","level":"SUCCESS","message_id":"msg_1753572265335_0pei7v989","user_id":"573003913251"} timestamp="2025-07-26T23:24:36.608Z"
2025-07-26T23:24:36.612572676Z [INFO] [LOCK_ALREADY_RELEASED] Lock ya liberado para usuario jsonPayload={"activeLocks":0,"category":"LOCK_ALREADY_RELEASED","environment":"cloud-run","flow":{"stage":"0_unknown"},"level":"TRACE","timestamp":"2025-07-26T23:24:36.608Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"LOCK_ALREADY_RELEASED","flow_stage":"0_unknown","level":"TRACE","user_id":"573003913251"} timestamp="2025-07-26T23:24:36.608Z"
2025-07-26T23:24:36.612608551Z [INFO] [QUEUE_PROCESSING_COMPLETE] Cola de usuario procesada completamente jsonPayload={"averageTimePerMessage":"11272ms","category":"QUEUE_PROCESSING_COMPLETE","environment":"cloud-run","errorCount":0,"flow":{"stage":"0_unknown"},"initialQueueLength":1,"level":"SUCCESS","processedCount":1,"processingDuration":"11272ms","remainingQueues":0,"timestamp":"2025-07-26T23:24:36.608Z","userId":"573003913251"} labels={"app":"whatsapp-bot","category":"QUEUE_PROCESSING_COMPLETE","flow_stage":"0_unknown","level":"SUCCESS","user_id":"573003913251"} timestamp="2025-07-26T23:24:36.608Z"
