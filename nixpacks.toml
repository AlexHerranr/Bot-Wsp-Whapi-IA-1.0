# Configuración de Nixpacks para Railway
# Este archivo configura el entorno de Railway para soportar Puppeteer y Chromium

[phases.setup]
# Instalar paquetes del sistema necesarios
nixPkgs = ["nodejs-18_x", "chromium", "glib", "nss", "nspr", "atk", "at-spi2-atk", "cups", "drm", "dbus", "expat", "libxcb", "libxkbcommon", "x11", "xorg.libX11", "xorg.libXcomposite", "xorg.libXdamage", "xorg.libXext", "xorg.libXfixes", "xorg.libXrandr", "xorg.libxcb", "cairo", "pango", "alsa-lib"]

[phases.install]
# Instalar dependencias de Node.js
cmds = ["npm ci --only=production"]

[phases.build]
# Compilar la aplicación TypeScript
cmds = ["npm run build"]

[start]
# Comando de inicio con variables de entorno para Puppeteer
cmd = "node dist/app-unified.js"

[variables]
# Variables de entorno para Puppeteer
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD = "true"
PUPPETEER_EXECUTABLE_PATH = "/nix/store/*/bin/chromium"
NODE_OPTIONS = "--max-old-space-size=768"