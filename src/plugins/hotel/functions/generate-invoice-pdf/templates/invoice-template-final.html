<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Confirmación de Reserva – {{bookingId}}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /*
        █████████████████████████████████████████████████████████████████████████████████
        ██ TEMPLATE PDF - CONFIRMACIÓN RESERVA (VERSIÓN FINAL) ██
        █████████████████████████████████████████████████████████████████████████████████
        
        🚨 ELEMENTOS SAGRADOS - NUNCA MODIFICAR:
        ═══════════════════════════════════════════════════════════════════════════════
        1. VARIABLES DINÁMICAS: Todas las referencias {{variable}} son intocables
        2. MÁRGENES PDF: margin: 0.4in (crítico para 1 página Legal 8.5"x14")
        3. ESTRUCTURA {{#if}} {{#each}}: Lógica condicional obligatoria
        4. SELECTORES CSS: .section, .payment-table, etc. son referencias fijas
        5. PRINT STYLES: @media print es esencial para PDF correcto
        
        ⚠️  OPTIMIZACIONES PERMITIDAS:
        - Colores, fonts, espaciado (respetando márgenes)
        - Estilos visuales (shadows, borders, etc.)
        - Contenido HTML fijo (texto, políticas)
        
        ❌ PROHIBIDO CAMBIAR:
        - Variables {{bookingId}}, {{guestName}}, etc.
        - Estructura de tabla con {{#each invoiceItems}}
        - Márgenes de impresión (0.4in = ajuste perfecto)
        - Condicionales {{#if totalPaid}}, etc.
        ═══════════════════════════════════════════════════════════════════════════════
        
        CAMPOS DINÁMICOS (100% desde JSON):
        📥 DE OPENAI: bookingId, guestName, email, dates, roomName, totalCharges, 
                       invoiceItems[], totalPaid, balance, paymentNote
        🏢 DE CONFIG: company.*, policies.*, location.*, fixedItems.*
        📊 CALCULADOS: fechas formateadas, multipleNights, enlaces dinámicos
        
        Versión: 4.3 (Estilos Corregidos)
        Fecha: Agosto 2024
        █████████████████████████████████████████████████████████████████████████████████
        */

        :root {
            --primary-hue: 221;
            --primary-saturation: 83%;
            --primary-lightness: 48%;
            --primary: hsl(var(--primary-hue), var(--primary-saturation), var(--primary-lightness)); /* #1d4ed8 */
            --primary-dark: hsl(var(--primary-hue), 70%, 35%);
            --primary-light: hsl(var(--primary-hue), 90%, 96%);
            
            --success-hue: 158;
            --success: hsl(var(--success-hue), 95%, 34%); /* #059669 */
            
            --warning-hue: 38;
            --warning: hsl(var(--warning-hue), 92%, 50%); /* #f59e0b */
            --warning-light: hsl(var(--warning-hue), 100%, 97%);
            
            --danger-hue: 359;
            --danger: hsl(var(--danger-hue), 71%, 51%); /* #dc2626 */

            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --bg-color: #f8fafc; /* Fondo gris claro para contraste */
            --bg-card: #ffffff; /* Documento en blanco puro */

            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.5;
            padding: 1rem;
        }

        .document-wrapper {
            max-width: 850px;
            margin: 0 auto;
            background-color: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        /* --- HEADER --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2.5rem; /* Espaciado corregido */
            border-bottom: 1px solid var(--border-color);
            /* Transición de degradado corregida */
            background: linear-gradient(270deg, var(--primary-light) 0%, rgba(221, 235, 252, 0.5) 50%, #ffffff 100%);
        }
        .header-logo img {
            max-width: 220px;
            height: auto;
            object-fit: contain;
        }
        .header-title {
            text-align: right;
        }
        .header-title h1 {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-dark);
            letter-spacing: 0.05em;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }
        .header-title p {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            font-family: monospace, sans-serif;
        }

        /* --- CONTENT --- */
        .content {
            padding: 2rem; /* Espaciado corregido */
        }

        /* --- SECTIONS --- */
        .section {
            margin-bottom: 2rem; /* Espaciado corregido */
        }
        .section:last-of-type {
            margin-bottom: 0;
        }
        .section-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }
        .section-icon {
            width: 40px;
            height: 40px;
            display: grid;
            place-items: center;
            background-color: var(--primary-light);
            color: var(--primary);
            border-radius: 10px;
        }
        .section-icon svg {
            width: 22px;
            height: 22px;
        }
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        /* --- INFO GRID --- */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        .info-item .info-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
        .info-item .info-value {
            font-size: 1rem;
            font-weight: 500;
        }
        .info-item .info-value strong {
            font-weight: 700;
        }
        .info-item .info-note {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* --- DATES SECTION --- */
        .dates-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
            background-color: var(--primary-light);
            padding: 1.5rem;
            border-radius: 12px;
        }
        .date-card {
            text-align: center;
            flex: 1;
        }
        .date-card .date-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        .date-card .date-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin: 0.25rem 0;
        }
        .date-card .date-note {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        .date-note .time-highlight {
            color: var(--danger);
            font-weight: 600;
        }
        .duration-badge {
            padding: 0.5rem 1.25rem;
            background-color: var(--primary);
            color: white;
            border-radius: 999px;
            font-weight: 700;
            font-size: 1.1rem;
            white-space: nowrap;
            box-shadow: var(--shadow-md);
        }
        
        /* --- PAYMENT TABLE --- */
        .payment-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        .payment-table th, .payment-table td {
            padding: 0.85rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .payment-table thead th {
            background-color: transparent; /* Corregido según tu preferencia */
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }
        .payment-table tbody tr:last-child td {
            border-bottom: none;
        }
        .payment-table .align-right { text-align: right; }
        .payment-table .align-center { text-align: center; }
        .payment-table .total-row td {
            font-weight: 700;
            font-size: 1.1rem;
            background-color: var(--primary-light);
            color: var(--primary-dark);
        }
        .payment-table .balance-row td {
            font-weight: 700;
            font-size: 1.1rem;
            background-color: #fefce8; /* yellow-50 */
            color: #a16207; /* yellow-700 */
        }
        .payment-table strong { font-weight: 600; }
        .table-note {
            margin-top: 1rem;
            font-size: 0.85rem;
            color: var(--text-muted);
            text-align: right;
        }

        /* --- POLICY SECTION --- */
        .policy-box {
            display: flex;
            gap: 1.25rem;
            align-items: flex-start;
            background-color: var(--warning-light);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid var(--warning);
        }
        .policy-box .policy-icon {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            display: grid;
            place-items: center;
            background-color: var(--warning);
            color: white;
            border-radius: 50%;
        }
        .policy-box .policy-icon svg {
            width: 20px;
            height: 20px;
        }
        .policy-box .policy-text {
            font-size: 0.9rem;
            line-height: 1.7;
        }
        .policy-box p:last-child { margin-bottom: 0; }

        /* --- FOOTER --- */
        .footer {
            padding: 1.5rem 2rem;
            background-color: #0f172a;
            color: #cbd5e1;
            text-align: center;
        }
        .footer .company-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: white;
            margin-bottom: 0.5rem;
        }
        .footer .company-details {
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .footer .contact-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        .footer .contact-links a {
            color: #93c5fd;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.2s ease;
        }
        .footer .contact-links a:hover {
            color: white;
        }

        /* --- PRINT STYLES --- */
        @media print {
            @page {
                size: legal;
                margin: 0.4in; /* Margen crítico para PDF */
            }
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            body {
                padding: 0 !important;
                background-color: #fff !important;
                font-size: 10pt !important;
            }
            .document-wrapper {
                max-width: 100% !important;
                border-radius: 0 !important;
                box-shadow: none !important;
                border: none !important;
                overflow: visible !important;
            }
            .header, .content, .footer {
                padding: 0.8rem !important;
            }
            .header { padding-bottom: 0.8rem !important; }
            .content { padding-top: 1.2rem !important; }

            .header-title h1 { font-size: 22pt !important; }
            .header-title p { font-size: 12pt !important; }
            .header-logo img { max-width: 220px !important; }
            
            .section { margin-bottom: 1.2rem !important; break-inside: avoid; }
            .section-header { margin-bottom: 0.8rem !important; }
            .section-title { font-size: 14pt !important; }
            
            .info-grid { gap: 1rem !important; }
            .info-value { font-size: 10pt !important; }

            .dates-container { padding: 0.8rem !important; }
            .date-value { font-size: 13pt !important; }
            .duration-badge { font-size: 10pt !important; }

            .payment-table { font-size: 9pt !important; }
            .payment-table th, .payment-table td { padding: 0.5rem 0.75rem !important; }
            .payment-table .total-row td, .payment-table .balance-row td { font-size: 10pt !important; }

            .policy-box { padding: 1rem !important; }
            .policy-text { font-size: 9pt !important; }

            .footer { padding: 1.2rem !important; }
        }
    </style>
</head>
<body>
    <div class="document-wrapper" role="document" aria-label="Confirmación de Reserva">

        <!-- Encabezado con logo de la empresa y datos de la reserva -->
        <header class="header">
            <div class="header-logo">
                <img src="{{companyLogo}}" alt="{{companyName}}" onerror="this.style.display='none';">
            </div>
            <div class="header-title">
                <h1>{{templateTitle}}</h1>
                <p>Reserva #{{bookingId}}</p>
            </div>
        </header>

        <!-- Contenido principal del documento -->
        <main class="content">
            <!-- Sección de Fechas de Estadía -->
            <section class="section" aria-labelledby="dates-title">
                <div class="section-header">
                    <div class="section-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg></div>
                    <h2 class="section-title" id="dates-title">Fechas de Estadía</h2>
                </div>
                <div class="dates-container">
                    <div class="date-card">
                        <div class="date-label">Check-in</div>
                        <div class="date-value">{{checkInDateFormatted}}</div>
                        <div class="date-note">{{checkInNote}} <span class="time-highlight">{{checkInTime}}</span></div>
                    </div>
                    <div class="duration-badge">{{nights}} Noche{{#if multipleNights}}s{{/if}}</div>
                    <div class="date-card">
                        <div class="date-label">Check-out</div>
                        <div class="date-value">{{checkOutDateFormatted}}</div>
                        <div class="date-note">{{checkOutNote}} <span class="time-highlight">{{checkOutTime}}</span></div>
                    </div>
                </div>
            </section>

            <!-- Sección de Detalles de la Reserva (Huésped y Apartamento) -->
            <section class="section" aria-labelledby="details-title">
                 <div class="section-header">
                    <div class="section-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></div>
                    <h2 class="section-title" id="details-title">Detalles de la Reserva</h2>
                </div>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Huésped Principal</div>
                        <div class="info-value"><strong>{{guestName}}</strong> ({{guestCount}})</div>
                    </div>
                    {{#if phone}}
                    <div class="info-item">
                        <div class="info-label">Teléfono</div>
                        <div class="info-value">{{phone}}</div>
                    </div>
                    {{/if}}
                    <div class="info-item">
                        <div class="info-label">Correo Electrónico</div>
                        <div class="info-value">{{email}}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Apartamento</div>
                        <div class="info-value"><strong>{{roomName}}</strong></div>
                        {{#if aptDescription}}<div class="info-note">{{aptDescription}}</div>{{/if}}
                    </div>
                </div>
            </section>

            <!-- Sección de Resumen Financiero -->
            <section class="section" aria-labelledby="payment-title">
                <div class="section-header">
                    <div class="section-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg></div>
                    <h2 class="section-title" id="payment-title">Resumen Financiero</h2>
                </div>
                <table class="payment-table">
                    <thead>
                        <tr>
                            <th>Descripción</th>
                            <th class="align-center">Cant.</th>
                            <th class="align-right">Precio Unit.</th>
                            <th class="align-right">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Items dinámicos que vienen de OpenAI (1 o varios) -->
                        {{#each invoiceItems}}
                        <tr>
                            <td><strong>{{description}}</strong></td>
                            <td class="align-center">{{#if quantity}}{{quantity}}{{else}}-{{/if}}</td>
                            <td class="align-right">{{#if unitPrice}}{{unitPrice}}{{else}}-{{/if}}</td>
                            <td class="align-right">{{totalAmount}}</td>
                        </tr>
                        {{/each}}
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td colspan="3"><strong>Total General</strong></td>
                            <td class="align-right"><strong>{{totalCharges}}</strong></td>
                        </tr>
                        <!-- Mostrar anticipo pagado si existe -->
                        {{#if totalPaid}}
                        <tr>
                            <td colspan="3"><strong>Anticipo Pagado</strong></td>
                            <td class="align-right"><strong>{{totalPaid}}</strong></td>
                        </tr>
                        {{/if}}
                        <!-- Mostrar saldo pendiente si existe -->
                        {{#if balance}}
                        <tr class="balance-row">
                            <td colspan="3"><strong>Saldo Pendiente a Pagar</strong></td>
                            <td class="align-right"><strong>{{balance}}</strong></td>
                        </tr>
                        {{/if}}
                    </tfoot>
                </table>
                 <!-- Nota de pago, se muestra si existe -->
                 {{#if paymentNote}}
                 <div class="table-note">{{paymentNote}}</div>
                 {{/if}}
            </section>

            <!-- Sección de Información Importante y Política de Cancelación -->
            <section class="section" aria-labelledby="policy-title">
                <div class="section-header">
                     <div class="section-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></div>
                    <h2 class="section-title" id="policy-title">Información Importante</h2>
                </div>
                <div class="policy-box">
                    <div class="policy-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></div>
                    <div class="policy-text">
                        <p><strong>Política de Cancelación:</strong> {{cancellationPolicy}}</p>
                        <p><strong>A tener en cuenta:</strong> {{servicesNote}}</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Pie de página con información de contacto de la empresa -->
        <footer class="footer">
            <div class="company-name">{{companyName}}</div>
            <div class="company-details">NIT: {{companyNit}} • {{companyAddress}}</div>
            <nav class="contact-links" aria-label="Contacto de la empresa">
                <a href="tel:{{companyPhone}}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>{{companyPhone}}</a>
                <a href="mailto:{{companyEmail}}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>{{companyEmail}}</a>
                <a href="http://{{companyWebsite}}" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>{{companyWebsite}}</a>
            </nav>
        </footer>
    </div>
</body>
</html>